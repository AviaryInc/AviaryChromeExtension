/*
 * Canvas2Image v0.1
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk
 * MIT License [http://www.opensource.org/licenses/mit-license.php]
 *
 * Modified by Aviary to AV namespace; no public vars 
 */typeof AV=="undefined"&&(AV={}),AV.toBitmapURL=function(e){var t=function(t){var n="";if(typeof t=="string")n=t;else{var r=t;for(var i=0;i<r.length;i++)n+=String.fromCharCode(r[i])}return e.btoa(n)},n=function(e){var n=[],r=e.width,i=e.height;n.push(66),n.push(77);var s=r*i*3+54;n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),n.push(0),n.push(0),n.push(0),n.push(0),n.push(54),n.push(0),n.push(0),n.push(0);var o=[];o.push(40),o.push(0),o.push(0),o.push(0);var u=r;o.push(u%256),u=Math.floor(u/256),o.push(u%256),u=Math.floor(u/256),o.push(u%256),u=Math.floor(u/256),o.push(u%256);var a=i;o.push(a%256),a=Math.floor(a/256),o.push(a%256),a=Math.floor(a/256),o.push(a%256),a=Math.floor(a/256),o.push(a%256),o.push(1),o.push(0),o.push(24),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0);var f=r*i*3;o.push(f%256),f=Math.floor(f/256),o.push(f%256),f=Math.floor(f/256),o.push(f%256),f=Math.floor(f/256),o.push(f%256);for(var l=0;l<16;l++)o.push(0);var c=(4-r*3%4)%4,h=e.data,p="",d=i;do{var v=r*(d-1)*4,m="";for(var g=0;g<r;g++){var y=4*g;m+=String.fromCharCode(h[v+y+2]),m+=String.fromCharCode(h[v+y+1]),m+=String.fromCharCode(h[v+y])}for(var b=0;b<c;b++)m+=String.fromCharCode(0);p+=m}while(--d);var w=t(n.concat(o))+t(p);return w};return function(e){var t=e.width,r=e.height;return n(e.getContext("2d").getImageData(0,0,t,r))}}(window);/*
 * Copyright 2012 Small Batch, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
/**
 * Global Aviary namespace object
 */
if (typeof AV == 'undefined') {
	AV = {};
}
;(function(window,document,undefined){
var h=void 0,j=!0,l=null,o=!1;function p(a){return function(){return this[a]}}var q;function r(a,c,b){var d=2<arguments.length?Array.prototype.slice.call(arguments,2):[];return function(){d.push.apply(d,arguments);return c.apply(a,d)}};function s(a){this.F=a;this.U=h}s.prototype.createElement=function(a,c,b){a=this.F.createElement(a);if(c)for(var d in c)c.hasOwnProperty(d)&&("style"==d?u(this,a,c[d]):a.setAttribute(d,c[d]));b&&a.appendChild(this.F.createTextNode(b));return a};function v(a,c,b){a=a.F.getElementsByTagName(c)[0];a||(a=document.documentElement);a&&a.lastChild&&a.insertBefore(b,a.lastChild)}function aa(a){function c(){document.body?a():setTimeout(c,0)}c()}function w(a){a.parentNode&&a.parentNode.removeChild(a)}
function x(a,c){return a.createElement("link",{rel:"stylesheet",href:c})}function y(a,c){return a.createElement("script",{src:c})}function z(a,c){for(var b=a.className.split(/\s+/),d=0,e=b.length;d<e;d++)if(b[d]==c)return;b.push(c);a.className=b.join(" ").replace(/^\s+/,"")}function A(a,c){for(var b=a.className.split(/\s+/),d=[],e=0,g=b.length;e<g;e++)b[e]!=c&&d.push(b[e]);a.className=d.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}
function ba(a,c){for(var b=a.className.split(/\s+/),d=0,e=b.length;d<e;d++)if(b[d]==c)return j;return o}function u(a,c,b){if(a.U===h){var d=a.F.createElement("p");d.innerHTML='<a style="top:1px;">w</a>';a.U=/top/.test(d.getElementsByTagName("a")[0].getAttribute("style"))}a.U?c.setAttribute("style",b):c.style.cssText=b};function B(a,c,b,d,e,g,f,i){this.za=a;this.Fa=c;this.na=b;this.ma=d;this.Ca=e;this.Ba=g;this.la=f;this.Ga=i}q=B.prototype;q.getName=p("za");q.va=p("Fa");q.X=p("na");q.sa=p("ma");q.ta=p("Ca");q.ua=p("Ba");q.ra=p("la");q.w=p("Ga");function C(a,c){this.a=a;this.j=c}var ca=new B("Unknown","Unknown","Unknown","Unknown","Unknown","Unknown",h,o);
C.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE"))if(a=D(this.a,/(MSIE [\d\w\.]+)/,1),""!=a){var c=a.split(" ");a=c[0];c=c[1];a=new B(a,c,a,c,F(this),G(this),H(this.j),6<=I(c))}else a=new B("MSIE","Unknown","MSIE","Unknown",F(this),G(this),H(this.j),o);else if(-1!=this.a.indexOf("Opera"))a:{var c=a="Unknown",b=D(this.a,/(Presto\/[\d\w\.]+)/,1);""!=b?(c=b.split("/"),a=c[0],c=c[1]):(-1!=this.a.indexOf("Gecko")&&(a="Gecko"),b=D(this.a,/rv:([^\)]+)/,1),""!=b&&(c=b));if(-1!=this.a.indexOf("Opera Mini/"))b=
D(this.a,/Opera Mini\/([\d\.]+)/,1),""==b&&(b="Unknown"),a=new B("OperaMini",b,a,c,F(this),G(this),H(this.j),o);else{if(-1!=this.a.indexOf("Version/")&&(b=D(this.a,/Version\/([\d\.]+)/,1),""!=b)){a=new B("Opera",b,a,c,F(this),G(this),H(this.j),10<=I(b));break a}b=D(this.a,/Opera[\/ ]([\d\.]+)/,1);a=""!=b?new B("Opera",b,a,c,F(this),G(this),H(this.j),10<=I(b)):new B("Opera","Unknown",a,c,F(this),G(this),H(this.j),o)}}else if(-1!=this.a.indexOf("AppleWebKit")){a=F(this);c=G(this);b=D(this.a,/AppleWebKit\/([\d\.\+]+)/,
1);""==b&&(b="Unknown");var d="Unknown";-1!=this.a.indexOf("Chrome")||-1!=this.a.indexOf("CrMo")||-1!=this.a.indexOf("CriOS")?d="Chrome":-1!=this.a.indexOf("Safari")?d="Safari":-1!=this.a.indexOf("AdobeAIR")&&(d="AdobeAIR");var e="Unknown";-1!=this.a.indexOf("Version/")?e=D(this.a,/Version\/([\d\.\w]+)/,1):"Chrome"==d?e=D(this.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):"AdobeAIR"==d&&(e=D(this.a,/AdobeAIR\/([\d\.]+)/,1));var g=o;"AdobeAIR"==d?(g=D(e,/\d+\.(\d+)/,1),g=2<I(e)||2==I(e)&&5<=parseInt(g,10)):
(g=D(b,/\d+\.(\d+)/,1),g=526<=I(b)||525<=I(b)&&13<=parseInt(g,10));a=new B(d,e,"AppleWebKit",b,a,c,H(this.j),g)}else-1!=this.a.indexOf("Gecko")?(c=a="Unknown",d=o,-1!=this.a.indexOf("Firefox")?(a="Firefox",b=D(this.a,/Firefox\/([\d\w\.]+)/,1),""!=b&&(d=D(b,/\d+\.(\d+)/,1),c=b,d=""!=b&&3<=I(b)&&5<=parseInt(d,10))):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),b=D(this.a,/rv:([^\)]+)/,1),""==b?b="Unknown":d||(d=I(b),e=parseInt(D(b,/\d+\.(\d+)/,1),10),g=parseInt(D(b,/\d+\.\d+\.(\d+)/,1),10),d=1<d||1==
d&&9<e||1==d&&9==e&&2<=g||b.match(/1\.9\.1b[123]/)!=l||b.match(/1\.9\.1\.[\d\.]+/)!=l),a=new B(a,c,"Gecko",b,F(this),G(this),H(this.j),d)):a=ca;return a};function F(a){var c=D(a.a,/(iPod|iPad|iPhone|Android)/,1);if(""!=c)return c;a=D(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1);return""!=a?("Mac_PowerPC"==a&&(a="Macintosh"),a):"Unknown"}
function G(a){var c=D(a.a,/(OS X|Windows NT|Android|CrOS) ([^;)]+)/,2);if(c||(c=D(a.a,/(iPhone )?OS ([\d_]+)/,2)))return c;return(a=D(a.a,/Linux ([i\d]+)/,1))?a:"Unknown"}function I(a){a=D(a,/(\d+)/,1);return""!=a?parseInt(a,10):-1}function D(a,c,b){return(a=a.match(c))&&a[b]?a[b]:""}function H(a){if(a.documentMode)return a.documentMode};function da(a,c,b){this.c=a;this.g=c;this.V=b;this.k="wf";this.h=new fa("-")}function ga(a){z(a.g,a.h.e(a.k,"loading"));J(a,"loading")}function K(a){A(a.g,a.h.e(a.k,"loading"));ba(a.g,a.h.e(a.k,"active"))||z(a.g,a.h.e(a.k,"inactive"));J(a,"inactive")}function J(a,c,b,d){if(a.V[c])a.V[c](b,d)};function ha(){this.ea={}}function ia(a,c){var b=[],d;for(d in c)if(c.hasOwnProperty(d)){var e=a.ea[d];e&&b.push(e(c[d]))}return b};function L(a,c,b,d,e){this.c=a;this.A=c;this.n=b;this.u=d;this.D=e;this.L=0;this.ia=this.da=o}L.prototype.watch=function(a,c,b,d,e){for(var g=a.length,f=0;f<g;f++){var i=a[f];c[i]||(c[i]=["n4"]);this.L+=c[i].length}e&&(this.da=e);for(f=0;f<g;f++)for(var i=a[f],e=c[i],m=b[i],k=0,n=e.length;k<n;k++){var E=e[k],t=this.A,P=i,ea=E;z(t.g,t.h.e(t.k,P,ea,"loading"));J(t,"fontloading",P,ea);t=r(this,this.oa);P=r(this,this.pa);(new d(t,P,this.c,this.n,this.u,this.D,i,E,m)).start()}};
L.prototype.oa=function(a,c){var b=this.A;A(b.g,b.h.e(b.k,a,c,"loading"));A(b.g,b.h.e(b.k,a,c,"inactive"));z(b.g,b.h.e(b.k,a,c,"active"));J(b,"fontactive",a,c);this.ia=j;ja(this)};L.prototype.pa=function(a,c){var b=this.A;A(b.g,b.h.e(b.k,a,c,"loading"));ba(b.g,b.h.e(b.k,a,c,"active"))||z(b.g,b.h.e(b.k,a,c,"inactive"));J(b,"fontinactive",a,c);ja(this)};
function ja(a){0==--a.L&&a.da&&(a.ia?(a=a.A,A(a.g,a.h.e(a.k,"loading")),A(a.g,a.h.e(a.k,"inactive")),z(a.g,a.h.e(a.k,"active")),J(a,"active")):K(a.A))};function M(a,c,b,d,e,g,f,i,m){this.I=a;this.Z=c;this.c=b;this.n=d;this.u=e;this.D=g;this.ya=new ka;this.v=new N;this.M=f;this.B=i;this.qa=m||"BESbswy";this.P=la(this,"arial,'URW Gothic L',sans-serif");this.Q=la(this,"Georgia,'Century Schoolbook L',serif");this.ba=this.P;this.ca=this.Q;this.R=O(this,"arial,'URW Gothic L',sans-serif");this.S=O(this,"Georgia,'Century Schoolbook L',serif")}M.prototype.start=function(){this.ha=this.D();this.K()};
M.prototype.K=function(){var a=this.n.p(this.R),c=this.n.p(this.S);(this.P!=a||this.Q!=c)&&this.ba==a&&this.ca==c?Q(this,this.I):5E3<=this.D()-this.ha?Q(this,this.Z):(this.ba=a,this.ca=c,ma(this))};function ma(a){a.u(function(a,b){return function(){b.call(a)}}(a,a.K),25)}function Q(a,c){w(a.R);w(a.S);c(a.M,a.B)}function la(a,c){var b=O(a,c,j),d=a.n.p(b);w(b);return d}function O(a,c,b){c=a.c.createElement("span",{style:R(a,c,a.B,b)},a.qa);v(a.c,"body",c);return c}
function R(a,c,b,d){b=a.v.expand(b);return"position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;font-family:"+(d?"":a.ya.quote(a.M)+",")+c+";"+b};function S(a,c,b,d,e){this.c=a;this.W=c;this.g=b;this.u=d;this.a=e;this.N=this.O=0}S.prototype.q=function(a,c){this.W.ea[a]=c};S.prototype.load=function(a){var c=new da(this.c,this.g,a);this.a.w()?na(this,c,a):K(c)};S.prototype.wa=function(a,c,b,d){var e=a.Y?a.Y():M;d?a.load(r(this,this.Aa,c,b,e)):(a=0==--this.O,this.N--,a&&(0==this.N?K(c):ga(c)),b.watch([],{},{},e,a))};
S.prototype.Aa=function(a,c,b,d,e,g){var f=0==--this.O;f&&ga(a);this.u(r(this,function(a,b,c,d,e,g){a.watch(b,c||{},d||{},e,g)},c,d,e,g,b,f))};function na(a,c,b){b=ia(a.W,b);a.N=a.O=b.length;for(var d=new L(a.c,c,{p:function(a){return a.offsetWidth}},a.u,function(){return(new Date).getTime()}),e=0,g=b.length;e<g;e++){var f=b[e];f.z(a.a,r(a,a.wa,f,c,d))}};function fa(a){this.xa=a||"-"}fa.prototype.e=function(a){for(var c=[],b=0;b<arguments.length;b++)c.push(arguments[b].replace(/[\W_]+/g,"").toLowerCase());return c.join(this.xa)};function ka(){this.ga="'"}ka.prototype.quote=function(a){for(var c=[],a=a.split(/,\s*/),b=0;b<a.length;b++){var d=a[b].replace(/['"]/g,"");-1==d.indexOf(" ")?c.push(d):c.push(this.ga+d+this.ga)}return c.join(",")};function N(){this.H=oa;this.o=pa}var oa=["font-style","font-weight"],pa={"font-style":[["n","normal"],["i","italic"],["o","oblique"]],"font-weight":[["1","100"],["2","200"],["3","300"],["4","400"],["5","500"],["6","600"],["7","700"],["8","800"],["9","900"],["4","normal"],["7","bold"]]};function T(a,c,b){this.$=a;this.Da=c;this.o=b}T.prototype.compact=function(a,c){for(var b=0;b<this.o.length;b++)if(c==this.o[b][1]){a[this.$]=this.o[b][0];break}};
T.prototype.expand=function(a,c){for(var b=0;b<this.o.length;b++)if(c==this.o[b][0]){a[this.$]=this.Da+":"+this.o[b][1];break}};N.prototype.compact=function(a){for(var c=["n","4"],a=a.split(";"),b=0,d=a.length;b<d;b++){var e=a[b].replace(/\s+/g,"").split(":");if(2==e.length){var g=e[1];a:{for(var e=e[0],f=0;f<this.H.length;f++)if(e==this.H[f]){e=new T(f,e,this.o[e]);break a}e=l}e&&e.compact(c,g)}}return c.join("")};
N.prototype.expand=function(a){if(2!=a.length)return l;for(var c=[l,l],b=0,d=this.H.length;b<d;b++){var e=this.H[b];(new T(b,e,this.o[e])).expand(c,a.substr(b,1))}return c[0]&&c[1]?c.join(";")+";":l};var U=window.AV.WebFont=function(){var a=(new C(navigator.userAgent,document)).parse();return new S(new s(document),new ha,document.documentElement,function(a,b){setTimeout(a,b)},a)}();U.load=U.load;U.addModule=U.q;B.prototype.getName=B.prototype.getName;B.prototype.getVersion=B.prototype.va;B.prototype.getEngine=B.prototype.X;B.prototype.getEngineVersion=B.prototype.sa;B.prototype.getPlatform=B.prototype.ta;B.prototype.getPlatformVersion=B.prototype.ua;B.prototype.getDocumentMode=B.prototype.ra;
B.prototype.isSupportingWebFont=B.prototype.w;function V(a,c,b){this.m=a;this.c=c;this.d=b;this.f=[];this.s={};this.v=new N}V.prototype.C=function(a){return("https:"==this.m.location.protocol?"https:":"http:")+(this.d.api||"//f.fontdeck.com/s/css/js/")+this.m.document.location.hostname+"/"+a+".js"};
V.prototype.z=function(a,c){var b=this.d.id,d=this;b?(this.m.__webfontfontdeckmodule__||(this.m.__webfontfontdeckmodule__={}),this.m.__webfontfontdeckmodule__[b]=function(a,b){for(var f=0,i=b.fonts.length;f<i;++f){var m=b.fonts[f];d.f.push(m.name);d.s[m.name]=[d.v.compact("font-weight:"+m.weight+";font-style:"+m.style)]}c(a)},v(this.c,"head",y(this.c,this.C(b)))):c(j)};V.prototype.load=function(a){a(this.f,this.s)};U.q("fontdeck",function(a){return new V(window,new s(document),a)});function W(a,c){this.c=a;this.d=c}var qa={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};W.prototype.z=function(a,c){return c(a.w())};
W.prototype.load=function(a){var c,b;v(this.c,"head",x(this.c,("https:"==document.location.protocol?"https:":"http:")+"//webfonts.fontslive.com/css/"+this.d.key+".css"));var d=this.d.families,e,g;e=[];g={};for(var f=0,i=d.length;f<i;f++){b=b=c=h;b=d[f].split(":");c=b[0];if(b[1]){b=b[1].split(",");for(var m=[],k=0,n=b.length;k<n;k++){var E=b[k];if(E){var t=qa[E];m.push(t?t:E)}}b=m}else b=["n4"];e.push(c);g[c]=b}a(e,g)};U.q("ascender",function(a){return new W(new s(document),a)});function ra(a,c){this.c=a;this.d=c}ra.prototype.load=function(a){for(var c=this.d.urls||[],b=this.d.families||[],d=0,e=c.length;d<e;d++)v(this.c,"head",x(this.c,c[d]));a(b)};ra.prototype.z=function(a,c){return c(a.w())};U.q("custom",function(a){return new ra(new s(document),a)});function X(a,c,b,d,e){this.m=a;this.a=c;this.c=b;this.j=d;this.d=e;this.f=[];this.s={}}X.prototype.z=function(a,c){var b=this,d=b.d.projectId;if(d){var e=y(b.c,b.C(d));e.id="__MonotypeAPIScript__"+d;e.onreadystatechange=function(a){if("loaded"===e.readyState||"complete"===e.readyState)e.onreadystatechange=l,e.onload(a)};e.onload=function(){if(b.m["__mti_fntLst"+d]){var e=b.m["__mti_fntLst"+d]();if(e&&e.length){var f;for(f=0;f<e.length;f++)b.f.push(e[f].fontfamily)}}c(a.w())};v(this.c,"head",e)}else c(j)};
X.prototype.C=function(a){var c=this.protocol(),b=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+b+"/"+a+".js"};X.prototype.load=function(a){a(this.f,this.s)};X.prototype.protocol=function(){var a=["http:","https:"],c=a[0];if(this.j&&this.j.location&&this.j.location.protocol)for(var b=0,b=0;b<a.length;b++)if(this.j.location.protocol===a[b])return this.j.location.protocol;return c};
U.q("monotype",function(a){var c=(new C(navigator.userAgent,document)).parse();return new X(window,c,new s(document),document,a)});function Y(a,c,b){this.m=a;this.c=c;this.d=b;this.f=[];this.s={}}Y.prototype.C=function(a){var c="https:"==window.location.protocol?"https:":"http:";return(this.d.api||c+"//use.typekit.com")+"/"+a+".js"};Y.prototype.z=function(a,c){var b=this.d.id,d=this.d,e=this;b?(this.m.__webfonttypekitmodule__||(this.m.__webfonttypekitmodule__={}),this.m.__webfonttypekitmodule__[b]=function(b){b(a,d,function(a,b,d){e.f=b;e.s=d;c(a)})},v(this.c,"head",y(this.c,this.C(b)))):c(j)};
Y.prototype.load=function(a){a(this.f,this.s)};U.q("typekit",function(a){return new Y(window,new s(document),a)});function Z(a,c,b,d,e,g,f,i,m){Z.Ea.call(this,a,c,b,d,e,g,f,i,m);a=["Times New Roman","Arial","Times","Sans","Serif"];c=a.length;b={};d=O(this,a[0],j);b[this.n.p(d)]=j;for(e=1;e<c;e++)g=a[e],u(this.c,d,R(this,g,this.B,j)),b[this.n.p(d)]=j,"4"!=this.B[1]&&(u(this.c,d,R(this,g,this.B[0]+"4",j)),b[this.n.p(d)]=j);w(d);this.t=b;this.ka=o}(function(a,c){function b(){}b.prototype=a.prototype;c.prototype=new b;c.Ea=a;c.Ha=a.prototype})(M,Z);var sa={Arimo:j,Cousine:j,Tinos:j};
Z.prototype.K=function(){var a=this.n.p(this.R),c=this.n.p(this.S);!this.ka&&a==c&&this.t[a]&&(this.t={},this.ka=this.t[a]=j);(this.P!=a||this.Q!=c)&&!this.t[a]&&!this.t[c]?Q(this,this.I):5E3<=this.D()-this.ha?this.t[a]&&this.t[c]&&sa[this.M]?Q(this,this.I):Q(this,this.Z):ma(this)};function ta(a){this.J=a?a:("https:"==window.location.protocol?"https:":"http:")+ua;this.f=[];this.T=[]}var ua="//fonts.googleapis.com/css";ta.prototype.e=function(){if(0==this.f.length)throw Error("No fonts to load !");if(-1!=this.J.indexOf("kit="))return this.J;for(var a=this.f.length,c=[],b=0;b<a;b++)c.push(this.f[b].replace(/ /g,"+"));a=this.J+"?family="+c.join("%7C");0<this.T.length&&(a+="&subset="+this.T.join(","));return a};function va(a){this.f=a;this.fa=[];this.ja={};this.G={};this.v=new N}var wa={ultralight:"n2",light:"n3",regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",ul:"n2",l:"n3",r:"n4",b:"n7",i:"i4",bi:"i7"},xa={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"};
va.prototype.parse=function(){for(var a=this.f.length,c=0;c<a;c++){var b=this.f[c].split(":"),d=b[0].replace(/\+/g," "),e=["n4"];if(2<=b.length){var g;var f=b[1];g=[];if(f)for(var f=f.split(","),i=f.length,m=0;m<i;m++){var k;k=f[m];if(k.match(/^[\w ]+$/)){var n=wa[k];n?k=n:(n=k.match(/^(\d*)(\w*)$/),k=n[1],n=n[2],k=(k=this.v.expand([n?n:"n",k?k.substr(0,1):"4"].join("")))?this.v.compact(k):l)}else k="";k&&g.push(k)}0<g.length&&(e=g);3==b.length&&(b=b[2],g=[],b=!b?g:b.split(","),0<b.length&&(b=xa[b[0]])&&
(this.G[d]=b))}this.G[d]||(b=xa[d])&&(this.G[d]=b);this.fa.push(d);this.ja[d]=e}};function $(a,c,b){this.a=a;this.c=c;this.d=b}$.prototype.z=function(a,c){c(a.w())};$.prototype.Y=function(){return"AppleWebKit"==this.a.X()?Z:M};$.prototype.load=function(a){"MSIE"==this.a.getName()&&this.d.blocking!=j?aa(r(this,this.aa,a)):this.aa(a)};
$.prototype.aa=function(a){for(var c=this.c,b=new ta(this.d.api),d=this.d.families,e=d.length,g=0;g<e;g++){var f=d[g].split(":");3==f.length&&b.T.push(f.pop());var i="";2==f.length&&""!=f[1]&&(i=":");b.f.push(f.join(i))}d=new va(d);d.parse();v(c,"head",x(c,b.e()));a(d.fa,d.ja,d.G)};U.q("google",function(a){var c=(new C(navigator.userAgent,document)).parse();return new $(c,new s(document),a)});window.WebFontConfig&&U.load(window.WebFontConfig);
})(this,document);
(function(){function H(g){throw g;}var I=void 0,Q=!0,R=null,V=!1;function Z(g,q){var a=Z.j(g,q||"/"),l=Z.i[a];l||H(Error("Failed to resolve module "+g+", tried "+a));return(a=Z.l[a])?a.e:l()}Z.Aa=[];Z.i={};Z.l={};Z.q=[".js",".coffee",".json"];Z.o={assert:Q,events:Q,fs:Q,path:Q,vm:Q};
Z.j=function(g,q){function a(b){b=c.normalize(b);if(Z.i[b])return b;for(var d=0;d<Z.q.length;d++){var f=Z.q[d];if(Z.i[b+f])return b+f}}function l(b){var b=b.replace(/\/+$/,""),d=c.normalize(b+"/package.json");if(Z.i[d]){var d=Z.i[d](),f=d.ta;if("object"===typeof f&&f.n){if(d=a(c.j(b,f.n)))return d}else if("string"===typeof f){if(d=a(c.j(b,f)))return d}else if(d.n&&(d=a(c.j(b,d.n))))return d}return a(b+"/index")}q||(q="/");if(Z.o[g])return g;var c=Z.i.path(),e=(q=c.j("/",q))||"/";if(g.match(/^(?:\.\.?\/|\/)/)){var k=
a(c.j(e,g))||l(c.j(e,g));if(k)return k}a:{for(var k="/"===e?[""]:c.normalize(e).split("/"),e=[],b=k.length-1;0<=b;b--)if("node_modules"!==k[b]){var o=k.slice(0,b+1).join("/")+"/node_modules";e.push(o)}for(k=0;k<e.length;k++){b=e[k];if(o=a(b+"/"+g)){e=o;break a}if(b=l(b+"/"+g)){e=b;break a}}e=(o=a(g))?o:I}if(e)return e;H(Error("Cannot find module '"+g+"'"))};
Z.oa=function(g,q){var a=Z.i.path(),l=R;try{l=Z.j(g+"/package.json","/")}catch(c){l=Z.j(g,"/")}for(var a=a.dirname(l),l=(Object.keys||function(b){var c=[],k;for(k in b)c.push(k);return c})(Z.i),e=0;e<l.length;e++){var k=l[e];k.slice(0,a.length+1)===a+"/"?(k=k.slice(a.length),Z.i[q+k]=Z.i[a+k]):k===a&&(Z.i[q]=Z.i[a])}};var ia={},ja="undefined"!==typeof window?window:{},ka=V;
Z.d=function(g,q){function a(e){var k=Z(e,l);if((e=Z.l[Z.j(e,l)])&&e.parent===R)e.parent=c;return k}!ka&&Z.i.z&&(ia=Z.i.z(),ka=Q);var l=Z.o[g]?"":Z.i.path().dirname(g);a.j=function(c){return Z.j(c,l)};a.i=Z.i;a.d=Z.d;a.l=Z.l;var c={id:g,filename:g,e:{},loaded:V,parent:R};Z.i[g]=function(){Z.l[g]=c;q.call(c.e,a,c,c.e,l,g,ia,ja);c.loaded=Q;return c.e}};
Z.d("path",function(g,q,a,l,c,e){function k(b,d){for(var c=[],k=0;k<b.length;k++)d(b[k],k,b)&&c.push(b[k]);return c}function b(b,d){for(var c=0,k=b.length;0<=k;k--){var h=b[k];"."==h?b.splice(k,1):".."===h?(b.splice(k,1),c++):c&&(b.splice(k,1),c--)}if(d)for(;c--;c)b.unshift("..");return b}var o=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;a.j=function(){for(var c="",d=V,f=arguments.length;-1<=f&&!d;f--){var o=0<=f?arguments[f]:e.aa();"string"===typeof o&&o&&(c=o+"/"+c,d="/"===o.charAt(0))}c=b(k(c.split("/"),
function(h){return!!h}),!d).join("/");return(d?"/":"")+c||"."};a.normalize=function(c){var d="/"===c.charAt(0),e="/"===c.slice(-1),c=b(k(c.split("/"),function(d){return!!d}),!d).join("/");!c&&!d&&(c=".");c&&e&&(c+="/");return(d?"/":"")+c};a.join=function(){var b=Array.prototype.slice.call(arguments,0);return a.normalize(k(b,function(d){return d&&"string"===typeof d}).join("/"))};a.dirname=function(b){return(b=o.exec(b)[1]||"")?1===b.length?b:b.substring(0,b.length-1):"."};a.qa=function(b,d){var c=
o.exec(b)[2]||"";d&&c.substr(-1*d.length)===d&&(c=c.substr(0,c.length-d.length));return c};a.wa=function(b){return o.exec(b)[3]||""}});
Z.d("__browserify_process",function(g,q,a,l,c,e){e=q.e={};e.za=function(){if("undefined"!==typeof window&&window.ma)return function(b){return window.ma(b)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var b=[];window.addEventListener("message",function(c){c.source===window&&"browserify-tick"===c.data&&(c.stopPropagation(),0<b.length&&b.shift()())},Q);return function(c){b.push(c);window.postMessage("browserify-tick","*")}}return function(b){setTimeout(b,0)}}();e.title=
"browser";e.sa=Q;e.va={};e.pa=[];e.ra=function(b){if("evals"===b)return g("vm");H(Error("No such module. (Possibly not yet loaded)"))};var k="/",b;e.aa=function(){return k};e.ua=function(c){b||(b=g("path"));k=b.j(c,k)}});
Z.d("/src/js/processors/tools/enhance.js",function(g,q){function a(b,c,k,h){var n,p,i,r,u,z;for(p=0;p<k;p++)for(n=0;n<c;n++)i=c*p+n,r=b[4*i],u=b[4*i+1],z=b[4*i+2],h[i]=0.2*r+0.7*u+0.1*z,0<n&&(h[i]+=h[c*p+n-1]),0<p&&(h[i]+=h[c*(p-1)+n]),0<p&&0<n&&(h[i]-=h[c*(p-1)+n-1])}function l(b,c){for(var k=[],h=b.length,n=0;n<h;n++){for(var p=0,i=0,r=0;r<h;r++)var u=Math.exp(-(r-n)*(r-n)/(2*c*c)),p=p+u*b[r],i=i+u;p/=i;k[n]=p}return k}function c(b,c){if(0>=c)return 0;if(1<=c)return 255;for(var k=0;c>b[k];)k++;
return 0===k?c/b[k]:k-1+(c-b[k-1])/(b[k]-b[k-1])}function e(b){for(var c=0,k=0;256>k;k++)c+=b[k];k=Array(256);k[0]=b[0]/c;for(var h=1;256>h;h++)k[h]=b[h]/c+k[h-1];return k}function k(b){var c=[],k=[],h=[],n=[],p,i;for(p=0;256>p;p++)k[p]=0,h[p]=0,n[p]=0;p=0;for(i=b.length;p<i;p+=4)k[b[p]]++,h[b[p+1]]++,n[b[p+2]]++;c[0]=k;c[1]=h;c[2]=n;return c}var b={};g("../colorConversion");var o=g("../histogramMapping"),j=g("../copy");b.nightenhance=function(b,f,o){var h=f*o,n=k(b),p=e(n[0]),i=e(n[1]),r=e(n[2]),
u=c(p,0),z=c(p,1),p=c(i,0),x=c(i,1),i=c(r,0),t=c(r,1),u=Math.pow(u,0.7),p=Math.pow(p,0.7),i=Math.pow(i,0.7),z=255-Math.pow(255-z,0.7),x=255-Math.pow(255-x,0.7),t=255-Math.pow(255-t,0.7),r=255/(z-u),z=255/(x-p),x=255/(t-i),j=0,t=[],a;for(a=0;256>a;a++)j+=0.213*n[0][a]+0.715*n[1][a]+0.072*n[2][a],t[a]=j/h,t[a]=0===a?1:255*(t[a]/a),t[a]=1<t[a]?Math.pow(t[a],0.65):1/Math.pow(1/t[a],0.65);t=l(t,4);for(a=f*o;a--;)h=b[4*a],n=b[4*a+1],j=b[4*a+2],f=t[0.213*h+0.715*n+0.072*j|0],o=f*n+0.5|0,h=(h+0.8*(h*f-h)+
(o-n)*(1-0.8)-u)*r+0.5|0,j=(j+0.8*(j*f-j)+(o-n)*(1-0.8)-i)*x+0.5|0,n=(o-p)*z+0.5|0,255<h?h=255:0>h&&(h=0),255<n?n=255:0>n&&(n=0),255<j?j=255:0>j&&(j=0),b[4*a]=h,b[4*a+1]=n,b[4*a+2]=j,b[4*a+3]=b[4*a+3]};b.localcontrastenhance=function(b,c,e){var h=k(b),n=[],p=c*e,i=0,r;for(r=0;256>r;r++)i+=h[1][r],n[r]=i/p,n[r]=0===r?1:n[r]/(r/255),n[r]=1<n[r]?Math.pow(n[r],0.33):1/Math.pow(1/n[r],0);n=l(n,15);for(r=0;256>r;r++)n[r]*=r/255,n[r]=255*n[r]+0.5|0;var u={r:n,g:n,b:n},n={blurAmount:120,sharpenVal:0.3,gain:0.6},
p=n.blurAmount,h=n.gain,n=n.sharpenVal,p=Math.round(p*((c+e)/1600)/5/2),i=[];a(b,c,e,i);var z=j.copy(b);r=[];o.mapHist(z,u);a(z,c,e,r);var x,t,P,D,s,C,O,g,v,q;for(C=0;C<e;C++)for(s=0;s<c;s++)u=4*(c*C+s),O=b[u],g=b[u+1],v=b[u+2],t=s-p,x=C-p,P=s+p,D=C+p,t=0>t?0:t>c-1?c-1:t,x=0>x?0:x>e-1?e-1:x,P=0>P?0:P>c-1?c-1:P,D=0>D?0:D>e-1?e-1:D,q=(D-x)*(P-t),z=(i[P+c*D]+i[t+c*x]-i[t+c*D]-i[P+c*x])/q,x=(r[P+c*D]+r[t+c*x]-r[t+c*D]-r[P+c*x])/q,t=x-z,P=0===z?x:x/z,x=0.2*O+0.7*g+0.1*v,O+=n*(x-z),g+=n*(x-z),v+=n*(x-z),
O=h*O*P+(1-h)*(O+t),g=h*g*P+(1-h)*(g+t),v=h*v*P+(1-h)*(v+t),b[u]=255<O?255:0>O?0:O+0.5|0,b[u+1]=255<g?255:0>g?0:g+0.5|0,b[u+2]=255<v?255:0>v?0:v+0.5|0};b.labcorrect=function(b,k,o){for(var h=0,n=0,p=[],i=[],r=[],n=[],n=0;256>n;n++)p[n]=0,i[n]=0,r[n]=0;var n=[0,0.030352698354883748,0.060705396709767497,0.09105809506465125,0.12141079341953499,0.15176349177441875,0.1821161901293025,0.21246888848418624,0.24282158683906999,0.27317428519395376,0.3035269835488375,0.3346535763899161,0.3676507324047436,0.40247170184963066,
0.43914420374102936,0.4776953480693729,0.5181516702338386,0.5605391624202722,0.6048833022857054,0.6512090792594475,0.6995410187265387,0.7499032043226175,0.8023192985384995,0.8568125618069307,0.9134058702220788,0.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,
2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,2.8426039504420793,2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,
5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,7.036009569659588,7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,
11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,13.563332965520566,13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,
20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,22.32279573168085,22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,
30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,33.71636150483304,34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,
45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,48.514994005607036,49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,
62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,66.5387298282272,67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,
83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,88.79231178819663,89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100],u=[0,0.09924488254695861,0.12504071661525748,0.14313588920856027,0.1575414309575025,0.16970636198605316,0.18033991980928551,0.18984863055466036,
0.19848976509391722,0.20643767470661487,0.21381661776730748,0.2207186428753261,0.22721406110407222,0.2333579349114362,0.2391942859295316,0.24475892765281868,0.2500814332305149,0.25518653946003345,0.2600951718542145,0.26482520821552014,0.26939205754235684,0.27380910584090884,0.27808806426285243,0.2822392443945425,0.28627177841712054,0.2901937969941595,0.2940125743549161,0.2977346476408758,0.3013659158571899,0.30491172251223664,0.3083769250994826,0.311765953881872,0.315082861915005,0.31833136784577337,
0.32151489271552486,0.3246365917579799,0.3276993819951494,0.33070596628701154,0.3336588543735265,0.336560381353843,0.3394127239721063,0.34221791501818183,0.3449778561018543,0.34769432901832303,0.350369005889286,0.3530034582361798,0.3555991651191077,0.35815752045576577,0.360679839618571,0.3631673653946448,0.36562127338186107,0.3680426768844678,0.37043263136354043,0.37279213849048415,0.3751221498457724,0.3774235702999315,0.3796972611093207,0.38194404275540383,0.38416469755287136,0.3863599720490726,
0.38853057923469275,0.3906772005834086,0.39280048793632477,0.3949010652453065,0.39697953018783444,0.3990364556647021,0.40107239119071786,0.4030878641875543,0.40508338118698156,0.40705942895191655,0.4090164755220073,0.41095497118983254,0.41287534941322973,0.41477802766875577,0.41666340825083015,0.41853187902070177,0.4203838141090141,0.4222195745754141,0.42403950902835275,0.4258439542079576,0.42763323553461496,0.4294076676256808,0.4311675547825421,0.43291319145006824,0.43464486265033075,0.43636284439232104,
0.43806740405925904,0.439758800774965,0.44143728575065216,0.4431031026133969,0.44475648771744863,0.4463976704394558,0.44802687345860653,0.4496443130226092,0.45125019920037296,0.4528447361221874,0.45442812220814444,0.4560005503854936,0.45756220829557587,0.4591132784909362,0.46065393862317483,0.46218436162206117,0.4637047158663982,0.4652151653470947,0.46671586982287233,0.46820698496900803,0.4696886625194857,0.4711610504029096,0.47262429287250746,0.4740785306305335,0.4755239009473612,0.4769605377755387,
0.47838857185906314,0.4798081308381152,0.48121933934948075,0.48262231912287346,0.4840171890733601,0.4854040653900775,0.4867830616214213,0.4881542887568748,0.4895178553056373,0.4908738673722041,0.4922224287290381,0.4935636408864699,0.4948976031599528,0.496224412734793,0.49754416472847035,0.4988569522506557,0.5001628664610298,0.501461996624999,0.5027544301674005,0.5040402527242843,0.5053195481928565,0.5065923987796591,0.5078588850470654,0.5091190859581595,0.5103730789200669,0.5116209398258046,0.5128627430947063,
0.514098561711485,0.5153284672639881,0.516552529979695,0.5177708187610112,0.5189834012194042,0.520190343708429,0.5213917113556842,0.5225875680937435,0.5237779766901,0.524962998776162,0.5261426948753368,0.5273171244302366,0.5284863458290399,0.5296504164310403,0.530809392591412,0.5319633296852224,0.5331122821307175,0.5342563034119088,0.5353954461004848,0.5365297618770742,0.5376593015518806,0.5387841150847137,0.5399042516044376,0.5410197594278565,0.5421306860780567,0.5432370783022257,0.5443389820889641,
0.5454364426851102,0.5465295046120907,0.5476182116818177,0.5487026070121426,0.5497827330418863,0.5508586315454556,0.5519303436470633,0.5529979098345615,0.5540613699729042,0.555120763317248,0.5561761285257049,0.5572275036717572,0.5582749262563468,0.5593184332196459,0.5603580609525242,0.5613938453077163,0.5624258216107048,0.5634540246703222,0.564478488789085,0.5654992477732644,0.5665163349427048,0.5675297831403955,0.5685396247418045,0.5695458916639811,0.5705486153744331,0.5715478268997879,0.5725435568342411,
0.5735358353478003,0.5745246921943311,0.5755101567194079,0.5764922578679786,0.577471024191847,0.5784464838569776,0.5794186646506286,0.5803875939883189,0.5813532989206311,0.582315806139859,0.5832751419864992,0.5842313324555962,0.5851844032029409,0.5861343795511286,0.5870812864954806,0.5880251487098322,0.5889659905521902,0.5899038360702656,0.5908387090068827,0.5917706328052692,0.5926996306142294,0.5936257252932051,0.5945489394172259,0.5954692952817516,0.5963868149074115,0.5973015200446405,0.5982134321782173,
0.599122572531705,0.6000289620717986,0.60093262151258,0.6018335713196846,0.6027318317143798,0.6036274226775593,0.6045203639536548,0.6054106750544663,0.606298375262915,0.6071834836367179,0.6080660190119893,0.6089460000067677,0.6098234450244732,0.6106983722572941,0.6115707996895061,0.6124407451007265,0.613308226069102,0.6141732599744346,0.6150358640012467,0.6158960551417848,0.6167538501989651,0.6176092657892629,0.6184623183455441,0.6193130241198446,0.620161399186094,0.6210074594427897,0.6218512206156173,
0.6226926982600246,0.623531907763744,0.6243688643492697,0.6252035830762873,0.6260360788440587,0.626866366393762,0.6276944603107898,0.6285203750270028,0.6293441248229434,0.6301657238300099,0.6309851860325884,0.6318025252701481,0.6326177552392989,0.63343088949581,0.6342419414565944,0.6350509244016576,0.6358578514760097,0.6366627356915467,0.6374655899288959,0.6382664269392303,0.6390652593460512,0.6398620996469384,0.6406569602152721,0.6414498533019224,0.6422407910369122,0.6430297854310497,0.6438168483775332,
0.6446019916535295,0.6453852269217243,0.6461665657318468,0.646946019522169,0.6477235996209785,0.6484993172480279,0.6492731835159596,0.6500452094317067,0.6508154058978702,0.651583783714075,0.6523503535783013,0.6531151260881964,0.653878111742364,0.6546393209416315,0.6553987639902987,0.6561564510973654,0.6569123923777382,0.6576665978534199,0.6584190774546778,0.6591698410211952,0.6599188983032032,0.660666258962595,0.6614119325740231,0.6621559286259783,0.6628982565218523,0.6636389255809841,0.6643779450396892,
0.6651153240522729,0.665851071692029,0.6665851969522216,0.667317708747053,0.6680486159126159,0.6687779272078317,0.6695056513153739,0.6702317968425779,0.6709563723223373,0.6716793862139855,0.6724008469041655,0.673120762707686,0.6738391418683641,0.6745559925598569,0.675271322886479,0.6759851408840097,0.6766974545204868,0.6774082716969896,0.67811760024841,0.6788254479442125,0.6795318224891835,0.6802367315241687,0.6809401826268009,0.6816421833122166,0.6823427410337628,0.6830418631836931,0.6837395570938545,
0.6844358300363635,0.6851306892242741,0.6858241418122343,0.6865161948971349,0.6872068555187488,0.687896130660361,0.6885840272493903,0.689270552158001,0.6899557122037085,0.6906395141499742,0.6913219647067927,0.6920030705312724,0.6926828382282061,0.6933612743506347,0.6940383854004035,0.6947141778287103,0.6953886580366461,0.6960618323757292,0.6967337071484312,0.6974042886086962,0.6980735829624533,0.6987415963681218,0.6994083349371105,0.7000738047343085,0.7007380117785719,0.7014009620432023,0.7020626614564196,
0.7027231159018287,0.7033823312188793,0.7040403132033212,0.7046970676076518,0.7053526001415594,0.7060069164723595,0.7066600222254262,0.7073119229846179,0.7079626242926972,0.7086121316517457,0.7092604505235738,0.7099075863301242,0.7105535444538713,0.7111983302382154,0.7118419489878712,0.7124844059692523,0.71312570641085,0.7137658555036082,0.7144048584012926,0.7150427202208567,0.7156794460428013,0.7163150409115315,0.7169495098357082,0.7175828577885948,0.7182150897084011,0.718846210498622,0.7194762250283715,
0.720105138132714,0.7207329546129908,0.721359679237142,0.721985316740026,0.7226098718237337,0.7232333491578999,0.7238557533800104,0.7244770890957053,0.7250973608790793,0.7257165732729777,0.7263347307892896,0.7269518379092367,0.7275678990836596,0.7281829187333003,0.728796901249081,0.7294098509923802,0.7300217722953055,0.7306326694609626,0.7312425467637221,0.7318514084494824,0.7324592587359297,0.7330661018127955,0.7336719418421106,0.7342767829584559,0.7348806292692114,0.735483484854801,0.7360853537689355,
0.7366862400388527,0.737286147665554,0.7378850806240391,0.7384830428635379,0.7390800383077395,0.7396760708550189,0.7402711443786605,0.7408652627270808,0.741458429724046,0.7420506491688895,0.7426419248367259,0.7432322604786622,0.7438216598220084,0.7444101265704832,0.7449976644044198,0.7455842769809682,0.7461699679342954,0.7467547408757834,0.7473385993942256,0.7479215470560205,0.748503587405363,0.7490847239644346,0.7496649602335902,0.7502442996915447,0.7508227457955557,0.7514003019816053,0.7519769716645798,
0.7525527582384471,0.7531276650764331,0.753701695531195,0.7542748529349934,0.754847140599863,0.7554185618177804,0.7559891198608314,0.7565588179813753,0.7571276594122083,0.757695647366725,0.7582627850390781,0.7588290756043364,0.7593945222186415,0.7599591280193618,0.7605228961252469,0.7610858296365782,0.7616479316353195,0.7622092051852651,0.7627696533321872,0.7633292791039805,0.7638880855108077,0.7644460755452401,0.7650032521824002,0.7655596183801003,0.7661151770789814,0.7666699312026493,0.7672238836578102,
0.7677770373344053,0.7683293951057427,0.7688809598286291,0.7694317343435,0.7699817214745477,0.7705309240298498,0.7710793448014944,0.7716269865657057,0.7721738520829675,0.772719944098145,0.7732652653406075,0.7738098185243465,0.7743536063480964,0.7748966314954512,0.775438896634981,0.7759804044203481,0.7765211574904205,0.7770611584693855,0.7776004099668616,0.7781389145780099,0.778676674883643,0.7792136934503352,0.7797499728305293,0.7802855155626435,0.7808203241711775,0.7813544011668172,0.7818877490465378,
0.7824203702937074,0.782952267378188,0.783483442756437,0.7840138988716062,0.7845436381536416,0.7850726630193806,0.7856009758726495,0.7861285791043594,0.7866554750926015,0.7871816662027413,0.7877071547875124,0.7882319431871087,0.7887560337292759,0.7892794287294033,0.7898021304906129,0.7903241413038489,0.7908454634479661,0.7913660991898175,0.7918860507843407,0.7924053204746444,0.7929239104920931,0.7934418230563915,0.7939590603756689,0.7944756246465603,0.7949915180542906,0.7955067427727543,0.7960213009645972,
0.7965351947812954,0.7970484263632353,0.7975609978397913,0.7980729113294042,0.7985841689396577,0.7990947727673552,0.799604724898595,0.8001140274088461,0.8006226823630215,0.8011306918155525,0.8016380578104618,0.8021447823814357,0.8026508675518954,0.8031563153350691,0.8036611277340616,0.8041653067419244,0.8046688543417252,0.8051717725066162,0.8056740631999023,0.8061757283751086,0.8066767699760472,0.8071771899368835,0.8076769901822017,0.8081761726270704,0.8086747391771066,0.8091726917285403,0.8096700321682774,
0.8101667623739631,0.810662884214044,0.81115839954783,0.8116533102255556,0.8121476180884412,0.8126413249687521,0.8131344326898597,0.8136269430663002,0.8141188579038331,0.8146101789994995,0.8151009081416802,0.8155910471101533,0.8160805976761496,0.8165695616024108,0.8170579406432438,0.8175457365445769,0.8180329510440145,0.8185195858708919,0.8190056427463286,0.8194911233832824,0.8199760294866028,0.8204603627530825,0.8209441248715112,0.8214273175227265,0.8219099423796651,0.8223920011074144,0.8228734953632629,
0.8233544267967502,0.8238347970497164,0.8243146077563521,0.8247938605432471,0.8252725570294385,0.8257506988264595,0.8262282875383863,0.8267053247618866,0.8271818120862655,0.8276577510935128,0.8281331433583488,0.82860799044827,0.8290822939235957,0.8295560553375114,0.8300292762361152,0.830501958158461,0.830974102636603,0.8314457111956398,0.831916785353757,0.8323873266222709,0.8328573365056704,0.8333268165016603,0.8337957681012022,0.8342641927885572,0.8347320920413266,0.8351994673304931,0.8356663201204616,
0.8361326518690991,0.8365984640277758,0.8370637580414035,0.8375285353484762,0.8379927973811084,0.8384565455650747,0.8389197813198476,0.8393825060586361,0.8398447211884238,0.8403064281100062,0.8407676282180282,0.8412283229010212,0.8416885135414399,0.8421482015156988,0.8426073881942083,0.843066074941411,0.8435242631158167,0.8439819540700386,0.8444391491508282,0.8448958496991095,0.8453520570500146,0.8458077725329176,0.8462629974714685,0.8467177331836275,0.8471719809816981,0.8476257421723606,0.8480790180567055,
0.8485318099302657,0.8489841190830497,0.8494359467995736,0.8498872943588931,0.8503381630346358,0.8507885540950325,0.8512384688029485,0.8516879084159152,0.8521368741861606,0.85258536736064,0.8530333891810667,0.8534809408839426,0.8539280237005873,0.8543746388571686,0.854820787574732,0.8552664710692298,0.8557116905515508,0.8561564472275487,0.856600742298071,0.8570445769589876,0.8574879524012193,0.8579308698107657,0.8583733303687329,0.8588153352513616,0.8592568856300545,0.859697982671404,0.8601386275372181,
0.8605788213845489,0.8610185653657182,0.8614578606283446,0.8618967083153697,0.8623351095650842,0.8627730655111538,0.8632105772826455,0.8636476460040526,0.8640842727953206,0.8645204587718719,0.8649562050446316,0.8653915127200517,0.8658263829001364,0.8662608166824664,0.866694815160223,0.8671283794222129,0.8675615105528918,0.8679942096323882,0.8684264777365276,0.8688583159368556,0.8692897253006614,0.8697207068910011,0.8701512617667205,0.8705813909824783,0.8710110955887687,0.871440376631944,0.8718692351542368,
0.8722976721937826,0.872725688784642,0.8731532859568221,0.8735804647362989,0.8740072261450385,0.8744335712010189,0.8748595009182516,0.8752850163068022,0.8757101183728118,0.876134808118518,0.8765590865422758,0.8769829546385779,0.8774064133980755,0.8778294638075984,0.8782521068501757,0.8786743435050556,0.879096174747725,0.87951760154993,0.8799386248796953,0.8803592457013438,0.8807794649755161,0.8811992836591893,0.8816187027056972,0.8820377230647484,0.8824563456824455,0.8828745715013043,0.8832924014602719,
0.8837098364947455,0.884126877536591,0.8845435255141612,0.8849597813523133,0.8853756459724286,0.8857911202924285,0.8862062052267938,0.8866209016865818,0.8870352105794438,0.8874491328096428,0.8878626692780711,0.888275820882267,0.8886885885164322,0.8891009730714491,0.8895129754348972,0.8899245964910704,0.8903358371209934,0.8907466982024383,0.8911571806099414,0.8915672852148191,0.8919770128851846,0.8923863644859639,0.8927953408789115,0.8932039429226274,0.8936121714725718,0.8940200273810814,0.8944275114973853,
0.8948346246676199,0.895241367734845,0.8956477415390587,0.8960537469172131,0.896459384703229,0.8968646557280114,0.8972695608194643,0.8976741008025054,0.8980782764990811,0.8984820887281812,0.8988855383058536,0.8992886260452183,0.8996913527564827,0.9000937192469548,0.9004957263210588,0.9008973747803478,0.9012986654235191,0.9016995990464275,0.9021001764420992,0.9025003984007458,0.9029002657097783,0.9032997791538201,0.9036989395147207,0.9040977475715697,0.9044962041007096,0.9048943098757493,0.9052920656675773,
0.9056894722443748,0.906086530371629,0.9064832408121458,0.9068796043260627,0.9072756216708617,0.9076712936013822,0.9080666208698333,0.9084616042258066,0.9088562444162888,0.909250542185674,0.909644498275776,0.9100381134258407,0.9104313883725582,0.9108243238500753,0.9112169205900067,0.911609179321448,0.9120011007709872,0.912392685662716,0.9127839347182426,0.9131748486567027,0.9135654281947713,0.9139556740466742,0.9143455869241996,0.9147351675367098,0.9151244165911517,0.9155133347920691,0.9159019228416131,
0.9162901814395539,0.9166781112832916,0.9170657130678669,0.9174529874859728,0.9178399352279649,0.9182265569818724,0.9186128534334087,0.9189988252659826,0.9193844731607087,0.9197697977964173,0.9201547998496661,0.9205394799947498,0.9209238389037109,0.9213078772463497,0.9216915956902347,0.9220749949007134,0.9224580755409214,0.9228408382717931,0.9232232837520717,0.9236054126383193,0.9239872255849265,0.9243687232441223,0.9247499062659842,0.9251307752984477,0.925511330987316,0.9258915739762699,0.9262715049068767,
0.9266511244186009,0.9270304331488122,0.9274094317327963,0.9277881208037635,0.9281665009928579,0.9285445729291671,0.9289223372397313,0.9292997945495522,0.9296769454816025,0.9300537906568345,0.9304303306941893,0.9308065662106061,0.9311824978210302,0.931558126138423,0.9319334517737698,0.9323084753360892,0.9326831974324412,0.9330576186679365,0.9334317396457447,0.9338055609671028,0.934179083231324,0.934552307035806,0.9349252329760395,0.935297861645616,0.935670193636237,0.936042229537722,0.936413969938016,
0.9367854154231987,0.937156566577492,0.9375274239832683,0.9378979882210586,0.9382682598695602,0.938638239505645,0.9390079277043673,0.9393773250389714,0.9397464320808999,0.9401152493998012,0.9404837775635372,0.9408520171381909,0.9412199686880747,0.9415876327757369,0.9419550099619702,0.9423221008058192,0.9426889058645871,0.943055425693844,0.9434216608474337,0.9437876118774816,0.9441532793344015,0.9445186637669033,0.944883765722,0.9452485857450149,0.9456131243795891,0.945977382167688,0.9463413596496092,
0.9467050573639889,0.9470684758478091,0.9474316156364045,0.9477944772634701,0.9481570612610669,0.9485193681596299,0.948881398487974,0.9492431527733017,0.9496046315412092,0.9499658353156932,0.950326764619158,0.9506874199724215,0.9510478018947224,0.9514079109037265,0.9517677475155331,0.9521273122446822,0.9524866056041599,0.9528456281054056,0.9532043802583186,0.9535628625712634,0.9539210755510774,0.9542790197030759,0.9546366955310597,0.9549941035373201,0.9553512442226458,0.955708118086329,0.9560647256261716,
0.956421067338491,0.9567771437181263,0.9571329552584446,0.9574885024513466,0.9578437857872732,0.9581988057552107,0.9585535628426971,0.9589080575358283,0.9592622903192632,0.9596162616762304,0.9599699720885332,0.9603234220365561,0.9606766119992698,0.9610295424542377,0.9613822138776207,0.9617346267441839,0.9620867815273011,0.9624386786989614,0.962790318729774,0.9631417020889744,0.9634928292444291,0.963843700662642,0.9641943168087592,0.9645446781465745,0.9648947851385351,0.9652446382457469,0.9655942379279795,
0.9659435846436719,0.9662926788499377,0.9666415210025703,0.9669901115560479,0.9673384509635392,0.9676865396769084,0.9680343781467202,0.9683819668222451,0.9687293061514642,0.969076396581075,0.9694232385564956,0.9697698325218702,0.970116178920074,0.9704622781927181,0.970808130780155,0.9711537371214826,0.9714990976545498,0.9718442128159609,0.9721890830410812,0.972533708764041,0.9728780904177409,0.9732222284338563,0.9735661232428426,0.9739097752739395,0.9742531849551758,0.9745963527133741,0.9749392789741559,
0.9752819641619453,0.9756244086999749,0.9759666130102891,0.9763085775137494,0.9766503026300392,0.9769917887776673,0.9773330363739738,0.9776740458351333,0.9780148175761602,0.9783553520109127,0.9786956495520978,0.9790357106112746,0.97937553559886,0.9797151249241322,0.9800544789952351,0.9803935982191831,0.9807324830018651,0.9810711337480483,0.9814095508613835,0.9817477347444082,0.9820856857985518,0.9824234044241392,0.9827608910203951,0.9830981459854481,0.9834351697163352,0.9837719626090052,0.9841085250583236,
0.9844448574580762,0.984780960200973,0.985116833678653,0.9854524782816871,0.9857878943995831,0.9861230824207893,0.9864580427326981,0.9867927757216505,0.9871272817729397,0.9874615612708154,0.987795614598487,0.9881294421381279,0.9884630442708796,0.9887964213768549,0.989129573835142,0.9894625020238087,0.9897952063199055,0.9901276870994697,0.9904599447375294,0.9907919796081064,0.9911237920842207,0.9914553825378941,0.9917867513401535,0.9921178988610346,0.992448825469586,0.9927795315338723,0.9931100174209779,
0.9934402834970106,0.9937703301271053,0.9941001576754271,0.9944297665051756,0.9947591569785874,0.9950883294569406,0.9954172843005578,0.9957460218688093,0.9960745425201175,0.996402846611959,0.9967309345008691,0.997058806542445,0.9973864630913489,0.9977139045013114,0.9980411311251348,0.9983681433146974,0.998694941420955,0.9990215257939463,0.9993478967827943,0.999674054735711,1],z=[0,0.01262952101661779,0.02525904203323558,0.03788856304985337,0.049711876377871826,0.05991457469741709,0.06898447286600867,
0.0772092360066284,0.08477358579410943,0.091804259875822,0.09839255413111209,0.10460674144643575,0.11049941567981197,0.116112082049842,0.12147815731101994,0.12662500399558943,0.13157535287823224,0.1363483240840589,0.1409601768441825,0.14542487095720244,0.14975449458714327,0.15395959525747982,0.1580494394769152,0.16203221890462635,0.16591521589126665,0.16970493774704687,0.17340722665014255,0.1770273503750349,0.18057007776923878,0.18403974199157158,0.18744029384710506,0.19077534704588353,0.1940482168277028,
0.19726195310091915,0.20041936901604623,0.20352306571797985,0.2065754538818233,0.20957877252746188,0.21253510552056065,0.21544639609752403,0.21831445969536206,0.2211409953214818,0.2239275956609244,0.22667575608780954,0.22938688272237368,0.2320622996539648,0.2347032554328511,0.2373109289190679,0.2398864345642407,0.24243082719196402,0.24494510633355537,0.24743022016856214,0.2498870691130589,0.25231650909335385,0.25471935453807176,0.25709638111758565,0.2594483282563151,0.2617759014404253,0.26407977434087276,
0.2663605907694862,0.26861896648381073,0.27085549085472227,0.2730707284093175,0.2752652202602596,0.2774394854315987,0.27959402209005907,0.2817293086898797,0.28384580503848866,0.2859439532895821,0.2880241788695442,0.29008689134257926,0.2921324852194264,0.2941613407140744,0.296173824452494,0.29817029013704466,0.30015107916988515,0.30211652123843086,0.3040669348656343,0.3060026279276311,0.30792389814107823,0.3098310335223196,0.3117243128203384,0.3136040059252957,0.3154703742543138,0.3173236711160275,
0.3191641420553126,0.32099202517948666,0.3228075514671829,0.32461094506100485,0.32640242354498716,0.328182198207814,0.3299504742926743,0.331707451234572,0.33345332288585067,0.3351882777306368,0.33691249908885884,0.33862616531045336,0.3403294499603252,0.3420225219945948,0.3437055459286266,0.34537868199729943,0.34704208630795363,0.3486959109864158,0.3503403043164812,0.3519754108732058,0.35360137165034033,0.3552183241822174,0.3568264026603817,0.35842573804523775,0.3600164581729729,0.3615986878579945,
0.36317254899111157,0.36473816063367165,0.3662956391078557,0.36784509808331944,0.3693866486603606,0.37092039944977906,0.37244645664958986,0.3739649241187381,0.37547590344795784,0.37697949402790815,0.3784757931147127,0.3799648958930234,0.3814468955367197,0.3829218832673514,0.3843899484104266,0.38585117844964034,0.3873056590791346,0.38875347425387746,0.39019470623824154,0.3916294356528607,0.39305774151983813,0.3944797013063766,0.3958953909668962,0.3973048849837052,0.398708256406281,0.4001055768892218,
0.40149691672892146,0.40288234489901914,0.4042619290846755,0.40563573571572004,0.40700382999871526,0.4083662759479818,0.409723136415623,0.4110744731205898,0.41242034667682187,0.4137608166205015,0.41509594143645334,0.41642577858372254,0.41775038452036234,0.41906981472746097,0.420384123732435,0.4216933651316181,0.4229975916121692,0.42429685497332564,0.4255912061470252,0.4268806952179194,0.4281653714427998,0.42944528326945836,0.43072047835500143,0.4319910035836372,0.43325690508395387,0.43451822824570774,
0.43577501773613614,0.43702731751581336,0.43827517085406376,0.4395186203439474,0.44075770791683294,0.4419924748565711,0.44322296181328236,0.4444492088167707,0.445671255289577,0.4468891400596831,0.4481029013728773,0.44931257690479337,0.45051820377263313,0.4517198185465818,0.45291745726092675,0.4541111554248895,0.4553009480331786,0.45648686957627277,0.4576689540504429,0.45884723496752006,0.46002174536441914,0.46119251781242304,0.4623595844262362,0.46352297687281546,0.46468272637998137,0.46583886374482125,
0.46699141934188554,0.46814042313118737,0.469285904666008,0.47042789310051664,0.47156641719720765,0.4727015053341615,0.4738331855121353,0.47496148536148547,0.47608643214893004,0.4772080527841532,0.47832637382625737,0.479441421490067,0.4805532216522879,0.4816617998575264,0.482767181324172,0.48386939095014764,0.48496845331853117,0.4860643927030504,0.4871572330734569,0.48824699810078104,0.48933371116247054,0.4904173953474175,0.4914980734608752,0.4925757680292682,0.49365050130489957,0.49472229527055495,
0.49579117164401115,0.49685715188244534,0.49792025718675353,0.4989805085057765,0.5000379265404378,0.5010925317477942,0.5021443443450035,0.5031933843132081,0.5042396714013406,0.5052832251298499,0.5063240647943513,0.5073622094692027,0.5083976780110088,0.5094304890620533,0.5104606610536634,0.5114882122095067,0.512513160548822,0.5135355238895871,0.514555319851623,0.5155725658596376,0.5165872791462103,0.5175994767547175,0.518609175542202,0.5196163921821871,0.5206211431674361,0.5216234448126594,0.522623313257169,
0.5236207644674844,0.5246158142398872,0.5256084782029289,0.5265987718198912,0.5275867103912004,0.5285723090567965,0.5295555827984594,0.5305365464420905,0.5315152146599541,0.5324916019728768,0.533465722752407,0.5344375912229347,0.5354072214637743,0.5363746274112078,0.5373398228604933,0.5383028214678364,0.5392636367523269,0.5402222820978414,0.5411787707549106,0.5421331158425572,0.5430853303500971,0.5440354271389132,0.5449834189441957,0.545929318376653,0.5468731379241937,0.5478148899535785,0.5487545867120445,
0.5496922403289016,0.550627862817102,0.5515614660747821,0.5524930618867796,0.5534226619261247,0.5543502777555052,0.5552759208287091,0.5561996024920415,0.5571213339857184,0.5580411264452384,0.5589589909027302,0.5598749382882796,0.5607889794312336,0.5617011250614838,0.5626113858107291,0.5635197722137174,0.5644262947094677,0.5653309636424726,0.5662337892638817,0.5671347817326651,0.5680339511167598,0.5689313073941972,0.5698268604542126,0.5707206200983378,0.5716125960414764,0.5725027979129619,0.5733912352575995,
0.5742779175366926,0.5751628541290517,0.5760460543319896,0.5769275273622997,0.5778072823572206,0.5786853283753848,0.5795616743977544,0.5804363293285412,0.5813093019961135,0.5821806011538895,0.5830502354812169,0.5839182135842398,0.5847845439967515,0.5856492351810363,0.5865122955286974,0.5873737333614738,0.5882335569320437,0.5890917744248176,0.5899483939567188,0.5908034235779529,0.5916568712727662,0.5925087449601928,0.5933590524947909,0.5942078016673694,0.5950550002057023,0.5959006557752352,0.5967447759797787,
0.5975873683621958,0.5984284404050756,0.5992679995314003,0.6001060531052015,0.6009426084322078,0.601777672760483,0.6026112532810554,0.6034433571285388,0.6042739913817439,0.6051031630642828,0.6059308791451635,0.6067571465393772,0.6075819721084775,0.6084053626611514,0.6092273249537822,0.6100478656910059,0.6108669915262589,0.6116847090623188,0.6125010248518375,0.6133159453978685,0.614129477154385,0.6149416265267927,0.6157523998724356,0.6165618035010941,0.6173698436754775,0.6181765266117102,0.6189818584798096,
0.6197858454041609,0.6205884934639824,0.621389808693787,0.6221897970838367,0.6229884645805916,0.6237858170871525,0.6245818604636987,0.6253766005279194,0.6261700430554399,0.6269621937802424,0.627753058395081,0.628542642551892,0.6293309518621987,0.6301179918975115,0.6309037681897214,0.6316882862314913,0.6324715514766395,0.6332535693405202,0.6340343452003991,0.6348138843958234,0.6355921922289883,0.6363692739650979,0.6371451348327226,0.6379197800241517,0.6386932146957418,0.6394654439682601,0.6402364729272251,
0.6410063066232419,0.6417749500723333,0.6425424082562685,0.6433086861228857,0.6440737885864122,0.6448377205277801,0.645600486794939,0.6463620922031635,0.6471225415353585,0.6478818395423597,0.6486399909432315,0.6493970004255614,0.6501528726457492,0.650907612229295,0.6516612237710832,0.6524137118356617,0.6531650809575201,0.6539153356413631,0.6546644803623813,0.6554125195665185,0.6561594576707364,0.6569052990632761,0.6576500481039163,0.6583937091242286,0.6591362864278302,0.6598777842906337,0.6606182069610937,
0.6613575586604503,0.6620958435829714,0.6628330658961898,0.6635692297411403,0.664304339232592,0.665038398459279,0.6657714114841288,0.6665033823444867,0.6672343150523395,0.6679642135945361,0.6686930819330041,0.6694209240049673,0.6701477437231571,0.6708735449760244,0.6715983316279475,0.6723221075194388,0.6730448764673485,0.6737666422650662,0.6744874086827211,0.6752071794673781,0.6759259583432347,0.6766437490118126,0.6773605551521499,0.6780763804209894,0.6787912284529659,0.6795051028607908,0.6802180072354358,
0.6809299451463133,0.6816409201414555,0.6823509357476922,0.6830599954708256,0.6837681027958041,0.684475261186894,0.6851814740878487,0.6858867449220779,0.6865910770928132,0.6872944739832727,0.6879969389568239,0.6886984753571457,0.6893990865083861,0.6900987757153224,0.6907975462635155,0.6914954014194653,0.692192344430764,0.6928883785262472,0.6935835069161438,0.6942777327922245,0.694971059327949,0.6956634896786107,0.6963550269814812,0.6970456743559527,0.6977354349036788,0.6984243117087141,0.6991123078376528,
0.699799426339765,0.7004856702471326,0.7011710425747831,0.7018555463208224,0.7025391844665666,0.7032219599766716,0.7039038757992623,0.7045849348660602,0.7052651400925095,0.7059444943779024,0.7066230006055029,0.7073006616426692,0.707977480340976,0.7086534595363333,0.7093286020491069,0.7100029106842357,0.7106763882313484,0.7113490374648795,0.7120208611441837,0.7126918620136494,0.7133620428028108,0.7140314062264597,0.7146999549847549,0.7153676917633327,0.7160346192334134,0.7167007400519098,0.7173660568615324,
0.7180305722908951,0.7186942889546185,0.719357209453434,0.720019336374285,0.7206806722904288,0.7213412197615364,0.7220009813337923,0.7226599595399918,0.7233181568996399,0.7239755759190464,0.724632219091423,0.7252880888969768,0.7259431878030049,0.7265975182639874,0.727251082721679,0.7279038836052013,0.7285559233311324,0.7292072043035966,0.7298577289143543,0.7305074995428886,0.7311565185564938,0.7318047883103603,0.7324523111476625,0.7330990893996414,0.7337451253856901,0.7343904214134368,0.7350349797788271,
0.7356788027662066,0.7363218926484012,0.7369642516867986,0.7376058821314261,0.7382467862210323,0.7388869661831627,0.7395264242342394,0.7401651625796365,0.7408031834137572,0.741440488920109,0.7420770812713791,0.7427129626295076,0.7433481351457623,0.7439826009608107,0.744616362204793,0.7452494209973932,0.7458817794479106,0.7465134396553299,0.7471444037083915,0.7477746736856601,0.7484042516555937,0.7490331396766116,0.749661339797162,0.7502888540557885,0.7509156844811968,0.75154183309232,0.7521673018983844,
0.7527920928989733,0.7534162080840919,0.7540396494342302,0.7546624189204263,0.7552845185043287,0.7559059501382585,0.7565267157652705,0.7571468173192143,0.7577662567247944,0.7583850358976305,0.7590031567443164,0.7596206211624794,0.7602374310408384,0.7608535882592614,0.7614690946888241,0.7620839521918652,0.7626981626220444,0.7633117278243974,0.7639246496353923,0.7645369298829836,0.7651485703866682,0.7657595729575378,0.766369939398335,0.7669796715035041,0.7675887710592457,0.7681972398435691,0.768805079626343,
0.7694122921693485,0.7700188792263292,0.7706248425430432,0.7712301838573123,0.7718349048990725,0.7724390073904231,0.773042493045677,0.7736453635714078,0.7742476206664997,0.7748492660221942,0.7754503013221389,0.7760507282424334,0.776650548451678,0.7772497636110178,0.7778483753741909,0.7784463853875732,0.7790437952902235,0.7796406067139292,0.7802368212832507,0.7808324406155657,0.781427466321113,0.7820219000030365,0.7826157432574284,0.7832089976733718,0.7838016648329837,0.7843937463114573,0.7849852436771035,
0.7855761584913932,0.7861664923089979,0.7867562466778316,0.7873454231390905,0.787934023227294,0.7885220484703245,0.7891095003894674,0.78969638049945,0.7902826903084814,0.790868431318291,0.7914536050241666,0.7920382129149933,0.7926222564732914,0.7932057371752538,0.7937886564907835,0.7943710158835304,0.7949528168109292,0.7955340607242347,0.7961147490685586,0.7966948832829057,0.7972744648002096,0.7978534950473676,0.7984319754452766,0.7990099074088677,0.7995872923471412,0.8001641316632006,0.8007404267542867,
0.8013161790118125,0.8018913898213956,0.8024660605628923,0.8030401926104308,0.8036137873324438,0.8041868460917015,0.8047593702453443,0.8053313611449138,0.8059028201363865,0.806473748560204,0.8070441477513057,0.8076140190391593,0.808183363747792,0.8087521831958219,0.8093204786964877,0.8098882515576799,0.8104555030819705,0.8110222345666428,0.811588447303722,0.8121541425800035,0.8127193216770835,0.8132839858713867,0.8138481364341967,0.8144117746316832,0.8149749017249316,0.8155375189699711,0.816099627617802,
0.8166612289144245,0.8172223241008661,0.8177829144132087,0.8183430010826165,0.8189025853353624,0.819461668392856,0.8200202514716689,0.8205783357835622,0.821135922535513,0.8216930129297397,0.8222496081637287,0.8228057094302597,0.8233613179174317,0.8239164348086886,0.8244710612828438,0.8250251985141056,0.8255788476721027,0.8261320099219078,0.8266846864240632,0.8272368783346047,0.827788586805086,0.8283398129826024,0.8288905580098155,0.829440823024976,0.8299906091619481,0.8305399175502322,0.8310887493149887,
0.8316371055770607,0.8321849874529976,0.8327323960550771,0.8332793324913279,0.833825797865553,0.8343717932773512,0.8349173198221393,0.835462378591175,0.8360069706715774,0.83655109714635,0.8370947590944016,0.8376379575905678,0.8381806937056326,0.8387229685063494,0.8392647830554617,0.8398061384117246,0.8403470356299247,0.8408874757609016,0.8414274598515679,0.8419669889449293,0.8425060640801054,0.8430446862923493,0.8435828566130675,0.84412057606984,0.84465784568644,0.8451946664828526,0.8457310394752956,
0.8462669656762376,0.8468024460944176,0.8473374817348641,0.8478720735989141,0.8484062226842315,0.8489399299848259,0.8494731964910713,0.8500060231897245,0.8505384110639432,0.8510703610933044,0.8516018742538222,0.8521329515179663,0.852663593854679,0.8531938022293939,0.8537235776040522,0.8542529209371217,0.854781833183613,0.8553103152950976,0.8558383682197243,0.8563659929022369,0.8568931902839906,0.8574199613029695,0.8579463068938025,0.8584722279877803,0.8589977255128725,0.8595228003937431,0.8600474535517671,
0.860571685905047,0.8610954983684285,0.8616188918535168,0.8621418672686924,0.8626644255191268,0.8631865675067983,0.8637082941305079,0.8642296062858937,0.864750504865448,0.8652709907585314,0.8657910648513881,0.8663107280271617,0.8668299811659093,0.8673488251446174,0.867867260837216,0.8683852891145937,0.8689029108446124,0.8694201268921217,0.8699369381189732,0.8704533453840357,0.8709693495432085,0.8714849514494362,0.8720001519527227,0.8725149519001453,0.8730293521358685,0.873543353501158,0.8740569568343945,
0.8745701629710876,0.8750829727438886,0.8755953869826052,0.8761074065142143,0.8766190321628751,0.8771302647499432,0.8776411050939833,0.8781515540107819,0.8786616123133618,0.8791712808119936,0.8796805603142088,0.8801894516248137,0.8806979555459011,0.8812060728768631,0.8817138044144045,0.882221150952554,0.8827281132826775,0.883234692193491,0.8837408884710714,0.8842467028988698,0.8847521362577235,0.8852571893258682,0.8857618628789493,0.8862661576900348,0.8867700745296263,0.8872736141656715,0.8877767773635756,
0.8882795648862128,0.8887819774939383,0.8892840159445996,0.8897856809935476,0.8902869733936489,0.8907878938952963,0.8912884432464204,0.8917886221925007,0.8922884314765765,0.8927878718392589,0.8932869440187404,0.8937856487508071,0.8942839867688488,0.8947819588038698,0.8952795655845005,0.8957768078370067,0.8962736862853018,0.8967702016509559,0.8972663546532074,0.8977621460089725,0.8982575764328569,0.8987526466371646,0.899247357331909,0.8997417092248232,0.90023570302137,0.9007293394247513,0.9012226191359196,
0.9017155428535865,0.9022081112742335,0.9027003250921215,0.9031921849993009,0.9036836916856209,0.90417484583874,0.9046656481441341,0.9051560992851082,0.9056461999428044,0.9061359507962115,0.9066253525221751,0.9071144057954066,0.9076031112884924,0.9080914696719034,0.9085794816140041,0.9090671477810619,0.9095544688372559,0.9100414454446862,0.9105280782633834,0.9110143679513163,0.911500315164402,0.9119859205565143,0.9124711847794927,0.9129561084831508,0.9134406923152851,0.9139249369216844,0.9144088429461374,
0.9148924110304419,0.915375641814413,0.9158585359358921,0.9163410940307543,0.9168233167329184,0.9173052046743536,0.9177867584850888,0.9182679787932209,0.9187488662249219,0.9192294214044485,0.9197096449541494,0.9201895374944735,0.9206690996439783,0.9211483320193369,0.9216272352353475,0.9221058099049397,0.9225840566391834,0.9230619760472966,0.9235395687366524,0.9240168353127874,0.9244937763794097,0.9249703925384051,0.9254466843898465,0.9259226525320003,0.9263982975613347,0.9268736200725265,0.9273486206584685,
0.9278232999102779,0.9282976584173026,0.9287716967671293,0.9292454155455901,0.9297188153367703,0.9301918967230154,0.9306646602849383,0.9311371066014265,0.9316092362496491,0.9320810498050639,0.9325525478414245,0.9330237309307874,0.9334945996435183,0.9339651545483003,0.9344353962121393,0.9349053252003717,0.9353749420766716,0.9358442474030564,0.9363132417398943,0.9367819256459111,0.9372502996781967,0.9377183643922115,0.9381861203417932,0.9386535680791633,0.9391207081549341,0.9395875411181145,0.9400540675161166,
0.9405202878947628,0.9409862027982911,0.9414518127693627,0.9419171183490671,0.9423821200769295,0.9428468184909163,0.9433112141274416,0.9437753075213736,0.9442390992060405,0.9447025897132368,0.9451657795732294,0.9456286693147632,0.946091259465068,0.946553550549864,0.9470155430933681,0.9474772376182993,0.947938634645885,0.9483997346958671,0.9488605382865075,0.9493210459345939,0.9497812581554465,0.9502411754629217,0.9507007983694208,0.9511601273858931,0.9516191630218428,0.9520779057853349,0.9525363561829999,
0.9529945147200402,0.9534523819002355,0.9539099582259479,0.9543672441981287,0.9548242403163215,0.9552809470786706,0.9557373649819242,0.9561934945214409,0.9566493361911946,0.9571048904837803,0.957560157890419,0.9580151389009636,0.9584698340039032,0.9589242436863693,0.9593783684341407,0.9598322087316485,0.9602857650619817,0.9607390379068922,0.9611920277467992,0.9616447350607958,0.9620971603266527,0.9625493040208236,0.9630011666184514,0.9634527485933709,0.9639040504181161,0.9643550725639237,0.9648058155007385,
0.9652562796972185,0.9657064656207391,0.9661563737373994,0.9666060045120247,0.9670553584081741,0.9675044358881427,0.9679532374129683,0.9684017634424352,0.9688500144350788,0.969297990848191,0.9697456931378244,0.9701931217587966,0.9706402771646961,0.9710871598078853,0.9715337701395063,0.9719801086094847,0.9724261756665348,0.9728719717581634,0.9733174973306754,0.9737627528291767,0.9742077386975799,0.9746524553786086,0.9750969033138012,0.9755410829435159,0.9759849947069349,0.9764286390420681,0.976872016385759,
0.9773151271736872,0.9777579718403738,0.9782005508191854,0.9786428645423387,0.9790849134409042,0.9795266979448097,0.9799682184828468,0.9804094754826725,0.9808504693708154,0.9812912005726785,0.9817316695125434,0.9821718766135753,0.9826118222978263,0.9830515069862399,0.9834909310986545,0.9839300950538076,0.9843689992693404,0.9848076441618009,0.9852460301466487,0.9856841576382579,0.9861220270499221,0.9865596387938579,0.9869969932812083,0.9874340909220475,0.9878709321253837,0.9883075172991641,0.9887438468502779,
0.9891799211845601,0.9896157407067957,0.9900513058207229,0.9904866169290382,0.9909216744333976,0.9913564787344237,0.9917910302317056,0.9922253293238062,0.9926593764082635,0.9930931718815946,0.9935267161393003,0.9939600095758677,0.9943930525847745,0.9948258455584919,0.9952583888884886,0.9956906829652349,0.9961227281782049,0.9965545249158808,0.9969860735657569,0.9974173745143414,0.9978484281471626,0.9982792348487693,0.9987097950027365,0.9991401089916675,0.9995701771971982,1],x,a,j=[];for(x=0;x<o;x+=
2)for(a=0;a<k;a+=2){var h=4*a+4*x*k,l,s,C,O,g,v;l=u.length;O=n[b[h]];g=n[b[h+1]];v=n[b[h+2]];s=0.00433891*O+0.00376234915*g+0.0018990604648*v;C=0.002126*O+0.007152*g+7.22E-4*v;O=1.77255E-4*O+0.00109475308*g+0.0087295537*v;s=0.008856<s?1<=s?u[l-1]:u[s*l|0]:7.787*s+16/116;C=0.008856<C?1<=C?u[l-1]:u[C*l|0]:7.787*C+16/116;O=0.008856<O?1<=O?u[l-1]:u[O*l|0]:7.787*O+16/116;l=116*C-16;s=500*(s-C);C=200*(C-O);j[0]=2.55*l;j[1]=s+127;j[2]=C+127;p[j[0]+0.5|0]++;i[j[1]+0.5|0]++;r[j[2]+0.5|0]++}h=[];h[0]=p;h[1]=
i;h[2]=r;x=e(h[1]);h=e(h[2]);x=(c(x,0.1)+c(x,0.9))/2-127;a=(c(h,0.1)+c(h,0.9))/2-127;h=0;x=0>x?-Math.pow(-0.5*x,1):Math.pow(0.5*x,1);h=0>a?-Math.pow(-0.5*a,1):Math.pow(0.5*a,1);p=127/(127+x);i=127/(127+h);for(x=0;x<o;x++)for(a=0;a<k;a++)h=4*a+4*x*k,l=u.length,O=n[b[h]],g=n[b[h+1]],v=n[b[h+2]],s=0.00433891*O+0.00376234915*g+0.0018990604648*v,C=0.002126*O+0.007152*g+7.22E-4*v,O=1.77255E-4*O+0.00109475308*g+0.0087295537*v,s=0.008856<s?1<=s?u[l-1]:u[s*l|0]:7.787*s+16/116,C=0.008856<C?1<=C?u[l-1]:u[C*
l|0]:7.787*C+16/116,O=0.008856<O?1<=O?u[l-1]:u[O*l|0]:7.787*O+16/116,l=116*C-16,s=500*(s-C),C=200*(C-O),j[0]=2.55*l,j[1]=s+127,j[2]=C+127,j[1]*=p,j[2]*=i,r=z.length,C=(j[0]/2.55+16)/116,s=(j[1]-127)/500+C,l=C-(j[2]-127)/200,O=C*C*C,g=s*s*s,v=l*l*l,C=0.008856<O?O:(C-16/116)/7.787,s=0.008856<g?g:(s-16/116)/7.787,l=0.008856<v?v:(l-16/116)/7.787,s*=0.95047,C*=1,l*=1.08883,g=3.2406*s+-1.5372*C+-0.4986*l,O=-0.9689*s+1.8758*C+0.0415*l,C=0.0557*s+-0.204*C+1.057*l,g=0>=g?0:1<=g?1:z[g*r|0],O=0>=O?0:1<=O?1:
z[O*r|0],C=0>=C?0:1<=C?1:z[C*r|0],g=255*g+0.5|0,O=255*O+0.5|0,C=255*C+0.5|0,r=g+0.5|0,s=O+0.5|0,C=C+0.5|0,255<r?r=255:0>r&&(r=0),255<s?s=255:0>s&&(s=0),255<C?C=255:0>C&&(C=0),b[h]=r,b[h+1]=s,b[h+2]=C};q.e=b});
Z.d("/src/js/processors/colorConversion.js",function(g,q){q.e={rgb2lab:function(a,l,c,e){"object"!==typeof e&&(e=[0,0.030352698354883748,0.060705396709767497,0.09105809506465125,0.12141079341953499,0.15176349177441875,0.1821161901293025,0.21246888848418624,0.24282158683906999,0.27317428519395376,0.3035269835488375,0.3346535763899161,0.3676507324047436,0.40247170184963066,0.43914420374102936,0.4776953480693729,0.5181516702338386,0.5605391624202722,0.6048833022857054,0.6512090792594475,0.6995410187265387,
0.7499032043226175,0.8023192985384995,0.8568125618069307,0.9134058702220788,0.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,2.8426039504420793,
2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,7.036009569659588,
7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,13.563332965520566,
13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,22.32279573168085,
22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,33.71636150483304,
34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,48.514994005607036,
49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,66.5387298282272,
67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,88.79231178819663,
89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100]);var k,a=e[a],l=e[l],c=e[c],e=0.00433891*a+0.00376234915*l+0.0018990604648*c;k=0.002126*a+0.007152*l+7.22E-4*c;a=1.77255E-4*a+0.00109475308*l+0.0087295537*c;e=0.008856<e?Math.pow(e,1/3):7.787*e+16/116;k=0.008856<k?Math.pow(k,1/3):7.787*k+16/116;a=0.008856<a?Math.pow(a,1/3):7.787*a+
16/116;return[2.55*(116*k-16),500*(e-k)+127,200*(k-a)+127]},rgb2labwithcbrtmapping:function(a,l,c,e,k){"object"!==typeof e&&(e=[0,0.030352698354883748,0.060705396709767497,0.09105809506465125,0.12141079341953499,0.15176349177441875,0.1821161901293025,0.21246888848418624,0.24282158683906999,0.27317428519395376,0.3035269835488375,0.3346535763899161,0.3676507324047436,0.40247170184963066,0.43914420374102936,0.4776953480693729,0.5181516702338386,0.5605391624202722,0.6048833022857054,0.6512090792594475,
0.6995410187265387,0.7499032043226175,0.8023192985384995,0.8568125618069307,0.9134058702220788,0.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,
2.8426039504420793,2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,
7.036009569659588,7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,
13.563332965520566,13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,
22.32279573168085,22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,
33.71636150483304,34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,
48.514994005607036,49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,
66.5387298282272,67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,
88.79231178819663,89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100]);"object"!==typeof k&&(k=[0,0.09924488254695861,0.12504071661525748,0.14313588920856027,0.1575414309575025,0.16970636198605316,0.18033991980928551,0.18984863055466036,0.19848976509391722,0.20643767470661487,0.21381661776730748,0.2207186428753261,0.22721406110407222,
0.2333579349114362,0.2391942859295316,0.24475892765281868,0.2500814332305149,0.25518653946003345,0.2600951718542145,0.26482520821552014,0.26939205754235684,0.27380910584090884,0.27808806426285243,0.2822392443945425,0.28627177841712054,0.2901937969941595,0.2940125743549161,0.2977346476408758,0.3013659158571899,0.30491172251223664,0.3083769250994826,0.311765953881872,0.315082861915005,0.31833136784577337,0.32151489271552486,0.3246365917579799,0.3276993819951494,0.33070596628701154,0.3336588543735265,
0.336560381353843,0.3394127239721063,0.34221791501818183,0.3449778561018543,0.34769432901832303,0.350369005889286,0.3530034582361798,0.3555991651191077,0.35815752045576577,0.360679839618571,0.3631673653946448,0.36562127338186107,0.3680426768844678,0.37043263136354043,0.37279213849048415,0.3751221498457724,0.3774235702999315,0.3796972611093207,0.38194404275540383,0.38416469755287136,0.3863599720490726,0.38853057923469275,0.3906772005834086,0.39280048793632477,0.3949010652453065,0.39697953018783444,
0.3990364556647021,0.40107239119071786,0.4030878641875543,0.40508338118698156,0.40705942895191655,0.4090164755220073,0.41095497118983254,0.41287534941322973,0.41477802766875577,0.41666340825083015,0.41853187902070177,0.4203838141090141,0.4222195745754141,0.42403950902835275,0.4258439542079576,0.42763323553461496,0.4294076676256808,0.4311675547825421,0.43291319145006824,0.43464486265033075,0.43636284439232104,0.43806740405925904,0.439758800774965,0.44143728575065216,0.4431031026133969,0.44475648771744863,
0.4463976704394558,0.44802687345860653,0.4496443130226092,0.45125019920037296,0.4528447361221874,0.45442812220814444,0.4560005503854936,0.45756220829557587,0.4591132784909362,0.46065393862317483,0.46218436162206117,0.4637047158663982,0.4652151653470947,0.46671586982287233,0.46820698496900803,0.4696886625194857,0.4711610504029096,0.47262429287250746,0.4740785306305335,0.4755239009473612,0.4769605377755387,0.47838857185906314,0.4798081308381152,0.48121933934948075,0.48262231912287346,0.4840171890733601,
0.4854040653900775,0.4867830616214213,0.4881542887568748,0.4895178553056373,0.4908738673722041,0.4922224287290381,0.4935636408864699,0.4948976031599528,0.496224412734793,0.49754416472847035,0.4988569522506557,0.5001628664610298,0.501461996624999,0.5027544301674005,0.5040402527242843,0.5053195481928565,0.5065923987796591,0.5078588850470654,0.5091190859581595,0.5103730789200669,0.5116209398258046,0.5128627430947063,0.514098561711485,0.5153284672639881,0.516552529979695,0.5177708187610112,0.5189834012194042,
0.520190343708429,0.5213917113556842,0.5225875680937435,0.5237779766901,0.524962998776162,0.5261426948753368,0.5273171244302366,0.5284863458290399,0.5296504164310403,0.530809392591412,0.5319633296852224,0.5331122821307175,0.5342563034119088,0.5353954461004848,0.5365297618770742,0.5376593015518806,0.5387841150847137,0.5399042516044376,0.5410197594278565,0.5421306860780567,0.5432370783022257,0.5443389820889641,0.5454364426851102,0.5465295046120907,0.5476182116818177,0.5487026070121426,0.5497827330418863,
0.5508586315454556,0.5519303436470633,0.5529979098345615,0.5540613699729042,0.555120763317248,0.5561761285257049,0.5572275036717572,0.5582749262563468,0.5593184332196459,0.5603580609525242,0.5613938453077163,0.5624258216107048,0.5634540246703222,0.564478488789085,0.5654992477732644,0.5665163349427048,0.5675297831403955,0.5685396247418045,0.5695458916639811,0.5705486153744331,0.5715478268997879,0.5725435568342411,0.5735358353478003,0.5745246921943311,0.5755101567194079,0.5764922578679786,0.577471024191847,
0.5784464838569776,0.5794186646506286,0.5803875939883189,0.5813532989206311,0.582315806139859,0.5832751419864992,0.5842313324555962,0.5851844032029409,0.5861343795511286,0.5870812864954806,0.5880251487098322,0.5889659905521902,0.5899038360702656,0.5908387090068827,0.5917706328052692,0.5926996306142294,0.5936257252932051,0.5945489394172259,0.5954692952817516,0.5963868149074115,0.5973015200446405,0.5982134321782173,0.599122572531705,0.6000289620717986,0.60093262151258,0.6018335713196846,0.6027318317143798,
0.6036274226775593,0.6045203639536548,0.6054106750544663,0.606298375262915,0.6071834836367179,0.6080660190119893,0.6089460000067677,0.6098234450244732,0.6106983722572941,0.6115707996895061,0.6124407451007265,0.613308226069102,0.6141732599744346,0.6150358640012467,0.6158960551417848,0.6167538501989651,0.6176092657892629,0.6184623183455441,0.6193130241198446,0.620161399186094,0.6210074594427897,0.6218512206156173,0.6226926982600246,0.623531907763744,0.6243688643492697,0.6252035830762873,0.6260360788440587,
0.626866366393762,0.6276944603107898,0.6285203750270028,0.6293441248229434,0.6301657238300099,0.6309851860325884,0.6318025252701481,0.6326177552392989,0.63343088949581,0.6342419414565944,0.6350509244016576,0.6358578514760097,0.6366627356915467,0.6374655899288959,0.6382664269392303,0.6390652593460512,0.6398620996469384,0.6406569602152721,0.6414498533019224,0.6422407910369122,0.6430297854310497,0.6438168483775332,0.6446019916535295,0.6453852269217243,0.6461665657318468,0.646946019522169,0.6477235996209785,
0.6484993172480279,0.6492731835159596,0.6500452094317067,0.6508154058978702,0.651583783714075,0.6523503535783013,0.6531151260881964,0.653878111742364,0.6546393209416315,0.6553987639902987,0.6561564510973654,0.6569123923777382,0.6576665978534199,0.6584190774546778,0.6591698410211952,0.6599188983032032,0.660666258962595,0.6614119325740231,0.6621559286259783,0.6628982565218523,0.6636389255809841,0.6643779450396892,0.6651153240522729,0.665851071692029,0.6665851969522216,0.667317708747053,0.6680486159126159,
0.6687779272078317,0.6695056513153739,0.6702317968425779,0.6709563723223373,0.6716793862139855,0.6724008469041655,0.673120762707686,0.6738391418683641,0.6745559925598569,0.675271322886479,0.6759851408840097,0.6766974545204868,0.6774082716969896,0.67811760024841,0.6788254479442125,0.6795318224891835,0.6802367315241687,0.6809401826268009,0.6816421833122166,0.6823427410337628,0.6830418631836931,0.6837395570938545,0.6844358300363635,0.6851306892242741,0.6858241418122343,0.6865161948971349,0.6872068555187488,
0.687896130660361,0.6885840272493903,0.689270552158001,0.6899557122037085,0.6906395141499742,0.6913219647067927,0.6920030705312724,0.6926828382282061,0.6933612743506347,0.6940383854004035,0.6947141778287103,0.6953886580366461,0.6960618323757292,0.6967337071484312,0.6974042886086962,0.6980735829624533,0.6987415963681218,0.6994083349371105,0.7000738047343085,0.7007380117785719,0.7014009620432023,0.7020626614564196,0.7027231159018287,0.7033823312188793,0.7040403132033212,0.7046970676076518,0.7053526001415594,
0.7060069164723595,0.7066600222254262,0.7073119229846179,0.7079626242926972,0.7086121316517457,0.7092604505235738,0.7099075863301242,0.7105535444538713,0.7111983302382154,0.7118419489878712,0.7124844059692523,0.71312570641085,0.7137658555036082,0.7144048584012926,0.7150427202208567,0.7156794460428013,0.7163150409115315,0.7169495098357082,0.7175828577885948,0.7182150897084011,0.718846210498622,0.7194762250283715,0.720105138132714,0.7207329546129908,0.721359679237142,0.721985316740026,0.7226098718237337,
0.7232333491578999,0.7238557533800104,0.7244770890957053,0.7250973608790793,0.7257165732729777,0.7263347307892896,0.7269518379092367,0.7275678990836596,0.7281829187333003,0.728796901249081,0.7294098509923802,0.7300217722953055,0.7306326694609626,0.7312425467637221,0.7318514084494824,0.7324592587359297,0.7330661018127955,0.7336719418421106,0.7342767829584559,0.7348806292692114,0.735483484854801,0.7360853537689355,0.7366862400388527,0.737286147665554,0.7378850806240391,0.7384830428635379,0.7390800383077395,
0.7396760708550189,0.7402711443786605,0.7408652627270808,0.741458429724046,0.7420506491688895,0.7426419248367259,0.7432322604786622,0.7438216598220084,0.7444101265704832,0.7449976644044198,0.7455842769809682,0.7461699679342954,0.7467547408757834,0.7473385993942256,0.7479215470560205,0.748503587405363,0.7490847239644346,0.7496649602335902,0.7502442996915447,0.7508227457955557,0.7514003019816053,0.7519769716645798,0.7525527582384471,0.7531276650764331,0.753701695531195,0.7542748529349934,0.754847140599863,
0.7554185618177804,0.7559891198608314,0.7565588179813753,0.7571276594122083,0.757695647366725,0.7582627850390781,0.7588290756043364,0.7593945222186415,0.7599591280193618,0.7605228961252469,0.7610858296365782,0.7616479316353195,0.7622092051852651,0.7627696533321872,0.7633292791039805,0.7638880855108077,0.7644460755452401,0.7650032521824002,0.7655596183801003,0.7661151770789814,0.7666699312026493,0.7672238836578102,0.7677770373344053,0.7683293951057427,0.7688809598286291,0.7694317343435,0.7699817214745477,
0.7705309240298498,0.7710793448014944,0.7716269865657057,0.7721738520829675,0.772719944098145,0.7732652653406075,0.7738098185243465,0.7743536063480964,0.7748966314954512,0.775438896634981,0.7759804044203481,0.7765211574904205,0.7770611584693855,0.7776004099668616,0.7781389145780099,0.778676674883643,0.7792136934503352,0.7797499728305293,0.7802855155626435,0.7808203241711775,0.7813544011668172,0.7818877490465378,0.7824203702937074,0.782952267378188,0.783483442756437,0.7840138988716062,0.7845436381536416,
0.7850726630193806,0.7856009758726495,0.7861285791043594,0.7866554750926015,0.7871816662027413,0.7877071547875124,0.7882319431871087,0.7887560337292759,0.7892794287294033,0.7898021304906129,0.7903241413038489,0.7908454634479661,0.7913660991898175,0.7918860507843407,0.7924053204746444,0.7929239104920931,0.7934418230563915,0.7939590603756689,0.7944756246465603,0.7949915180542906,0.7955067427727543,0.7960213009645972,0.7965351947812954,0.7970484263632353,0.7975609978397913,0.7980729113294042,0.7985841689396577,
0.7990947727673552,0.799604724898595,0.8001140274088461,0.8006226823630215,0.8011306918155525,0.8016380578104618,0.8021447823814357,0.8026508675518954,0.8031563153350691,0.8036611277340616,0.8041653067419244,0.8046688543417252,0.8051717725066162,0.8056740631999023,0.8061757283751086,0.8066767699760472,0.8071771899368835,0.8076769901822017,0.8081761726270704,0.8086747391771066,0.8091726917285403,0.8096700321682774,0.8101667623739631,0.810662884214044,0.81115839954783,0.8116533102255556,0.8121476180884412,
0.8126413249687521,0.8131344326898597,0.8136269430663002,0.8141188579038331,0.8146101789994995,0.8151009081416802,0.8155910471101533,0.8160805976761496,0.8165695616024108,0.8170579406432438,0.8175457365445769,0.8180329510440145,0.8185195858708919,0.8190056427463286,0.8194911233832824,0.8199760294866028,0.8204603627530825,0.8209441248715112,0.8214273175227265,0.8219099423796651,0.8223920011074144,0.8228734953632629,0.8233544267967502,0.8238347970497164,0.8243146077563521,0.8247938605432471,0.8252725570294385,
0.8257506988264595,0.8262282875383863,0.8267053247618866,0.8271818120862655,0.8276577510935128,0.8281331433583488,0.82860799044827,0.8290822939235957,0.8295560553375114,0.8300292762361152,0.830501958158461,0.830974102636603,0.8314457111956398,0.831916785353757,0.8323873266222709,0.8328573365056704,0.8333268165016603,0.8337957681012022,0.8342641927885572,0.8347320920413266,0.8351994673304931,0.8356663201204616,0.8361326518690991,0.8365984640277758,0.8370637580414035,0.8375285353484762,0.8379927973811084,
0.8384565455650747,0.8389197813198476,0.8393825060586361,0.8398447211884238,0.8403064281100062,0.8407676282180282,0.8412283229010212,0.8416885135414399,0.8421482015156988,0.8426073881942083,0.843066074941411,0.8435242631158167,0.8439819540700386,0.8444391491508282,0.8448958496991095,0.8453520570500146,0.8458077725329176,0.8462629974714685,0.8467177331836275,0.8471719809816981,0.8476257421723606,0.8480790180567055,0.8485318099302657,0.8489841190830497,0.8494359467995736,0.8498872943588931,0.8503381630346358,
0.8507885540950325,0.8512384688029485,0.8516879084159152,0.8521368741861606,0.85258536736064,0.8530333891810667,0.8534809408839426,0.8539280237005873,0.8543746388571686,0.854820787574732,0.8552664710692298,0.8557116905515508,0.8561564472275487,0.856600742298071,0.8570445769589876,0.8574879524012193,0.8579308698107657,0.8583733303687329,0.8588153352513616,0.8592568856300545,0.859697982671404,0.8601386275372181,0.8605788213845489,0.8610185653657182,0.8614578606283446,0.8618967083153697,0.8623351095650842,
0.8627730655111538,0.8632105772826455,0.8636476460040526,0.8640842727953206,0.8645204587718719,0.8649562050446316,0.8653915127200517,0.8658263829001364,0.8662608166824664,0.866694815160223,0.8671283794222129,0.8675615105528918,0.8679942096323882,0.8684264777365276,0.8688583159368556,0.8692897253006614,0.8697207068910011,0.8701512617667205,0.8705813909824783,0.8710110955887687,0.871440376631944,0.8718692351542368,0.8722976721937826,0.872725688784642,0.8731532859568221,0.8735804647362989,0.8740072261450385,
0.8744335712010189,0.8748595009182516,0.8752850163068022,0.8757101183728118,0.876134808118518,0.8765590865422758,0.8769829546385779,0.8774064133980755,0.8778294638075984,0.8782521068501757,0.8786743435050556,0.879096174747725,0.87951760154993,0.8799386248796953,0.8803592457013438,0.8807794649755161,0.8811992836591893,0.8816187027056972,0.8820377230647484,0.8824563456824455,0.8828745715013043,0.8832924014602719,0.8837098364947455,0.884126877536591,0.8845435255141612,0.8849597813523133,0.8853756459724286,
0.8857911202924285,0.8862062052267938,0.8866209016865818,0.8870352105794438,0.8874491328096428,0.8878626692780711,0.888275820882267,0.8886885885164322,0.8891009730714491,0.8895129754348972,0.8899245964910704,0.8903358371209934,0.8907466982024383,0.8911571806099414,0.8915672852148191,0.8919770128851846,0.8923863644859639,0.8927953408789115,0.8932039429226274,0.8936121714725718,0.8940200273810814,0.8944275114973853,0.8948346246676199,0.895241367734845,0.8956477415390587,0.8960537469172131,0.896459384703229,
0.8968646557280114,0.8972695608194643,0.8976741008025054,0.8980782764990811,0.8984820887281812,0.8988855383058536,0.8992886260452183,0.8996913527564827,0.9000937192469548,0.9004957263210588,0.9008973747803478,0.9012986654235191,0.9016995990464275,0.9021001764420992,0.9025003984007458,0.9029002657097783,0.9032997791538201,0.9036989395147207,0.9040977475715697,0.9044962041007096,0.9048943098757493,0.9052920656675773,0.9056894722443748,0.906086530371629,0.9064832408121458,0.9068796043260627,0.9072756216708617,
0.9076712936013822,0.9080666208698333,0.9084616042258066,0.9088562444162888,0.909250542185674,0.909644498275776,0.9100381134258407,0.9104313883725582,0.9108243238500753,0.9112169205900067,0.911609179321448,0.9120011007709872,0.912392685662716,0.9127839347182426,0.9131748486567027,0.9135654281947713,0.9139556740466742,0.9143455869241996,0.9147351675367098,0.9151244165911517,0.9155133347920691,0.9159019228416131,0.9162901814395539,0.9166781112832916,0.9170657130678669,0.9174529874859728,0.9178399352279649,
0.9182265569818724,0.9186128534334087,0.9189988252659826,0.9193844731607087,0.9197697977964173,0.9201547998496661,0.9205394799947498,0.9209238389037109,0.9213078772463497,0.9216915956902347,0.9220749949007134,0.9224580755409214,0.9228408382717931,0.9232232837520717,0.9236054126383193,0.9239872255849265,0.9243687232441223,0.9247499062659842,0.9251307752984477,0.925511330987316,0.9258915739762699,0.9262715049068767,0.9266511244186009,0.9270304331488122,0.9274094317327963,0.9277881208037635,0.9281665009928579,
0.9285445729291671,0.9289223372397313,0.9292997945495522,0.9296769454816025,0.9300537906568345,0.9304303306941893,0.9308065662106061,0.9311824978210302,0.931558126138423,0.9319334517737698,0.9323084753360892,0.9326831974324412,0.9330576186679365,0.9334317396457447,0.9338055609671028,0.934179083231324,0.934552307035806,0.9349252329760395,0.935297861645616,0.935670193636237,0.936042229537722,0.936413969938016,0.9367854154231987,0.937156566577492,0.9375274239832683,0.9378979882210586,0.9382682598695602,
0.938638239505645,0.9390079277043673,0.9393773250389714,0.9397464320808999,0.9401152493998012,0.9404837775635372,0.9408520171381909,0.9412199686880747,0.9415876327757369,0.9419550099619702,0.9423221008058192,0.9426889058645871,0.943055425693844,0.9434216608474337,0.9437876118774816,0.9441532793344015,0.9445186637669033,0.944883765722,0.9452485857450149,0.9456131243795891,0.945977382167688,0.9463413596496092,0.9467050573639889,0.9470684758478091,0.9474316156364045,0.9477944772634701,0.9481570612610669,
0.9485193681596299,0.948881398487974,0.9492431527733017,0.9496046315412092,0.9499658353156932,0.950326764619158,0.9506874199724215,0.9510478018947224,0.9514079109037265,0.9517677475155331,0.9521273122446822,0.9524866056041599,0.9528456281054056,0.9532043802583186,0.9535628625712634,0.9539210755510774,0.9542790197030759,0.9546366955310597,0.9549941035373201,0.9553512442226458,0.955708118086329,0.9560647256261716,0.956421067338491,0.9567771437181263,0.9571329552584446,0.9574885024513466,0.9578437857872732,
0.9581988057552107,0.9585535628426971,0.9589080575358283,0.9592622903192632,0.9596162616762304,0.9599699720885332,0.9603234220365561,0.9606766119992698,0.9610295424542377,0.9613822138776207,0.9617346267441839,0.9620867815273011,0.9624386786989614,0.962790318729774,0.9631417020889744,0.9634928292444291,0.963843700662642,0.9641943168087592,0.9645446781465745,0.9648947851385351,0.9652446382457469,0.9655942379279795,0.9659435846436719,0.9662926788499377,0.9666415210025703,0.9669901115560479,0.9673384509635392,
0.9676865396769084,0.9680343781467202,0.9683819668222451,0.9687293061514642,0.969076396581075,0.9694232385564956,0.9697698325218702,0.970116178920074,0.9704622781927181,0.970808130780155,0.9711537371214826,0.9714990976545498,0.9718442128159609,0.9721890830410812,0.972533708764041,0.9728780904177409,0.9732222284338563,0.9735661232428426,0.9739097752739395,0.9742531849551758,0.9745963527133741,0.9749392789741559,0.9752819641619453,0.9756244086999749,0.9759666130102891,0.9763085775137494,0.9766503026300392,
0.9769917887776673,0.9773330363739738,0.9776740458351333,0.9780148175761602,0.9783553520109127,0.9786956495520978,0.9790357106112746,0.97937553559886,0.9797151249241322,0.9800544789952351,0.9803935982191831,0.9807324830018651,0.9810711337480483,0.9814095508613835,0.9817477347444082,0.9820856857985518,0.9824234044241392,0.9827608910203951,0.9830981459854481,0.9834351697163352,0.9837719626090052,0.9841085250583236,0.9844448574580762,0.984780960200973,0.985116833678653,0.9854524782816871,0.9857878943995831,
0.9861230824207893,0.9864580427326981,0.9867927757216505,0.9871272817729397,0.9874615612708154,0.987795614598487,0.9881294421381279,0.9884630442708796,0.9887964213768549,0.989129573835142,0.9894625020238087,0.9897952063199055,0.9901276870994697,0.9904599447375294,0.9907919796081064,0.9911237920842207,0.9914553825378941,0.9917867513401535,0.9921178988610346,0.992448825469586,0.9927795315338723,0.9931100174209779,0.9934402834970106,0.9937703301271053,0.9941001576754271,0.9944297665051756,0.9947591569785874,
0.9950883294569406,0.9954172843005578,0.9957460218688093,0.9960745425201175,0.996402846611959,0.9967309345008691,0.997058806542445,0.9973864630913489,0.9977139045013114,0.9980411311251348,0.9983681433146974,0.998694941420955,0.9990215257939463,0.9993478967827943,0.999674054735711,1]);var b,o=k.length,a=e[a],l=e[l],c=e[c],e=0.00433891*a+0.00376234915*l+0.0018990604648*c;b=0.002126*a+0.007152*l+7.22E-4*c;a=1.77255E-4*a+0.00109475308*l+0.0087295537*c;e=0.008856<e?1<=e?k[o-1]:k[e*o|0]:7.787*e+16/116;
b=0.008856<b?1<=b?k[o-1]:k[b*o|0]:7.787*b+16/116;a=0.008856<a?1<=a?k[o-1]:k[a*o|0]:7.787*a+16/116;return[2.55*(116*b-16),500*(e-b)+127,200*(b-a)+127]},lab2rgb:function(a){var l=(a[0]/2.55+16)/116,c=(a[1]-127)/500+l,a=l-(a[2]-127)/200,e=l*l*l,k=c*c*c,b=a*a*a,c=0.95047*(0.008856<k?k:(c-16/116)/7.787),l=1*(0.008856<e?e:(l-16/116)/7.787),a=1.08883*(0.008856<b?b:(a-16/116)/7.787),e=3.2406*c+-1.5372*l+-0.4986*a,k=-0.9689*c+1.8758*l+0.0415*a,l=0.0557*c+-0.204*l+1.057*a,e=0.0031308<e?1.055*Math.pow(e,0.41666666666667)-
0.055:12.92*e,k=0.0031308<k?1.055*Math.pow(k,0.41666666666667)-0.055:12.92*k,l=0.0031308<l?1.055*Math.pow(l,0.41666666666667)-0.055:12.92*l;return[255*e+0.5|0,255*k+0.5|0,255*l+0.5|0]},lab2rgbwithmapping:function(a,l){"object"!==typeof l&&(l=[0,0.01262952101661779,0.02525904203323558,0.03788856304985337,0.049711876377871826,0.05991457469741709,0.06898447286600867,0.0772092360066284,0.08477358579410943,0.091804259875822,0.09839255413111209,0.10460674144643575,0.11049941567981197,0.116112082049842,
0.12147815731101994,0.12662500399558943,0.13157535287823224,0.1363483240840589,0.1409601768441825,0.14542487095720244,0.14975449458714327,0.15395959525747982,0.1580494394769152,0.16203221890462635,0.16591521589126665,0.16970493774704687,0.17340722665014255,0.1770273503750349,0.18057007776923878,0.18403974199157158,0.18744029384710506,0.19077534704588353,0.1940482168277028,0.19726195310091915,0.20041936901604623,0.20352306571797985,0.2065754538818233,0.20957877252746188,0.21253510552056065,0.21544639609752403,
0.21831445969536206,0.2211409953214818,0.2239275956609244,0.22667575608780954,0.22938688272237368,0.2320622996539648,0.2347032554328511,0.2373109289190679,0.2398864345642407,0.24243082719196402,0.24494510633355537,0.24743022016856214,0.2498870691130589,0.25231650909335385,0.25471935453807176,0.25709638111758565,0.2594483282563151,0.2617759014404253,0.26407977434087276,0.2663605907694862,0.26861896648381073,0.27085549085472227,0.2730707284093175,0.2752652202602596,0.2774394854315987,0.27959402209005907,
0.2817293086898797,0.28384580503848866,0.2859439532895821,0.2880241788695442,0.29008689134257926,0.2921324852194264,0.2941613407140744,0.296173824452494,0.29817029013704466,0.30015107916988515,0.30211652123843086,0.3040669348656343,0.3060026279276311,0.30792389814107823,0.3098310335223196,0.3117243128203384,0.3136040059252957,0.3154703742543138,0.3173236711160275,0.3191641420553126,0.32099202517948666,0.3228075514671829,0.32461094506100485,0.32640242354498716,0.328182198207814,0.3299504742926743,
0.331707451234572,0.33345332288585067,0.3351882777306368,0.33691249908885884,0.33862616531045336,0.3403294499603252,0.3420225219945948,0.3437055459286266,0.34537868199729943,0.34704208630795363,0.3486959109864158,0.3503403043164812,0.3519754108732058,0.35360137165034033,0.3552183241822174,0.3568264026603817,0.35842573804523775,0.3600164581729729,0.3615986878579945,0.36317254899111157,0.36473816063367165,0.3662956391078557,0.36784509808331944,0.3693866486603606,0.37092039944977906,0.37244645664958986,
0.3739649241187381,0.37547590344795784,0.37697949402790815,0.3784757931147127,0.3799648958930234,0.3814468955367197,0.3829218832673514,0.3843899484104266,0.38585117844964034,0.3873056590791346,0.38875347425387746,0.39019470623824154,0.3916294356528607,0.39305774151983813,0.3944797013063766,0.3958953909668962,0.3973048849837052,0.398708256406281,0.4001055768892218,0.40149691672892146,0.40288234489901914,0.4042619290846755,0.40563573571572004,0.40700382999871526,0.4083662759479818,0.409723136415623,
0.4110744731205898,0.41242034667682187,0.4137608166205015,0.41509594143645334,0.41642577858372254,0.41775038452036234,0.41906981472746097,0.420384123732435,0.4216933651316181,0.4229975916121692,0.42429685497332564,0.4255912061470252,0.4268806952179194,0.4281653714427998,0.42944528326945836,0.43072047835500143,0.4319910035836372,0.43325690508395387,0.43451822824570774,0.43577501773613614,0.43702731751581336,0.43827517085406376,0.4395186203439474,0.44075770791683294,0.4419924748565711,0.44322296181328236,
0.4444492088167707,0.445671255289577,0.4468891400596831,0.4481029013728773,0.44931257690479337,0.45051820377263313,0.4517198185465818,0.45291745726092675,0.4541111554248895,0.4553009480331786,0.45648686957627277,0.4576689540504429,0.45884723496752006,0.46002174536441914,0.46119251781242304,0.4623595844262362,0.46352297687281546,0.46468272637998137,0.46583886374482125,0.46699141934188554,0.46814042313118737,0.469285904666008,0.47042789310051664,0.47156641719720765,0.4727015053341615,0.4738331855121353,
0.47496148536148547,0.47608643214893004,0.4772080527841532,0.47832637382625737,0.479441421490067,0.4805532216522879,0.4816617998575264,0.482767181324172,0.48386939095014764,0.48496845331853117,0.4860643927030504,0.4871572330734569,0.48824699810078104,0.48933371116247054,0.4904173953474175,0.4914980734608752,0.4925757680292682,0.49365050130489957,0.49472229527055495,0.49579117164401115,0.49685715188244534,0.49792025718675353,0.4989805085057765,0.5000379265404378,0.5010925317477942,0.5021443443450035,
0.5031933843132081,0.5042396714013406,0.5052832251298499,0.5063240647943513,0.5073622094692027,0.5083976780110088,0.5094304890620533,0.5104606610536634,0.5114882122095067,0.512513160548822,0.5135355238895871,0.514555319851623,0.5155725658596376,0.5165872791462103,0.5175994767547175,0.518609175542202,0.5196163921821871,0.5206211431674361,0.5216234448126594,0.522623313257169,0.5236207644674844,0.5246158142398872,0.5256084782029289,0.5265987718198912,0.5275867103912004,0.5285723090567965,0.5295555827984594,
0.5305365464420905,0.5315152146599541,0.5324916019728768,0.533465722752407,0.5344375912229347,0.5354072214637743,0.5363746274112078,0.5373398228604933,0.5383028214678364,0.5392636367523269,0.5402222820978414,0.5411787707549106,0.5421331158425572,0.5430853303500971,0.5440354271389132,0.5449834189441957,0.545929318376653,0.5468731379241937,0.5478148899535785,0.5487545867120445,0.5496922403289016,0.550627862817102,0.5515614660747821,0.5524930618867796,0.5534226619261247,0.5543502777555052,0.5552759208287091,
0.5561996024920415,0.5571213339857184,0.5580411264452384,0.5589589909027302,0.5598749382882796,0.5607889794312336,0.5617011250614838,0.5626113858107291,0.5635197722137174,0.5644262947094677,0.5653309636424726,0.5662337892638817,0.5671347817326651,0.5680339511167598,0.5689313073941972,0.5698268604542126,0.5707206200983378,0.5716125960414764,0.5725027979129619,0.5733912352575995,0.5742779175366926,0.5751628541290517,0.5760460543319896,0.5769275273622997,0.5778072823572206,0.5786853283753848,0.5795616743977544,
0.5804363293285412,0.5813093019961135,0.5821806011538895,0.5830502354812169,0.5839182135842398,0.5847845439967515,0.5856492351810363,0.5865122955286974,0.5873737333614738,0.5882335569320437,0.5890917744248176,0.5899483939567188,0.5908034235779529,0.5916568712727662,0.5925087449601928,0.5933590524947909,0.5942078016673694,0.5950550002057023,0.5959006557752352,0.5967447759797787,0.5975873683621958,0.5984284404050756,0.5992679995314003,0.6001060531052015,0.6009426084322078,0.601777672760483,0.6026112532810554,
0.6034433571285388,0.6042739913817439,0.6051031630642828,0.6059308791451635,0.6067571465393772,0.6075819721084775,0.6084053626611514,0.6092273249537822,0.6100478656910059,0.6108669915262589,0.6116847090623188,0.6125010248518375,0.6133159453978685,0.614129477154385,0.6149416265267927,0.6157523998724356,0.6165618035010941,0.6173698436754775,0.6181765266117102,0.6189818584798096,0.6197858454041609,0.6205884934639824,0.621389808693787,0.6221897970838367,0.6229884645805916,0.6237858170871525,0.6245818604636987,
0.6253766005279194,0.6261700430554399,0.6269621937802424,0.627753058395081,0.628542642551892,0.6293309518621987,0.6301179918975115,0.6309037681897214,0.6316882862314913,0.6324715514766395,0.6332535693405202,0.6340343452003991,0.6348138843958234,0.6355921922289883,0.6363692739650979,0.6371451348327226,0.6379197800241517,0.6386932146957418,0.6394654439682601,0.6402364729272251,0.6410063066232419,0.6417749500723333,0.6425424082562685,0.6433086861228857,0.6440737885864122,0.6448377205277801,0.645600486794939,
0.6463620922031635,0.6471225415353585,0.6478818395423597,0.6486399909432315,0.6493970004255614,0.6501528726457492,0.650907612229295,0.6516612237710832,0.6524137118356617,0.6531650809575201,0.6539153356413631,0.6546644803623813,0.6554125195665185,0.6561594576707364,0.6569052990632761,0.6576500481039163,0.6583937091242286,0.6591362864278302,0.6598777842906337,0.6606182069610937,0.6613575586604503,0.6620958435829714,0.6628330658961898,0.6635692297411403,0.664304339232592,0.665038398459279,0.6657714114841288,
0.6665033823444867,0.6672343150523395,0.6679642135945361,0.6686930819330041,0.6694209240049673,0.6701477437231571,0.6708735449760244,0.6715983316279475,0.6723221075194388,0.6730448764673485,0.6737666422650662,0.6744874086827211,0.6752071794673781,0.6759259583432347,0.6766437490118126,0.6773605551521499,0.6780763804209894,0.6787912284529659,0.6795051028607908,0.6802180072354358,0.6809299451463133,0.6816409201414555,0.6823509357476922,0.6830599954708256,0.6837681027958041,0.684475261186894,0.6851814740878487,
0.6858867449220779,0.6865910770928132,0.6872944739832727,0.6879969389568239,0.6886984753571457,0.6893990865083861,0.6900987757153224,0.6907975462635155,0.6914954014194653,0.692192344430764,0.6928883785262472,0.6935835069161438,0.6942777327922245,0.694971059327949,0.6956634896786107,0.6963550269814812,0.6970456743559527,0.6977354349036788,0.6984243117087141,0.6991123078376528,0.699799426339765,0.7004856702471326,0.7011710425747831,0.7018555463208224,0.7025391844665666,0.7032219599766716,0.7039038757992623,
0.7045849348660602,0.7052651400925095,0.7059444943779024,0.7066230006055029,0.7073006616426692,0.707977480340976,0.7086534595363333,0.7093286020491069,0.7100029106842357,0.7106763882313484,0.7113490374648795,0.7120208611441837,0.7126918620136494,0.7133620428028108,0.7140314062264597,0.7146999549847549,0.7153676917633327,0.7160346192334134,0.7167007400519098,0.7173660568615324,0.7180305722908951,0.7186942889546185,0.719357209453434,0.720019336374285,0.7206806722904288,0.7213412197615364,0.7220009813337923,
0.7226599595399918,0.7233181568996399,0.7239755759190464,0.724632219091423,0.7252880888969768,0.7259431878030049,0.7265975182639874,0.727251082721679,0.7279038836052013,0.7285559233311324,0.7292072043035966,0.7298577289143543,0.7305074995428886,0.7311565185564938,0.7318047883103603,0.7324523111476625,0.7330990893996414,0.7337451253856901,0.7343904214134368,0.7350349797788271,0.7356788027662066,0.7363218926484012,0.7369642516867986,0.7376058821314261,0.7382467862210323,0.7388869661831627,0.7395264242342394,
0.7401651625796365,0.7408031834137572,0.741440488920109,0.7420770812713791,0.7427129626295076,0.7433481351457623,0.7439826009608107,0.744616362204793,0.7452494209973932,0.7458817794479106,0.7465134396553299,0.7471444037083915,0.7477746736856601,0.7484042516555937,0.7490331396766116,0.749661339797162,0.7502888540557885,0.7509156844811968,0.75154183309232,0.7521673018983844,0.7527920928989733,0.7534162080840919,0.7540396494342302,0.7546624189204263,0.7552845185043287,0.7559059501382585,0.7565267157652705,
0.7571468173192143,0.7577662567247944,0.7583850358976305,0.7590031567443164,0.7596206211624794,0.7602374310408384,0.7608535882592614,0.7614690946888241,0.7620839521918652,0.7626981626220444,0.7633117278243974,0.7639246496353923,0.7645369298829836,0.7651485703866682,0.7657595729575378,0.766369939398335,0.7669796715035041,0.7675887710592457,0.7681972398435691,0.768805079626343,0.7694122921693485,0.7700188792263292,0.7706248425430432,0.7712301838573123,0.7718349048990725,0.7724390073904231,0.773042493045677,
0.7736453635714078,0.7742476206664997,0.7748492660221942,0.7754503013221389,0.7760507282424334,0.776650548451678,0.7772497636110178,0.7778483753741909,0.7784463853875732,0.7790437952902235,0.7796406067139292,0.7802368212832507,0.7808324406155657,0.781427466321113,0.7820219000030365,0.7826157432574284,0.7832089976733718,0.7838016648329837,0.7843937463114573,0.7849852436771035,0.7855761584913932,0.7861664923089979,0.7867562466778316,0.7873454231390905,0.787934023227294,0.7885220484703245,0.7891095003894674,
0.78969638049945,0.7902826903084814,0.790868431318291,0.7914536050241666,0.7920382129149933,0.7926222564732914,0.7932057371752538,0.7937886564907835,0.7943710158835304,0.7949528168109292,0.7955340607242347,0.7961147490685586,0.7966948832829057,0.7972744648002096,0.7978534950473676,0.7984319754452766,0.7990099074088677,0.7995872923471412,0.8001641316632006,0.8007404267542867,0.8013161790118125,0.8018913898213956,0.8024660605628923,0.8030401926104308,0.8036137873324438,0.8041868460917015,0.8047593702453443,
0.8053313611449138,0.8059028201363865,0.806473748560204,0.8070441477513057,0.8076140190391593,0.808183363747792,0.8087521831958219,0.8093204786964877,0.8098882515576799,0.8104555030819705,0.8110222345666428,0.811588447303722,0.8121541425800035,0.8127193216770835,0.8132839858713867,0.8138481364341967,0.8144117746316832,0.8149749017249316,0.8155375189699711,0.816099627617802,0.8166612289144245,0.8172223241008661,0.8177829144132087,0.8183430010826165,0.8189025853353624,0.819461668392856,0.8200202514716689,
0.8205783357835622,0.821135922535513,0.8216930129297397,0.8222496081637287,0.8228057094302597,0.8233613179174317,0.8239164348086886,0.8244710612828438,0.8250251985141056,0.8255788476721027,0.8261320099219078,0.8266846864240632,0.8272368783346047,0.827788586805086,0.8283398129826024,0.8288905580098155,0.829440823024976,0.8299906091619481,0.8305399175502322,0.8310887493149887,0.8316371055770607,0.8321849874529976,0.8327323960550771,0.8332793324913279,0.833825797865553,0.8343717932773512,0.8349173198221393,
0.835462378591175,0.8360069706715774,0.83655109714635,0.8370947590944016,0.8376379575905678,0.8381806937056326,0.8387229685063494,0.8392647830554617,0.8398061384117246,0.8403470356299247,0.8408874757609016,0.8414274598515679,0.8419669889449293,0.8425060640801054,0.8430446862923493,0.8435828566130675,0.84412057606984,0.84465784568644,0.8451946664828526,0.8457310394752956,0.8462669656762376,0.8468024460944176,0.8473374817348641,0.8478720735989141,0.8484062226842315,0.8489399299848259,0.8494731964910713,
0.8500060231897245,0.8505384110639432,0.8510703610933044,0.8516018742538222,0.8521329515179663,0.852663593854679,0.8531938022293939,0.8537235776040522,0.8542529209371217,0.854781833183613,0.8553103152950976,0.8558383682197243,0.8563659929022369,0.8568931902839906,0.8574199613029695,0.8579463068938025,0.8584722279877803,0.8589977255128725,0.8595228003937431,0.8600474535517671,0.860571685905047,0.8610954983684285,0.8616188918535168,0.8621418672686924,0.8626644255191268,0.8631865675067983,0.8637082941305079,
0.8642296062858937,0.864750504865448,0.8652709907585314,0.8657910648513881,0.8663107280271617,0.8668299811659093,0.8673488251446174,0.867867260837216,0.8683852891145937,0.8689029108446124,0.8694201268921217,0.8699369381189732,0.8704533453840357,0.8709693495432085,0.8714849514494362,0.8720001519527227,0.8725149519001453,0.8730293521358685,0.873543353501158,0.8740569568343945,0.8745701629710876,0.8750829727438886,0.8755953869826052,0.8761074065142143,0.8766190321628751,0.8771302647499432,0.8776411050939833,
0.8781515540107819,0.8786616123133618,0.8791712808119936,0.8796805603142088,0.8801894516248137,0.8806979555459011,0.8812060728768631,0.8817138044144045,0.882221150952554,0.8827281132826775,0.883234692193491,0.8837408884710714,0.8842467028988698,0.8847521362577235,0.8852571893258682,0.8857618628789493,0.8862661576900348,0.8867700745296263,0.8872736141656715,0.8877767773635756,0.8882795648862128,0.8887819774939383,0.8892840159445996,0.8897856809935476,0.8902869733936489,0.8907878938952963,0.8912884432464204,
0.8917886221925007,0.8922884314765765,0.8927878718392589,0.8932869440187404,0.8937856487508071,0.8942839867688488,0.8947819588038698,0.8952795655845005,0.8957768078370067,0.8962736862853018,0.8967702016509559,0.8972663546532074,0.8977621460089725,0.8982575764328569,0.8987526466371646,0.899247357331909,0.8997417092248232,0.90023570302137,0.9007293394247513,0.9012226191359196,0.9017155428535865,0.9022081112742335,0.9027003250921215,0.9031921849993009,0.9036836916856209,0.90417484583874,0.9046656481441341,
0.9051560992851082,0.9056461999428044,0.9061359507962115,0.9066253525221751,0.9071144057954066,0.9076031112884924,0.9080914696719034,0.9085794816140041,0.9090671477810619,0.9095544688372559,0.9100414454446862,0.9105280782633834,0.9110143679513163,0.911500315164402,0.9119859205565143,0.9124711847794927,0.9129561084831508,0.9134406923152851,0.9139249369216844,0.9144088429461374,0.9148924110304419,0.915375641814413,0.9158585359358921,0.9163410940307543,0.9168233167329184,0.9173052046743536,0.9177867584850888,
0.9182679787932209,0.9187488662249219,0.9192294214044485,0.9197096449541494,0.9201895374944735,0.9206690996439783,0.9211483320193369,0.9216272352353475,0.9221058099049397,0.9225840566391834,0.9230619760472966,0.9235395687366524,0.9240168353127874,0.9244937763794097,0.9249703925384051,0.9254466843898465,0.9259226525320003,0.9263982975613347,0.9268736200725265,0.9273486206584685,0.9278232999102779,0.9282976584173026,0.9287716967671293,0.9292454155455901,0.9297188153367703,0.9301918967230154,0.9306646602849383,
0.9311371066014265,0.9316092362496491,0.9320810498050639,0.9325525478414245,0.9330237309307874,0.9334945996435183,0.9339651545483003,0.9344353962121393,0.9349053252003717,0.9353749420766716,0.9358442474030564,0.9363132417398943,0.9367819256459111,0.9372502996781967,0.9377183643922115,0.9381861203417932,0.9386535680791633,0.9391207081549341,0.9395875411181145,0.9400540675161166,0.9405202878947628,0.9409862027982911,0.9414518127693627,0.9419171183490671,0.9423821200769295,0.9428468184909163,0.9433112141274416,
0.9437753075213736,0.9442390992060405,0.9447025897132368,0.9451657795732294,0.9456286693147632,0.946091259465068,0.946553550549864,0.9470155430933681,0.9474772376182993,0.947938634645885,0.9483997346958671,0.9488605382865075,0.9493210459345939,0.9497812581554465,0.9502411754629217,0.9507007983694208,0.9511601273858931,0.9516191630218428,0.9520779057853349,0.9525363561829999,0.9529945147200402,0.9534523819002355,0.9539099582259479,0.9543672441981287,0.9548242403163215,0.9552809470786706,0.9557373649819242,
0.9561934945214409,0.9566493361911946,0.9571048904837803,0.957560157890419,0.9580151389009636,0.9584698340039032,0.9589242436863693,0.9593783684341407,0.9598322087316485,0.9602857650619817,0.9607390379068922,0.9611920277467992,0.9616447350607958,0.9620971603266527,0.9625493040208236,0.9630011666184514,0.9634527485933709,0.9639040504181161,0.9643550725639237,0.9648058155007385,0.9652562796972185,0.9657064656207391,0.9661563737373994,0.9666060045120247,0.9670553584081741,0.9675044358881427,0.9679532374129683,
0.9684017634424352,0.9688500144350788,0.969297990848191,0.9697456931378244,0.9701931217587966,0.9706402771646961,0.9710871598078853,0.9715337701395063,0.9719801086094847,0.9724261756665348,0.9728719717581634,0.9733174973306754,0.9737627528291767,0.9742077386975799,0.9746524553786086,0.9750969033138012,0.9755410829435159,0.9759849947069349,0.9764286390420681,0.976872016385759,0.9773151271736872,0.9777579718403738,0.9782005508191854,0.9786428645423387,0.9790849134409042,0.9795266979448097,0.9799682184828468,
0.9804094754826725,0.9808504693708154,0.9812912005726785,0.9817316695125434,0.9821718766135753,0.9826118222978263,0.9830515069862399,0.9834909310986545,0.9839300950538076,0.9843689992693404,0.9848076441618009,0.9852460301466487,0.9856841576382579,0.9861220270499221,0.9865596387938579,0.9869969932812083,0.9874340909220475,0.9878709321253837,0.9883075172991641,0.9887438468502779,0.9891799211845601,0.9896157407067957,0.9900513058207229,0.9904866169290382,0.9909216744333976,0.9913564787344237,0.9917910302317056,
0.9922253293238062,0.9926593764082635,0.9930931718815946,0.9935267161393003,0.9939600095758677,0.9943930525847745,0.9948258455584919,0.9952583888884886,0.9956906829652349,0.9961227281782049,0.9965545249158808,0.9969860735657569,0.9974173745143414,0.9978484281471626,0.9982792348487693,0.9987097950027365,0.9991401089916675,0.9995701771971982,1]);var c=l.length,e=(a[0]/2.55+16)/116,k=(a[1]-127)/500+e,b=e-(a[2]-127)/200,o=e*e*e,j=k*k*k,d=b*b*b,k=0.95047*(0.008856<j?j:(k-16/116)/7.787),e=1*(0.008856<o?
o:(e-16/116)/7.787),b=1.08883*(0.008856<d?d:(b-16/116)/7.787),o=3.2406*k+-1.5372*e+-0.4986*b,j=-0.9689*k+1.8758*e+0.0415*b,e=0.0557*k+-0.204*e+1.057*b,o=0>=o?0:1<=o?1:l[o*c|0],j=0>=j?0:1<=j?1:l[j*c|0],e=0>=e?0:1<=e?1:l[e*c|0];return[255*o+0.5|0,255*j+0.5|0,255*e+0.5|0]}}});
Z.d("/src/js/processors/histogramMapping.js",function(g,q){q.e={fadeMapping:function(a,l){for(var c=0;256>c;c++)a.r[c]=c*(1-l)+a.r[c]*l+0.5|0,a.g[c]=c*(1-l)+a.g[c]*l+0.5|0,a.b[c]=c*(1-l)+a.b[c]*l+0.5|0,a.r[c]=0>a.r[c]?0:255<a.r[c]?255:a.r[c],a.g[c]=0>a.g[c]?0:255<a.g[c]?255:a.g[c],a.b[c]=0>a.b[c]?0:255<a.b[c]?255:a.b[c]},mapHist:function(a,l){for(var c=a.length,e=0;e<c;)a[e]=l.r[a[e]],a[e+1]=l.g[a[e+1]],a[e+2]=l.b[a[e+2]],e+=4}}});
Z.d("/src/js/processors/copy.js",function(g,q){function a(a){try{return document.createElement("canvas").getContext("2d").getImageData(0,0,1,Math.ceil(a/4)).data}catch(c){return Array(a)}}q.e={copy:function(l){var c;c="undefined"!==typeof Uint8ClampedArray?new Uint8ClampedArray(l.length):a(l.length);for(var e=l.length,k=0;k<e;k+=4)c[k]=l[k],c[k+1]=l[k+1],c[k+2]=l[k+2],c[k+3]=l[k+3];return c},copyTo:function(a,c){for(var e=c.length,k=0;k<e;k+=4)a[k]=c[k],a[k+1]=c[k+1],a[k+2]=c[k+2],a[k+3]=c[k+3];return a},
makeData:function(l){return"undefined"!==typeof Uint8ClampedArray?new Uint8ClampedArray(l):a(l)}}});
Z.d("/src/js/processors/legacy/whiten2.js",function(g,q){var a={},l=g("../colorConversion"),c=g("./mask");a.whiten2=function(e,k,b,a,j){for(var d=[],f=0;256>f;f++)d[f]=0.04045>=f/255?100*f/255/12.92:100*Math.pow((f/255+0.055)/1.055,2.4);for(var m=Array(k*b),f=0;f<k*b;f++)m[f]=0;for(var h=0.7*j,f=0;f<a.length;f++)c.maskspottool(k,b,m,a[f][0],a[f][1],j,h);for(var n,j=0;j<b;j++)for(f=0;f<k;f++)a=4*(f+k*j),m[f+k*j]&&(h=l.rgb2lab(e[a],e[a+1],e[a+2],d),n=Math.pow(h[1]-127,2)+Math.min(Math.pow(h[2]-154,
2),Math.pow(h[2]-170,2)),n=Math.exp(-n/100)*m[f+k*j],h=l.lab2rgb([255*Math.pow(h[0]/255,1-0.4*n),h[1],(1-n)*(h[2]-127)+127]),e[a]=h[0],e[a+1]=h[1],e[a+2]=h[2])};q.e=a});
Z.d("/src/js/processors/legacy/mask.js",function(g,q){q.e={maskspottool:function(a,l,c,e,k,b,o,j){"undefined"===typeof j&&(j=1);for(var d=b*b,f=o*o,m=Math.max(0,Math.min(a-1,Math.round(e-b))),h=Math.max(0,Math.min(l-1,Math.round(k-b))),n=Math.max(0,Math.min(a-1,Math.round(e+b))),l=Math.max(0,Math.min(l-1,Math.round(k+b))),p,b=h;b<=l;b++)for(var i=m;i<=n;i++)h=i+a*b,p=(i-e)*(i-e)+(b-k)*(b-k),p<d&&(p=0>o?j:j*Math.exp(-p/(2*f)),p>c[h]&&(c[h]=p))}}});
Z.d("/src/js/processors/legacy/redeye2.js",function(g,q){var a={};g("../colorConversion");var l=g("./mask");a.redeye2=function(c,e,k,b,a){for(var j=Array(e*k),d=0;d<e*k;d++)j[d]=0;for(var f=0.7*a,d=0;d<b.length;d++)l.maskspottool(e,k,j,b[d][0],b[d][1],a,f);for(var m,h,n,d=0;d<=k-1;d++)for(f=0;f<=e-1;f++)b=f+e*d,j[b]&&(a=c[4*b],m=c[4*b+1],h=c[4*b+2],n=a>m+h?1:0,0>n&&(n=0),n*=j[b],0.1<n&&(a=c[4*b],m=c[4*b+1],h=c[4*b+2],n*=3,1<n&&(n=1),a=(1-n)*a+n*(m+h)/2+0.5|0,c[4*b]=a))};q.e=a});
Z.d("/src/js/processors/legacy/selectiveblur.js",function(g,q){var a={},l=g("../sharpness"),c=g("./mask");a.selectiveblur=function(e,k,b,a,j){for(var d=Array(k*b),f=0;f<k*b;f++)d[f]=0;for(var m=0.5*j,f=0;f<a.length;f++)c.maskspottool(k,b,d,a[f][0],a[f][1],j,m,0.65);l.sharpenX(e,k,b,-100,d);l.sharpenY(e,k,b,-100,d)};q.e=a});
Z.d("/src/js/processors/sharpness.js",function(g,q){var a={},l=g("./copy");a.bitmapBlend=function(c,e,k,b,a,j,d,f,m){var m="NN"===m,h="clarity"===f,n="clarityv2"===f,p="overlay"===f,f="laplaceAdd"===f,i,r,u,z,x,t=a/e,l=j/k,D,s,C,g,L,v,q,G,M,J,E,F;for(z=0;z<k;z++)for(x=0;x<e;x++){var A=4*(x+e*z);m?(C=x*t+0.5|0,g=z*l+0.5|0,C>a-1?C=a-1:0>C&&(C=0),g>j-1?g=j-1:0>g&&(g=0),i=4*(C+a*g),C=b[i],g=b[i+1],D=b[i+2]):(C=x*t,g=z*l,i=Math.floor(C),r=Math.floor(g),D=i+1,s=r+1,C-=i,g-=r,D>a-1&&(D=a-1),i>a-1&&(i=a-
1),0>D&&(D=0),0>i&&(i=0),s>j-1&&(s=j-1),r>j-1&&(r=j-1),0>s&&(s=0),0>r&&(r=0),u=4*(D+a*s),L=4*(i+a*s),v=4*(D+a*r),i=4*(i+a*r),D=b[u],r=b[u+1],u=b[u+2],q=b[L],s=b[L+1],L=b[L+2],G=b[v],M=b[v+1],v=b[v+2],J=b[i],E=b[i+1],F=b[i+2],i=J*(1-C)*(1-g)+G*C*(1-g)+q*g*(1-C)+D*g*C,r=E*(1-C)*(1-g)+M*C*(1-g)+s*g*(1-C)+r*g*C,u=F*(1-C)*(1-g)+v*C*(1-g)+L*g*(1-C)+u*g*C,C=i,g=r,D=u);i=c[A];r=c[A+1];u=c[A+2];f?(c[A]=i+d*(C-128),c[A+1]=r+d*(g-128),c[A+2]=u+d*(D-128)):n?(r0=i,g0=r,b0=u,g=0.2*C+0.7*g+0.1*D,s=d*Math.pow(Math.abs(g-
(0.2*i+0.7*r+0.1*u))/255,2),L=1-s,i=128>=i?L*i+2*s*i*C/256+0.5|0:L*i+s*(255-2*(255-i)*(255-C)/255)+0.5|0,r=128>=r?L*r+2*s*r*g/256+0.5|0:L*r+s*(255-2*(255-r)*(255-g)/255)+0.5|0,u=128>=u?L*u+2*s*u*D/256+0.5|0:L*u+s*(255-2*(255-u)*(255-D))+0.5|0,c[A]=i,c[A+1]=r,c[A+2]=u):h?(r0=i,g0=r,b0=u,g=0.2*C+0.7*g+0.1*D,s=d*Math.pow(Math.abs(g-(0.2*i+0.7*r+0.1*u))/255,2),L=1-s,i=128>=i?L*i+2*s*i*C/256+0.5|0:L*i+s*(255-(255-(2*i-256))*(255-C)/256)+0.5|0,r=128>=r?L*r+2*s*r*g/256+0.5|0:L*r+s*(255-(255-(2*r-256))*(255-
g)/256)+0.5|0,u=128>=u?L*u+2*s*u*D/256+0.5|0:L*u+s*(255-(255-(2*u-256))*(255-D)/256)+0.5|0,c[A]=i,c[A+1]=r,c[A+2]=u):p?(s=d,L=1-s,i=128>=i?L*i+2*s*i*C/256+0.5|0:L*i+s*(255-(255-(2*i-256))*(255-C)/256)+0.5|0,r=128>=r?L*r+2*s*r*g/256+0.5|0:L*r+s*(255-(255-(2*r-256))*(255-g)/256)+0.5|0,u=128>=u?L*u+2*s*u*D/256+0.5|0:L*u+s*(255-(255-(2*u-256))*(255-D)/256)+0.5|0,c[A]=i,c[A+1]=r,c[A+2]=u):(c[A]=i*(1-d)+d*C,c[A+1]=r*(1-d)+d*g,c[A+2]=u*(1-d)+d*D);c[A+3]=255}};a.sharpenX=function(c,e,k,b,a){if(0!==b){var j=
"undefined"!==typeof a,d,f,m=Q;0>b&&(b=-b,m=V);var h=4*(b/100),b=[],n=Math.ceil(2*h),p=2*n+1,i=0;for(f=0;f<p;f++)b[f]=Math.exp(-(n-f)*(n-f)/(2*h*h)),i+=b[f];f=l.makeData(4*e);var r,u,z,x,t,g;for(r=0;r<k;r++){for(h=0;h<e;h++)t=4*(r*e+h),f[4*h]=c[t],f[4*h+1]=c[t+1],f[4*h+2]=c[t+2],f[4*h+3]=c[t+3];for(h=0;h<e;h++)if(!j||a[h+e*r]){t=4*(r*e+h);g=4*(h-n);x=z=u=0;if(h<n||h>e-1-n)for(d=0;d<p;d++)g=4*Math.max(0,Math.min(e-1,h+d-n)),u+=b[d]*f[g],z+=b[d]*f[g+1],x+=b[d]*f[g+2];else{u+=b[0]*f[g];z+=b[0]*f[g+1];
x+=b[0]*f[g+2];u+=b[1]*f[g+4];z+=b[1]*f[g+5];x+=b[1]*f[g+6];u+=b[2]*f[g+8];z+=b[2]*f[g+9];x+=b[2]*f[g+10];for(d=3;d<p;d++)u+=b[d]*f[g+4*d],z+=b[d]*f[g+4*d+1],x+=b[d]*f[g+4*d+2]}m?j?(d=a[h+e*r],u=(1+0.5*d)*c[t]-d*u/i/2+0.5|0,z=(1+0.5*d)*c[t+1]-d*z/i/2+0.5|0,x=(1+0.5*d)*c[t+2]-d*x/i/2+0.5|0):(u=1.5*c[t]-u/i/2+0.5|0,z=1.5*c[t+1]-z/i/2+0.5|0,x=1.5*c[t+2]-x/i/2+0.5|0):j?(d=a[h+e*r],u=(1-d)*c[t]+d*u/i+0.5|0,z=(1-d)*c[t+1]+d*z/i+0.5|0,x=(1-d)*c[t+2]+d*x/i+0.5|0):(u=u/i+0.5|0,z=z/i+0.5|0,x=x/i+0.5|0);c[t]=
0>u?0:255<u?255:u;c[t+1]=0>z?0:255<z?255:z;c[t+2]=0>x?0:255<x?255:x}}}};a.sharpenY=function(c,e,k,b,a,j){if(0!==b){var j="mascara"===j,d=Q;0>b&&(b=-b,d=V);for(var f="undefined"!==typeof a,m,h=4*(b/100),b=[],n=Math.ceil(2*h),p=2*n+1,i=0,r=0;r<p;r++)b[r]=Math.exp(-(n-r)*(n-r)/(2*h*h)),i+=b[r];for(var h=l.makeData(4*k),u,z,x,t,g=0;g<e;g++){for(var D=0;D<k;D++)x=4*(D*e+g),h[4*D]=c[x],h[4*D+1]=c[x+1],h[4*D+2]=c[x+2],h[4*D+3]=c[x+3];for(D=0;D<k;D++)if(!f||a[g+e*D]){x=4*(D*e+g);t=4*(D-n);z=u=r=0;if(D<n||
D>k-1-n)for(m=0;m<p;m++)t=4*Math.max(0,Math.min(k-1,D+m-n)),r+=b[m]*h[t],u+=b[m]*h[t+1],z+=b[m]*h[t+2];else{r+=b[0]*h[t];u+=b[0]*h[t+1];z+=b[0]*h[t+2];r+=b[1]*h[t+4];u+=b[1]*h[t+4+1];z+=b[1]*h[t+4+2];r+=b[2]*h[t+8];u+=b[2]*h[t+8+1];z+=b[2]*h[t+8+2];for(m=3;m<p;m++)r+=b[m]*h[t+4*m],u+=b[m]*h[t+4*m+1],z+=b[m]*h[t+4*m+2]}d?f?(m=a[g+e*D],j&&c[x+1]>u/i&&(m=0),c[x]=(1+0.5*m)*c[x]-m*r/i/2+0.5|0,c[x+1]=(1+0.5*m)*c[x+1]-m*u/i/2+0.5|0,c[x+2]=(1+0.5*m)*c[x+2]-m*z/i/2+0.5|0):(c[x]=1.5*c[x]-r/i/2+0.5|0,c[x+1]=
1.5*c[x+1]-u/i/2+0.5|0,c[x+2]=1.5*c[x+2]-z/i/2+0.5|0,c[x+3]=h[4*D+3]):f?(m=a[g+e*D],c[x]=(1-m)*c[x]+m*r/i+0.5|0,c[x+1]=(1-m)*c[x+1]+m*u/i+0.5|0,c[x+2]=(1-m)*c[x+2]+m*z/i+0.5|0):(c[x]=r/i+0.5|0,c[x+1]=u/i+0.5|0,c[x+2]=z/i+0.5|0)}}}};a.joesharpen=function(c,e,k,b){a.sharpenX(c,e,k,b);a.sharpenY(c,e,k,b)};a.sharpen=function(c,e,k,b,o,j){if(!(0==o||0==b)){var d,b=b*((e+k)/2/800);1==o&&"normal"==j?a.joesharpen(c,e,k,b):(d=l.copy(c),a.joesharpen(d,e,k,b),a.bitmapBlend(c,e,k,d,e,k,o,j))}};q.e=a});
Z.d("/src/js/processors/tools/colorsplash.js",function(g,q){var a={},l=g("../colorMatrixTransform"),c=g("./mask"),e=g("./drawtool");a.draw=function(k,b,e,a,d){d.constant=1;d.considerLuminosity=V;c.masksimilarcolors(k,b,e,a,d)};a.preview=e.preview;a.init=function(k,b,e,a){if(!(b*e>a.length||0>b*e)&&4*b*e===k.length)c.initMaskOpaque(a),b=[1,0,0,0,0,1,0,0,0,0,1,0],l.adjSaturation(b,0),l.colorMatrixTransform(k,b)};q.e=a});
Z.d("/src/js/processors/colorMatrixTransform.js",function(g,q){var a={},l=g("./histogramMapping");a.mulcm=function(c,e){var k=Array(12);k[0]=c[0]*e[0]+c[1]*e[4]+c[2]*e[8];k[1]=c[0]*e[1]+c[1]*e[5]+c[2]*e[9];k[2]=c[0]*e[2]+c[1]*e[6]+c[2]*e[10];k[4]=c[4]*e[0]+c[5]*e[4]+c[6]*e[8];k[5]=c[4]*e[1]+c[5]*e[5]+c[6]*e[9];k[6]=c[4]*e[2]+c[5]*e[6]+c[6]*e[10];k[8]=c[8]*e[0]+c[9]*e[4]+c[10]*e[8];k[9]=c[8]*e[1]+c[9]*e[5]+c[10]*e[9];k[10]=c[8]*e[2]+c[9]*e[6]+c[10]*e[10];k[3]=c[0]*e[3]+c[1]*e[7]+c[2]*e[11]+c[3];k[7]=
c[4]*e[3]+c[5]*e[7]+c[6]*e[11]+c[7];k[11]=c[8]*e[3]+c[9]*e[7]+c[10]*e[11]+c[11];for(var b=0;12>b;b++)c[b]=k[b]};a.adjSaturation=function(c,e){var k=0.213*(1-e),b=0.715*(1-e),o=0.072*(1-e);a.mulcm(c,[k+e,b,o,0,k,b+e,o,0,k,b,o+e,0])};a.adjBrightness=function(c,e){a.mulcm(c,[e,0,0,0,0,e,0,0,0,0,e,0])};a.adjContrast=function(c,e){var k=128*(1-e);a.mulcm(c,[e,0,0,k,0,e,0,k,0,0,e,k])};a.colorMatrixTransform=function(c,e){var k=c.length,b,a,j,d=0;if(0===e[1]&&0===e[2]&&0===e[4]&&0===e[6]&&0===e[8]&&0===
e[9]){k=[];b=[];a=[];for(j=0;256>j;j++)k[j]=Math.max(0,Math.min(255,e[0]*j+e[3]+0.5|0)),b[j]=Math.max(0,Math.min(255,e[5]*j+e[7]+0.5|0)),a[j]=Math.max(0,Math.min(255,e[10]*j+e[11]+0.5|0));l.mapHist(c,{r:k,g:b,b:a})}else for(;d<k;)b=e[0]*c[d]+e[1]*c[d+1]+e[2]*c[d+2]+e[3]+0.5|0,a=e[4]*c[d]+e[5]*c[d+1]+e[6]*c[d+2]+e[7]+0.5|0,j=e[8]*c[d]+e[9]*c[d+1]+e[10]*c[d+2]+e[11]+0.5|0,c[d]=0>b?0:255<b?255:b,c[d+1]=0>a?0:255<a?255:a,c[d+2]=0>j?0:255<j?255:j,d+=4};q.e=a});
Z.d("/src/js/processors/tools/mask.js",function(g,q){var a={},l=g("../colorConversion");a.initMaskTransparent=function(c){var e;for(e=0;e<c.length;e++)c[e]=0};a.initMaskOpaque=function(c){var e;for(e=0;e<c.length;e++)c[e]=255};a.masksimilarcolors=function(c,e,k,b,a){var j=a.posX,d=a.posY,f=a.startX,m=a.startY,h=a.radius,n=a.sigmaC,p=a.addMask,i=a.colorLAB,r=a.alpha,a=a.considerLuminosity;h||(h=10);n||(n=6);"undefined"===typeof a&&(a=V);var u=0.5*h,z,x=[];for(z=0;256>z;z++)x[z]=0.04045>=z/255?100*
z/255/12.92:100*Math.pow((z/255+0.055)/1.055,2.4);var t=[];for(z=0;1024>z;z++)t[z]=Math.pow(z/1023,1/3);var g,D,s,f=Math.max(0,Math.min(e-1,Math.round(f))),m=Math.max(0,Math.min(k-1,Math.round(m))),f=4*(f+e*m),i="object"!==typeof i?l.rgb2labwithcbrtmapping(c[f],c[f+1],c[f+2],x,t):i;z=Math.pow(h+u*(1-Math.sqrt(5/255)),2);g=Math.sqrt(z);var C=-2*n*n*Math.log(250/255),O=-2*n*n*Math.log(5/255),f=Math.max(0,Math.min(e-1,Math.round(j-g))),L=Math.max(0,Math.min(e-1,Math.round(j+g))),m=Math.max(0,Math.min(k-
1,Math.round(d-g))),k=Math.max(0,Math.min(k-1,Math.round(d+g))),v;for(g=m;g<=k;g++)for(m=f;m<=L;m++)if(D=4*(m+e*g),v=m+e*g,s=(m-j)*(m-j)+(g-d)*(g-d),s<z){D=l.rgb2labwithcbrtmapping(c[D],c[D+1],c[D+2],x,t);D=a?Math.pow(i[0]-D[0],2)+Math.pow(i[1]-D[1],2)+Math.pow(i[2]-D[2],2):Math.pow(i[1]-D[1],2)+Math.pow(i[2]-D[2],2);if(D<C)D=1;else if(D>O)continue;else D=Math.exp(-D/(2*n*n));s=s<h*h?1:Math.pow(1-(Math.sqrt(s)-h)/u,2);s*=D;s*=r;s=p?255*(1*s+(1-s)*b[v]/255):255*(0*s+(1-s)*b[v]/255);s=0>s?0:255<s?255:
s+0.5|0;b[v]=s}};a.maskradial=function(c,a,k,b,o){var c=o.posX,j=o.posY,o=o.sigmaR,d,f,m,h,n,p;h=o*o;n=-2*h*Math.log(1-1/255);p=-2*h*Math.log(1-254/255);var i;for(d=0;d<k;d++){i=(d-j)*(d-j);for(o=0;o<a;o++)f=o+a*d,m=(o-c)*(o-c)+i,m<n?m=0:m>p?m=255:(m=1-Math.exp(-m/(2*h)),m=255*m+0.5,m=255<m?255:0>m?0:m|0),b[f]=m}};a.masklinear=function(c,a,k,b,o){var c=o.posX,j=o.posY,d=o.sigmaR,f=o.angle,m,h,n,p,i,r,o=d*d,d=Math.sqrt(-2*o*Math.log(1-1/255));p=Math.sqrt(-2*o*Math.log(1-254/255));i=-Math.sin(f);r=
Math.cos(f);for(m=0;m<k;m++)for(f=0;f<a;f++)h=f+a*m,n=Math.abs(i*(c-f)+r*(m-j)),n=n<d?0:n>p?1:1-Math.exp(-n*n/(2*o)),n=255*n+0.5,n=255<n?255:0>n?0:n|0,b[h]=n};q.e=a});
Z.d("/src/js/processors/tools/drawtool.js",function(g,q){var a={},l=g("../colorMatrixTransform"),c=g("../sharpness"),e=g("./mask");a.sanitizeDrawParams=function(c){"undefined"===typeof c&&(c={});"number"!==typeof c.posX&&(c.posX=0);"number"!==typeof c.posY&&(c.posY=0);"number"!==typeof c.startX&&(c.startX=c.posX);"number"!==typeof c.startY&&(c.startY=c.posY);"number"!==typeof c.radius&&(c.radius=0);"number"!==typeof c.sigmaC&&(c.sigmaC=10);"number"!==typeof c.constant&&(c.constant=1);"number"!==typeof c.alpha&&
(c.alpha=1);"boolean"!==typeof c.addMask&&(c.addMask=Q);"boolean"!==typeof c.isFirstDraw&&(c.isFirstDraw=Q);"boolean"!==typeof c.considerLuminosity&&(c.considerLuminosity=V);return c};a.draw=function(c,b,a,j,d){"colorsplash"===d.toolName||"blemish"===d.toolName?(d.constant=1,d.considerLuminosity=V,e.masksimilarcolors(c,b,a,j,d)):"tiltshift"===d.toolName&&("linear"===d.tiltshiftMode?e.xa(c,b,a,j,d):"radial"===d.tiltshiftMode&&e.ya(c,b,a,j,d))};a.preview=function(c,b,a,e,d,f,m,h,n,p){"number"!==typeof m&&
(m=0);"number"!==typeof h&&(h=0);"number"!==typeof n&&(n=d-1);"number"!==typeof p&&(p=f-1);for(var m=0>m?0:m>d-1?d-1:Math.round(m),h=0>h?0:h>f-1?f-1:Math.round(h),n=0>n?0:n>d-1?d-1:Math.round(n),p=0>p?0:p>f-1?f-1:Math.round(p),i,r;h<=p;h++)for(f=m;f<=n;f++)i=4*(d*h+f),r=e[d*h+f]/255,c[i]=r*a[i]+(1-r)*b[i],c[i+1]=r*a[i+1]+(1-r)*b[i+1],c[i+2]=r*a[i+2]+(1-r)*b[i+2]};a.init=function(a,b,e,j,d){if(!(b*e>j.length||0>b*e)&&4*b*e===a.length){var f="colorsplash"===d,m="blemish"===d,d="tiltshift"===d,h;if(f)for(h=
0;h<j.length;h++)j[h]=255;else for(h=0;h<j.length;h++)j[h]=0;f?(b=[1,0,0,0,0,1,0,0,0,0,1,0],l.adjSaturation(b,0),l.colorMatrixTransform(a,b)):(m||d)&&c.joesharpen(a,b,e,-100)}};q.e=a});
Z.d("/src/js/processors/tools/brightness.js",function(g,q){var a={},l=g("../gamma"),c=g("../colorMatrixTransform");a.brightness=function(a,k){if(0>k){var b=Math.log(0.5+k/400)/Math.log(0.5);l.gamma(a,b)}else{var b=[1,0,0,0,0,1,0,0,0,0,1,0],o=0.6*k/100+1,j=[1,0,0,0,0,1,0,0,0,0,1,0];j[0]=1*o;j[5]=1*o;j[10]=1*o;j[3]=0*o;j[7]=0*o;j[11]=0*o;c.mulcm(b,j);c.colorMatrixTransform(a,b)}};q.e=a});
Z.d("/src/js/processors/gamma.js",function(g,q){var a={},l=g("./histogramMapping");a.gamma=function(c,a){"undefined"===typeof a&&(a=1);var k=[],b=[],o;for(o=0;256>o;o++)k[o]=255*Math.pow(o/255,a)+0.5|0;b.r=k;b.g=k;b.b=k;l.mapHist(c,b)};q.e=a});Z.d("/src/js/processors/tools/contrast.js",function(g,q){var a={},l=g("../contrast");a.contrast=function(c,a){var k=Math.log(0.5+0.75*a/400)/Math.log(0.5);l.contrastCurve(c,1/k)};q.e=a});
Z.d("/src/js/processors/contrast.js",function(g,q){var a={},l=g("./histogramMapping");a.contrastCurve=function(c,a){for(var k=[],b=[],o=0;128>o;o++)k[o]=Math.round(127*Math.pow(o/127,a));for(o=128;256>o;o++)k[o]=Math.round(127+127*Math.pow((o-128)/127,1/a));b.r=k;b.g=k;b.b=k;l.mapHist(c,b)};q.e=a});
Z.d("/src/js/processors/tools/colortemp.js",function(g,q){var a={},l=g("../histogramMapping");a.colortemp=function(c,a){var k=a;0!==k&&(k=100*k/Math.abs(k)*(1-Math.cos(k*Math.PI/200)));var b=[],o=[],j=[],d,f;0<k?(d=255+90.78*k/100,f=255-24*k/100,k=255-140*k/100):(d=255+155*k/100,f=255-44.625*k/100,k=255-245.31*k/100);for(var m=0;255>=m;m++)b[m]=m*d/255+0.5|0,o[m]=m*f/255+0.5|0,j[m]=m*k/255+0.5|0,b[m]=255<b[m]?255:0>b[m]?0:b[m],o[m]=255<o[m]?255:0>o[m]?0:o[m],j[m]=255<j[m]?255:0>j[m]?0:j[m];l.mapHist(c,
{r:b,g:o,b:j})};q.e=a});Z.d("/src/js/processors/tools/tiltshift.js",function(g,q){var a={},l=g("../sharpness"),c=g("./mask"),e=g("./drawtool");a.draw=function(a,b,e,j,d){"linear"===d.tiltshiftMode?c.masklinear(a,b,e,j,d):"radial"===d.tiltshiftMode&&c.maskradial(a,b,e,j,d)};a.preview=e.preview;a.init=function(a,b,e,j){if(!(b*e>j.length||0>b*e)&&4*b*e===a.length)c.initMaskTransparent(j),l.sharpen(a,b,e,-100,1,"normal")};q.e=a});
Z.d("/src/js/processors/tools/blemish.js",function(g,q){var a={},l=g("../sharpness"),c=g("./mask"),e=g("./drawtool");a.draw=function(a,b,e,j,d){d.constant=1;d.considerLuminosity=V;d.sigmaC=99999999999;c.masksimilarcolors(a,b,e,j,d)};a.preview=e.preview;a.init=function(a,b,e,j){if(!(b*e>j.length||0>b*e)&&4*b*e===a.length)c.initMaskTransparent(j),l.sharpen(a,b,e,-100,1,"normal")};q.e=a});
Z.d("/src/js/processors/tools/redeye.js",function(g,q){var a={},l=g("./mask"),c=g("./drawtool");a.draw=function(c,a,b,g,j){j.constant=1;j.considerLuminosity=V;j.sigmaC=1E17;j.startX=j.posX;j.startY=j.posY;j.alpha=1;l.masksimilarcolors(c,a,b,g,j)};a.preview=c.preview;a.init=function(c,k,b,g){if(!(k*b>g.length||0>k*b)&&4*k*b===c.length)l.initMaskTransparent(g),a.redeye(c,k,b)};a.redeye=function(c,a,b){var l,j,d,f,m,h;for(j=0;j<b;j++)for(l=0;l<a;l++)d=4*(l+a*j),f=c[d],m=c[d+1],h=c[d+2],f>=m+h&&(f=(m+
h)/2,c[d]=0>f?0:255<f?255:f+0.5|0)};q.e=a});
Z.d("/src/js/processors/tools/whiten.js",function(g,q){var a={},l=g("./mask"),c=g("./drawtool"),e=g("../colorConversion");a.draw=function(c,b,a,e,d){d.constant=1;d.considerLuminosity=Q;d.sigmaC=10;d.startX=d.posX;d.startY=d.posY;d.alpha=0.5;d.sigmaC=99999999999999;l.masksimilarcolors(c,b,a,e,d)};a.preview=c.preview;a.init=function(c,b,e,j){if(!(b*e>j.length||0>b*e)&&4*b*e===c.length)l.initMaskTransparent(j),a.whiten(c,b,e)};a.whiten=function(c,b,a){for(var j=[],d=0;256>d;d++)j[d]=0.04045>=d/255?100*
d/255/12.92:100*Math.pow((d/255+0.055)/1.055,2.4);var f,m,h,n,p;for(h=0;h<a;h++)for(m=0;m<b;m++)d=4*(m+b*h),n=e.rgb2lab(c[d],c[d+1],c[d+2],j),f=0,f+=Math.pow(n[1]-132,2),127>n[2]&&(f+=Math.pow(n[2]-127,2)),f=0.65*Math.exp(-f/98),p=255*Math.pow(n[0]/255,1/(0.5*f+1)),n=e.lab2rgb([p,n[1],(1-f)*(n[2]-127)+127]),c[d]=n[0],c[d+1]=n[1],c[d+2]=n[2]};q.e=a});
Z.d("/src/js/processors/tools/spraytan.js",function(g,q){var a={},l=g("../blendWithColor"),c=g("./mask"),e=g("./drawtool");a.draw=function(a,b,l,j,d){d=e.sanitizeDrawParams(d);d.constant=1;d.alpha=0.1;d.considerLuminosity=V;d.sigmaC=10;c.masksimilarcolors(a,b,l,j,d)};a.preview=e.preview;a.init=function(a,b,e,j){if(!(b*e>j.length||0>b*e)&&4*b*e===a.length)c.initMaskTransparent(j),j=[30,30,30,1],l.colorSoft(a,b,e,j[0],j[1],j[2],j[3])};q.e=a});
Z.d("/src/js/processors/blendWithColor.js",function(g,q){var a={};g("./colorMatrixTransform");a.colorOverlay=function(a,c,e,k,b,g,j,d){"undefined"===typeof d&&(d="all");for(var f,m,h,n,p=c/2|0,i=e/2|0,r=j,u=1-j,z=0;z<e;z++)for(var x=0;x<c;x++)n=4*(z*c+x),j="left"===d&&x>p?0:"right"===d&&x<p?0:"bottom"===d&&z<i?0:"top"===d&&x<i?0:r,u=1-j,f=a[n],m=a[n+1],h=a[n+2],f=128>=f?u*f+2*j*f*k/255+0.5|0:u*f+j*(255-(255-f)*(255-k)/127.5)+0.5|0,m=128>=m?u*m+2*j*m*b/255+0.5|0:u*m+j*(255-(255-m)*(255-b)/127.5)+0.5|
0,h=128>=h?u*h+2*j*h*g/255+0.5|0:u*h+j*(255-(255-h)*(255-g)/127.5)+0.5|0,f=255<f?255:0>f?0:f,m=255<m?255:0>m?0:m,h=255<h?255:0>h?0:h,a[n]=f,a[n+1]=m,a[n+2]=h};a.colorMultiply=function(a,c,e,k,b,g,j){var d,f,m,h,n=1-j,p,i;for(i=0;i<e;i++)for(p=0;p<c;p++)h=4*(i*c+p),d=n*a[h]+j*k*a[h]/255+0.5|0,f=n*a[h+1]+j*b*a[h+1]/255+0.5|0,m=n*a[h+2]+j*g*a[h+2]/255+0.5|0,d=255<d?255:0>d?0:d,f=255<f?255:0>f?0:f,m=255<m?255:0>m?0:m,a[h]=d,a[h+1]=f,a[h+2]=m};a.colorDarken=function(a,c,e,k,b,g,j){var d,f,m,h,n=1-j,p,
i;for(i=0;i<e;i++)for(p=0;p<c;p++)h=4*(i*c+p),d=a[h],f=a[h+1],m=a[h+2],d=n*d+j*(d<k?d:k)+0.5|0,f=n*f+j*(f<b?f:b)+0.5|0,m=n*m+j*(m<g?m:g)+0.5|0,d=255<d?255:0>d?0:d,f=255<f?255:0>f?0:f,m=255<m?255:0>m?0:m,a[h]=d,a[h+1]=f,a[h+2]=m};a.colorSoft=function(a,c,e,k,b,g,j){var d,f,m,h,n=1-j,p,i,r;for(i=0;i<e;i++)for(p=0;p<c;p++)h=4*(i*c+p),d=a[h],f=a[h+1],m=a[h+2],r=d*k>>8,d=n*d+j*(r+(d*(255-((255-d)*(255-k)>>8)-r)>>8))+0.5|0,r=f*b>>8,f=n*f+j*(r+(f*(255-((255-f)*(255-b)>>8)-r)>>8))+0.5|0,r=m*g>>8,m=n*m+j*
(r+(m*(255-((255-m)*(255-g)>>8)-r)>>8))+0.5|0,d=255<d?255:0>d?0:d,f=255<f?255:0>f?0:f,m=255<m?255:0>m?0:m,a[h]=d,a[h+1]=f,a[h+2]=m};a.colorColor=function(a,c,e,k,b,g,j){var d,f,m=1-j,h,n,k=k/255,b=b/255;d=g/255;f=Math.max(k,b,d);var g=Math.min(k,b,d),p,i;if(f==g)p=g=0;else{h=f-g;g=0.5<(f+g)/2?h/(2-f-g):h/(f+g);switch(f){case k:p=(b-d)/h+(b<d?6:0);break;case b:p=(d-k)/h+2;break;case d:p=(k-b)/h+4}p/=6}for(n=0;n<e;n++)for(h=0;h<c;h++){f=4*(n*c+h);k=a[f];b=a[f+1];d=a[f+2];var r=k,u=b,z=d;i=(0.212671*
k+0.71516*b+0.072169*d)/255;var x=6*p,t=0.5<i?2*g*(1-i):2*g*i,P=t*(1-Math.abs(x%2-1));1>x?(k=t,b=P,d=0):2>x?(k=P,b=t,d=0):3>x?(k=0,b=t,d=P):4>x?(k=0,b=P,d=t):5>x?(k=P,b=0,d=t):6>x&&(k=t,b=0,d=P);i-=0.5*t;k=255*(k+i)+0.5|0;b=255*(b+i)+0.5|0;d=255*(d+i)+0.5|0;k=255<k?255:0>k?0:k;b=255<b?255:0>b?0:b;d=255<d?255:0>d?0:d;k=m*r+j*k;b=m*u+j*b;d=m*z+j*d;k=255<k?255:0>k?0:k;b=255<b?255:0>b?0:b;d=255<d?255:0>d?0:d;a[f]=k;a[f+1]=b;a[f+2]=d}};a.colorScreen=function(a,c,e,k,b,g,j){var d,f,m,h,n=1-j,p,i;for(i=
0;i<e;i++)for(p=0;p<c;p++)h=4*(i*c+p),d=a[h],f=a[h+1],m=a[h+2],d=n*d+j*(255-(255-d)*(255-k)/255)+0.5|0,f=n*f+j*(255-(255-f)*(255-b)/255)+0.5|0,m=n*m+j*(255-(255-m)*(255-g)/255)+0.5|0,d=255<d?255:0>d?0:d,f=255<f?255:0>f?0:f,m=255<m?255:0>m?0:m,a[h]=d,a[h+1]=f,a[h+2]=m};a.normalBlend=function(a,c,e,k,b,g,j){for(var d,f,m,h,n=1-j,p=0;p<e;p++)for(var i=0;i<c;i++)h=4*(p*c+i),d=a[h],f=a[h+1],m=a[h+2],d=n*d+j*k+0.5|0,f=n*f+j*b+0.5|0,m=n*m+j*g+0.5|0,d=255<d?255:0>d?0:d,f=255<f?255:0>f?0:f,m=255<m?255:0>m?
0:m,a[h]=d,a[h+1]=f,a[h+2]=m};q.e=a});
Z.d("/src/js/processors/tools/shinereduce.js",function(g,q){var a={},l=g("../blendWithColor"),c=g("./mask"),e=g("./drawtool"),k=g("../colorConversion");a.findBrightest=function(c,a,e,d,k,g){var d=Math.round(d),k=Math.round(k),h,n,p,i,r=Math.max(0,Math.min(a-1,Math.round(d-g)));n=Math.max(0,Math.min(e-1,Math.round(k-g)));var u=Math.max(0,Math.min(a-1,Math.round(d+g))),e=Math.max(0,Math.min(e-1,Math.round(k+g))),z=4*(d+a*k),x=[c[z],c[z+1],c[z+2]],t=0.2*c[z]+0.7*c[z+1]+0.1*c[z+2];for(p=n;p<=e;p++)for(n=
r;n<=u;n++)z=4*(a*p+n),i=Math.pow(n-d,2)+Math.pow(p-k,2),h=0.2*c[z]+0.7*c[z+1]+0.1*c[z+2],h*=Math.exp(-i/(2*g*g)),h>t&&(x=[c[z],c[z+1],c[z+2]],t=h);return x};a.draw=function(b,g,j,d,f){f=e.sanitizeDrawParams(f);f.constant=1;f.alpha=0.5;f.considerLuminosity=Q;f.sigmaC=25;console.log("draw");if(f.isFirstDraw){f.isFirstDraw=V;var m=a.findBrightest(b,g,j,f.posX,f.posY,f.radius);f.colorLAB=k.rgb2labwithcbrtmapping(m[0],m[1],m[2]);console.log("First draw",m,f.colorLAB)}c.masksimilarcolors(b,g,j,d,f)};a.preview=
e.preview;a.init=function(a,e,k,d){if(!(e*k>d.length||0>e*k)&&4*e*k===a.length)c.initMaskTransparent(d),d=[190,110,62,0.26],l.colorMultiply(a,e,k,d[0],d[1],d[2],d[3])};q.e=a});
Z.d("/src/js/processors/tools/blush.js",function(g,q){var a={},l=g("../blendWithColor"),c=g("./mask"),e=g("./drawtool");a.draw=function(a,b,g,j,d){d=e.sanitizeDrawParams(d);d.constant=1;d.alpha=0.1;d.considerLuminosity=V;d.sigmaC=15;c.masksimilarcolors(a,b,g,j,d)};a.preview=e.preview;a.init=function(a,b,e,j){if(!(b*e>j.length||0>b*e)&&4*b*e===a.length)c.initMaskTransparent(j),j=[190,30,20,0.34],l.colorSoft(a,b,e,j[0],j[1],j[2],j[3])};q.e=a});
Z.d("/src/js/processors/tools/lipstick.js",function(g,q){var a={},l=g("../blendWithColor"),c=g("./mask"),e=g("./drawtool"),k=g("../colorConversion");a.getColorClosestToLip=function(c,a,e,d,f,g){var d=Math.round(d),f=Math.round(f),h=[213,128,118],n=[],p;for(p=0;256>p;p++)n[p]=0.04045>=p/255?100*p/255/12.92:100*Math.pow((p/255+0.055)/1.055,2.4);var h=k.rgb2labwithcbrtmapping(h[0],h[1],h[2],n),i=[],r,u,z;p=Math.max(0,Math.min(a-1,d-3*g));r=Math.max(0,Math.min(e-1,f-3*g));var x=Math.max(0,Math.min(a-
1,d+3*g)),t=Math.max(0,Math.min(e-1,f+3*g));"number"!==typeof window.da&&(window.da=1);"number"!==typeof window.w&&(window.w=15);"number"!==typeof window.na&&(window.na=0.1);"number"!==typeof window.pow&&(window.pow=0.25);var l,D=-1;for(u=r;u<=t;u++)for(r=p;r<=x;r++){index=4*(a*u+r);z=Math.pow(r-d,2)+Math.pow(u-f,2);var e=c[index],s=c[index+1],C=c[index+2],O,L,v;O=Math.min(e,s,C);i=L=Math.max(e,s,C);v=L-O;if(0!=v)O=v/L;else return e=O=0,[e,O,i];e=e==L?(s-C)/v:s==L?2+(C-e)/v:4+(e-s)/v;e*=60;0>e&&(e+=
360);e=[e,O,i];i=k.rgb2labwithcbrtmapping(c[index],c[index+1],c[index+2],n);s=e[0];e=Math.cos(s*Math.PI/180)-1;s=Math.sin(s*Math.PI/180);e=Math.exp(-(e*e+s*s)/(2*sigmaHue*sigmaHue));s=h;C=window.w;i=Math.exp(-(Math.pow(s[1]-i[1],2)+Math.pow(s[2]-i[2],2))/(2*C*C));z=e*i*Math.exp(-z/(2*g*g));z>D&&(l=[c[index],c[index+1],c[index+2]],D=z,console.log("new best"))}return l};a.draw=function(b,g,j,d,f){f=e.sanitizeDrawParams(f);f.constant=1;f.alpha=0.5;f.considerLuminosity=Q;f.sigmaC=7;console.log("draw");
if(f.isFirstDraw){f.isFirstDraw=V;var m=a.getColorClosestToLip(b,g,j,f.posX,f.posY,f.radius/3);f.colorLAB=k.rgb2labwithcbrtmapping(m[0],m[1],m[2]);console.log("First draw",m,f.colorLAB)}c.masksimilarcolors(b,g,j,d,f)};a.preview=e.preview;a.init=function(a,e,k,d){if(!(e*k>d.length||0>e*k)&&4*e*k===a.length)c.initMaskTransparent(d),d=[192,42,45,0.6],l.colorSoft(a,e,k,d[0],d[1],d[2],d[3])};q.e=a});
Z.d("/src/js/processors/tools/mascara.js",function(g,q){var a={},l=g("../sharpness"),c=g("./mask"),e=g("./drawtool"),k=g("../copy");a.draw=function(a,k,j,d,f){f=e.sanitizeDrawParams(f);f.constant=1;f.considerLuminosity=V;f.sigmaC=99999999999;c.masksimilarcolors(a,k,j,d,f)};a.preview=e.preview;a.init=function(a,e,j,d){if(!(e*j>d.length||0>e*j)&&4*e*j===a.length){c.initMaskTransparent(d);d=k.copy(a);l.sharpen(a,e,j,100,1,"normal");var f,g,h,n;for(f=0;f<e*j;f++)g=4*f,h=0.2*d[g]+0.7*d[g+1]+0.1*d[g+2],
n=0.2*a[g]+0.7*a[g+1]+0.1*a[g+2],n>h&&(a[g]=d[g],a[g+1]=d[g+1],a[g+2]=d[g+2])}};q.e=a});
Z.d("/proclist/src/js/MoaLiteProclistManager.coffee",function(g,q){var a;a=g("./MoaLiteProclistProcessorRunning");q.e={MLPLLoadEffect:function(a){var c,e;c=JSON.parse(a);if(!c)return console.log("Invalid JSON string."),R;a=c.identifier;e=c.processors;return!a||!e?(console.log("Missing or problematic identifier property and/or processors property."),R):c},MLPLRunEffect:function(g,c,e){var k,b,o;k=g.identifier;g=g.processors;if(!k||!g)return console.log("Missing or problematic identifier property and/or processors property."),
V;k=0;for(o=g.length;k<o;k++)if(b=g[k],b=a.MLPLRunProcessor(b,c,e),!b)return V;return Q}}});
Z.d("/proclist/src/js/MoaLiteProclistProcessorRunning.coffee",function(g,q){function a(){this.constructor=d}function l(c,n){l.$.constructor.call(this);this.name="Processor Error";this.ja=n;this.message=c;this.toString=function(){return""+this.name+": "+this.message+" ("+this.ja+")"}}var c,e,k,b,o,j={}.hasOwnProperty,d=l,f=Error,m;for(m in f)j.call(f,m)&&(d[m]=f[m]);a.prototype=f.prototype;d.prototype=new a;d.$=f.prototype;c=l;o={original:function(c,n){var p;p=g("../../../src/js/processors/copy");
n.data=p.copy(n.data);return Q},legacyProcessor:function(a,n,p){var i;i=g("../../../src/js/processors/legacyProcessor");a=a!=R?a.legacyName:I;a==R&&H(new c("Legacy name '"+a+"' not found.","legacyProcessor"));i[a](n.data,n.width,n.height,p);return Q},legacy_compare_processor:function(c,n,p,i){return I(c,n,p,i)},colorMatrixTransform:function(a,n,p){var i,r,b,d,k,f,j;i=V;k=g("../../../src/js/processors/colorMatrixTransform");d=a!=R?a.operations:I;a=[1,0,0,0,0,1,0,0,0,0,1,0];if(d){f=0;for(j=d.length;f<
j;f++)switch(r=d[f],b=r!=R?r.value:I,r!=R?r.operation:I){case "hardSet":i=r!=R?r.gain:I;r=r!=R?r.entries:I;(i==R||r==R)&&H(new c("invalid entries val for hardSet operation.","colorMatrixTransform"));for(b=0;12>b;)a[b]=r[b],0===b||5===b||10===b?a[b]=a[b]*i*p.intensity+(1-p.intensity):3!==b&&(7!==b&&11!==b)&&(a[b]=a[b]*i*p.intensity),b++;i=Q;break;case "saturation":i=e(b,0,p.intensity);k.adjSaturation(a,i);i=Q;break;case "brightness":i=e(b,0,p.intensity);k.adjBrightness(a,i);i=Q;break;case "contrast":i=
e(b,0,p.intensity);k.adjContrast(a,i);i=Q;break;default:H(new c("Operation "+(r!=R?r.operation:I)+" not found.","colorMatrixTransform"))}}k.colorMatrixTransform(n!=R?n.data:I,a);return i},histogramMapping:function(a,n,p){var i;i=g("../../../src/js/processors/histogramMapping");(a=a!=R?a.histMap:I)||H(new c("histMap dne or is not an object.","histogramMapping"));a=k(a);i.fadeMapping(a,p!=R?p.intensity:I);i.mapHist(n!=R?n.data:I,a);return Q},vignette:function(a,n,p){var i,b,e,d,k,f,j,m,s;k=g("../../../src/js/processors/vignette");
e=a!=R?a.color:I;b=a!=R?a.blendMode:I;i=a!=R?a.shape:I;s=i!=R?i.vignetteScale:I;j=i!=R?i.shapeMode:I;f=i!=R?i.scaling:I;a=i!=R?i.dx:I;d=i!=R?i.dy:I;i=parseFloat(e.a/255);switch(f){case "average":s=(n.width+n.height)/2*s/(p.intensity+1E-9);m=V;break;case "max":s=Math.max(n.width,n.height)*s/(p.intensity+1E-9);m=V;break;case "stretch":s/=p.intensity+1E-9;m=Q;break;default:H(new c("scaling mode "+f+" not defined.","vignette"))}k.vignette(n.data,n.width,n.height,s,e.r,e.g,e.b,i,b,j,m,a,d);return Q},contrast:function(a,
n,p){var i;i=g("../../../src/js/processors/contrast");a=a!=R?a.value:I;a==R&&H(new c("value is missing.","contrast"));i.contrastCurve(n.data,e(a,0,p.intensity));return Q},noise:function(a,n,p){var i,b;b=g("../../../src/js/processors/rng");i=g("../../../src/js/processors/noise");a=a!=R?a.intensity:I;a==R&&H(new c("intensity is missing.","noise"));a*=p.intensity;p=new b.RNG(p.seed);i.noise(n.data,n.width,n.height,a,p.nextInt());return Q},blendWithColor:function(a,n,p){var i,b,e;e=g("../../../src/js/processors/blendWithColor");
b=a!=R?a.color:I;i=a!=R?a.blendMode:I;a=a!=R?a.alpha:I;(b==R||a==R)&&H(new c("color or alpha param is missing.","blendWithColor"));a*=p.intensity;switch(i){case "overlay":e.colorOverlay(n.data,n.width,n.height,b.r,b.g,b.b,a);n=Q;break;case "multiply":e.colorMultiply(n.data,n.width,n.height,b.r,b.g,b.b,a);n=Q;break;case "screen":e.colorScreen(n.data,n.width,n.height,b.u,b.t,b.p,a);n=Q;break;case "darken":e.colorDarken(n.data,n.width,n.height,b.u,b.t,b.p,a);n=Q;break;case "color":e.colorColor(n.data,
n.width,n.height,b.u,b.t,b.p,a);n=Q;break;default:e.normalBlend(n.data,n.width,n.height,b.r,b.g,b.b,a),n=Q}return n},gamma:function(a,n,p){var i;i=g("../../../src/js/processors/gamma");a=a!=R?a.value:I;a==R&&H(new c("value is missing.","gamma"));i.gamma(n.data,e(a,0,p.intensity));return Q},flare:function(a,n,p){var i,b,e,d,k,f,j,m,s;m=g("../../../src/js/processors/flare");b=a!=R?a.color:I;i=a!=R?a.blendMode:I;s=a!=R?a.type:I;k=a!=R?a.dx:I;f=a!=R?a.dy:I;e=a!=R?a.dsx:I;d=a!=R?a.dsy:I;j=a!=R?a.fScale:
I;(s==R||b==R||i==R||k==R||f==R||e==R||d==R||j==R)&&H(new c("some params are incorrect or missing.","flare"));a=parseFloat(b.a/255);a*=p.intensity;m.flare(n.data,n.width,n.height,j,b.r,b.g,b.b,a,s,k,f,e,d,i);return Q},intensityMap:function(a,n,p){var i,b,e,d;d=g("../../../src/js/processors/intensityMap");e=g("../../../src/js/processors/histogramMapping");b=a!=R?a.histMap:I;i=a!=R?a.blendMode:I;a=a!=R?a.alpha:I;(b==R||a==R)&&H(new c("histMap or alpha missing or problematic.","intensityMap"));b=k(b);
e.fadeMapping(b,p!=R?p.intensity:I);d.mapIntensity(n.data,b,i,a*p.intensity);return Q},sharpness:function(a,n,p){var i,b,e;e=g("../../../src/js/processors/sharpness");b=a!=R?a.amount:I;i=a!=R?a.alpha:I;a=a!=R?a.blendMode:I;(b==R||a==R||i==R)&&H(new c("amount, blendMode, or alpha param is missing.","sharpness"));i*=p.intensity;e.sharpen(n.data,n.width,n.height,b,i,a);return Q},gradient:function(a,n,p){var i,b,e,d,k,f,j,m,s,l,o,L;j=g("../../../src/js/processors/gradient");d=a!=R?a.colors:I;f=a!=R?a.opacities:
I;k=a!=R?a.gradientShape:I;m=a!=R?a.scale:I;o=a!=R?a.xCenter:I;L=a!=R?a.yCenter:I;b=a!=R?a.angle:I;b*=Math.PI/180;i=a!=R?a.alpha:I;e=a!=R?a.blendMode:I;s=(a!=R?a.vignetteShape:I)||{};if(a!=R&&a.vignetteShape)switch(a=s!=R?s.scaling:I,l=s!=R?s.vignetteScale:I,a){case "average":s.vignetteScale=(n.width+n.height)/2*l/(p.intensity+1E-9);s.stretch=V;break;case "max":s.vignetteScale=Math.max(n.width,n.height)*l/(p.intensity+1E-9);s.stretch=V;break;case "stretch":s.vignetteScale=l/(p.intensity+1E-9);s.stretch=
Q;break;default:H(new c("scaling mode "+a+" not defined.","vignette"))}console.log(s);(d==R||f==R)&&H(new c("colors or opacities param is missing.","sharpness"));j.applyGradient(n!=R?n.data:I,n.width,n.height,{colors:d,opacities:f},k,m,o,L,b,s,e,i);return Q}};b=function(a){var n,p,i;n=[];p=0;for(i=a.length;p<i;)n.push(a[p]),p++;return n};k=function(a){return{r:b(a.r),g:b(a.g),b:b(a.b)}};e=function(a,n,p){p==R&&(p=1);return a*p+1*(1-p)};q.e={MLPLRunProcessor:function(a,n,p){var i,b,e;i=a!=R?a.parameters:
I;"undefined"===typeof p&&(p={});"undefined"===typeof p.border&&(p.border=Q);"undefined"===typeof p.intensity&&(p.intensity=1);"undefined"===typeof p.seed&&(p.seed=0);b=o[a!=R?a.name:I];if(b!=R)try{e=b(i,n,p)}catch(d){H(new c("Uknown Error",a.name))}else H(new c("unrecognized processor"));return e}}});
Z.d("/src/js/processors/legacyProcessor.js",function(g,q){function a(a,p,i,c){"undefined"===typeof c.offset&&(c.offset=0);"undefined"===typeof c.corner&&(c.corner=0);"undefined"===typeof c.scale&&(c.scale=1);"undefined"===typeof c.seed&&(c.seed=0);"undefined"===typeof c.alpha&&(c.alpha=1);"undefined"===typeof c.color&&(c.color=[0,0,0,1]);var b=c.offset,e=c.corner,d=c.scale,h=c.color,f=c.alpha,c=new k.RNG(c.seed),g=h[0],j=h[1],l=h[2],h=h[3],o=Array(i),L=Array(i),v=Array(p),q=Array(p);o[i-1]=e;o[0]=
0;L[i-1]=0;L[0]=0;v[p-1]=0;v[0]=0;q[p-1]=0;q[0]=e;m.k(o,0,i-1,0.03*p*f,0.7,"uniform",c.nextInt());m.k(L,0,i-1,0.03*p*f,0.7,"uniform",c.nextInt());m.k(v,0,p-1,0.03*i*f,0.7,"uniform",c.nextInt());m.k(q,0,p-1,0.03*i*f,0.7,"uniform",c.nextInt());var G,M,f=i/2|0,J=p/2|0,E=(p+i)/30,F,A;for(A=0;A<i;A++)for(F=0;F<p;F++)e=4*(A*p+F),M=A<f?A-v[F]-b:i-1-A-q[F]-b,G=F<J?F-o[A]-b:p-1-F-L[A]-b,0>M||0>G?(G=1-h,a[e]=a[e]*G+g*(1-G)|0,a[e+1]=a[e+1]*G+j*(1-G)|0,a[e+2]=a[e+2]*G+l*(1-G)|0,a[e+3]=a[e+3]):(G=M<Math.SQRT2*
E&&G<Math.SQRT2*E?Math.SQRT2*E-Math.sqrt(Math.pow(M-Math.SQRT2*E,2)+Math.pow(G-Math.SQRT2*E,2)):G<M?G:M,G<E&&(M=2*Math.pow(1-G/E,4*d),M>1/255&&(G=0.4*c.nextFloat()+0.6,G=1-G*M,1<G?G=1:0>G&&(G=0),G=1-h+h*G,a[e]=a[e]*G+g*(1-G)|0,a[e+1]=a[e+1]*G+j*(1-G)|0,a[e+2]=a[e+2]*G+l*(1-G)|0,a[e+3]=a[e+3])))}function l(a,c,i,b,e){var d="torn";"undefined"==typeof d&&(d="");var h,f,g,j,s;"torn"===d&&(h=e[0]*(c+i)/2,f=e[1]*(c+i)/2,g=e[2],j="uniform","string"===typeof e[3]&&(j=e[3]),s=e[4]);for(var e=b[0],d=b[1],l=
b[2],b=b[3],o=1!==b,L=Math.max(c,i),v=[],q=[],G=Math.max(1,0.0010*(c+i)),M,J,E,F,A,y,N,T=[i,c,c,i],B=[1,1,-1,-1],i=[0,0,i-1,c-1],K=new k.RNG(s),S=0;4>S;S++){s=T[S];y=B[S];N=i[S];L=s;v[L-1]=N+y*f;v[0]=N+y*f;m.k(v,0,L-1,h,g,j,K.nextInt());q[L-1]=N+y*f;q[0]=N+y*f;m.k(q,0,L-1,h,g,j,K.nextInt());for(L=0;L<s;L++){J=v[L];E=q[L];for(M=N;y*M<y*(J+y*G);M+=y)F=0===S||3===S?4*(L*c+M):4*(M*c+L),y*M<y*(J-y*G)&&y*M>y*(E+y*G)?o?(a[F]=b*e+(1-b)*a[F]+0.5|0,a[F+1]=b*d+(1-b)*a[F+1]+0.5|0,a[F+2]=b*l+(1-b)*a[F+2]+0.5|
0):(a[F]=e,a[F+1]=d,a[F+2]=l):y*M<y*(J+y*G)&&y*M>y*(E-y*G)&&(A=b*Math.min(y*(J-M)/G,y*(M-E)/G),1<A?A=1:0>A&&(A=0),a[F]=A*e+(1-A)*a[F]+0.5|0,a[F+1]=A*d+(1-A)*a[F+1]+0.5|0,a[F+2]=A*l+(1-A)*a[F+2]+0.5|0)}}}function c(a,c,i,b,e,d){"undefined"==typeof e&&(e="");var h,f,g,j;h=f=g=j=V;var l,C,o,L,v,q,G,M,J,E,F,A,y,N,T,B,K,S,U=b[0],W=b[1],$=b[2],b=b[3],ha=1!==b,ba=1+(c+i)/2/1024;o=new k.RNG;"torn"===e?(f=Q,C=d[0]*(c+i)/2,l=d[1]*(c+i)/2,v=d[2],L="uniform","string"===typeof d[3]&&(L=d[3]),o=d[4],q="onlyout"===
d[5],o=new k.RNG(o)):"bulge"===e?(h=Q,l=d[0]*(c+i)/2,G=d[1]*l,M=d[2]*l):"rect"===e?(g=Q,l=d[0]*(c+i)/2,1===d[1]&&(ba=0)):"round"===e&&(j=Q,l=d[0]*Math.min(c,i),E=d[1]*l,F=d[2]*l,A=d[3]*l,y=d[4]*l,J=l,"number"===typeof d[5]&&(J*=d[5]));for(var X=Math.max(c,i),d=[],aa,ca,Y,ea,e=[i,c,c,i],la=[1,1,-1,-1],oa=[0,0,i-1,c-1],fa=0;4>fa;fa++){ca=e[fa];Y=la[fa];ea=oa[fa];X=ca;if(f){if(d[X-1]=ea+Y*l,d[0]=ea+Y*l,m.k(d,0,X-1,C,v,L,o.nextInt()),q)for(i=0;i<X;i++)d[i]=Y*Math.min(Y*(ea+Y*l),Y*d[i])}else if(h)for(i=
0;i<X;i++)d[i]=ea-Y*(G*Math.sin(i*Math.PI/X)-M);else if(g)for(i=0;i<X;i++)d[i]=ea+Y*l;else if(j){S=J*(1-1/Math.SQRT2);0===fa&&(B=F,T=E,K=A);1===fa&&(B=E,T=F,K=y);2===fa&&(B=A,T=F,K=y);3===fa&&(B=y,T=E,K=A);B-=ba/2;for(i=0;i<X;i++)N=i,d[i]=N<T+S?ea+Y*(B+S):N<T+J?ea+Y*(B+J-Math.sqrt(J*J-Math.pow(N-T-J,2))):N<ca-1-K-J?ea+Y*B:N<=ca-1-K-S?ea+Y*(B+J-Math.sqrt(J*J-Math.pow(ca-1-N-K-J,2))):ea+Y*(B+S)}for(i=0;i<ca;i++){N=d[i];for(X=ea;Y*X<Y*(N+Y*ba);X+=Y)S=0===fa||3===fa?4*(i*c+X):4*(X*c+i),Y*X<Y*(N-Y*ba)?
ha?(a[S]=b*U+(1-b)*a[S]+0.5|0,a[S+1]=b*W+(1-b)*a[S+1]+0.5|0,a[S+2]=b*$+(1-b)*a[S+2]+0.5|0,a[S+3]=255*b+(1-b)*a[S+3]+0.5|0):(a[S]=U,a[S+1]=W,a[S+2]=$,a[S+3]=255):(aa=b*(1-(Y*(X-N)+ba)/(2*ba)),a[S]=aa*U+(1-aa)*a[S]+0.5|0,a[S+1]=aa*W+(1-aa)*a[S+1]+0.5|0,a[S+2]=aa*$+(1-aa)*a[S+2]+0.5|0,a[S+3]=255*aa+(1-aa)*a[S+3]+0.5|0)}}}function e(a,c,i,b,e,d){"undefined"===typeof e&&(e="");var h,f,g,j,m,l,o,L,v,q,G,M,J,E,F,A,y,N=1,T,B,K,S,U,W,$;T=B=K=S=U=W=$=V;h=(c+i)/30;g=f=0;var ha=i/2|0,ba=c/2|0,X=b[0],aa=b[1],
ca=b[2],b=255*b[3];"halftone"===e?(T=Q,h=(c+i)/30,f=d[0],L=1E3/(c+i),"number"===typeof d[1]&&(L=0===d[1]?0:L/d[1])):"smooth"===e?(K=Q,h=d[0]*(c+i)/30,"undefined"!==typeof d[1]&&(f=d[1]/h)):"rough"===e?(W=Q,h=d[0]*(c+i)/30,"undefined"!==typeof d[1]&&(f=d[1]/h),"undefined"!==typeof d[2]&&(g=d[2]),y=new k.RNG(g)):"viewfinder"===e?($=Q,h=(c+i)/60,G=M=E=J=0,"undefined"!==typeof d[0]&&(E=d[0]),"undefined"!==typeof d[1]&&(J=d[1]),"undefined"!==typeof d[2]&&(G=d[2]),"undefined"!==typeof d[3]&&(M=d[3]),"undefined"!==
typeof d[4]&&(g=d[4]),y=new k.RNG(g)):"lines"===e?(B=Q,h=d[0]*(c+i)/30,A=d[1]):"shadow"===e?(S=Q,h=d[0]*(c+i)/80,f=0.3,v=Math.PI/180*d[1],q=Math.sin(v),v=0.5*Math.cos(v)*h,q=0.5*q*h):"fade"===e&&(U=Q,h=(c+i)/80,"number"===typeof d[0]&&(h*=d[0]),f="number"===typeof d[1]?d[1]:1,"number"===typeof d[2]&&(N=d[2]));f*=h;$||(G=M=E=J=f);for(g=0;g<i;g++){m=g<ha?g-E:i-1-g-J;for(d=0;d<c;d++)if(e=4*(c*g+d),j=d<ba?d-G:c-1-d-M,o=m<Math.SQRT2*N*h&&j<Math.SQRT2*N*h?Math.SQRT2*N*h-Math.sqrt((m-Math.SQRT2*N*h)*(m-
Math.SQRT2*N*h)+(j-Math.SQRT2*N*h)*(j-Math.SQRT2*N*h)):m<j?m:j,0>m||0>j)T?(l=Math.cos((g-ha)*L)*Math.cos((d-ba)*L)+1,l=1-2*l,l=0>l?0:1<l?1:l,a[e]=a[e]*l+X*(1-l)+0.5|0,a[e+1]=a[e+1]*l+aa*(1-l)+0.5|0,a[e+2]=a[e+2]*l+ca*(1-l)+0.5|0,a[e+3]=a[e+3]*l+b*(1-l)+0.5|0):S?(o=g<ha?g-f-q:i-1-g-f+q,F=d<ba?d-f-v:c-1-d-f+v,o=o<Math.SQRT2*N*h&&F<Math.SQRT2*N*h?Math.SQRT2*N*h-Math.pow(Math.pow(o-Math.SQRT2*N*h,4)+Math.pow(F-Math.SQRT2*N*h,4),0.25):o<F?o:F,o<-h&&(o=-h),l=0.6*Math.pow((o/h+1)/2,4),l=0>l?0:1<l?1:l,a[e]=
X*(1-l)+0.5|0,a[e+1]=aa*(1-l)+0.5|0,a[e+2]=ca*(1-l)+0.5|0,a[e+3]=b*(1-l)+l*a[e+3]+0.5|0):(a[e]=X,a[e+1]=aa,a[e+2]=ca,a[e+3]=b);else if(o<h){if(T)l=Math.cos((g-ha)*L)*Math.cos((d-ba)*L)+1,l=0>=o?1-2*l:1-2*l*Math.pow(1-o/h,4);else if(S){o=g<ha?g-f-q:i-1-g-f+q;F=d<ba?d-f-v:c-1-d-f+v;o=o<Math.SQRT2*N*h&&F<Math.SQRT2*N*h?Math.SQRT2*N*h-Math.pow(Math.pow(o-Math.SQRT2*N*h,4)+Math.pow(F-Math.SQRT2*N*h,4),0.25):o<F?o:F;if(j>=h&&m>=h)continue;o<-h&&(o=-h);o>h&&(o=Math.sqrt(o/h)*h);l=0.6*Math.pow((o/h+1)/2,
4);l=0>l?0:1<l?1:l;a[e]=X*(1-l)+0.5|0;a[e+1]=aa*(1-l)+0.5|0;a[e+2]=ca*(1-l)+0.5|0;a[e+3]=255;continue}else U?(o=0>o?0:o,l=Math.pow(o/h,2)):K?l=1-2*Math.pow(1-o/h,4):W?l=1-2*(0.4*y.nextFloat()+0.6)*Math.pow(1-o/h,4):$?l=1-2*(0.4*y.nextFloat()+0.6)*Math.pow(1-o/h,4):B&&(l=1-2*((0.4*Math.random()+0.6)*(Math.cos(140*Math.PI*((g-ha)/i)/A)+1))*Math.pow(1-o/h,4));l=0>l?0:1<l?1:l;a[e]=a[e]*l+X*(1-l)+0.5|0;a[e+1]=a[e+1]*l+aa*(1-l)+0.5|0;a[e+2]=a[e+2]*l+ca*(1-l)+0.5|0;a[e+3]=a[e+3]*l+b*(1-l)+0.5|0}}}var k=
g("./rng"),b=g("./flare"),o=g("./vignette"),j=g("./legacy/auto_colors_fade_max_color"),d=g("./legacy/soft_focus"),f={},m={ia:function(a){for(var c=1;2*c<=a;)c*=2;return c},ga:function(a,c,i,b,e,d,h){"undefined"===typeof d&&(d="uniform");var k=c+m.ia(i-c);a[k]=a[i];"uniform"===d?m.ha(a,c,k,b,e,h):"normal"===d?m.fa(a,c,k,b,e,h):"laplacian"===d&&m.ea(a,c,k,b,e,h);m.ka(a,k,i);return a},ka:function(a,c,i){if(!(i<=c))for(var c=i/c,b,e;0<=i;i--)b=i/c,e=b-(b|0),a[i]=e?(1-e)*a[b|0]+e*a[(b|0)+1]:a[b]},ha:function(a,
c,i,b,e,d){for(var h=i-c,k=(i-c)/2,f;2<=h;){for(var g=c;g<i;g+=h)f=g+k,a[f]=(a[g]+a[g+h])/2+b*(d.nextFloat()-0.5);b*=Math.pow(2,-e);h=k;k/=2}},fa:function(a,c,i,b,e,d){for(var h=i-c,k=(i-c)/2,f;2<=h;){for(var g=c;g<i;g+=h)f=g+k,a[f]=(a[g]+a[g+h])/2+b*d.nextFloatNormal();b*=Math.pow(2,-e);h=k;k/=2}},ea:function(a,c,i,b,e,d){for(var h=i-c,k=(i-c)/2,f;2<=h;){for(var g=c;g<i;g+=h)f=g+k,a[f]=(a[g]+a[g+h])/2+b*d.nextFloatLaplace();b*=Math.pow(2,-e);h=k;k/=2}},k:function(a,c,i,b,e,d,h){h=new k.RNG(h);m.ga(a,
c,i,b,e,d,h);return h.getState()}},h={ca:function(a,c,i,b,e,d,h,k,f,g,j,l,m,o,v){var q=c/2|0,G=i/2|0,k=k*q+o*q,f=f*q+v*G,j=1,l=1/j/q/l,j=1/j/q/m,m=g*g,o=Math.PI/(2*m),M,J,E,F;M=Math.round(Math.min(i-1,Math.max(0,G+f-5*g/j)));for(var i=Math.round(Math.max(0,Math.min(i-1,G+f+5*g/j))),v=Math.round(Math.min(c-1,Math.max(0,q+k-5*g/l))),g=Math.round(Math.max(0,Math.min(c-1,q+k+5*g/l))),A=M;A<=i;A++){M=4*A*c;J=j*(A-G-f);for(var y=v;y<=g;y++)E=M+4*y,F=l*(y-q-k),F=F*F+J*J,F>5*m||(F=2.25>F*o?1-h*Math.max(Math.cos(F*
o),Math.cos(Math.sqrt(F*o)/1.8)/2):1-h*Math.cos(Math.sqrt(F*o)/1.8)/2,1<F&&(F=1),a[E]=a[E]*F+b*(1-F)|0,a[E+1]=a[E+1]*F+e*(1-F)|0,a[E+2]=a[E+2]*F+d*(1-F)|0)}},h:function(a,c,i,b,e,d,k,f,g,j,l,m,o,q){q||(q=0);m||(m=0);o||(o=1.3);var o=o*e,v=[];v[" "]=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];v["%"]=[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]];v["&"]=[[0,1,1,1,
1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0]];v["~"]=[[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0]];v["{"]=[[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[0,1,1,1,1,1,1],[0,1,1,1,1,1,1],[0,1,1,1,1,1,1]];v["}"]=[[0,1,1,1,0,1,0],[0,1,1,1,0,1,0],[0,1,1,1,0,1,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0]];v["^"]=[[0,0,0,1,0,0,0],[0,0,0,1,0,
0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0]];v[">"]=[[0,1,0,0,0,0,0],[0,1,1,0,0,0,0],[0,1,1,1,0,0,0],[0,1,1,1,1,0,0],[0,1,1,1,0,0,0],[0,1,1,0,0,0,0],[0,1,0,0,0,0,0]];v["<"]=[[0,0,0,0,0,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,0,0,1,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,0]];v[":"]=[[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0]];v["-"]=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,
0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];v["+"]=[[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0]];v["."]=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]];v["/"]=[[0,0,0,0,0,0,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0]];v["?"]=[[0,0,1,1,0,0,0],[0,1,0,0,1,0,0],[0,1,0,0,1,0,0],[0,0,1,1,0,0,0],
[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];v["*"]=[[0,0,0,0,0,0,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,1,0,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]];v["|"]=[[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]];v["@"]=[[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0]];v.A=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,
0,0,0,1,0],[0,1,0,0,0,1,0]];v.B=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0]];v.C=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.D=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0]];v.E=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]];v.F=
[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0]];v.G=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,1,1,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.H=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]];v.I=[[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0]];v.J=[[0,0,0,0,0,1,0],[0,0,0,0,0,1,
0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.K=[[0,1,0,0,0,1,0],[0,1,0,0,1,0,0],[0,1,0,1,0,0,0],[0,1,1,0,0,0,0],[0,1,0,1,0,0,0],[0,1,0,0,1,0,0],[0,1,0,0,0,1,0]];v.L=[[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]];v.M=[[0,1,0,0,0,1,0],[0,1,1,0,1,1,0],[0,1,0,1,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]];v.N=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,0,0,1,0],[0,1,0,1,0,
1,0],[0,1,0,0,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]];v.O=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.P=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0]];v.Q=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,0,1,1,1,1,0]];v.R=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,
0,1,0],[0,1,0,0,0,1,0]];v.S=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.T=[[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]];v.U=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];v.V=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0]];v.W=[[0,
1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,1,0,1,0],[0,1,1,0,1,1,0],[0,1,0,0,0,1,0]];v.X=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]];v.Y=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]];v.Z=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]];v.f=[[0,0,0,0,0,0,0],[0,0,0,1,1,1,0],
[0,0,1,0,0,0,0],[0,0,1,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,0,0,0,0],[0,0,1,0,0,0,0]];v.s=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,1,0],[0,0,1,1,1,0,0]];v["1"]=[[0,0,0,1,0,0,0],[0,0,1,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]];v["2"]=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]];v["3"]=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,
1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]];v["4"]=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0]];v["5"]=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]];v["6"]=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0]];v["7"]=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,
1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]];v["8"]=[[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0]];v["9"]=[[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]];v["0"]=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,1,1,0],[0,1,0,1,0,1,0],[0,1,1,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];for(var ga,G,M=0;M<b.length;M++)for(var J=0;7>J;J++)for(var E=0;7>E;E++)v[b[M]]&&v[b[M]][E][J]&&
(G=(7*(M+m)+J)*o*Math.cos(q)-E*o*Math.sin(q),ga=(7*(M+m)+J)*o*Math.sin(q)+E*o*Math.cos(q),h.ca(a,c,i,f,g,j,l,G,ga,e,1,1,1,d,k))},c:function(a,c,i,b,e,d,h,k,f){for(var g=0;g<k.length-1;g++){var j=k[g][0],l=k[g][1],m=k[g+1][0],o=k[g+1][1],v,q,G,M,J,E,F,A=[l-o,m-j],y=Math.sqrt(A[0]*A[0]+A[1]*A[1]);A[0]/=y;A[1]/=y;var y=[m-j,o-l],y=y[0]*y[0]+y[1]*y[1],N=f*f,T=(f+2)*(f+2);E=Math.round(Math.min(i-1,Math.max(0,Math.min(l,o)-f-2)));for(var B=Math.round(Math.max(0,Math.min(i-1,Math.max(l,o)+f+2))),K=Math.round(Math.min(c-
1,Math.max(0,Math.min(j,m)-f-2))),S=Math.round(Math.max(0,Math.min(c-1,Math.max(j,m)+f+2))),U=E;U<=B;U++){E=4*U*c;for(var W=K;W<=S;W++)if(F=E+4*W,v=Math.abs(A[0]*(W-j)+A[1]*(U-l)),q=(W-j)*(W-j)+(U-l)*(U-l),G=(W-m)*(W-m)+(U-o)*(U-o),q<G?(M=G,J=q):(M=q,J=G),G=v>f+2?1:J+y<M?q<N||G<N?1-h:q<T||G<T?1-h+h*(Math.sqrt(J)-f)/2:1:v>f?1-h+h*(v-f)/2:1-h,0.995>G)v=a[F]*G+b*(1-G)+0.5|0,q=a[F+1]*G+e*(1-G)+0.5|0,G=a[F+2]*G+d*(1-G)+0.5|0,v=0>v?0:255<v?255:v,q=0>q?0:255<q?255:q,G=0>G?0:255<G?255:G,a[F]=v,a[F+1]=q,a[F+
2]=G,a[F+3]=a[F+3]}}},v:function(a,c,i,b,e,d,h,k,f,g,j){var l=(c+i)/2,m,o,v=0.01*h,q=h*h,d=d*d;m=Math.min(i,Math.max(0,Math.round(e-h*l-4)));for(var i=Math.min(i,Math.max(0,Math.round(e+h*l+4))),G=Math.min(c,Math.max(0,Math.round(b-h*l-4))),h=Math.min(c,Math.max(0,Math.round(b+h*l+4))),M,J,E,F,A=m;A<i;A++){M=4*A*c;m=(A-e)/l;for(var y=G;y<h;y++)J=M+4*y,o=(y-b)/l,o=o*o+m*m,E=o>q+v?0:o>q?(q+v-o)/v:o>d?1:o>d-v?1-(d-o)/v:0,E=1-E*E*j,0.995>E&&(o=a[J]*E+k*(1-E)+0.5|0,F=a[J+1]*E+f*(1-E)+0.5|0,E=a[J+2]*E+
g*(1-E)+0.5|0,o=0>o?0:255<o?255:o,F=0>F?0:255<F?255:F,E=0>E?0:255<E?255:E,a[J]=o,a[J+1]=F,a[J+2]=E,a[J+3]=a[J+3])}},ba:function(a,c,i,b,e,d,h,k,f,g){var j=g*g,l=2;l>2*g&&(l=2*g);var m,o,v,q=Math.pow(g+l,2);m=Math.round(Math.min(i-1,Math.max(0,f-g-l)));for(var i=Math.round(Math.max(0,Math.min(i-1,f+g+l))),G=Math.round(Math.min(c-1,Math.max(0,k-g-l))),M=Math.round(Math.max(0,Math.min(c-1,k+g+l))),J=m;J<=i;J++){m=4*J*c;for(var E=G;E<=M;E++)o=m+4*E,v=(k-E)*(k-E)+(f-J)*(f-J),v>q||(v=v>j?1-h+h*(Math.sqrt(v)-
g)/l:1-h,a[o]=a[o]*v+b*(1-v),a[o+1]=a[o+1]*v+e*(1-v),a[o+2]=a[o+2]*v+d*(1-v))}},m:function(a,c,i,b,e,d,f,g){var g=new k.RNG(g),j=[];j[0]=[b,e,d];for(var l=1;0.2<d;){var d=0.97*d,m=g.nextFloat()*(l-1)|0,b=j[m][0],e=j[m][1],m=j[m][2],o=2*g.nextFloat()*Math.PI,b=b+0.5*(m+d)*Math.cos(o),e=e+0.5*(m+d)*Math.sin(o);h.ba(a,c,i,f[0],f[1],f[2],f[3],b,e,d);j[l]=[b,e,d];l++}}};f.purpleBorder=function(a,b,i,e){var d=[0,0,0,1];c(a,b,i,d,"torn",[0.02*e.intensity,0.02,0.5,"uniform",e.seed]);c(a,b,i,d,"round",[0.02,
1,1,1,1,1.5])};f.san_carmenBorder=function(a,b,i,e){var d=new k.RNG(e.seed),h=e.intensity;c(a,b,i,[225,225,200,1],"round",[0.025,1,1,1,1,1.5]);for(e=4;10>e;e++)l(a,b,i,[225,225,200,0.2],[0.06*h*(10-e)/10,0.0050*e+0.01,0.4,"uniform",d.nextInt()])};f.san_carmenAutoColors=function(a,c,i,b){j.autocolorsfade(a,c,i,b.intensity,251,233,194)};f.threshBorder=function(a,b,i){c(a,b,i,[0,0,0,1],"round",[0.025,1,1,1,1,1.5])};f.brownieBorder=function(b,e,i,d){var h=d.intensity,d=new k.RNG(d.seed);c(b,e,i,[0,0,
0,0.2],"torn",[0.03*h,0.02,0.2,"uniform",d.nextInt()]);c(b,e,i,[0,0,0,0.8],"torn",[0.02*h,0.01,0.5,"uniform",d.nextInt()]);a(b,e,i,{color:[0,0,0,1],offset:-(e+i)/150,corner:0,scale:0.5,seed:d.nextInt(),alpha:h})};f.maya_unicornBorder=function(a,b,i,e){var d=e.intensity,e=new k.RNG(e.seed);c(a,b,i,[0,0,0,1],"torn",[0,0.04*i/Math.min(b,i),0.2,"uniform",e.nextInt()]);var f="Abercrave Abilene Aith Banff Blean Caarnduncan Corrievorrie Cotterstock Dalrymple Draffan Dubuque Epsom Frolesworth Glassel Golant Harpenden Hassop Hove Popcastle Winkley".split(" "),
f="&  >| "+f[e.nextFloat()*f.length|0].toUpperCase()+" |<  &",g=0.8,j=0.935,l=0.0030*Math.min(b,i)/b;h.h(a,b,i,f,l,g,j,255,255,0,0.3,-f.length);h.h(a,b,i,f,l,-0.8,-0.957,255,255,0,0.3,0,0,0);f=[255,255,255,1];c(a,b,i,f,"torn",[0,0.01*i/Math.min(b,i),0.2,"uniform",e.nextInt()]);c(a,b,i,f,"torn",[0.02*d,0.01*i/Math.min(b,i),0.5,"uniform",e.nextInt()]);c(a,b,i,f,"torn",[0.0080*d,0.01*i/Math.min(b,i),0.3,"normal",e.nextInt()])};f.old_threshBorder=function(a,b,i,e){var d=e.intensity,e=new k.RNG(e.seed);
c(a,b,i,[255,255,255,1],"round",[0.025,1,1,1,1,1.5]);for(var h=4;10>h;h++)l(a,b,i,[255,255,255,0.2],[0.06*d*(10-h)/10,0.0050*h+0.01,0.4,"uniform",e.nextInt()])};f.bordeauxBorder=function(a,c,b,e){var e=new k.RNG(e.seed),d=c/((c+b)/2);h.c(a,c,b,255,255,255,0.3,[[0.46*c,0.5*b-0.05*c],[0.54*c,0.5*b-0.05*c]],0);h.v(a,c,b,c/2,b/2-0.05*c,0.08*d,0.081*d,255,255,255,0.3);h.c(a,c,b,255,255,255,0.3,[[0.5*c,0.5*b-0.18*c-0.05*c],[0.5*c,0.5*b-0.25*c-0.05*c]],0);h.c(a,c,b,255,255,255,0.3,[[0.5*c,0.5*b+0.18*c-0.05*
c],[0.5*c,0.5*b+0.25*c-0.05*c]],0);h.c(a,c,b,255,255,255,0.3,[[0.5*c-0.18*c,0.5*b-0.05*c],[0.5*c-0.25*c,0.5*b-0.05*c]],0);h.c(a,c,b,255,255,255,0.3,[[0.5*c+0.18*c,0.5*b-0.05*c],[0.5*c+0.25*c,0.5*b-0.05*c]],0);h.c(a,c,b,255,255,255,1,[[-c,b-0.1*c],[2*c,b-0.1*c]],0);h.c(a,c,b,0,0,0,1,[[-c,b],[2*c,b]],0.1*c);var d="               ",f=d.length*e.nextFloat()|0,f=Math.min(d.length-1,Math.max(0,f)),d=d.substr(0,f)+"@"+d.substr(f+1),f=[255,255,255,0.6],g=0.5*(1-3*0.1*c/b)+0.5;h.h(a,c,b,"+2..1..0..1..2-",
0.0050/1.2,-0.5,g,f[0],f[1],f[2],f[3],-7.5);h.h(a,c,b,d,0.0050/1.2,-0.5,g+0.035*1.3*c/b,f[0],f[1],f[2],f[3],-7.5);d=0.0050*c;f=0.8*c;g=b-8*d;h.c(a,c,b,255,255,255,1,[[f,g],[f+10*d,g]],d/4);h.c(a,c,b,255,255,255,1,[[f,g-6*d],[f+10*d,g-6*d]],d/4);h.c(a,c,b,255,255,255,1,[[f,g],[f,g-6*d]],d/4);h.c(a,c,b,255,255,255,1,[[f+10*d,g],[f+10*d,g-6*d]],d/4);h.c(a,c,b,255,255,255,1,[[f-d,g-2*d],[f-d,g-4*d]],d/4);e=4*e.nextFloat();0<e&&h.c(a,c,b,255,255,255,1,[[f+8*d,g-2*d],[f+8*d,g-4*d]],d/4);1<e&&h.c(a,c,b,
255,255,255,1,[[f+6*d,g-2*d],[f+6*d,g-4*d]],d/4);2<e&&h.c(a,c,b,255,255,255,1,[[f+4*d,g-2*d],[f+4*d,g-4*d]],d/4);3<e&&h.c(a,c,b,255,255,255,1,[[f+2*d,g-2*d],[f+2*d,g-4*d]],d/4)};f.covertBorder=function(a,c,b,d){var f=new k.RNG(d.seed);f.nextInt();f.nextInt();for(var d="1.4 2 2.8 4 5.6 8 11 16 22 32".split(" "),g=d[f.nextFloat()*d.length|0];3>g.length;)g+=" ";for(var d=["100","200","400","800","1600"],j=d[f.nextFloat()*d.length|0];4>j.length;)j+=" ";for(var d="1 2 4 8 15 30 60 125 250 500 1000".split(" "),
l=d[0],g=0.5*parseFloat(j)/(0.015625*parseFloat(g)*parseFloat(g)),j=1;j<d.length;j++)Math.abs(parseInt(d[j])-g)<Math.abs(parseInt(l)-g)&&(l=d[j]);for(;4>l.length;)l=" "+l;g="               ";f=g.length*f.nextFloat();f=Math.min(g.length-1,Math.max(0,f));g=g.substr(0,f)+"@"+g.substr(f+1);f="dfasdfsdf";f=(new Date).toDateString();f=f.toUpperCase();j=[90,250,20,0.6];e(a,c,b,[0,0,0,1],"smooth",[0.5,0.6*(Math.max(c,b)/15)]);for(var m=0.0043*Math.min(c,b)/c,o=0;o<d.length;o++){var s=1.1/d.length,q=-s*o+
0.5;(l==d[o]||l==" "+d[o]||l=="  "+d[o]||l=="   "+d[o])&&h.c(a,c,b,90,250,20,0.6,[[0.97*c,(q+s/2+1)*b/2],[2*c,(q+1)*b/2]],0.7*m*c);h.h(a,c,b,d[o],0.7*m,1,q,j[0],j[1],j[2],j[3],-2-d[o].length/2)}h.c(a,c,b,0,0,0,0.1,[[0,b/3],[c,b/3]],0);h.c(a,c,b,0,0,0,0.1,[[0,2*b/3],[c,2*b/3]],0);h.c(a,c,b,0,0,0,0.1,[[c/3,0],[c/3,b]],0);h.c(a,c,b,0,0,0,0.1,[[2*c/3,0],[2*c/3,b]],0);h.h(a,c,b,"+2..1..0..1..2-",m/1.2,-0.5,0.915,j[0],j[1],j[2],j[3],-7.5);h.h(a,c,b,g,m/1.2,-0.5,0.918+9.1*m*c/b,j[0],j[1],j[2],j[3],-7.5);
h.h(a,c,b,f,m,0.75,0.92,j[0],j[1],j[2],j[3],-f.length)};f.orcaBorder=function(a,c,b,d){var f=d.seed,g=new k.RNG(f),d="1.4 2 2.8 4 5.6 8 11 16 22 32".split(" "),g=d[g.nextFloat()*d.length|0],j=[216,193,163,0.6];e(a,c,b,[0,0,0,1],"rough",[1,0.6*((c+b)/30),f]);for(var f=0.0043*Math.min(c,b)/c,l=0;l<d.length;l++){var m=1.1/d.length*l-0.5;(g==d[l]||g==d[l]+" "||g==d[l]+"  ")&&h.c(a,c,b,230,50,40,0.7,[[0.95*c,(m+1)*b/2],[2*c,0.5*b]],0.7*f*c);h.h(a,c,b,d[l],0.7*f,1,m,j[0],j[1],j[2],j[3],-2-d[l].length/2)}h.c(a,
c,b,0,0,0,0.1,[[c/4,0],[c/4,b/3]],0);h.c(a,c,b,0,0,0,0.1,[[0,b/4],[c/3,b/4]],0);h.c(a,c,b,0,0,0,0.1,[[0,3*b/4],[c/3,3*b/4]],0);h.c(a,c,b,0,0,0,0.1,[[c/4,b],[c/4,2*b/3]],0);h.c(a,c,b,0,0,0,0.1,[[3*c/4,0],[3*c/4,b/3]],0);h.c(a,c,b,0,0,0,0.1,[[c,b/4],[2*c/3,b/4]],0);h.c(a,c,b,0,0,0,0.1,[[3*c/4,b],[3*c/4,2*b/3]],0);h.c(a,c,b,0,0,0,0.1,[[c,3*b/4],[2*c/3,3*b/4]],0);h.c(a,c,b,0,0,0,0.1,[[0,b/2],[c/4,b/2]],0);h.c(a,c,b,0,0,0,0.1,[[c/2,0],[c/2,b/4]],0);h.c(a,c,b,0,0,0,0.1,[[c/2,b],[c/2,3*b/4]],0);h.c(a,c,
b,0,0,0,0.1,[[c,b/2],[3*c/4,b/2]],0);h.v(a,c,b,c/2,b/2,0.08,0.22,255,255,255,0.28)};f.titanBorder=function(a,c,b,d){var f=d.seed,d=new k.RNG(f),g="1.4 2 2.8 4 5.6 8 11 16 22 32".split(" "),j=g[d.nextFloat()*g.length|0],d="1 2 4 8 15 30 60 125 250 500 1000".split(" "),g=0.0050*(c+b)/c/2;e(a,c,b,[0,0,0,1],"viewfinder",[0.0050*(c+b),0.035*(c+b),0.0050*(c+b),0.035*(c+b),f]);h.c(a,c,b,0,0,0,1,[[c-0.03*(c+b),0.8*b-0.035*(c+b)],[c-0.03*(c+b),0.2*b]],(c+b)/50);var f=0.035*(c+b),l=0.5*(1-2.5*(f/b))+0.5;h.c(a,
c,b,255,255,255,0.2,[[0.4*c,b-f/2],[0.45*c,b-f/2]],(c+b)/100);h.h(a,c,b,j,g,-0.15,l,255,255,255,1,-j.length/2);f=[230,230,255,0.8];for(j=0;j<d.length;j++)h.h(a,c,b,d[j],0.7*g,1,-(1.1/d.length)*j+0.4,f[0],f[1],f[2],f[3],-3.5-d[j].length/2)};f.andyBorder=function(a,b,d,e){for(var f=e.seed,e=(new Date).toDateString(),e=e.toUpperCase(),f=new k.RNG(f),g="1.4 2 2.8 4 5.6 8 11 16 22 32".split(" "),g=g[f.nextFloat()*g.length|0];3>g.length;)g+=" ";for(var j=["100","200","400","800","1600"],j=j[f.nextFloat()*
j.length|0];4>j.length;)j+=" ";for(var l="1 2 4 8 15 30 60 125 250 500 1000".split(" "),m=l[0],o=0.5*parseFloat(j)/(0.015625*parseFloat(g)*parseFloat(g)),s=1;s<l.length;s++)Math.abs(parseInt(l[s],10)-o)<Math.abs(parseInt(m,10)-o)&&(m=l[s]);for(;4>m.length;)m=" "+m;l="               ";f=l.length*f.nextFloat();f=Math.min(l.length-1,Math.max(0,f));l=l.substr(0,f)+"@"+l.substr(f+1);f=m+"/s f"+g+"  > |";g="  | <     ISO:"+j;c(a,b,d,[0,0,0,1],"round",[0.0080,6,4,4,4,1.5]);j=0.0043*Math.min(b,d)/b;h.h(a,
b,d,f,j,-0.9,-0.978,180,120,0,1);h.h(a,b,d,g,j,0.9,-0.978,180,120,0,1,-g.length);h.h(a,b,d,"+2..1..0..1..2-",j/1.7,0,-0.985,180,120,0,1,-7.5);h.h(a,b,d,l,j/1.7,0,-0.988+9.1*j*b/d,180,120,0,1,-7.5);h.h(a,b,d,e,j,0.85,0.86,230,50,40,1,-e.length)};f.aquaBorder=function(a,b,d){c(a,b,d,[255,255,255,1],"round",[0.025,1,1,1,1,1.5])};f.edgewoodBorder=function(a,b,d,e){var h,f=new k.RNG(e.seed),g=[255,255,255,1];c(a,b,d,g,"round",[0.025,1,1,1,1,1.5]);for(h=4;10>h;h++)l(a,b,d,g,[0.03*e.intensity*(10-h)/10,
0.0050*h+0.01,0.4,"uniform",f.nextInt()])};f.joe_coolBorder=function(a,b,d){c(a,b,d,[255,255,255,1],"bulge",[0.05,0.28,0.5])};f.singeBorder=function(a,c,b){e(a,c,b,[0,0,0,1],"fade",1)};f.solarBorder=function(c,b,d,e){for(var e=new k.RNG(e.seed),f=(b+d)/2/50,g=[[141,88,46,0.1],[70,48,26,0.1]],j,l,m=0;2>m;m++)for(var o=7;10>o;o++)for(var s=o;10>s;s+=0.4)j=0.02*b*e.nextFloatNormal(),l=d*e.nextFloat(),h.m(c,b,d,j,l,f/3*o/15,g[m],e.nextInt()),j=b+0.02*b*e.nextFloatNormal(),l=d*e.nextFloat(),h.m(c,b,d,
j,l,f/3*o/15,g[m],e.nextInt()),j=b*e.nextFloat(),l=0.02*d*e.nextFloatNormal(),h.m(c,b,d,j,l,f/3*o/15,g[m],e.nextInt()),j=b*e.nextFloat(),l=d+0.02*d*e.nextFloatNormal(),h.m(c,b,d,j,l,f/3*o/15,g[m],e.nextInt());a(c,b,d,{color:[200,140,80,0.3],offset:(b+d)/80,corner:(b+d)/40,seed:e.nextInt()});a(c,b,d,{color:[113,77,40,0.7],offset:(b+d)/200,corner:(b+d)/60,seed:e.nextInt()});a(c,b,d,{color:[0,0,0,0.9],offset:0,corner:(b+d)/80,seed:e.nextInt()})};f.earthyBorder=function(b,d,e,h){var f=new k.RNG(h.seed),
g=[0,15,0,1],h=h.intensity;c(b,d,e,g,"torn",[0.02*h,0.02,0.5,"uniform",f.nextInt()]);c(b,d,e,g,"torn",[0.01*h,0.02,0,"uniform",f.nextInt()]);a(b,d,e,{color:g,seed:f.nextInt(),alpha:h})};f.ithacaFlare=function(a,c,d,e){var h=e.intensity,f=new k.RNG(e.seed),e=0.3*(f.nextFloat()-0.5),g=0.3*(f.nextFloat()-0.5),f=0.4*f.nextFloat();b.flare(a,c,d,1+f,255,255,255,0.6*h,"angleGaussian",e,g)};f.ithacaBorder=function(a,c,b){e(a,c,b,[255,255,255,1],"smooth",[1])};f.cherryBorder=function(a,b,d,e){var f=new k.RNG(e.seed);
c(a,b,d,[255,255,255,1],"round",[0.03,1,1,1,1,1.5]);var e=0.03*Math.min(b,d)/b,g="ABERCRAVE ABILENE AITH BANFF BLEAN CAARNDUNCAN CORRIEVORRIE COTTERSTOCK DALRYMPLE DRAFFAN DUBUQUE EPSOM FROLESWORTH GLASSEL GOLANT HARPENDEN HASSOP HOVE POPCASTLE WINKLEY".split(" "),f="<> <> "+g[f.nextFloat()*g.length|0].toUpperCase()+" <> <>",g=1-1.4*e,j=0.85,l=0.0030*Math.min(b,d)/b,m=-Math.PI/2;h.h(a,b,d,f,l,g,j,230,50,40,0.4,0,0,m);h.h(a,b,d,f,l,-1+0.6*e,j,230,50,40,0.4,0,0,m);j=-0.85;h.h(a,b,d,f,l,1-1.4*e,j,230,
50,40,0.4,-f.length,0,m);h.h(a,b,d,f,l,-1+0.6*e,j,230,50,40,0.4,-f.length,0,m)};f.cross_processBorder=function(a,b,d,e){c(a,b,d,[255,255,255,1],"torn",[0.015*e.intensity,0.02,0.5,"uniform",e.seed])};f.sunburnFlare=function(a,c,d,e){var f=e.intensity,h=new k.RNG(e.seed),e=0.1*(h.nextFloat()-0.5),g=0.1*(h.nextFloat()-0.5),h=0.1*(h.nextFloat()-0.5);b.flare(a,c,d,1+h,255,255,255,1*f,"gaussianThing2",e,g)};f.sunburnBorder=function(a,c,b){e(a,c,b,[0,0,0,1],"fade",[1,0,2.222])};f.fadedBorder=function(a,
b,d,e){var h=e.intensity,e=new k.RNG(e.seed);c(a,b,d,[255,255,255,1],"round",[0.025,1,1,1,1,1.5]);var f;for(f=4;10>f;f++)l(a,b,d,[255,255,255,1],[0.03*h,0.0050*f+0.01,8,"uniform",e.nextInt()])};f.chronoBorder=function(b,d,e,f){var g=f.intensity,f=new k.RNG(f.seed);h.c(b,d,e,255,255,0,0.2,[[0.35*d,e/8],[0.65*d,e/8]],(d+e)/250);h.c(b,d,e,255,255,0,0.2,[[0.35*d,7*e/8],[0.65*d,7*e/8]],(d+e)/250);h.c(b,d,e,255,255,0,0.2,[[0.11*d,0.2*e],[0.11*d,0.8*e]],(d+e)/250);h.c(b,d,e,110,110,0,0.85,[[0.965*d,0],[0.965*
d,e]],0.07*d);h.c(b,d,e,110,0,0,0.85,[[0.947*d,0.04*e],[1.2*d,0.3*e]],0.05*d);h.c(b,d,e,110,0,0,0.85,[[0.947*d,0.96*e],[1.2*d,0.7*e]],0.05*d);h.c(b,d,e,0,0,0,0.5,[[0.895*d,0],[0.895*d,e]],0);for(var j="1.4 2 2.8 4 5.6 8 11 16 22 32".split(" "),l=j[f.nextFloat()*j.length|0],m=[0,0,0,0.8],q=0;q<j.length;q++){var D=2/j.length,s=0.9-D*q;(l==j[q]||l==j[q]+" "||l==j[q]+"  ")&&h.c(b,d,e,255,255,0,0.2,[[0.86*d,(s/2-D/10+0.5)*e],[0.86*d,(s/2+D/10+0.5)*e]],(d+e)/250);h.h(b,d,e,j[q],0.0040,0.95,s,m[0],m[1],
m[2],m[3],-2-j[q].length/2);h.h(b,d,e,"%",0.0040,0.95,s+D/2,m[0],m[1],m[2],m[3],-2.5)}a(b,d,e,{color:[0,0,0,1],seed:f.nextInt(),alpha:1,scale:0.5});o.vignette(b,d,e,1.1*((d+e)/2)/(g+1E-9),0,0,150);c(b,d,e,[0,0,0,1],"bulge",[0.05,0.28,0.5])};f.cabanaBorder=function(a,b,d){var e=0.0053*Math.min(b,d)/b;h.c(a,b,d,255,255,255,0.5,[[0,0.1*d],[0.08*b,0.1*d]],0);h.h(a,b,d,"0.5",e,-0.8,-0.8-2*e,255,255,255,0.5);h.c(a,b,d,255,255,255,0.5,[[0,0.3*d],[0.08*b,0.3*d]],0);h.h(a,b,d,"1.0",e,-0.8,-0.4-2*e,255,255,
255,0.5);h.c(a,b,d,255,255,255,0.5,[[0,0.5*d],[0.08*b,0.5*d]],0);h.h(a,b,d,"1.5",e,-0.8,-2*e,255,255,255,0.5);h.c(a,b,d,255,255,255,0.5,[[0,0.7*d],[0.08*b,0.7*d]],0);h.h(a,b,d,"2.0",e,-0.8,0.4-2*e,255,255,255,0.5);h.c(a,b,d,255,255,255,0.5,[[0,0.9*d],[0.08*b,0.9*d]],0);h.h(a,b,d,"2.5",e,-0.8,0.8-2*e,255,255,255,0.5);c(a,b,d,[0,0,0,1],"round",[0.025,1,1,1,1,1.5])};f.soft_focus=function(a,b,c,e){e=e.intensity;d.softFocusConvolution(a,b,c,0.4*e,1+0.25*e)};q.e=f});
Z.d("/src/js/processors/rng.js",function(g,q){function a(a){this.la=this.state="number"===typeof a&&0<=a?a:Math.floor(4294967295*Math.random())}var l={};a.prototype.nextInt=function(){return this.state=(69069*this.state+1)%4294967296};a.prototype.nextIntN=function(a){for(;0<a;)this.state=(69069*this.state+1)%4294967296,a--;return this.state};a.prototype.nextFloat=function(){this.state=(69069*this.state+1)%4294967296;return this.state/4294967296};a.prototype.getState=function(){return this.state};
a.prototype.getSeed=function(){return this.la};a.prototype.nextFloatNormal=function(){for(var a=this.nextFloat(),e=this.nextFloat();0===a;)a=this.nextFloat();for(;0===e;)e=this.nextFloat();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*e)};a.prototype.nextFloatLaplace=function(){var a=0.5-this.nextFloat();return 0>a?Math.log(1+2*a):-Math.log(1-2*a)};l.RNG=a;q.e=l});
Z.d("/src/js/processors/flare.js",function(g,q){q.e={flare:function(a,g,c,e,k,b,o,j,d,f,m,h,n,p){"undefined"===typeof f&&(f=0);"undefined"===typeof m&&(m=0);"undefined"===typeof h&&(h=1);"undefined"===typeof n&&(n=1);"undefined"===typeof k?k=0:0>k?k=0:255<k&&(k=255);"undefined"===typeof b?b=0:0>b?b=0:255<b&&(b=255);"undefined"===typeof o?o=0:0>o?o=0:255<o&&(o=255);"undefined"===typeof j&&(j=1);var i="sinc"===d,r="gaussianThing"===d,u="gaussianThing2"===d,q="gaussianThing3"===d,x="gaussianThing4"===
d,t="angleGaussian"===d,P="stardom"===d,D="lobes"===d,s="stripe"===d,C="stripe2"===d,O="dimondFlare"===d,L="crossFlare"===d,v="cornerFlares"===d,ga="fingerFlare"===d,G="blobFlare"===d,M="blah"===d,J="blob"===d,d="blob2"===d;if(!(0==h||0==n||0==e||0==j)){var E=V;"overlay"===p&&(E=Q);var F,A,y,N,T,B,K,p=g/2|0,S=c/2|0,U=Math.log(1/255/j),f=f*p,m=m*S,h=1/e/p/h,n=1/e/S/n;i&&(n=h=2/e/(p+S));for(T=0;T<c;T++){F=4*T*g;K=n*(T-S-m);for(N=0;N<g;N++)if(e=F+4*N,B=h*(N-p-f),y=1,i?(y=80*(B*B+K*K),y=0===y?1:1-0.4*
j*(Math.sin(y)/Math.sqrt(y))):r?(A=2*-(B*B+K*K)-16*(K+0.5)*(K+0.5)*(B+0.5)*(B+0.5),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):u?(A=2*-(B*B+K*K)-16*(K+1)*(K+1)*(B-0.5)*(B-0.5),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):q?(y=B*B+K*K,A=2*-y-1*(K+1.7)*(K+1.7)*(B-0.6)*(B-0.6),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):x?(A=-0.5*(K-1.7)*(K-1.7)*(B+0.6)*(B+0.6)-0.5*(K+1.7)*(K+1.7)*(B-0.6)*(B-0.6),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):t?(A=2*-(B*B+K*K)-5*(B+0.2)*(K+0.2)*B*B,y=A<U?1:0<A?1-0.5*j:1-0.5*j*Math.exp(A)):P?(y=B*B+K*K,B=Math.atan2(K,
B),y=1-0.2*j*(1-y*y*Math.sin(10*B))):D?(y=B*B+K*K,B=Math.atan2(K,B),y=1-0.5*j*Math.exp(2*-y)*(0.5+0.5*Math.sin(4*B+1))):s?(A=-(B*B)-K*K/64,y=A<U?1:0<A?1-j:1-j*Math.exp(A)):C?(A=-(K*K)-B*B/64,y=A<U?1:0<A?1-j:1-j*Math.exp(A)):O?(y=B*B+K*K,y=1-j*Math.exp(2*-(y*y)+-8*(K+0.5)*(K-0.5)*(B+0.5)*(B-0.5))):L?(y=B*B+K*K,A=2*-(y/180)-16*(K+0.5)*(K+0.5)*(B+0.5)*(B+0.5),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):v?(y=B*B+K*K,y=1-j*Math.exp(2*-(y/180))*Math.exp(-8*(K+1)*(K-1)*(B+1)*(B-1))):ga?(K=n*(T-S-m)-1,B=h*(N-p-f)-1,
y=(B+1)*B+K*K,y=j*Math.exp(K/B+-y*Math.exp(Math.exp(K)*B))):G?(y=B*B+K*K,y=1-j*Math.exp(-Math.pow(y,2)+-0.9*(K-1.7)*(K+0.5)*(B-1.5)*(B+0.5))):M?(y=B*B+K*K,B=Math.atan2(K,B),y=A<U?1:0<A?1-j:1-0.2*j*(1-Math.sin(y)*Math.sin(10*y)*Math.sin(10*B))):d?(A=10*-Math.pow(K*K+B*B,2),y=A<U?1:0<A?1-j:1-j*Math.exp(A)):J&&(A=100*-Math.pow(K*K+B*B,4),y=A<U?1:0<A?1-j:1-j*Math.exp(A)),y=0>y?0:1<y?1:y,E){B=a[e];var W=a[e+1],$=a[e+2];B=128>=B?y*B+2*(1-y)*B*k/256+0.5|0:y*B+(1-y)*(255-(255-(2*B-256))*(255-k)/256)+0.5|
0;W=128>=W?y*W+2*(1-y)*W*b/256+0.5|0:y*W+(1-y)*(255-(255-(2*W-256))*(255-b)/256)+0.5|0;$=128>=$?y*$+2*(1-y)*$*o/256+0.5|0:y*$+(1-y)*(255-(255-(2*$-256))*(255-o)/256)+0.5|0;a[e]=B;a[e+1]=W;a[e+2]=$}else a[e]=a[e]*y+k*(1-y)+0.5|0,a[e+1]=a[e+1]*y+b*(1-y)+0.5|0,a[e+2]=a[e+2]*y+o*(1-y)+0.5|0}}}}});
Z.d("/src/js/processors/vignette.js",function(g,q){q.e={vignette:function(a,g,c,e,k,b,o,j,d,f,m,h,n){var p="overlay"===d,d="multiply"===d,i="sharp"===f,r="ultraSharp"===f,f="mediumSharp"===f;"boolean"!==typeof m&&(m=V);"number"!==typeof j&&(j=1);"number"!==typeof h&&(h=0);"number"!==typeof n&&(n=0);var e=1/(Math.pow(e,2)/1.15),u,q,x,t,P,D,s,C=g/2|0,O=c/2|0,L=5/3,v=34/45,ga=13/63,G=514/14175,h=h*C,n=n*O,M,J;for(J=0;J<c;J++){q=4*J*g;x=(J-O-n)*(J-O-n);for(M=0;M<g;M++)(u=q+4*M,t=m?((M-C-h)*(M-C-h)/g/
g+(J-O-n)*(J-O-n)/c/c)*e:((M-C-h)*(M-C-h)+x)*e,i&&(t*=t),r&&(t*=t,t*=t),f&&(t=Math.pow(t,1.5)),1.15<t?t=0:0.04>t?t=1:(t*=t,P=t*t,D=P*t,s=D*t,t=1-2*t+L*P-v*D+ga*s-G*s*t),p)?(P=a[u],D=a[u+1],s=a[u+2],t=(1-t)*j,P=128>=P?(1-t)*P+2*t*P*k/256+0.5|0:(1-t)*P+t*(255-(255-(2*P-256))*(255-k)/256)+0.5|0,D=128>=D?(1-t)*D+2*t*D*b/256+0.5|0:(1-t)*D+t*(255-(255-(2*D-256))*(255-b)/256)+0.5|0,s=128>=s?(1-t)*s+2*t*s*o/256+0.5|0:(1-t)*s+t*(255-(255-(2*s-256))*(255-o)/256)+0.5|0,P=255<P?255:0>P?0:P,D=255<D?255:0>D?0:
D,s=255<s?255:0>s?0:s,a[u]=P,a[u+1]=D,a[u+2]=s):d?(t=1-j*(1-t),t=0>t?0:1<t?1:t,P=t*a[u]+(1-t)*k*a[u]/255+0.5|0,D=t*a[u+1]+(1-t)*b*a[u+1]/255+0.5|0,s=t*a[u+2]+(1-t)*o*a[u+2]/255+0.5|0,P=255<P?255:0>P?0:P,D=255<D?255:0>D?0:D,s=255<s?255:0>s?0:s,a[u]=P,a[u+1]=D,a[u+2]=s):(t=1-j*(1-t),t=0>t?0:1<t?1:t,a[u]=a[u]*t+k*(1-t)+0.5|0,a[u+1]=a[u+1]*t+b*(1-t)+0.5|0,a[u+2]=a[u+2]*t+o*(1-t)+0.5|0)}}}});
Z.d("/src/js/processors/legacy/auto_colors_fade_max_color.js",function(g,q){var a=g("../colorMatrixTransform"),l={getcdf:function(a){for(var e=0,g=0;256>g;g++)e+=a[g];g=Array(256);g[0]=a[0]/e;for(var b=1;256>b;b++)g[b]=a[b]/e+g[b-1];return g},cdfinv:function(a,e){if(0>=e)return 0;if(1<=e)return 255;for(var g=0;e>a[g];)g++;return 0===g?e/a[g]:g-1+(e-a[g-1])/(a[g]-a[g-1])},getHist:function(a){var e=Array(256),g=Array(256),b=Array(256),l,j;for(l=0;256>l;l++)e[l]=0,g[l]=0,b[l]=0;l=0;for(j=a.length;l<
j;l+=4)e[a[l]]++,g[a[l+1]]++,b[a[l+2]]++;return{r:e,g:g,b:b}},autocolorsfade:function(c,e,g,b,o,j,d){"undefined"===typeof b&&(b=1);var e=l.getHist(c),g=l.getcdf(e.r),f=l.getcdf(e.g),m=l.getcdf(e.b),e=b*l.cdfinv(g,0.0050),h=255*(1-b)+b*l.cdfinv(g,0.995),g=b*l.cdfinv(f,0.0050),n=255*(1-b)+b*l.cdfinv(f,0.995),f=b*l.cdfinv(m,0.0050),m=255*(1-b)+b*l.cdfinv(m,0.995);"undefined"!==typeof o&&(h=Math.max(o,h)*b+h*(1-b));"undefined"!==typeof j&&(n=Math.max(j,n)*b+n*(1-b));"undefined"!==typeof d&&(m=Math.max(d,
m)*b+m*(1-b));b=[255/(h-e),0,0,0,0,255/(n-g),0,0,0,0,255/(m-f),0];a.colorMatrixTransform(c,[1,0,0,-e,0,1,0,-g,0,0,1,-f]);a.colorMatrixTransform(c,b)}};q.e=l});
Z.d("/src/js/processors/legacy/soft_focus.js",function(g,q){var a={},l=g("../copy");a.softFocusConvolution=function(a,e,g,b,o){"undefined"===typeof b&&(b=0.4);"undefined"===typeof o&&(o=1.25);for(var j=l.copy(a),d,f,m,h,n,p,i=[4,0,-4,0,-10,10,-10,10,-15,15,0,0,-6,6,-6,6,10,-10,0,0],r=[0,4,0,-4,-10,-10,10,10,0,0,15,-15,-6,-6,6,6,0,0,10,-10],u=Array(20),q=d=0;20>q;q++)u[q]=Math.exp(-(i[q]*i[q]+r[q]*r[q])/100),d+=u[q];for(q=0;20>q;q++)u[q]/=d;for(q=0;q<g;q++)for(var x=0;x<e;x++){d=4*(x+e*q);p=n=h=0;
if(20>q||20>x||x>e-20||q>g-20)for(var t=0;20>t;t++)f=Math.max(0,Math.min(e-1,x+i[t])),m=Math.max(0,Math.min(g-1,q+r[t])),f=4*(f+e*m),m=u[t],h+=m*j[f],n+=m*j[f+1],p+=m*j[f+2];else for(t=0;20>t;t++)f=x+i[t],m=q+r[t],f=4*(f+e*m),m=u[t],h+=m*j[f],n+=m*j[f+1],p+=m*j[f+2];h=o*b*h+(1-b)*j[d]+0.5|0;n=o*b*n+(1-b)*j[d+1]+0.5|0;p=o*b*p+(1-b)*j[d+2]+0.5|0;255<h?h=255:0>h&&(h=0);255<n?n=255:0>n&&(n=0);255<p?p=255:0>p&&(p=0);a[d]=h;a[d+1]=n;a[d+2]=p;a[d+3]=j[d+3]}};q.e=a});
Z.d("/src/js/processors/noise.js",function(g,q){var a={},l=g("./rng");a.noise=function(a,e,g,b,o){var j,d,f,m,h=new l.RNG(o),b=255*b;for(m=0;m<e*g;m++)o=4*m,f=b*(2*h.nextFloat()-1),j=a[o]+f+0.5|0,d=a[o+1]+f+0.5|0,f=a[o+2]+f+0.5|0,j=0>j?0:255<j?255:j,d=0>d?0:255<d?255:d,f=0>f?0:255<f?255:f,a[o]=j,a[o+1]=d,a[o+2]=f};q.e=a});
Z.d("/src/js/processors/intensityMap.js",function(g,q){q.e={mapIntensity:function(a,g,c,e){for(var k=a.length,b=0,o,j,d,f,m,h=1-e,n="overlay"===c,p="multiply"===c;b<k;)o=0.212671*a[b]+0.71516*a[b+1]+0.072169*a[b+2]+0.5|0,n?(c=a[b],j=a[b+1],d=a[b+2],f=g.r[o],m=g.g[o],o=g.b[o],c=128>=c?h*c+2*e*c*f/256+0.5|0:h*c+e*(255-(255-(2*c-256))*(255-f)/256)+0.5|0,j=128>=j?h*j+2*e*j*m/256+0.5|0:h*j+e*(255-(255-(2*j-256))*(255-m)/256)+0.5|0,d=128>=d?h*d+2*e*d*o/256+0.5|0:h*d+e*(255-(255-(2*d-256))*(255-o)/256)+
0.5|0,c=0>c?0:255<c?255:c,j=0>j?0:255<j?255:j,d=0>d?0:255<d?255:d,a[b]=c,a[b+1]=j,a[b+2]=d):p?(c=a[b],j=a[b+1],d=a[b+2],f=g.r[o],m=g.g[o],o=g.b[o],c=h*c+e*c*f/255+0.5|0,j=h*j+e*j*m/255+0.5|0,d=h*d+e*d*o/255+0.5|0,c=0>c?0:255<c?255:c,j=0>j?0:255<j?255:j,d=0>d?0:255<d?255:d,a[b]=c,a[b+1]=j,a[b+2]=d):(a[b]=h*a[b]+e*g.r[o],a[b+1]=h*a[b+1]+e*g.g[o],a[b+2]=h*a[b+2]+e*g.b[o]),b+=4}}});
Z.d("/src/js/processors/gradient.js",function(g,q){q.e={applyGradient:function(a,g,c,e,k,b,o,j,d,f,m,h){"string"!==typeof m&&(m="normal");"number"!==typeof h&&(m=1);if(0!=b){var n=[[],[],[],[]],p,i,r,q,z,x,t;x=0;t=1;for(p=0;1024>p;p++){for(i=1-(1023-p)/1023;e.colors[t].location<=100*i&&"object"===typeof e.colors[t+1];)t++,x++;i=(100*i-e.colors[x].location)/(e.colors[t].location-e.colors[x].location);i=Math.max(0,Math.min(1,i));i+=9*(1+1.5*Math.abs(i-0.5))*Math.sin(2*Math.PI*(i-0.5))/255;i=Math.max(0,
Math.min(1,i));q=e.colors[x].color;z=e.colors[t].color;r=1-i;n[0][p]=Math.max(0,Math.min(255,Math.round(q.r*r+i*z.r)));n[1][p]=Math.max(0,Math.min(255,Math.round(q.g*r+i*z.g)));n[2][p]=Math.max(0,Math.min(255,Math.round(q.b*r+i*z.b)))}x=0;t=1;for(p=0;1024>p;p++){for(i=1-(1023-p)/1023;e.opacities[t].location<=100*i&&"object"===typeof e.opacities[t+1];)t++,x++;i=(100*i-e.opacities[x].location)/(e.opacities[t].location-e.opacities[x].location);i=Math.max(0,Math.min(1,i));i+=9*(1+1.5*Math.abs(i-0.5))*
Math.sin(2*Math.PI*(i-0.5))/255;i=Math.max(0,Math.min(1,i));q=e.opacities[x].opacity;z=e.opacities[t].opacity;r=1-i;n[3][p]=Math.max(0,Math.min(1,q*r+i*z))}x=f.shapeMode;e="sharp"===x;p="ultraSharp"===x;x="mediumSharp"===x;t=f.dx;i=f.dy;var f=1/(Math.pow(f.vignetteScale,2)/1.15),P,D,s;r=g/2|0;q=c/2|0;t*=r;i*=q;z=5/3;var C=34/45,O=13/63,L=514/14175,v=h,ga="overlay"===m,m="multiply"===m,G="linear"===k,M="linearVignette"===k,k="radial"===k,J,E,F,A,y,N,T,B,K=Math.sin(d),S=Math.cos(d);for(y=0;y<c;y++){d=
(y/c-j)/b;for(A=0;A<g;A++)J=4*(y*g+A),P=(A/g-o)/b,G?E=S*P-K*d:k?E=Math.sqrt(P*P+d*d):M&&((E=S*P-K*d,h=((A-r-t)*(A-r-t)/g/g+(y-q-i)*(y-q-i)/c/c)*f,e&&(h*=h),p&&(h*=h,h*=h),x&&(h=Math.pow(h,1.5)),1.15<h)?h=v:0.04>h?h=0:(h*=h,P=h*h,D=P*h,s=D*h,h=v*(1-(1-2*h+z*P-C*D+O*s-L*s*h)))),E=0>E?0:1<E?1:E,P=n[0][1023*E+0.5|0],D=n[1][1023*E+0.5|0],s=n[2][1023*E+0.5|0],E=n[3][1023*E+0.5|0],E*=h,F=1-E,N=a[J],T=a[J+1],B=a[J+2],ga?(N=128>=N?F*N+2*E*N*P/256+0.5|0:F*N+E*(255-(255-(2*N-256))*(255-P)/256),T=128>=T?F*T+
2*E*T*D/256+0.5|0:F*T+E*(255-(255-(2*T-256))*(255-D)/256),B=128>=B?F*B+2*E*B*s/256+0.5|0:F*B+E*(255-(255-(2*B-256))*(255-s)/256)):m?(N=F*N+E*P*N/255,T=F*T+E*D*T/255,B=F*B+E*s*B/255):(N=F*N+P*E,T=F*T+D*E,B=F*B+s*E),N=N+0.5|0,T=T+0.5|0,B=B+0.5|0,N=255<N?255:0>N?0:N,T=255<T?255:0>T?0:T,B=255<B?255:0>B?0:B,a[J]=N,a[J+1]=T,a[J+2]=B}}}}});
Z.d("/proclist/src/js/FeatherEntry.coffee",function(g){g("../../../src/js/processors/tools/enhance");g("../../../src/js/processors/legacy/whiten2");g("../../../src/js/processors/legacy/redeye2");g("../../../src/js/processors/legacy/selectiveblur");g("../../../src/js/processors/tools/colorsplash");g("../../../src/js/processors/tools/brightness");g("../../../src/js/processors/tools/contrast");g("../../../src/js/processors/tools/colortemp");g("../../../src/js/processors/tools/drawtool");g("../../../src/js/processors/tools/tiltshift");
g("../../../src/js/processors/tools/blemish");g("../../../src/js/processors/tools/redeye");g("../../../src/js/processors/tools/whiten");g("../../../src/js/processors/tools/spraytan");g("../../../src/js/processors/tools/shinereduce");g("../../../src/js/processors/tools/blush");g("../../../src/js/processors/tools/lipstick");g("../../../src/js/processors/tools/mascara");g("./MoaLiteProclistManager");typeof Aviary!==I&&(Aviary.require=g)});Z("/proclist/src/js/FeatherEntry.coffee");})();
if(typeof AV=="undefined"){AV={}}AV.Actions=function(){this.actionList=[];this.index=-1;return this};AV.Actions.prototype.undoImplicitActions=function(){while(this.index>=0&&this.actionList[this.index][2].implicit===true&&!this.isACheckpoint()){var undoAction=this.actionList[this.index][0];var undoFunc=undoAction[0];var undoObj=undoAction[1];var undoArgs=undoAction[2];undoFunc.apply(undoObj,undoArgs);this.index--}};AV.Actions.prototype.canUndo=function(){if(AV.launchData.forceCropPreset&&this.index<=1){return false}var canUndo=this.index>=0;if(this.index===0&&this.actionList[0][2].implicit===true){canUndo=false}return canUndo};AV.Actions.prototype.undo=function(){var undoAction,undoFunc,undoObj,undoArgs,dims;if(this.index<0||this.isACheckpoint()){return}do{if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}undoAction=this.actionList[this.index][0];if(undoAction){undoFunc=undoAction[0];undoObj=undoAction[1];undoArgs=undoAction[2];undoFunc.apply(undoObj,undoArgs)}if(this.index>0){dims=this.actionList[this.index-1][3];if(dims){this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}else{this.setDims(this._origHiresWidth,this._origHiresHeight)}this.index--}while(this.index>=0&&!this.isACheckpoint()&&this.actionList[this.index][2].implicit===true);if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.undoFake=function(){var dims;if(this.index<0||this.isACheckpoint()){return}if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}if(this.index>0){dims=this.actionList[this.index-1][3];if(dims){this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}else{this.setDims(this._origHiresWidth,this._origHiresHeight)}this.index--;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.undoToCheckpoint=function(){var undoAction,undoFunc,undoObj,undoArgs,dims;if(this.index<0){return}if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}do{undoAction=this.actionList[this.index][0];undoFunc=undoAction[0];undoObj=undoAction[1];undoArgs=undoAction[2];undoFunc.apply(undoObj,undoArgs);if(this.index>0){dims=this.actionList[this.index-1][3];if(dims){this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}else{this.setDims(this._origHiresWidth,this._origHiresHeight)}this.index--}while(this.index>=0&&!this.isACheckpoint());if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.canRedo=function(){return this.index<this.actionList.length-1};AV.Actions.prototype.redo=function(){var redoAction,redoFunc,redoObj,redoArgs,dims;if(this.index>=this.actionList.length-1){return}do{if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}this.index++;redoAction=this.actionList[this.index][1];if(redoAction){redoFunc=redoAction[0];redoObj=redoAction[1];redoArgs=redoAction[2];redoFunc.apply(redoObj,redoArgs);dims=this.actionList[this.index][3];if(dims){this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}}while(this.index<this.actionList.length-1&&this.actionList[this.index][2].implicit===true);if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.redoFake=function(){var nextItem,dims;if(this.index>=this.actionList.length-1){return}if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}nextItem=this.actionList[this.index+1];if(nextItem){dims=nextItem[3];if(dims){this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}this.index++;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.redoToCheckpoint=function(){var redoAction,redoFunc,redoObj,redoArgs,dims,futureIndex,hasFutureCheckpoint=false;if(this.index>=this.actionList.length-1){return true}futureIndex=this.index;do{futureIndex++;hasFutureCheckpoint=this.isACheckpoint(futureIndex)}while(!hasFutureCheckpoint&&futureIndex<this.actionList.length-1);if(!hasFutureCheckpoint){return false}if(AV.paintWidgetInstance){AV.paintWidgetInstance.dirty=true}do{this.index++;redoAction=this.actionList[this.index][1];if(redoAction){redoFunc=redoAction[0];redoObj=redoAction[1];redoArgs=redoAction[2];redoFunc.apply(redoObj,redoArgs);dims=this.actionList[this.index][3];this.setDims(dims.hiresWidth||dims.width,dims.hiresHeight||dims.height)}}while(this.index<this.actionList.length-1&&!this.isACheckpoint());if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}return true};AV.Actions.prototype.push=function(undo,redo,redoSerializable,hiresDimsOverride,flags){flags=flags||{};var hiresDims;this.truncate(true);hiresDims=hiresDimsOverride||this.getDims();this.actionList.push([undo,redo,flags,hiresDims,redoSerializable])};AV.Actions.prototype.setCheckpoint=function(checkpoint){if(this.index<0){return}this.actionList[this.index][2].checkpoint=checkpoint};AV.Actions.prototype.isACheckpoint=function(index){index=index!==undefined?index:this.index;if(this.actionList[index]){return!!this.actionList[index][2].checkpoint}else{return false}};AV.Actions.prototype.isImplicit=function(implicit){if(this.index<0){return}this.actionList[this.index][2].implicit=implicit};AV.Actions.prototype.truncate=function(suppressNotification){this.actionList.length=this.index+1;if(!suppressNotification&&AV.controlsWidgetInstance){AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[this.canUndo(),this.canRedo()])}};AV.Actions.prototype.getDims=function(){var wh=null;if(AV.paintWidgetInstance){wh=wh||{};wh.width=AV.paintWidgetInstance.width;wh.height=AV.paintWidgetInstance.height}if(this.hiresWidth&&this.hiresHeight){wh=wh||{};wh.hiresWidth=this.hiresWidth;wh.hiresHeight=this.hiresHeight}return wh};AV.Actions.prototype.setDims=function(w,h){if(this.hiresWidth!=w||this.hiresHeight!=h){this.hiresWidth=w;this.hiresHeight=h;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.imageSizeTracker.setImageScaledIndicator()}}};AV.Actions.prototype.setOrigSize=function(w,h){this._origHiresWidth=w;this._origHiresHeight=h;this.setDims(w,h)};AV.Actions.prototype.exportJSON=function(simplify){var origWidth,origHeight;if(AV.paintWidgetInstance){var owh=AV.paintWidgetInstance.getOrigSize();origWidth=owh.width;origHeight=owh.height}var jsonObj={metadata:{imageorigsize:[origWidth,origHeight]}};var action;var redoJSONObj;var i,j;var actionlistSimp;var addIndex;var actionName;var actionLayerId;var addAction;var newAction;var deleteList;var layerTracker;var actionlist=[];if(AV.isRelaunched&&AV.prevActionList){var previous=JSON.parse(AV.prevActionList);if(previous){actionlist=previous.actionlist.slice()}}actionlist.push({action:"setfeathereditsize",width:origWidth,height:origHeight});for(i=0;i<this.index+1;i++){action=this.actionList[i];redoJSONObj=action[4];if(!redoJSONObj){continue}if(redoJSONObj.length==undefined){actionlist.push(redoJSONObj)}else{for(j=0;j<redoJSONObj.length;j++){actionlist.push(redoJSONObj[j])}}}if(simplify){addIndex={};actionlistSimp=[];actionlistSimp.length=actionlist.length;for(i=0;i<actionlist.length;i++){action=AV.util.extend({},actionlist[i]);actionName=action.action;switch(actionName){case"addsticker":case"addtext":actionLayerId=action.id;addIndex[actionLayerId]=i;actionlistSimp[i]=action;break;case"setsticker":actionLayerId=action.id;addAction=actionlist[addIndex[actionLayerId]];newAction={};newAction.action=addAction.action;newAction.url=addAction.url;newAction.urls=addAction.urls;newAction.size=addAction.size;newAction.external=addAction.external;newAction.id=addAction.id;newAction.center=action.center;newAction.scale=action.scale;newAction.rotation=action.rotation;actionlistSimp[i]=newAction;break;case"settext":actionLayerId=action.id;addAction=actionlist[addIndex[actionLayerId]];newAction={};newAction.action=addAction.action;newAction.id=addAction.id;newAction.text=addAction.text;newAction.font=addAction.font;newAction.size=addAction.size;newAction.color=addAction.color;newAction.shadowcolor=addAction.shadowcolor;newAction.center=action.center;newAction.scale=action.scale;newAction.rotation=action.rotation;actionlistSimp[i]=newAction;break;default:actionlistSimp[i]=action;break}}deleteList={};for(i=actionlistSimp.length-1;i>=0;i--){action=actionlistSimp[i];actionName=action.action;switch(actionName){case"deletetext":case"deletesticker":actionLayerId=action.id;deleteList[actionLayerId]=true;actionlistSimp.splice(i,1);break;case"addtext":case"addsticker":actionLayerId=action.id;if(deleteList[actionLayerId]){actionlistSimp.splice(i,1)}else{deleteList[actionLayerId]=true}delete action.id;break}}jsonObj["actionlist"]=actionlistSimp}else{jsonObj["actionlist"]=actionlist}if(jsonObj&&jsonObj.actionlist&&jsonObj.actionlist.length){var list=jsonObj.actionlist;for(var i=0;i<list.length;i++){if(list[i].action=="addsticker"){if(list[i].url&&list[i].url.indexOf("https://")==0){list[i].url=list[i].url.replace("https://","http://");for(var ii=0;ii<list[i].urls.length;ii++){list[i].urls[ii]=list[i].urls[ii].replace("https://","http://")}}}}}return AV.JSON.stringify(jsonObj)};AV.Actions.prototype.importJSON=function(jsonString,callback){if(!jsonString){if(callback){callback()}return false}if(!AV.paintWidgetInstance){if(callback){callback()}return false}var origWidth,origHeight;var jsonObj,actionlist=[];var _actions=this;var i,j,actionlistLength;try{jsonObj=AV.JSON.parse(jsonString);if(jsonObj){actionlist=jsonObj.actionlist}}catch(probablyAParseError){if(callback){callback()}return false}actionlistLength=actionlist.length;var enhanceNames={labcorrect:true,backlightenhance:true,nightenhance:true,autoenhance:true};var convertEnhanceAction=function(actionObject){var actionName=actionObject.action;for(var effectName in enhanceNames){if(effectName===actionName){actionObject.id=actionName;actionObject.action="enhance";return true}}return false};var processItem=function(actionObject){convertEnhanceAction(actionObject);var actionName=actionObject.action;switch(actionName){case"addsticker":actionName="overlay";break;case"addtext":if(actionObject.align){actionName="textwithfont"}else{actionName="text"}break;case"tools":actionName=actionObject.toolname;if(actionName=="tiltshift"){actionName="focus"}break;case"rotate":actionName="straighten";break;case"colortemp":actionName="warmth";break;case"sharpness":actionName="sharpen";break;case"redeye2":actionName="redeye";break;case"whiten2":actionName="whiten";break;case"selectiveblur":actionName="blemish";break;case"imageborders":actionName="frames";break;default:break}if(AV.paintWidgetInstance.module[actionName]&&AV.paintWidgetInstance.module[actionName]["readAction"]){AV.paintWidgetInstance.moduleLoaded(actionName,function(toolName){AV.paintWidgetInstance.setMode(actionName);AV.paintWidgetInstance.module[actionName]["readAction"].apply(this,[actionObject,nextItem])})}else{nextItem()}};var nextItem=function(){_actions.setCheckpoint(true);i++;if(i<actionlistLength){processItem(actionlist[i])}else{if(callback){callback()}AV.paintWidgetInstance.setMode(null)}};i=0;nextItem();return true};!function(AV,window,document){AV.FilterManager=function(){var urls=[];var utils={};var borders={};var flares={};var tools={};var effects={};var idToEffect={};var filterPacks={};var loadingUrls={};var api=this;var _haveNotSeenUrl=function(url){var i,len=urls.length;for(i=0;i<len;i++){if(urls[i]===url){return false}}urls.push(url);return true};var _haveNotLoadedUrl=function(url){return!!loadingUrls[url]};var _fireAllCallbacksForUrl=function(url){var i,len,callback;if(loadingUrls[url]&&loadingUrls[url].length){len=loadingUrls[url].length;for(i=0;i<len;i++){callback=loadingUrls[url][i];if(callback){callback.call()}}}delete loadingUrls[url]};var _addCallbackForUrl=function(url,callback){loadingUrls[url]=loadingUrls[url]||[];loadingUrls[url].push(callback)};var _gatherProclistEffects=function(id,packs){var i,pack,effects,packLen;if(packs){for(i=0;i<packs.length;i++){pack=packs[i];if(pack&&pack["codename"]&&pack["codename"]+"_effects"===id){effects=pack.items;if(effects){filterPacks[id]=effects;packLen=effects.length;for(var j=0;j<packLen;j++){idToEffect[effects[j]["identifier"]]=effects[j]}}packs.splice(i,1);break}}}};api.getEffectById=function(id){return idToEffect[id]};api.getClickableFiltersForPack=function(id){return filterPacks[id]};api.loadPack=function(packId,url,callback){var onComplete=function(){_gatherProclistEffects(packId,AV.proclistPacks);if(callback)callback.call(this)};if(url&&_haveNotSeenUrl(url)){_addCallbackForUrl(url,onComplete);AV.util.loadFile(url,"js",function(ev){_fireAllCallbacksForUrl(url)})}else{if(_haveNotLoadedUrl(url)){_addCallbackForUrl(url,onComplete)}else{onComplete()}}};return api}}(window["AV"]||(window["AV"]={}),window,document);!function(exports){exports["AV"]=exports["AV"]||{};var AV=exports["AV"];AV.ImageBorderManager=function(){var urls=[];var idToEffect={};var filterPacks={};var api=this;var _haveNotSeenUrl=function(url){var i,len=urls.length;for(i=0;i<len;i++){if(urls[i]===url){return false}}urls.push(url);return true};var _gatherFilters=function(id,packs){var i,j,clickable,packlen,borderObj;if(packs){for(i=0;i<packs.length;i++){filterPacks[id]=packs[i];packlen=packs[i].length;for(j=0;j<packlen;j++){borderObj=packs[i][j];idToEffect[borderObj.border_name]=borderObj}}packs.splice(0,i+1)}};api.getEffectById=function(id){return idToEffect[id]};api.getClickableFiltersForPack=function(id){return filterPacks[id]};api.tileBorder=function(frameName,callback){var item=api.getEffectById(frameName);var itemImages=item.images;var imageObj0=new Image;var imageObj1=new Image;var imageObj2=new Image;var imageObj3=new Image;var imageObj4=new Image;var imageObj5=new Image;var imageObj6=new Image;var imageObj7=new Image;var tileNames=["tl","tr","br","bl","l","t","r","b"];var tileImgs=[imageObj0,imageObj1,imageObj2,imageObj3,imageObj4,imageObj5,imageObj6,imageObj7];var imagesToLoad=[];var tilesObj={};for(var i=0;i<tileNames.length;i++){var prop=tileNames[i];tilesObj[prop]={w:itemImages[prop].width,h:itemImages[prop].height,img:tileImgs[i]};imagesToLoad.push({img:tileImgs[i],src:itemImages[prop].src})}AV.util.loadImagesSync(imagesToLoad,function(){if(callback){callback.apply(this,[tilesObj])}})};api.loadPack=function(packId,url,callback){if(url&&_haveNotSeenUrl(url)){AV.util.loadFile(url,"js",function(ev){_gatherFilters(packId,AV["borderPacks"]);if(callback)callback.call(this)})}else{_gatherFilters(packId,AV["borderPacks"]);if(callback)callback.call(this)}};return api};return exports}(this);!function(AV,window,document){AV.OverlayRegistry=function(){var _registry={};var _loadSticker=function(url,callback){var hiResURL=url;var imgElementClean=document.createElement("img");imgElementClean.fullimageurl=hiResURL;var onload_handler=function(e){avpw$(imgElementClean).unbind("load",onload_handler);api.addElement(url,imgElementClean);if(callback){callback.apply(this,[e])}};avpw$(imgElementClean).load(onload_handler);avpw$(imgElementClean).attr("src",url)};var api=this;api.add=function(id,hiresurl){if(!_registry[id]){_registry[id]={}}if(hiresurl){_registry[id].hiresurl=hiresurl}};api.addElement=function(id,cleanImage){if(!_registry[id]){api.add(id)}_registry[id].element=cleanImage};api.getElement=function(id,callback){var el=null;if(!_registry[id]||!_registry[id].element){if(callback){_loadSticker(id,callback)}}else{el=_registry[id].element;if(callback){callback.apply(this,[el])}}return el};api.getHiRes=function(id){return _registry[id].hiresurl};return api}}(window["AV"]||(window["AV"]={}),window,document);!function(AV,window,document){var mediator=AV.Events;AV.ModeManager=function(){var _this=this;var activateCanvasForMode=function(mode){_this.setCurrentLayerByName("background");_this.uiLayerShow(false);if(_this.active!==null){if(_this.active.deactivate!==undefined){_this.active.deactivate()}}if(mode!==null&&mode!==undefined&&mode!==""){var newactive=_this.module[mode];if(newactive!==undefined){_this.active=newactive;if(_this.active.activate!==undefined){_this.active.activate(_this)}}}else{_this.active=null}};var init=function(context){if(context){_this=context}mediator.on("canvas:activate",activateCanvasForMode)};var shutdown=function(){mediator.off("canvas:activate",activateCanvasForMode)};var api={};api.init=init;api.shutdown=shutdown;return api}}(window["AV"]||(window["AV"]={}),window,document);!function(exports,window,document){exports["AV"]=exports["AV"]||{};var AV=exports["AV"];var mediator=AV.Events;!function($){$.support.touch=$.support.touch||"ontouchend"in document}(avpw_jQuery);AV.PaintUI=function(canvas,eventsCanvas){var $canvas=avpw$(canvas);var $eventsCanvas=avpw$(eventsCanvas);var _registry={};var _events=["mouseOutEvent","mouseMoveEvent","mouseDownEvent","mouseUpEvent"];var _canvasOffset;var _moveReady=true;var _MOVE_DELAY=30;var _panEnabled=true;var _canvasMouseIsDown=false;var api=this;var _noOp=function(){};var _getCoords=function(ev){_canvasOffset=_canvasOffset||$canvas.offset();var x,y,canvasX,canvasY,touch,frac;if(ev.type=="internal"){x=ev.x;y=ev.y}else{touch=AV.util.getTouch(ev);if(touch){x=touch.pageX;y=touch.pageY}else{x=ev.pageX;y=ev.pageY}}canvasX=x-_canvasOffset.left;canvasY=y-_canvasOffset.top;canvasControlsX=canvasX;canvasControlsY=canvasY;frac=api.viewport.getRatio();canvasX=canvasX*frac;canvasY=canvasY*frac;return{x:x|0,y:y|0,canvasX:canvasX|0,canvasY:canvasY|0,canvasControlsX:canvasControlsX,canvasControlsY:canvasControlsY}};var _isWithinCanvasByBounds=function(x,y){var frac=api.viewport.getRatio();var cpos=$canvas.offset();var x0=cpos.left;var x1=x0+$canvas.width()/frac;var y0=cpos.top;var y1=y0+$canvas.height()/frac;return x>x0&&x<x1&&y>y0&&y<y1};api.enablePan=function(){_panEnabled=true;api.viewport.clearAvailablePanDirections();api.viewport.pan()};api.disablePan=function(){_panEnabled=false;api.hidePan()};api.showPan=function(){if(_panEnabled){api.addCanvasClass("avpw_can_pan")}};api.hidePan=function(){api.removeCanvasClass("avpw_can_pan")};var PAN_RATE=20;var _panTimer=null;var _panBusy=false;var _startCoords;var _canvasPanned=function(x,y){_panBusy=true;var dx=x-_startCoords.x;var dy=y-_startCoords.y;api.viewport.pan(dx,dy);var lastCoords={x:x,y:y};window.clearTimeout(_panTimer);_panTimer=window.setTimeout(function(){_panBusy=false;_startCoords=lastCoords},PAN_RATE)};var ZOOM_RATE=20;var _zoomTimer=null;var _zoomBusy=false;var _canvasZoomed=function(scale){_zoomBusy=true;api.viewport.gestureZoomUpdate(scale);window.clearTimeout(_zoomTimer);_zoomTimer=window.setTimeout(function(){_zoomBusy=false},ZOOM_RATE)};var _canvasGestureChanged=function(ev){if(ev.scale&&!_zoomBusy){_canvasZoomed(ev.scale)}return false};var _onModeChange=function(mode){api.setMouseCursor();if(avpw$.support.touch){if(mode==null){$eventsCanvas.bind("gesturechange",_canvasGestureChanged).bind("gestureend",api.viewport.gestureZoomFinish)}else{$eventsCanvas.unbind("gesturechange").unbind("gestureend")}}};var _canvasMouseOut=function(ev){if(_registry["mouseOutEvent"]){_registry["mouseOutEvent"].apply(api,[{},ev])}};var _canvasMouseMove=function(ev){var coords;if(_moveReady){_moveReady=false;window.setTimeout(function(){_moveReady=true},_MOVE_DELAY);if(_registry["mouseMoveEvent"]){coords=_getCoords(ev);return _registry["mouseMoveEvent"].apply(api,[coords,ev])}else{if(_panEnabled&&_canvasMouseIsDown){coords=_getCoords(ev);ev.preventDefault();_startCoords=_startCoords||coords;if(!_panBusy){_canvasPanned(coords.x,coords.y)}}}}};var _canvasMouseDown=function(ev){if(_registry["mouseDownEvent"]){var coords=_getCoords(ev);return _registry["mouseDownEvent"].apply(api,[coords,ev,_isWithinCanvasByBounds(coords.x,coords.y)])}else{if(_panEnabled){_startCoords=undefined;_canvasMouseIsDown=true;if(api.canvasHasClass("avpw_can_pan")){api.addCanvasClass("avpw_is_panning")}}}};var _canvasMouseUp=function(ev){if(_registry["mouseUpEvent"]){var coords=_getCoords(ev);_registry["mouseUpEvent"].apply(api,[coords,ev])}else{if(_panEnabled){_canvasMouseIsDown=false;if(api.viewport.isZoomed()){api.viewport.bounceBack()}api.removeCanvasClass("avpw_is_panning")}}};api.resetOffset=function(){_canvasOffset=undefined};api.getCoordinatesFromEventWithinCanvasBounds=function(ev){var coords=_getCoords(ev);return _isWithinCanvasByBounds(coords.x,coords.y)?coords:null};api.getCoordinatesFromEvent=function(ev){return _getCoords(ev)};api.getViewportCenter=function(){var viewportOffset,viewportEl,w,h;viewportEl=AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"getEmbedElement");if(viewportEl){viewportEl=avpw$(viewportEl);w=viewportEl.width();h=viewportEl.height();viewportOffset=viewportEl.offset();return _getCoords({type:"internal",x:w/2+viewportOffset.left,y:h/2+viewportOffset.top})}else{return null}};api.subscribe=function(module){for(var i=0;i<_events.length;i++){if(module[_events[i]]){_registry[_events[i]]=module[_events[i]].AV_bindInst(module)}}api.disablePan()};api.unsubscribe=function(module){_registry={};api.enablePan()};api.shutdown=function(){mediator.off("layout:resize",api.resetOffset);$eventsCanvas.unbind("mouseleave").unbind("mousedown");avpw$(window).unbind("mousemove",_canvasMouseMove).unbind("mouseup",_canvasMouseUp).unbind("scroll",api.resetOffset);if(avpw$.support.touch){$eventsCanvas.unbind("touchmove").unbind("touchstart").unbind("touchend").unbind("gesturechange").unbind("gestureend");avpw$(window).unbind("touchmove",_noOp)}api.resetOffset();api.viewport.shutdown();_registry={};_canvasMouseIsDown=false};api.setMouseCursor=function(cur){if(cur===undefined){cur=""}canvas.style.cursor=cur};api.addCanvasClass=function(className){$canvas.addClass(className)};api.removeCanvasClass=function(className){$canvas.removeClass(className)};api.canvasHasClass=function(className){return $canvas.hasClass(className)};mediator.on("tool:open",_onModeChange);mediator.on("layout:resize",api.resetOffset);$eventsCanvas.bind("mouseleave",_canvasMouseOut).bind("mousedown",_canvasMouseDown);avpw$(window).bind("mouseup",_canvasMouseUp).bind("mousemove",_canvasMouseMove).bind("scroll",api.resetOffset);if(avpw$.support.touch){avpw$(window).bind("touchmove",_noOp);$eventsCanvas.bind("touchstart",function(ev){avpw$(window).unbind("mousemove",_canvasMouseMove);$eventsCanvas.bind("touchmove",_canvasMouseMove);return _canvasMouseDown(ev)}).bind("touchend",function(ev){$eventsCanvas.unbind("touchmove",_canvasMouseMove);avpw$(window).bind("mousemove",_canvasMouseMove);_canvasMouseUp(ev);return false});$eventsCanvas.bind("gesturechange",_canvasGestureChanged).bind("gestureend",api.viewport.gestureZoomFinish)}api.viewport.setCanvas.apply(api,[canvas]);return api};AV.PaintUI.prototype.viewport=function(){var _paintUI,_canvas,api={};var _realDOMWidth,_zoomDelta;var viewportBbox=null,zoomedCanvasBbox=null;var _innerPadding=0;var _lastCanvasRatio=1;var _possiblePanDirections;var _getPanDirections=function(){var zoomedCanvasX1=zoomedCanvasBbox.x0+zoomedCanvasBbox.w,zoomedCanvasY1=zoomedCanvasBbox.y0+zoomedCanvasBbox.h,x=false,y=false;if(zoomedCanvasX1>viewportBbox.w||zoomedCanvasBbox.x0<viewportBbox.x0){x=true}if(zoomedCanvasBbox.y0<viewportBbox.y0||zoomedCanvasY1>viewportBbox.h){y=true}if(x||y){_paintUI.showPan()}else{_paintUI.hidePan()}return{x:x,y:y}};var TRANSFORM_PROPERTY=AV.support.getVendorProperty("transform");var _transform=function(args){if(TRANSFORM_PROPERTY&&(AV.launchData["openType"]=="mobile"||AV.launchData["openType"]=="aviary")){var scale=args&&args.scale?args.scale:1/api.getRatio();var centerOffsetX=.5*(zoomedCanvasBbox.w*1/scale-zoomedCanvasBbox.w)+.5|0;var centerOffsetY=.5*(zoomedCanvasBbox.h*1/scale-zoomedCanvasBbox.h)+.5|0;var x=zoomedCanvasBbox.x0-centerOffsetX;var y=zoomedCanvasBbox.y0-centerOffsetY;var style=new AV.TransformStyle(_canvas.style[TRANSFORM_PROPERTY]);style.set({translate:x+"px, "+y+"px",scale:scale});_canvas.style[TRANSFORM_PROPERTY]=style.serialize()}else{_canvas.style.width=zoomedCanvasBbox.w+"px";_canvas.style.height=zoomedCanvasBbox.h+"px";_canvas.style.marginLeft="-"+(zoomedCanvasBbox.w/2+.5|0)+"px";_canvas.style.marginTop="-"+(zoomedCanvasBbox.h/2+.5|0)+"px"}};api.setCanvas=function(canvas){_canvas=canvas;_paintUI=this;if(TRANSFORM_PROPERTY){_paintUI.addCanvasClass("avpw_position_by_transform")}};api.shutdown=function(){_realDOMWidth=_zoomDelta=undefined;viewportBbox=zoomedCanvasBbox=null};var _setZoomDelta=function(){_zoomDelta=Math.abs((_realDOMWidth-zoomedCanvasBbox.w)/2)+.5|0};var _zoomByIncrement=function(inc){if(inc){var w=zoomedCanvasBbox.w+_zoomDelta*inc,h=w*_canvas.height/_canvas.width+.5|0;if(h<0||w<0){return false}zoomedCanvasBbox.w=w;zoomedCanvasBbox.h=h;_centerCanvas();_clearAvailablePanDirections()}};var _lastScale=1;var _supportsAnimation=!!AV.support.getVendorProperty("transformStyle");api.gestureZoomUpdate=function(scale){_lastScale=scale;scale=scale*1/api.getRatio();_transform({scale:scale})};api.gestureZoomFinish=function(){if(_lastScale){var w=zoomedCanvasBbox.w*_lastScale+.5|0,h=zoomedCanvasBbox.h*_lastScale+.5|0,wOverH=w/h;if(w<viewportBbox.w&&h<viewportBbox.h){if(w>wOverH*h){zoomedCanvasBbox.w=viewportBbox.w;zoomedCanvasBbox.h=viewportBbox.w*h/w+.5|0}else{zoomedCanvasBbox.h=viewportBbox.h;zoomedCanvasBbox.w=viewportBbox.h*wOverH+.5|0}}else{zoomedCanvasBbox.w=w;zoomedCanvasBbox.h=h}_transform()}};api.setPadding=function(val){_innerPadding=val};var _setScale=function(maxWidth,maxHeight,clamp){var canvasWidth=_canvas.width;var canvasHeight=_canvas.height;var canvasWidthOverHeight=canvasWidth/canvasHeight;var zoomedDims;maxWidth=maxWidth||canvasWidth;maxHeight=maxHeight||canvasHeight;maxWidth-=_innerPadding;maxHeight-=_innerPadding;_realDOMWidth=canvasWidth;if(clamp){zoomedDims=AV.util.getScaledDims(canvasWidth,canvasHeight,maxWidth,maxHeight);maxWidth=zoomedDims.width;maxHeight=zoomedDims.height}zoomedCanvasBbox=new AV.Bbox(0,0,maxWidth,maxHeight);_setZoomDelta();_clearAvailablePanDirections()};var _pan=function(x,y,force){_possiblePanDirections=_possiblePanDirections||_getPanDirections();var doThePan=false;if(force||_possiblePanDirections.x){zoomedCanvasBbox.x0+=x;doThePan=true}if(force||_possiblePanDirections.y){zoomedCanvasBbox.y0+=y;doThePan=true}return doThePan};var _clearAvailablePanDirections=function(){_possiblePanDirections=undefined};var _bounceBack=function(){var zoomedCanvasX1=zoomedCanvasBbox.x0+zoomedCanvasBbox.w,zoomedCanvasY1=zoomedCanvasBbox.y0+zoomedCanvasBbox.h,overshot;if(zoomedCanvasX1>viewportBbox.w&&zoomedCanvasBbox.x0>viewportBbox.x0){overshot=viewportBbox.w-zoomedCanvasBbox.w;zoomedCanvasBbox.x0=overshot>0?overshot:0}else if(zoomedCanvasBbox.x0<viewportBbox.x0&&zoomedCanvasX1<viewportBbox.w){overshot=viewportBbox.w-zoomedCanvasBbox.w;zoomedCanvasBbox.x0=overshot<0?overshot:0}if(zoomedCanvasY1>viewportBbox.h&&zoomedCanvasBbox.y0>viewportBbox.y0){overshot=viewportBbox.h-zoomedCanvasBbox.h;zoomedCanvasBbox.y0=overshot>0?overshot:0}else if(zoomedCanvasBbox.y0<viewportBbox.x0&&zoomedCanvasY1<viewportBbox.h){overshot=viewportBbox.h-zoomedCanvasBbox.h;zoomedCanvasBbox.y0=overshot<0?overshot:0}return _pan(0,0)};var _centerCanvas=function(){if(!viewportBbox){return}var centerOffsetX=(viewportBbox.w-zoomedCanvasBbox.w)/2+.5|0;var centerOffsetY=(viewportBbox.h-zoomedCanvasBbox.h)/2+.5|0;zoomedCanvasBbox.x0=zoomedCanvasBbox.y0=0;_pan(centerOffsetX,centerOffsetY,true)};var _rotateBoundsBy90=function(angle){if(angle%180&&!(angle%90)){var w=zoomedCanvasBbox.w;zoomedCanvasBbox.w=zoomedCanvasBbox.h;zoomedCanvasBbox.h=w;_centerCanvas();return true}else{return false}};var _onCanvasResized=function(){var newCanvasRatio=api.getRatio();mediator.trigger("canvas:resize",zoomedCanvasBbox,newCanvasRatio,_lastCanvasRatio);_lastCanvasRatio=newCanvasRatio};api.isZoomed=function(){return api.getRatio()!==1};api.getRatio=function(){return zoomedCanvasBbox?_realDOMWidth/zoomedCanvasBbox.w:1};api.zoomIn=function(){if(!zoomedCanvasBbox){_setScale()}_zoomByIncrement(1);_transform();_paintUI.resetOffset();_onCanvasResized();return false};api.zoomOut=function(){if(!zoomedCanvasBbox){_setScale()}_zoomByIncrement(-1);_transform();_paintUI.resetOffset();_onCanvasResized();return false};api.zoomByRatio=function(ratio){var newW=_canvas.width*ratio;var newH=_canvas.height*ratio;var oldW=zoomedCanvasBbox.w;var oldH=zoomedCanvasBbox.h;var panX=0;var panY=0;zoomedCanvasBbox.w=newW+.5|0;zoomedCanvasBbox.h=newH+.5|0;_possiblePanDirections=_getPanDirections();if(_possiblePanDirections.x){panX=-((newW-oldW)/2+.5|0)}else{panX=(viewportBbox.w-zoomedCanvasBbox.w)/2+.5|0;zoomedCanvasBbox.x0=0}if(_possiblePanDirections.y){panY=-((newH-oldH)/2+.5|0)}else{panY=(viewportBbox.h-zoomedCanvasBbox.h)/2+.5|0;zoomedCanvasBbox.y0=0}_pan(panX,panY,true);_bounceBack();_transform();_paintUI.resetOffset();_clearAvailablePanDirections();_onCanvasResized();return false};api.fitLayout=function(w,h){viewportBbox=new AV.Bbox(0,0,w,h);_setScale(w,h,true);_centerCanvas();_transform();_paintUI.resetOffset();_onCanvasResized()};api.resize=function(w,h){_setScale(w,h,true);_centerCanvas();_transform();_paintUI.resetOffset();_onCanvasResized();return false};api.resizeFake=function(w,h){_setScale(w,h);_centerCanvas();_transform();_paintUI.resetOffset();return false};api.pan=function(x,y,force){if(_pan(x,y,force)){_transform();_paintUI.resetOffset()}};api.clearAvailablePanDirections=function(){_clearAvailablePanDirections()};api.bounceBack=function(){if(_bounceBack()){_transform();_paintUI.resetOffset()}_onCanvasResized()};api.rotate=function(x,y,z){x=x?x+"deg":"0";y=y?y+"deg":"0";z=z?z+"deg":"0";var style=new AV.TransformStyle(_canvas.style[TRANSFORM_PROPERTY]);if(_supportsAnimation){style.set({rotateX:x,rotateY:y,rotateZ:z})}else{style.set({rotate:x})}_canvas.style[TRANSFORM_PROPERTY]=style.serialize()};api.rotateBoundsBy90=function(angle){if(_rotateBoundsBy90(angle)){_onCanvasResized();return true}else{return false}};return api}();return exports}(this,typeof window!=="undefined"?window:{},typeof document!=="undefined"?document:{});!function(AV,window,document){avpw$=typeof avpw$!=="undefined"?avpw$:{};AV.CropController=function(controls,paintWidget){var api=this;var _dragStart=null;var _dragCornerOffset={};var _forceAspect=false;var _wtoh=1;var _corner=-1;var _bbox;var _canvasBbox;var _cropUIElement;var _overlayModule;var lastW,lastH;var _setCanvasBounds=function(){_canvasBbox=new AV.Bbox(0,0,paintWidget.width,paintWidget.height)};var _unsetCanvasBounds=function(){_canvasBbox=null};var _storeRatio=function(){_wtoh=_bbox?Math.abs((_bbox.x1-_bbox.x0)/(_bbox.y1-_bbox.y0)):0};var _constrainBoundingBoxByPoint=function(xCoord,yCoord){var factor,constraint;if(_wtoh==0){return}var htow=1/_wtoh;if(_forceAspect){if(Math.abs((_bbox.x1-_bbox.x0)/(_bbox.y1-_bbox.y0))>_wtoh){factor=AV.math.sign(_bbox.y1-_bbox.y0)*Math.abs(_bbox.x1-_bbox.x0)*htow+.5|0;if(yCoord==="y1"){_bbox[yCoord]=_bbox.y0+factor}else{_bbox[yCoord]=_bbox.y1-factor}}else{factor=AV.math.sign(_bbox.x1-_bbox.x0)*Math.abs(_bbox.y1-_bbox.y0)*_wtoh+.5|0;if(xCoord==="x1"){_bbox[xCoord]=_bbox.x0+factor}else{_bbox[xCoord]=_bbox.x1-factor}}}constraint=_canvasBbox.constrain(_bbox[xCoord],_bbox[yCoord]);_bbox[xCoord]=constraint.x;_bbox[yCoord]=constraint.y;if(_forceAspect&&constraint.dirty){if(Math.abs((_bbox.x1-_bbox.x0)/(_bbox.y1-_bbox.y0))>_wtoh){factor=AV.math.sign(_bbox.x1-_bbox.x0)*Math.abs(_bbox.y1-_bbox.y0)*_wtoh+.5|0;if(xCoord==="x1"){_bbox[xCoord]=_bbox.x0+factor}else{_bbox[xCoord]=_bbox.x1-factor}}else{factor=AV.math.sign(_bbox.y1-_bbox.y0)*Math.abs(_bbox.x1-_bbox.x0)*htow+.5|0;if(yCoord==="y1"){_bbox[yCoord]=_bbox.y0+factor}else{_bbox[yCoord]=_bbox.y1-factor}}}};var _set_bboxByCorner=function(x,y){switch(_corner){case 1:_bbox.x1=x+_dragCornerOffset.x;
_bbox.y0=y-_dragCornerOffset.y;_constrainBoundingBoxByPoint("x1","y0");break;case 2:_bbox.x0=x-_dragCornerOffset.x;_bbox.y1=y+_dragCornerOffset.y;_constrainBoundingBoxByPoint("x0","y1");break;case 3:_bbox.x1=x+_dragCornerOffset.x;_bbox.y1=y+_dragCornerOffset.y;_constrainBoundingBoxByPoint("x1","y1");break;case 0:default:_bbox.x0=x-_dragCornerOffset.x;_bbox.y0=y-_dragCornerOffset.y;_constrainBoundingBoxByPoint("x0","y0");break}};var _move_bbox=function(dx,dy){var w,h;_bbox.x0+=dx;_bbox.x1+=dx;_bbox.y0+=dy;_bbox.y1+=dy;w=_bbox.x1-_bbox.x0;h=_bbox.y1-_bbox.y0;var topLeft=_canvasBbox.constrain(_bbox.x0,_bbox.y0);if(topLeft.dirty){_bbox.x0=topLeft.x;_bbox.y0=topLeft.y;_bbox.x1=_bbox.x0+w;_bbox.y1=_bbox.y0+h}var bottomRight=_canvasBbox.constrain(_bbox.x1,_bbox.y1);if(bottomRight.dirty){_bbox.x1=bottomRight.x;_bbox.y1=bottomRight.y;_bbox.x0=_bbox.x1-w;_bbox.y0=_bbox.y1-h}};var _cropFlipButton;var _cropToolTip,_tooltipW,_tooltipH;var _addCropUI=function(){_cropFlipButton=avpw$('<div id="avpw_crop_flip_button"></div>');controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(_cropFlipButton);_cropUIElement=avpw$(AV.template[AV.launchData.layout].cropLayer());controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(_cropUIElement);_cropToolTip=_cropUIElement.find("#avpw_crop_tooltip");_tooltipW=_cropToolTip.find("#avpw_crop_tooltip_w");_tooltipH=_cropToolTip.find("#avpw_crop_tooltip_h")};api.setToolTipValues=function(w,h){if(!_tooltipW||!_tooltipH)return;_tooltipW.html(w);_tooltipH.html(h)};var _removeCropUI=function(){_cropUIElement.remove();_cropUIElement=null;_cropFlipButton.remove();_cropFlipButton=null;_cropToolTip=_tooltipW=_tooltipH=null};var _drawCropUI=function(_bbox,shouldAnimate){var zoomScale=controls.canvasUI.viewport.getRatio();var left,top,w,h;if(_bbox.x0<_bbox.x1){left=_bbox.x0;w=_bbox.x1-_bbox.x0}else{left=_bbox.x1;w=_bbox.x0-_bbox.x1}if(_bbox.y0<_bbox.y1){top=_bbox.y0;h=_bbox.y1-_bbox.y0}else{top=_bbox.y1;h=_bbox.y0-_bbox.y1}_mediator.trigger("tool:crop:change",w,h);left=left/zoomScale+.5|0;top=top/zoomScale+.5|0;w=w/zoomScale+.5|0;h=h/zoomScale+.5|0;var style={left:left+"px",top:top+"px",width:w+"px",height:h+"px"};_cropUIElement.css(style)};var _mediator;api.activate=function(mediator){_bbox=new AV.Bbox;_setCanvasBounds();_overlayModule=new AV.OverlaySelectionModule(paintWidget);_forceAspect=false;_addCropUI();_mediator=mediator;controls.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement")};api.deactivate=function(){_bbox=null;_unsetCanvasBounds();_overlayModule=null;controls.layoutNotify(AV.launchData["openType"],"hideCanvasControlsElement");_removeCropUI()};var toolTipPaddingH=60,toolTipPaddingV=60;api.updateUIDown=function(x,y){_cropToolTip.show();var bestDist=99999999,dist;var zoomScale=1;zoomScale=controls.canvasUI.viewport.getRatio();var hwidth=_overlayModule.getHandleImageWidth();var cutoff=zoomScale*(hwidth/2)*(hwidth/2)|0;_dragStart=null;paintWidget.uiLayerReset();paintWidget.uiLayerShow(true);_corner=-1;dist=AV.math.sqrDist(_bbox.x0,_bbox.y0,x,y);if(dist<bestDist&&dist<cutoff){_corner=0;bestDist=dist;_cropToolTip.css({top:-toolTipPaddingV,left:-toolTipPaddingH,right:"auto",bottom:"auto"})}dist=AV.math.sqrDist(_bbox.x1,_bbox.y0,x,y);if(dist<bestDist&&dist<cutoff){_corner=1;bestDist=dist;_cropToolTip.css({top:-toolTipPaddingV,left:"auto",right:-toolTipPaddingH,bottom:"auto"})}dist=AV.math.sqrDist(_bbox.x0,_bbox.y1,x,y);if(dist<bestDist&&dist<cutoff){_corner=2;bestDist=dist;_cropToolTip.css({top:"auto",left:-toolTipPaddingH,right:"auto",bottom:-toolTipPaddingV})}dist=AV.math.sqrDist(_bbox.x1,_bbox.y1,x,y);if(dist<bestDist&&dist<cutoff){_corner=3;bestDist=dist;_cropToolTip.css({top:"auto",left:"auto",right:-toolTipPaddingH,bottom:-toolTipPaddingV})}switch(_corner){case 0:_dragCornerOffset={x:x-_bbox.x0,y:y-_bbox.y0};break;case 3:_dragCornerOffset={x:_bbox.x1-x,y:_bbox.y1-y};break;case 1:_dragCornerOffset={x:_bbox.x1-x,y:y-_bbox.y0};break;case 2:_dragCornerOffset={x:x-_bbox.x0,y:_bbox.y1-y};break;default:_cropToolTip.hide();if(_bbox.contains(x,y)){_dragStart={x:x,y:y}}else{return false}break}return true};api.updateUIMove=function(x,y){var dx,dy;if(_dragStart!=null){dx=x-_dragStart.x;dy=y-_dragStart.y;_move_bbox(dx,dy);_dragStart.x=x;_dragStart.y=y}else{_set_bboxByCorner(x,y)}_overlayModule.drawCropSelectionBackground(_bbox);paintWidget.recomposite(0);_drawCropUI(_bbox)};api.apply=function(x,y){_cropToolTip.hide();var t;if(_bbox.x0>_bbox.x1){t=_bbox.x0;_bbox.x0=_bbox.x1;_bbox.x1=t}if(_bbox.y0>_bbox.y1){t=_bbox.y0;_bbox.y0=_bbox.y1;_bbox.y1=t}};api.flipIt=function(){api.setInitialSelectionByRatio(lastH/lastW)};api.setInitialSelectionTo=function(w,h){if(!_bbox)return;lastW=w;lastH=h;_bbox.x0=(paintWidget.canvas.width-w)/2+.5|0;_bbox.x1=_bbox.x0+w+.5|0;_bbox.y0=(paintWidget.canvas.height-h)/2+.5|0;_bbox.y1=_bbox.y0+h+.5|0;paintWidget.uiLayerReset();paintWidget.uiLayerShow(true);_overlayModule.drawCropSelectionBackground(_bbox);paintWidget.recomposite();_drawCropUI(_bbox,true)};api.setInitialSelectionByRatio=function(w2h){var margin=0;var w=paintWidget.canvas.width;var h=paintWidget.canvas.height;var borderTB=margin;var borderLR=margin;var normw=w-2*borderLR;var normh=h-2*borderTB;var neww;var newh;neww=normh*w2h;newh=normh;if(neww>normw){neww=normw;newh=normw/w2h}return api.setInitialSelectionTo(neww,newh)};api.setInitialSelection=function(){var l,r,t,b;if(_forceAspect){l=t=.12}else{l=.09;t=.18}r=1-l;b=1-t;_bbox.x0=paintWidget.canvas.width*l+.5|0;_bbox.x1=paintWidget.canvas.width*r+.5|0;_bbox.y0=paintWidget.canvas.height*t+.5|0;_bbox.y1=paintWidget.canvas.height*b+.5|0;paintWidget.uiLayerReset();paintWidget.uiLayerShow(true);_overlayModule.drawCropSelectionBackground(_bbox);paintWidget.recomposite();_drawCropUI(_bbox)};api.forceAspect=function(force){if(force){_storeRatio()}_forceAspect=force};api.isValidCrop=function(){if(Math.abs(_bbox.x0-_bbox.x1)===0||Math.abs(_bbox.y0-_bbox.y1)===0)return false;else return true};api.crop=function(){return _bbox};return api}}(window["AV"]||(window["AV"]={}),window,document);!function(AV,window,document){var mediator=AV.Events;avpw$=typeof avpw$!=="undefined"?avpw$:{};AV.OverlayController=function(controls,paintWidget,o){var modes=o.modes||{OFF_STATE:0};var _handlePosition=o.handlePosition||AV.OverlayController.HANDLE_POSITION.BOTTOM_LEFT;var _DRAG_THRESHOLD=5;var _MINIMUM_OVERLAY_WIDTH=o.minimumOverlaySize||20;var _MAXIMUM_OVERLAY_WIDTH=o.maximumOverlaySize||99999999;var _OVERLAY_BORDER_WIDTH=10;var _OVERLAY_EDITING_CLASS="avpw_selection_overlay_selected avpw_selection_overlay_editing";var _OVERLAY_DRAG_CLASS="avpw_selection_overlay_selected avpw_selection_overlay_dragonly";var TRANSFORM_PROPERTY=AV.support.getVendorProperty("transform");var _overlays;var _maxOverlayZIndex;var _currentOverlay;var _lastOverlayAddedID=null;var _clickButNotDragState=false;var _mouseDown=false;var _sizeMouseDown=false;var _initialRotation;var _forceDragMode=o.forceDragMode||false;var _resetAllOverlaysMode=function(exceptionOverlay){if(!exceptionOverlay||_currentOverlay!==exceptionOverlay){_currentOverlay=null}for(var overlay in _overlays){if(_overlays.hasOwnProperty(overlay)&&_overlays[overlay]!=exceptionOverlay){_setOverlayMode(_overlays[overlay],modes.OFF_STATE)}}};var _resizeAllOverlays=function(bbox,newRatio,oldRatio){var adjustedRatio;var overlay,overlayObject;if(newRatio!==oldRatio){newRatio=1/newRatio;oldRatio=1/oldRatio;adjustedRatio=newRatio/oldRatio;for(overlay in _overlays){overlayObject=_overlays[overlay];_moveOverlayToCoords(overlayObject,{x:overlayObject.topLeftX*adjustedRatio,y:overlayObject.topLeftY*adjustedRatio});_scaleOverlayByScale(overlayObject,adjustedRatio)}}};var _moveCurrentOverlayToTop=function(){_maxOverlayZIndex++;if(_currentOverlay&&_currentOverlay.element){_currentOverlay.zIndex=_maxOverlayZIndex;_currentOverlay.element.css("z-index",_maxOverlayZIndex)}};var _setCurrentOverlayById=function(id){_resetAllOverlaysMode(_overlays[id]);_currentOverlay=_overlays[id];_moveCurrentOverlayToTop()};var _saveDimensionsFromElement=function(element){var width,height,aspectRatio=o.aspectRatio,overlayObj=_overlays[element.id];width=element?parseInt(element.style.width,10):0;height=element?avpw$(element).height():0;var left=element?parseInt(element.style.left,10):0;var top=element?parseInt(element.style.top,10):0;var centerX=left+_OVERLAY_BORDER_WIDTH+width/2;var centerY=top+_OVERLAY_BORDER_WIDTH+height/2;if(!aspectRatio){if(width!==0&&height!==0){aspectRatio=height/width}else{aspectRatio=1}}if(overlayObj){AV.util.extend(overlayObj,{width:width,aspectRatio:aspectRatio,topLeftX:parseInt(element.style.left||0,10),topLeftY:parseInt(element.style.top||0,10),centerX:centerX,centerY:centerY})}};var _setOverlayMode=function(target,mode){target.mode=mode;target.element.removeClass(_OVERLAY_DRAG_CLASS);target.element.removeClass(_OVERLAY_EDITING_CLASS);if(mode===modes.DRAG_STATE){target.element.addClass(_OVERLAY_DRAG_CLASS)}else if(mode===modes.EDIT_STATE){target.element.addClass(_OVERLAY_EDITING_CLASS)}else{if(_currentOverlay&&_currentOverlay==target){_currentOverlay=null}}if(o.onModeChange){o.onModeChange.apply(controls,[target,mode])}};var _cycleOverlayMode=function(target,enable){if(target){if(!target.mode||target.mode===modes.OFF_STATE){if(enable&&modes.DRAG_STATE)_setOverlayMode(target,modes.DRAG_STATE)}else if(target.mode===modes.DRAG_STATE){if(enable){if(modes.EDIT_STATE){_setOverlayMode(target,modes.EDIT_STATE)}}else{_setOverlayMode(target,modes.OFF_STATE)}}else if(target.mode===modes.EDIT_STATE){if(!enable){if(modes.DRAG_STATE){_setOverlayMode(target,modes.DRAG_STATE)}else{_setOverlayMode(target,modes.OFF_STATE)}}}}};var _removeOverlay=function(overlay){if(overlay&&overlay.element){overlay.element.remove();delete _overlays[overlay.id]}};var _removeAllOverlays=function(){avpw$.each(_overlays,function(id){_removeOverlay(_overlays[id])})};var _moveOverlayToCoords=function(overlay,coords){overlay.element.css({left:coords.x+"px",top:coords.y+"px"});overlay.topLeftX=coords.x;overlay.topLeftY=coords.y};var _moveOverlay=function(overlay,coords){var initialCoordsX,initialCoordsY,dx,dy,overThreshold=false;initialCoordsX=overlay.initialCoordsX;initialCoordsY=overlay.initialCoordsY;dx=coords.x-initialCoordsX;dy=coords.y-initialCoordsY;if(Math.abs(dx)>_DRAG_THRESHOLD||Math.abs(dy)>_DRAG_THRESHOLD){overThreshold=true}if(overThreshold){overlay.element.css({left:overlay.topLeftX+dx+"px",top:overlay.topLeftY+dy+"px"})}return overThreshold};var _showCurrentOverlay=function(){if(_currentOverlay&&_currentOverlay.element){_currentOverlay.element.show()}};var _hideCurrentOverlay=function(){if(_currentOverlay&&_currentOverlay.element){_currentOverlay.element.hide()}};var _scaleOverlayByScale=function(overlay,scale){var width=overlay.width*scale;var height=width*overlay.aspectRatio;overlay.element.css({width:width+"px",height:height+"px"});overlay.width=width};var _scaleAndRotateOverlay=function(overlay,coords){var initialCoordsX,initialCoordsY,width,height,aspectRatio,topLeftX,topLeftY,centerX,centerY,handleX,handleY,handleNewX,handleNewY,canvasOffset,initialRotation,originalAngle,newAngle,scale,minScale,maxScale,rotation;topLeftX=overlay.topLeftX;topLeftY=overlay.topLeftY;initialCoordsX=overlay.initialCoordsX;initialCoordsY=overlay.initialCoordsY;canvasOffset=controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").offset();initialCoordsX-=canvasOffset.left;initialCoordsY-=canvasOffset.top;coords.x-=canvasOffset.left;coords.y-=canvasOffset.top;aspectRatio=overlay.aspectRatio;width=overlay.width;height=width*aspectRatio;if(_handlePosition==AV.OverlayController.HANDLE_POSITION.BOTTOM_LEFT){handleX=topLeftX;handleY=topLeftY+height+_OVERLAY_BORDER_WIDTH/2}else if(_handlePosition==AV.OverlayController.HANDLE_POSITION.BOTTOM_CENTER){handleX=topLeftX+width/2+_OVERLAY_BORDER_WIDTH;handleY=topLeftY+height+_OVERLAY_BORDER_WIDTH}else if(_handlePosition==AV.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT){handleX=topLeftX+width+_OVERLAY_BORDER_WIDTH*2;handleY=topLeftY+height+_OVERLAY_BORDER_WIDTH*2}centerX=overlay.centerX;centerY=overlay.centerY;handleNewX=coords.x;handleNewY=coords.y;scale=Math.sqrt(Math.pow(handleNewX-centerX,2)+Math.pow(handleNewY-centerY,2))/Math.sqrt(Math.pow(handleX-centerX,2)+Math.pow(handleY-centerY,2));minScale=_MINIMUM_OVERLAY_WIDTH/width;maxScale=_MAXIMUM_OVERLAY_WIDTH/width;scale=scale>minScale?scale:minScale;scale=scale<maxScale?scale:maxScale;initialRotation=overlay.rotation||0;originalAngle=Math.atan2(handleY-centerY,handleX-centerX);if(initialRotation){originalAngle=initialRotation-(2*Math.PI-originalAngle)}newAngle=Math.atan2(handleNewY-centerY,handleNewX-centerX);rotation=newAngle-originalAngle+initialRotation;overlay.rotation=rotation;rotation=rotation*180/Math.PI+.5|0;overlay.element[0].style[TRANSFORM_PROPERTY]="rotate("+rotation+"deg)";overlay.element.css({left:(topLeftX-width*.5*(scale-1)+.5|0)+"px",top:(topLeftY-height*.5*(scale-1)+.5|0)+"px",width:(width*scale+.5|0)+"px",height:(height*scale+.5|0)+"px"});return scale};var _overlayRemoveClicked=function(parentOverlay,onRemoveMouseDown){var id,overlay;if(parentOverlay.length){id=parentOverlay[0].id;overlay=_overlays[id];if(overlay){if(onRemoveMouseDown){onRemoveMouseDown.apply(controls,[overlay])}_removeOverlay(overlay)}}};var _overlayMouseDown=function(element,onOverlayMouseDown){var targetOverlay=_overlays[element.attr("id")];var mouseDownOnCurrentOverlay=false;if(targetOverlay===_currentOverlay){mouseDownOnCurrentOverlay=true;_mouseDown=true}if(onOverlayMouseDown){onOverlayMouseDown.apply(controls,[targetOverlay,mouseDownOnCurrentOverlay])}return mouseDownOnCurrentOverlay};var _overlaySizeMouseDown=function(onSizeMouseDown){if(_currentOverlay){_sizeMouseDown=true;_initialRotation=_currentOverlay.rotation;if(onSizeMouseDown){onSizeMouseDown.apply(controls,[_currentOverlay])}}};var _overlayMouseUp=function(element){if(element){_saveDimensionsFromElement(element[0]);_setCurrentOverlayById(element.attr("id"))}};var _addOverlayToCanvas=function(overlay,callback){if(overlay&&overlay.element){_saveDimensionsFromElement(overlay.element[0]);if(callback){callback.apply(controls,[overlay])}}};var _addAllOverlaysToCanvas=function(callback){var i,len=_maxOverlayZIndex+1;var overlaysInOrder=new Array(len);avpw$.each(_overlays,function(id){overlaysInOrder[_overlays[id].zIndex]=_overlays[id]});for(i=0;i<len;i++){if(overlaysInOrder[i]){_addOverlayToCanvas(overlaysInOrder[i],callback)}}};var api=this;api.activate=function(){_maxOverlayZIndex=1;_overlays={};_lastOverlayAddedID=null;controls.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement");mediator.on("canvas:resize",_resizeAllOverlays)};api.deactivate=function(){_removeAllOverlays();_overlays={};controls.layoutNotify(AV.launchData["openType"],"hideCanvasControlsElement");mediator.off("canvas:resize",_resizeAllOverlays)};api.updateUIDown=function(coords,ev,onOverlayMouseDown,onSizeMouseDown,onRemoveMouseDown,onClickOutside){var mouseDownOnCurrentOverlay=false;var $element=avpw$(ev.target);var $overlay=$element.closest(".avpw_selection_overlay");var $sizeHandle=$element.closest(".avpw_selection_overlay_size_handle");var $closeButton=$element.closest(".avpw_selection_overlay_close_button");if($closeButton&&$closeButton.length){_overlayRemoveClicked($overlay,onRemoveMouseDown);ev.preventDefault();return false}if($overlay&&$overlay.length){_clickButNotDragState=true;mouseDownOnCurrentOverlay=_overlayMouseDown($overlay,onOverlayMouseDown)}if($sizeHandle&&$sizeHandle.length){_overlaySizeMouseDown(onSizeMouseDown)}if(mouseDownOnCurrentOverlay){AV.util.extend(_currentOverlay,{initialCoordsX:coords.x,initialCoordsY:coords.y});_saveDimensionsFromElement($overlay[0])}else{if(_currentOverlay&&_currentOverlay.element){if(!_forceDragMode){_cycleOverlayMode(_currentOverlay,false)}if(onClickOutside){onClickOutside()}}}};api.updateUIMove=function(coords,ev,onMouseMoveStart,onScaleChanged,onOverlayDragMove){if(_mouseDown&&_currentOverlay&&_currentOverlay.element){if(_clickButNotDragState&&onMouseMoveStart){onMouseMoveStart.apply(controls,[_currentOverlay])}if(_sizeMouseDown){scale=_scaleAndRotateOverlay(_currentOverlay,coords);if(onScaleChanged){onScaleChanged.apply(controls,[_currentOverlay,scale])}_clickButNotDragState=false}else{if(_currentOverlay.mode===modes.DRAG_STATE){_clickButNotDragState=!_moveOverlay(_currentOverlay,coords);if(onOverlayDragMove){onOverlayDragMove()}}}}return false};api.apply=function(coords,ev,onMouseUp){var mouseDownOnCurrentOverlay=false;var $element=avpw$(ev.target);var $overlay=$element.closest(".avpw_selection_overlay");var targetOverlay;if($overlay&&$overlay.length){_overlayMouseUp($overlay);mouseDownOnCurrentOverlay=true;targetOverlay=_overlays[$overlay.attr("id")]}if(onMouseUp){onMouseUp.apply(controls,[targetOverlay,mouseDownOnCurrentOverlay,_sizeMouseDown])}if(_clickButNotDragState){_clickButNotDragState=false;if(_currentOverlay&&_currentOverlay.element&&!_forceDragMode){_cycleOverlayMode(_currentOverlay,true)}}_mouseDown=false;_sizeMouseDown=false};api.newOverlay=function(overlayObject){var overlayElement=overlayObject.element;_resetAllOverlaysMode();controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(overlayElement);_cycleOverlayMode(overlayObject,true);_overlays[overlayObject.id]=overlayObject;_saveDimensionsFromElement(overlayElement[0]);_currentOverlay=overlayObject;_lastOverlayAddedID=overlayObject.id;_moveCurrentOverlayToTop()};api.commit=function(callback){_addAllOverlaysToCanvas(callback)};api.currentOverlay=function(){return _currentOverlay};api.showCurrentOverlay=function(){_showCurrentOverlay()};api.hideCurrentOverlay=function(){_hideCurrentOverlay()};api.saveDimensions=function(overlay){overlay=overlay||_currentOverlay;_saveDimensionsFromElement(overlay.element[0])};api.isLastOverlayAdded=function(overlay){return _lastOverlayAddedID&&_overlays[_lastOverlayAddedID]===overlay};api.setHandlePosition=function(position_setting){_handlePosition=position_setting};api.setRotation=function(overlay,rotation){overlay.rotation=rotation;rotation=rotation*180/Math.PI+.5|0;overlay.element[0].style[TRANSFORM_PROPERTY]="rotate("+rotation+"deg)"};return api};AV.OverlayController.HANDLE_POSITION={BOTTOM_LEFT:0,BOTTOM_CENTER:1,BOTTOM_RIGHT:2}}(window["AV"]||(window["AV"]={}),window,document);!function(AV,window,document){var mediator=AV.Events;avpw$=typeof avpw$!=="undefined"?avpw$:{};AV.cnvs={clearCanvas:function(c){c.width=c.width},copyCanvas:function(src,x,y,w,h){var newCanvas=document.createElement("canvas");var cc;if(h===undefined){newCanvas.width=src.width;newCanvas.height=src.height;cc=newCanvas.getContext("2d");cc.drawImage(src,0,0)}else{newCanvas.width=w;newCanvas.height=h;cc=newCanvas.getContext("2d");cc.drawImage(src,-x,-y)}return newCanvas},drawImageCopy:function(context,image,x,y){var oldGCO=context.globalCompositeOperation;context.save();context.beginPath();context.rect(x,y,image.width,image.height);context.clip();context.closePath();context.globalCompositeOperation="copy";context.drawImage(image,x,y);context.globalCompositeOperation=oldGCO;context.restore()},getCanvasPixelData:function(c){var cc=c.getContext("2d");return cc.getImageData(0,0,c.width,c.height)},getImageDataRegion:function(can,x,y,w,h,pad){var cc;var tcan;var canWidth=can.width;var canHeight=can.height;var imageData;if(x<0||y<0||x+w>canWidth||y+h>canHeight){tcan=document.createElement("canvas");tcan.width=w;tcan.height=h;cc=tcan.getContext("2d");cc.drawImage(can,-x,-y);imageData=cc.getImageData(0,0,w,h);if(pad){var canCc=can.getContext("2d");var row0=canCc.getImageData(0,0,canWidth,1).data;var rowN=canCc.getImageData(0,canHeight-1,canWidth,1).data;var col0=canCc.getImageData(0,0,1,canHeight).data;var colN=canCc.getImageData(canWidth-1,0,1,canHeight).data;var pixels=imageData.data;for(var tcanY=0;tcanY<h;tcanY++){var row=null;var canY=tcanY+y;if(canY<0){canY=0;row=row0}if(canY>=canHeight){canY=canHeight-1;row=rowN}for(var tcanX=0;tcanX<w;tcanX++){var col=null;var canX=tcanX+x;if(canX<0){canX=0;col=col0}if(canX>=canWidth){canX=canWidth-1;col=colN}var tcanIndex=(tcanX+tcanY*w)*4;if(col){var colIndex=canY*4;pixels[tcanIndex++]=col[colIndex++];pixels[tcanIndex++]=col[colIndex++];pixels[tcanIndex++]=col[colIndex++];pixels[tcanIndex]=col[colIndex]}else if(row){var rowIndex=canX*4;pixels[tcanIndex++]=row[rowIndex++];pixels[tcanIndex++]=row[rowIndex++];pixels[tcanIndex++]=row[rowIndex++];pixels[tcanIndex]=row[rowIndex]}else{tcanX=canWidth-x-1}}}}}else{cc=can.getContext("2d");imageData=cc.getImageData(x,y,w,h)}return imageData},putImageDataRegion:function(can,data,x,y){var cc=can.getContext("2d");var tcc;var tcan;var canw=can.width;var canh=can.height;var dataw=data.width;var datah=data.height;if(x<0||y<0||x+dataw>=canw||y+datah>=canh){tcan=document.createElement("canvas");tcan.width=dataw;tcan.height=datah;tcc=tcan.getContext("2d");tcc.putImageData(data,0,0);cc.drawImage(tcan,x,y)}else{cc.putImageData(data,x,y)}},convertRgbToHsv:function(hsvs,rgbs,length){var i;var r,g,b;var hue,sat,val;for(i=0;i<length;i+=4){r=rgbs[i];g=rgbs[i+1];b=rgbs[i+2];var max=Math.max(r,Math.max(g,b));var min=Math.min(r,Math.min(g,b));val=max;if(max==0){hue=0;sat=0}else{var delta=max-min;sat=delta/max;if(r==max){hue=(g-b)/delta}else if(g==max){hue=2+(b-r)/delta}else{hue=4+(r-g)/delta}if(hue<0){hue+=6}hue*=60}hsvs[i]=hue;hsvs[i+1]=sat;hsvs[i+2]=val;hsvs[i+3]=rgbs[i+3]}},convertHsvToRgb:function(rgbs,hsvs,length){var i;var r,g,b;var hue,sat,val;for(i=0;i<length;i+=4){hue=hsvs[i];sat=hsvs[i+1];val=hsvs[i+2];r=g=b=val;if(sat!=0){hue/=60;var base=hue|0;var frac=hue-base;var dullest=1-sat;var dullerHi=1-sat*frac;var dullerLo=1-sat*(1-frac);switch(base){case 0:b*=dullest;g*=dullerLo;break;case 1:b*=dullest;r*=dullerHi;break;case 2:r*=dullest;b*=dullerLo;break;case 3:r*=dullest;g*=dullerHi;break;case 4:g*=dullest;r*=dullerLo;break;default:g*=dullest;b*=dullerHi}}if(r<0){r=0}if(r>255){r=255}if(g<0){g=0}if(g>255){g=255}if(b<0){b=0}if(b>255){b=255}rgbs[i]=r;rgbs[i+1]=g;rgbs[i+2]=b;rgbs[i+3]=hsvs[i+3]}},applyKernel1D:function(kernel,kernelMiddle,dest,destOffset,destStride,src,srcOffset,srcStride,count){var kernelLength=kernel.length;var i,k;var safeStart=kernelMiddle;var safeEnd=count-1-(kernelLength-kernelMiddle);for(i=0;i<count;i++){var r=0;var g=0;var b=0;if(i>=safeStart&&i<=safeEnd){var srcIndex=srcOffset+(i+(kernelLength-kernelMiddle)-1)*srcStride;var coeff;for(k=kernelLength-1;k>=3;){coeff=kernel[k--];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2];srcIndex-=srcStride;coeff=kernel[k--];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2];srcIndex-=srcStride;coeff=kernel[k--];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2];srcIndex-=srcStride;coeff=kernel[k--];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2];srcIndex-=srcStride}while(k>=0){coeff=kernel[k--];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2];srcIndex-=srcStride}}else{for(k=0;k<kernelLength;k++){var adjusted=i+(k-kernelMiddle);if(adjusted<0){adjusted=0}if(adjusted>=count){adjusted=count-1}var srcIndex=srcOffset+adjusted*srcStride;var coeff=kernel[k];r+=coeff*src[srcIndex];g+=coeff*src[srcIndex+1];b+=coeff*src[srcIndex+2]}}var destIndex=destOffset+i*destStride;dest[destIndex]=r;dest[destIndex+1]=g;dest[destIndex+2]=b}},shadowTransform:function(){var canvas=document.createElement("canvas");canvas.height=canvas.width=3;var offset=-1;var cc=canvas.getContext("2d");cc.shadowOffsetX=offset;cc.shadowOffsetY=offset;cc.shadowBlur=1;cc.shadowColor="red";cc.fillRect(1,1,1,1);var data=cc.getImageData(0,0,3,3).data;var transform={x:1,y:1};switch(255){case data[32]:transform.x=transform.y=-1;break;case data[24]:transform.y=-1;break;case data[8]:transform.x=-1;break;case data[0]:break}return transform}(),isOriginClean:function(canvasContext){var originClean=true;try{canvasContext.getImageData(0,0,1,1)}catch(err){if(err&&err.message){if(err.message.toLowerCase().indexOf("security")!==-1){originClean=false}}if(err&&err.name){if(err.name.toLowerCase().indexOf("security")!==-1){originClean=false}}}return originClean}};AV.math={sign:function(x){return x<0?-1:1},sqrDist:function(x0,y0,x1,y1){var dx=x1-x0;var dy=y1-y0;return dx*dx+dy*dy},solveQuadratic:function(a,b,c){var term1=-b;var term2=b*b-4*a*c;var term3=2*a;if(term2<0)return[0,0];return[(term1-Math.sqrt(term2))/term3,(term1+Math.sqrt(term2))/term3]},lowestPositiveQuadratic:function(a,b,c){var result=AV.math.solveQuadratic(a,b,c);var v0=result[0];var v1=result[1];if(v1<=0&&v0>0)return v0;if(v0<=0&&v1>0)return v1;return Math.max(Math.min(v0,v1),0)},lineSegmentIntersection:function(Ax,Ay,Bx,By,Cx,Cy,Dx,Dy,pointOfIntersection){var X,Y;var distAB,theCos,theSin,newX,ABpos;if(Ax==Bx&&Ay==By||Cx==Dx&&Cy==Dy)return null;if(Ax==Cx&&Ay==Cy||Bx==Cx&&By==Cy||Ax==Dx&&Ay==Dy||Bx==Dx&&By==Dy){return null}Bx-=Ax;By-=Ay;Cx-=Ax;Cy-=Ay;Dx-=Ax;Dy-=Ay;distAB=Math.sqrt(Bx*Bx+By*By);theCos=Bx/distAB;theSin=By/distAB;newX=Cx*theCos+Cy*theSin;Cy=Cy*theCos-Cx*theSin;Cx=newX;newX=Dx*theCos+Dy*theSin;Dy=Dy*theCos-Dx*theSin;Dx=newX;if(Cy<0&&Dy<0||Cy>=0&&Dy>=0)return null;ABpos=Dx+(Cx-Dx)*Dy/(Dy-Cy);if(ABpos<0||ABpos>distAB)return null;X=Ax+ABpos*theCos;Y=Ay+ABpos*theSin;pointOfIntersection.x=X;pointOfIntersection.y=Y;return true}};AV.Bbox=function(x0,y0,x1,y1,margin){if(y1!==undefined){this.x0=x0;this.y0=y0;this.x1=x1;this.y1=y1;this.w=this.x1-this.x0;this.h=this.y1-this.y0;if(margin!==undefined){this.margin=margin}else{this.margin=0}}else{this.reset()}};AV.Bbox.prototype.include=function(x,y){var minx=x-this.margin;var miny=y-this.margin;var maxx=x+this.margin;var maxy=y+this.margin;if(this.x0>minx){this.x0=minx}if(this.y0>miny){this.y0=miny}if(this.x1<maxx){this.x1=maxx}if(this.y1<maxy){this.y1=maxy}this.w=this.x1-this.x0;this.h=this.y1-this.y0};AV.Bbox.prototype.reset=function(){this.x0=999999999;this.y0=999999999;this.x1=-999999999;this.y1=-999999999;this.w=0;this.h=0;this.margin=0};AV.Bbox.prototype.contains=function(x,y){var t1=x>=this.x0&&x<=this.x1;var t2=y>=this.y0&&y<=this.y1;return t1&&t2};AV.Bbox.prototype.constrain=function(x,y){var dirty=false;if(x<this.x0){x=this.x0;dirty=true}if(x>this.x1){x=this.x1;dirty=true}if(y<this.y0){y=this.y0;dirty=true}if(y>this.y1){y=this.y1;dirty=true}return{x:x,y:y,dirty:dirty}};AV.Layer=function(info){this.image=this.canvas=this.drawable=null;if(info.image!==undefined){this.image=this.drawable=info.image;this.type="image"}else if(info.canvas!==undefined){this.canvas=this.drawable=info.canvas;this.type="canvas"}this.name=info.name;this.rotate=0;this.translateX=this.translateY=0;this.scaleX=this.scaleY=1};AV.Layer.prototype.worldToLocal=function(p){p.x-=this.translateX;p.y-=this.translateY;var cosa=Math.cos(-this.rotate);var sina=Math.sin(-this.rotate);var x=p.x;p.x=x*cosa-p.y*sina;p.y=x*sina+p.y*cosa;p.x/=this.scaleX;p.y/=this.scaleY};AV.Layer.prototype.localToWorld=function(p){if(this.centerX){p.x-=this.centerX}if(this.centerY){p.y-=this.centerY}p.x*=this.scaleX;p.y*=this.scaleY;var cosa=Math.cos(this.rotate);var sina=Math.sin(this.rotate);var x=p.x;p.x=x*cosa-p.y*sina;p.y=x*sina+p.y*cosa;p.x+=this.translateX;p.y+=this.translateY};AV.Layer.prototype.localPointIn=function(p){var x0=0,y0=0;if(this.centerX){x0-=this.centerX}if(this.centerY){y0-=this.centerY}return p.x>=x0&&p.y>=y0&&p.x<x0+this.drawable.width&&p.y<y0+this.drawable.height};AV.OverlaySelectionModule=function(context){var _paintWidget=context;var handleImg=document.createElement("img");handleImg.width=handleImg.height=50;var api=this;api.getHandleImageWidth=function(){return handleImg.width};api.drawCropSelection=function(_bbox){if(!_bbox){return}var x0,y0,x1,y1,w,h;var zoomScale=1;if(AV.controlsWidgetInstance&&AV.controlsWidgetInstance.canvasUI){zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio()}var l=_paintWidget.getLayerByName("_ui");if(_bbox.x0<_bbox.x1){x0=_bbox.x0;x1=_bbox.x1}else{x0=_bbox.x1;x1=_bbox.x0}if(_bbox.y0<_bbox.y1){y0=_bbox.y0;y1=_bbox.y1}else{y0=_bbox.y1;y1=_bbox.y0}w=x1-x0;h=y1-y0;var c=l.canvas.getContext("2d");c.globalCompositeOperation="copy";c.clearRect(0,0,l.canvas.width,l.canvas.height);c.globalCompositeOperation="source-over";c.fillStyle="#000000";c.globalAlpha=.6;c.fillRect(0,0,x0,l.canvas.height);c.fillRect(x1,0,l.canvas.width,l.canvas.height);c.fillRect(x0,0,x1-x0,y0-0);c.fillRect(x0,y1,x1-x0,l.canvas.height-y1);c.strokeStyle="#f4f4f4";c.globalAlpha=1;c.lineWidth=zoomScale;c.lineCap="square";c.strokeRect(x0,y0,w,h);c.beginPath();c.moveTo(x0,y0+h*.33+.5|0);c.lineTo(x1,y0+h*.33+.5|0);c.moveTo(x0,y0+h*.67+.5|0);c.lineTo(x1,y0+h*.67+.5|0);c.moveTo(x0+w*.33+.5|0,y0);c.lineTo(x0+w*.33+.5|0,y1);c.moveTo(x0+w*.67+.5|0,y0);c.lineTo(x0+w*.67+.5|0,y1);c.stroke();c.closePath();c.globalAlpha=1;var handlePoints=[{x:x0,y:y0},{x:x1,y:y0},{x:x0,y:y1},{x:x1,y:y1}];for(var i=0;i<handlePoints.length;i++){var handlePoint=handlePoints[i];c.setTransform(1,0,0,1,0,0);l.localToWorld(handlePoint);c.translate(handlePoint.x,handlePoint.y);c.translate(-1*(zoomScale*handleImg.width/2+.5|0),-1*(zoomScale*handleImg.height/2+.5|0));c.scale(zoomScale,zoomScale);c.drawImage(handleImg,0,0);c.scale(1,1);c.setTransform(1,0,0,1,0,0)}};api.drawCropSelectionBackground=function(_bbox){if(!_bbox){return}var x0,y0,x1,y1,w,h;var l=_paintWidget.getLayerByName("_ui");if(_bbox.x0<_bbox.x1){x0=_bbox.x0;x1=_bbox.x1}else{x0=_bbox.x1;x1=_bbox.x0}if(_bbox.y0<_bbox.y1){y0=_bbox.y0;y1=_bbox.y1}else{y0=_bbox.y1;y1=_bbox.y0}w=x1-x0;h=y1-y0;var c=l.canvas.getContext("2d");c.globalCompositeOperation="copy";c.clearRect(0,0,l.canvas.width,l.canvas.height);c.globalCompositeOperation="source-over";c.fillStyle="#000000";c.globalAlpha=.6;c.fillRect(0,0,x0,l.canvas.height);c.fillRect(x1,0,l.canvas.width,l.canvas.height);c.fillRect(x0,0,x1-x0,y0-0);c.fillRect(x0,y1,x1-x0,l.canvas.height-y1)};return api};AV.BrushModule=function(o){var _overflow=o.overflow||0;var _layerName=o.layerName||"drawing";var _preserveBacking=o.preserveBacking||false;var _paintWidget;var _origBacking;var _radius=5;var _color="rgba(255,255,204,0.5)";var _erase=false;var _pointlist;var _bbox;var _oldX,_oldY;var _oldMidX,_oldMidY;var api=this;var _drawUICircle=function(x,y){_paintWidget.uiLayerDrawCircleSelection(x,y,_radius)};var _createLayerIfNecessary=function(){var layer=_paintWidget.getLayerByName(_layerName);if(!layer){var dcanvas=document.createElement("canvas");dcanvas.width=_paintWidget.width;dcanvas.height=_paintWidget.height;layer=new AV.Layer({canvas:dcanvas,name:_layerName});_paintWidget.addLayer(layer);_paintWidget.uiLayerReset()}if(layer.canvas.width!=_paintWidget.width){layer.canvas.width=_paintWidget.width}if(layer.canvas.height!=_paintWidget.height){layer.canvas.height=_paintWidget.height}return layer};var _resetSpotToolLayer=function(){var i=_paintWidget.findLayerIndexByName("spot_tool");if(i!==-1){_paintWidget.layers[i].canvas.width=_paintWidget.canvas.width;_paintWidget.layers[i].canvas.height=_paintWidget.canvas.height}};var _drawLineSegment=function(c,x,y,begin,end){c.lineCap="round";c.lineJoin="round";c.lineWidth=_radius*2;if(_erase){c.strokeStyle="#fff";c.globalCompositeOperation="destination-out"}else{c.strokeStyle=_color;c.globalCompositeOperation="source-over"}c.beginPath();if(begin){_oldX=x;_oldY=y;c.moveTo(_oldX,_oldY);c.lineTo(x+.02,y);_oldMidX=x;_oldMidY=y}else if(end){c.moveTo(_oldMidX,_oldMidY);c.lineTo(_oldX,_oldY);_oldX=_oldY=_oldMidX=_oldMidY=null}else{var midX=(_oldX+x)/2|0;var midY=(_oldY+y)/2|0;c.moveTo(_oldMidX,_oldMidY);c.quadraticCurveTo(_oldX,_oldY,midX,midY);_oldX=x;_oldY=y;_oldMidX=midX;_oldMidY=midY}c.stroke();c.closePath()};var _generatePointList=function(pointList){var brushSize=_radius;var lastpoint;var i=0;var midpoints=[];var getQuadMid=function(points,x0,y0,x1,y1,cpx,cpy){var distdist=(x1-x0)*(x1-x0)+(y1-y0)*(y1-y0);if(distdist<brushSize*brushSize){return null}var ax,bx,ay,by,mx,my;
if(cpx!==undefined){ax=(cpx+x0)/2;bx=(cpx+x1)/2;ay=(cpy+y0)/2;by=(cpy+y1)/2;mx=(ax+bx)/2;my=(ay+by)/2}else{mx=(x0+x1)/2;my=(y0+y1)/2}getQuadMid(points,x0,y0,mx,my,ax,ay);points.push([mx|0,my|0]);getQuadMid(points,mx,my,x1,y1,bx,by)};for(i=0;i<pointList.length-1;++i){var point1=pointList[i];var point2=pointList[i+1];var midpoint=[(point1[0]+point2[0])/2|0,(point1[1]+point2[1])/2|0];if(i===0){getQuadMid(midpoints,point1[0],point1[1],midpoint[0],midpoint[1])}else{getQuadMid(midpoints,lastpoint[0],lastpoint[1],midpoint[0],midpoint[1],point1[0],point1[1])}lastpoint=midpoint;midpoints.push(midpoint);if(i===pointList.length-2){getQuadMid(midpoints,midpoint[0],midpoint[1],point2[0],point2[1]);midpoints.push(point2)}}return midpoints};var _drawingUndo=function(layerName,backing,x,y){var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");AV.cnvs.drawImageCopy(c,backing,x,y);_paintWidget.recomposite()};var _drawingRedo=function(layerName,backing,x,y){var layer=_createLayerIfNecessary();var c=layer.canvas.getContext("2d");AV.cnvs.drawImageCopy(c,backing,x,y);_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget;_bbox=new AV.Bbox;_oldX=_oldY=0;_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true)};api.deactivate=function(){_paintWidget.uiLayerShow(false)};api.updateUIDown=function(x,y){var layer=_createLayerIfNecessary();_paintWidget.currentLayer=layer;if(_preserveBacking){_origBacking=AV.cnvs.copyCanvas(layer.canvas)}_paintWidget.uiLayerShow(true);_pointlist=[[x+.5|0,y+.5|0]];_bbox.reset();_bbox.margin=(_radius+.5|0)+_overflow;_bbox.include(x,y);var c=layer.canvas.getContext("2d");_drawLineSegment(c,x,y,true);_paintWidget.recomposite()};api.updateUIMove=function(x,y){_paintWidget.uiLayerShow(true);_drawUICircle(x,y);_paintWidget.recomposite()};api.updateUIDraw=function(x,y){var layer=_paintWidget.currentLayer;var c=layer.canvas.getContext("2d");_pointlist.push([x+.5|0,y+.5|0]);_drawLineSegment(c,x,y,false);_bbox.include(x,y);_paintWidget.uiLayerShow(true);_drawUICircle(x,y);_paintWidget.recomposite()};api.commit=function(moduleName,undoFunc,redoFunc,expand){var layer,backing;if(undoFunc&&redoFunc){var pointlist=expand&&_pointlist.length>1?_generatePointList(_pointlist):_pointlist;_resetSpotToolLayer();layer=_paintWidget.layers[_paintWidget.currentLayerIndex];if(!layer.canvas){return}backing=AV.cnvs.copyCanvas(layer.canvas,_bbox.x0,_bbox.y0,_bbox.w,_bbox.h);_paintWidget.actions.push([undoFunc,this,[layer.name,backing,_bbox.x0,_bbox.y0]],[redoFunc,this,[layer.name,pointlist,_radius]],{action:moduleName,radius:_radius+.5|0,pointlist:pointlist});_paintWidget.actions.redo()}else{layer=_paintWidget.currentLayer;var c=layer.canvas.getContext("2d");_drawLineSegment(c,0,0,false,true);_paintWidget.recomposite();backing=AV.cnvs.copyCanvas(layer.canvas,_bbox.x0,_bbox.y0,_bbox.w,_bbox.h);var origBackingCrop=AV.cnvs.copyCanvas(_origBacking,_bbox.x0,_bbox.y0,_bbox.w,_bbox.h);_paintWidget.actions.push([_drawingUndo,this,[layer.name,origBackingCrop,_bbox.x0,_bbox.y0]],[_drawingRedo,this,[layer.name,backing,_bbox.x0,_bbox.y0]],{action:moduleName,erase:_erase,radius:_radius+.5|0,softness:0,color:AV.util.color_to_rgb(_color),pointlist:_pointlist});_paintWidget.actions.redoFake()}_pointlist=null;_origBacking=null};api.radius=function(){return _radius};api.setRadius=function(r){_radius=r};api.setColor=function(c){_color=c};api.setErase=function(e){_erase=e};return api};AV.SpotBrushModule=function(o){var _processor=o.processor;var _params=o.params;var _toolName=o.toolName;var _origBackingCanvas,_origSrc,_newPixelData,src,dst,_tmp,_mask;var _oldLayers;var _toolStrokes;var _copyProcessor=AV.require("../../../src/js/processors/copy");var _paintWidget;var _strokeBacking;var _maskBacking;var _radius=5;var _pointlist;var _oldX,_oldY;var _oldMidX,_oldMidY;var api=this;var _currentPointList;var _lastPoint;var _shouldHideCursor=false;var _initializeImageDataFromCanvas=function(flatten){flatten||(flatten=true);var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];if(layer.canvas==null){return}_origBackingCanvas=AV.cnvs.copyCanvas(layer.canvas);if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.layers[_paintWidget.currentLayerIndex]}var dcanvas=AV.cnvs.copyCanvas(layer.canvas);var ctx=layer.canvas.getContext("2d");var w=_paintWidget.width,h=_paintWidget.height;_origSrc=AV.cnvs.getCanvasPixelData(dcanvas);src=_origSrc.data;_newPixelData=AV.cnvs.getCanvasPixelData(dcanvas);dst=_newPixelData.data;_tmp=AV.cnvs.getCanvasPixelData(dcanvas).data;_mask=_copyProcessor.makeData(w*h);_processor.init(_tmp,w,h,_mask);_processor.preview(dst,src,_tmp,_mask,w,h);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite();_pointlist=[]};var _drawUICircle=function(x,y){mediator.trigger("canvas:setBrushPosition",x,y)};var _generatePointList=function(pointList){var brushSize=Math.floor(_radius*.2)||1;var lastpoint;var i=0;var midpoints=[];var getQuadMid=function(points,x0,y0,x1,y1,cpx,cpy){var distdist=(x1-x0)*(x1-x0)+(y1-y0)*(y1-y0);if(distdist<brushSize*brushSize){return null}var ax,bx,ay,by,mx,my;if(cpx!==undefined){ax=(cpx+x0)/2;bx=(cpx+x1)/2;ay=(cpy+y0)/2;by=(cpy+y1)/2;mx=(ax+bx)/2;my=(ay+by)/2}else{mx=(x0+x1)/2;my=(y0+y1)/2}getQuadMid(points,x0,y0,mx,my,ax,ay);points.push([mx|0,my|0]);getQuadMid(points,mx,my,x1,y1,bx,by)};for(i=0;i<pointList.length-1;++i){var point1=pointList[i];var point2=pointList[i+1];var midpoint=[(point1[0]+point2[0])/2|0,(point1[1]+point2[1])/2|0];if(i===0){getQuadMid(midpoints,point1[0],point1[1],midpoint[0],midpoint[1])}else{getQuadMid(midpoints,lastpoint[0],lastpoint[1],midpoint[0],midpoint[1],point1[0],point1[1])}lastpoint=midpoint;midpoints.push(midpoint);if(i===pointList.length-2){getQuadMid(midpoints,midpoint[0],midpoint[1],point2[0],point2[1]);midpoints.push(point2)}}return midpoints};var _drawingUndo=function(layerName,backing,x,y){var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");AV.cnvs.drawImageCopy(c,backing,x,y);_paintWidget.recomposite()};api.reset=function(){_initializeImageDataFromCanvas(true)};api.activate=function(paintWidget){_paintWidget=paintWidget;_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true);_toolStrokes=[];api.reset();AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement")};api.deactivate=function(){_paintWidget.uiLayerShow(false);mediator.trigger("canvas:hideBrushCursor");_toolStrokes=null};var _applyDraw=function(x,y,scaledRadius){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");var w=_paintWidget.width,h=_paintWidget.height;var minX,minY,maxX,maxY;var paddedBrushRadius=scaledRadius*1.5;if(_lastPoint!=null){var distance=Math.sqrt(Math.pow(_lastPoint[0]-x,2)+Math.pow(_lastPoint[1]-y,2));if(distance<.6*_radius){return}var fillPoints=_generatePointList([[_lastPoint[0],_lastPoint[1]],[x,y]]);minX=x;minY=y;maxX=x;maxY=y;var xPos,yPos;for(var i=0;i<fillPoints.length;i++){xPos=fillPoints[i][0];yPos=fillPoints[i][1];if(xPos<minX){minX=xPos}if(xPos>maxX){maxX=xPos}if(yPos<minY){minY=yPos}if(yPos>maxY){maxY=yPos}api.drawPoint(xPos,yPos,xPos,yPos,w,h,scaledRadius)}}else{minX=x;minY=y;maxX=x;maxY=y}minX-=paddedBrushRadius;minY-=paddedBrushRadius;maxX+=paddedBrushRadius;maxY+=paddedBrushRadius;_currentPointList.push([x,y]);api.drawPoint(x,y,x,y,w,h,scaledRadius);_processor.preview(dst,src,_tmp,_mask,w,h,minX,minY,maxX,maxY);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};api.drawPoint=function(x,y,startX,startY,w,h,scaledRadius){var procParams=AV.util.extend({posX:x,posY:y,startX:startX,startY:startY,radius:scaledRadius},_params);_currentPointList.push([x,y]);_lastPoint=[x,y];_processor.draw(src,w,h,_mask,procParams)};api.startStroke=function(){_currentPointList=[]};api.updateUIDown=function(x,y,scaledRadius){_maskBacking=_copyProcessor.copy(_mask);if(!_shouldHideCursor){_paintWidget.uiLayerShow(true);_drawUICircle(x,y)}var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];if(!layer.canvas){return}_strokeBacking=AV.cnvs.getCanvasPixelData(layer.canvas);api.startStroke();_currentPointList.push([x,y]);_applyDraw(x,y,scaledRadius)};api.updateUIMove=function(x,y,mouseDown,scaledRadius){if(mouseDown){_applyDraw(x,y,scaledRadius);_currentPointList.push([x,y])}if(!_shouldHideCursor){_paintWidget.uiLayerShow(true);_drawUICircle(x,y)}_paintWidget.recomposite()};api.updateUIUp=function(){_lastPoint=null};var _applyImage=function(imageData){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];layer.canvas.getContext("2d").putImageData(imageData,0,0);_paintWidget.recomposite();_origSrc=AV.cnvs.getCanvasPixelData(layer.canvas);src=_origSrc.data;_newPixelData=AV.cnvs.getCanvasPixelData(layer.canvas);dst=_newPixelData.data;_mask=_copyProcessor.makeData(_paintWidget.width*_paintWidget.height)};var _undoStroke=function(mask,origSrc,oldLayers){_mask=mask;if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");_origSrc=origSrc;src=_origSrc.data;_processor.preview(dst,src,_tmp,_mask,layer.canvas.width,layer.canvas.height);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};var _redoStroke=function(mask){_mask=mask;_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");_origSrc=AV.cnvs.getCanvasPixelData(layer.canvas);src=_origSrc.data;_processor.preview(dst,src,_tmp,_mask,layer.canvas.width,layer.canvas.height);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};api.commitStroke=function(scaledRadius){var newMask=_copyProcessor.copy(_mask);var toolOrigSrc=AV.cnvs.getCanvasPixelData(_origBackingCanvas);_paintWidget.actions.push([_undoStroke,this,[_maskBacking,toolOrigSrc,_oldLayers]],[_redoStroke,this,[newMask]],{});_paintWidget.actions.redoFake();api.finializeStroke(scaledRadius)};api.finializeStroke=function(scaledRadius){_toolStrokes.push(AV.util.extend({},{radius:scaledRadius,pointlist:_currentPointList}))};api.commit=function(isHeadless){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");var dstCopy=ctx.getImageData(0,0,_paintWidget.width,_paintWidget.height);_paintWidget.actions.undoToCheckpoint();var origCopy=ctx.getImageData(0,0,_paintWidget.width,_paintWidget.height);_paintWidget.actions.push([_applyImage,this,[origCopy]],[_applyImage,this,[dstCopy]],api.getFlattenedActionList());_paintWidget.actions.redo()};api.getFlattenedActionList=function(){return{action:"tools",toolname:_toolName,strokes:_toolStrokes}};api.resetImageData=function(){_initializeImageDataFromCanvas(true)};api.radius=function(){return _radius};api.setRadius=function(r){_radius=r;mediator.trigger("canvas:setBrushSize",r)};return api};AV.SpotBrushModule.Cursor=function(){var api={};var _brushElm,_ctx;var _createBrush=function(){_brushElm=document.createElement("canvas");_brushElm.className="avpw_cursor_circle";_brushElm.width=_brushElm.height=200;_ctx=_brushElm.getContext("2d");AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(_brushElm)};api.show=function(){if(!_brushElm)_createBrush();avpw$(_brushElm).fadeIn()};api.hide=function(){if(_brushElm)avpw$(_brushElm).hide()};api.setPosition=function(x,y){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();_brushElm.style.top=(y/zoomScale+.5|0)+"px";_brushElm.style.left=(x/zoomScale+.5|0)+"px"};api.setSize=function(radius){if(!_brushElm)return;_brushElm.width=_brushElm.width;radius=radius*1.3;var x=radius;var y=radius;_ctx.beginPath();_ctx.strokeStyle="#ffffff";_ctx.arc(x,y,radius,0,2*Math.PI,false);_ctx.closePath();_ctx.stroke();var lineWidth=2;var innerRadius=radius-lineWidth;if(innerRadius>0){_ctx.beginPath();_ctx.strokeStyle="#000000";_ctx.arc(x,y,innerRadius,0,2*Math.PI,false);_ctx.closePath();_ctx.stroke()}_brushElm.style.marginLeft=-radius+"px";_brushElm.style.marginTop=-radius+"px"};mediator.on("canvas:showBrushCursor",api.show);mediator.on("canvas:hideBrushCursor",api.hide);mediator.on("canvas:setBrushPosition",api.setPosition);mediator.on("canvas:setBrushSize",api.setSize);return api}();AV.PaintWidget=function(width,height,actions,modeManager,filterManager,overlayRegistry,imageBorderManager){this.imgElementClean=null;this.busy=false;this.moduleLoadedCallback={};this.canvasReadyCallback=avpw$.Deferred?new avpw$.Deferred:null;this.active=null;this.layers=[];this.dirtyRect={bbox:new AV.Bbox,dirty:false};this.canvas=document.createElement("canvas");this.setDimensions(width,height);this.canvas.id="avpw_canvas_element";this.dirty=false;this.actions=actions;if(modeManager&&modeManager.init){modeManager.init(this);this.modeManager=modeManager}this.filterManager=filterManager;this.overlayRegistry=overlayRegistry;this.imageBorderManager=imageBorderManager};AV.PaintWidget.prototype.setOrigSize=function(w,h){this._origWidth=w+.5|0;this._origHeight=h+.5|0};AV.PaintWidget.prototype.getOrigSize=function(){return{width:this._origWidth,height:this._origHeight}};AV.PaintWidget.prototype.c2a=function(w,h,forceFloor){var factor,newHiresWidth,newHiresHeight,currentDims=this.getScaledSize();if(currentDims.hiresWidth&&currentDims.hiresHeight){if(w!=currentDims.width||h!=currentDims.height){factor=currentDims.hiresWidth/currentDims.width;newHiresWidth=w*factor;if(forceFloor)newHiresWidth=newHiresWidth+.5|0;factor=currentDims.hiresHeight/currentDims.height;newHiresHeight=h*factor;if(forceFloor)newHiresHeight=newHiresHeight+.5|0;return{width:w,height:h,hiresWidth:newHiresWidth,hiresHeight:newHiresHeight}}else{return currentDims}}else{return{width:w,height:h}}};AV.PaintWidget.prototype.a2c=function(w,h,forceFloor){var factor,newWidth,newHeight,currentDims=this.getScaledSize();if(currentDims.hiresWidth&&currentDims.hiresHeight){if(w!=currentDims.width||h!=currentDims.height){factor=currentDims.width/currentDims.hiresWidth;newWidth=w*factor;if(forceFloor)newWidth=newWidth+.5|0;factor=currentDims.height/currentDims.hiresHeight;newHeight=h*factor;if(forceFloor)newHeight=newHeight+.5|0;return{width:newWidth,height:newHeight,hiresWidth:w,hiresHeight:h}}else{return currentDims}}else{return{width:w,height:h}}};AV.PaintWidget.prototype.setBackground=function(imgElementClean){var c,originClean;imgElementClean.crossOrigin="Anonymous";this.imgElementClean=imgElementClean;var bgcanvas=document.createElement("canvas");bgcanvas.width=this.width;bgcanvas.height=this.height;c=bgcanvas.getContext("2d");c.drawImage(imgElementClean,0,0,this.width,this.height);originClean=AV.cnvs.isOriginClean(c);this.addLayer(new AV.Layer({canvas:bgcanvas,name:"background"}));this.recomposite();this.currentLayerIndex=0;this.currentLayer=this.layers[this.currentLayerIndex];if(this.canvasReadyCallback){this.canvasReadyCallback.resolve()}return originClean};AV.PaintWidget.prototype.shutdown=function(){this.setMode(null);if(this.modeManager){this.modeManager.shutdown();this.modeManager=null}this.actions=null;this.layers=null;this.currentLayer=null;this.canvas=null;this.moduleLoadedCallback=null;this.canvasReadyCallback=null;this.waitThrobberShow=null};AV.PaintWidget.prototype.moduleLoaded=function(modulename,callback){var pw=this,dfd,asyncCodeDeferreds=[];var completeDeferred=function(){dfd.done(function(){if(callback){callback.apply(this,[modulename])}});pw.moduleLoadedCallback[modulename]=dfd};var buildAsyncCodeDeferreds=function(assets){var i,url;for(i=0;i<assets.length;i++){url=assets[i].resourceUrl;if(url){!function(){var codeLoad=new avpw$.Deferred;if(assets[i].assetType===AV.controlsWidgetInstance.assetManager.types.EFFECT){pw.filterManager.loadPack(assets[i].assetId,url,function(){codeLoad.resolve()})}else if(assets[i].assetType===AV.controlsWidgetInstance.assetManager.types.IMAGEBORDER){pw.imageBorderManager.loadPack(assets[i].assetId,url,codeLoad.resolve)}else if(assets[i].assetType===AV.controlsWidgetInstance.assetManager.types.FONTPACK){AV.util.loadFile(url,"js",codeLoad.resolve)}else{codeLoad.resolve()}asyncCodeDeferreds.push(codeLoad)}()}}asyncCodeDeferreds.push(pw.canvasReadyCallback);dfd=avpw$.when.apply(pw,asyncCodeDeferreds);completeDeferred()};if(pw.moduleLoadedCallback){dfd=pw.moduleLoadedCallback[modulename]}if(!dfd){if(modulename==="effects"){if(AV.controlsWidgetInstance.assetManager){AV.controlsWidgetInstance.assetManager.getAssets("EFFECT",buildAsyncCodeDeferreds)}}else if(modulename==="frames"){if(AV.controlsWidgetInstance.assetManager){AV.controlsWidgetInstance.assetManager.getAssets("IMAGEBORDER",buildAsyncCodeDeferreds)}}else if(modulename==="textwithfont"){if(AV.controlsWidgetInstance.assetManager){AV.controlsWidgetInstance.assetManager.getAssets("FONTPACK",buildAsyncCodeDeferreds)}}else{dfd=avpw$.when(pw.canvasReadyCallback);completeDeferred()}}else{completeDeferred()}return dfd?dfd.isResolved():false};AV.PaintWidget.prototype.setDimensions=function(w,h){this.canvas.width=this.width=w;this.canvas.height=this.height=h;if(AV.controlsWidgetInstance){if(AV.controlsWidgetInstance.canvasUI){AV.controlsWidgetInstance.canvasUI.resetOffset()}AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"scaleCanvas")}};AV.PaintWidget.prototype.getScaledSize=function(){if(this.actions){return this.actions.getDims()}else{return{width:this.width,height:this.height}}};AV.PaintWidget.prototype.showWaitThrobber=function(show,callback){if(callback){setTimeout(callback,5)}};AV.PaintWidget.prototype.getBackgroundLayerIndex=function(){return 0};AV.PaintWidget.prototype.findLayerIndexByName=function(name){var i;for(i=0;i<this.layers.length;i++){if(this.layers[i].name===name){return i}}return-1};AV.PaintWidget.prototype.getLayerByName=function(name){var i=this.findLayerIndexByName(name);if(i===-1){return null}return this.layers[i]};AV.PaintWidget.prototype.moveLayerByName=function(name,x,y){var l=this.getLayerByName(name);if(l===null){return}l.translateX=x;l.translateY=y};AV.PaintWidget.prototype.setCurrentLayerByName=function(name){var i=this.findLayerIndexByName(name);if(i===-1){return false}this.currentLayerIndex=i;this.currentLayer=this.layers[i];return true};AV.PaintWidget.prototype.layerToTop=function(index){var l=this.layers[index];while(index<this.layers.length-1){var t=parseInt(index,10)+1;this.layers[index]=this.layers[t];index++}this.layers[index]=l};AV.PaintWidget.prototype.layerDelete=function(index){while(index<this.layers.length-1){var t=parseInt(index,10)+1;this.layers[index]=this.layers[t];index++}this.layers.length-=1};AV.PaintWidget.prototype.uiLayerReset=function(){var i=this.findLayerIndexByName("_ui");if(i==-1){var newCanvas=document.createElement("canvas");newCanvas.width=this.canvas.width;newCanvas.height=this.canvas.height;var l=new AV.Layer({canvas:newCanvas,name:"_ui"});l.hidden=true;this.layers.push(l)}else{this.layers[i].hidden=true;this.layers[i].canvas.width=this.canvas.width;this.layers[i].canvas.height=this.canvas.height;this.layerToTop(i)}};AV.PaintWidget.prototype.uiLayerShow=function(show){var i=this.findLayerIndexByName("_ui");if(i!=-1){this.layers[i].hidden=!show;if(!show){this.recomposite()}}};AV.PaintWidget.prototype.uiLayerClear=function(){var l=this.getLayerByName("_ui");var c=l.canvas.getContext("2d");c.globalCompositeOperation="copy";c.clearRect(0,0,l.canvas.width,l.canvas.height);c.globalCompositeOperation="source-over"};AV.PaintWidget.prototype.uiLayerDrawCircleSelection=function(x,y,radius,noClear){var l=this.getLayerByName("_ui");var c=l.canvas.getContext("2d");var lineWidth=1;if(!noClear){c.globalCompositeOperation="copy";c.clearRect(0,0,l.canvas.width,l.canvas.height)}var zoomScale=1;if(AV.controlsWidgetInstance.canvasUI){zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio()}lineWidth=lineWidth*zoomScale+.5|0;c.globalCompositeOperation="source-over";c.lineWidth=lineWidth;c.globalAlpha=1;c.beginPath();c.strokeStyle="#ffffff";c.arc(x,y,radius,0,2*Math.PI,false);c.closePath();c.stroke();var innerRadius=radius-lineWidth;if(innerRadius>0){c.beginPath();c.strokeStyle="#000000";c.arc(x,y,innerRadius,0,2*Math.PI,false);c.closePath();c.stroke()}};AV.PaintWidget.prototype.dirtyRectEnable=function(enable){this.dirtyRect.dirty=enable};AV.PaintWidget.prototype.recomposite=function(fromDepth){var i;var l;AV.cnvs.clearCanvas(this.canvas);var cc=this.canvas.getContext("2d");if(fromDepth==null){fromDepth=0}else{fromDepth--;if(fromDepth<0){fromDepth=0}}cc.setTransform(1,0,0,1,0,0);for(i=fromDepth;i<this.layers.length;i++){l=this.layers[i];if(l.hidden){continue}cc.save();if(this.dirtyRect.dirty){cc.beginPath();cc.rect(this.dirtyRect.bbox.x0,this.dirtyRect.bbox.y0,this.dirtyRect.bbox.w,this.dirtyRect.bbox.h);cc.clip();cc.closePath()}cc.translate(l.translateX,l.translateY);cc.rotate(l.rotate);cc.scale(l.scaleX,l.scaleY);if(l.centerX!=null&&l.centerY!=null){cc.translate(-l.centerX,-l.centerY)}if(l.alpha!=null){cc.globalAlpha=l.alpha}else{cc.globalAlpha=1}cc.drawImage(l.drawable,0,0);cc.restore()}if(this.debugPoint!=null){cc.setTransform(1,0,0,1,0,0);cc.strokeStyle="#00ffff";cc.lineWidth=1;cc.lineCap="round";cc.lineJoin="round";cc.strokeRect(this.debugPoint.x-2,this.debugPoint.y-2,4,4)}};AV.PaintWidget.prototype.makeThumbFlat=function(newCanvas,surround){this.recomposite();var w=newCanvas.width;var h=newCanvas.height;var ctx=newCanvas.getContext("2d");ctx.globalCompositeOperation="copy";ctx.clearRect(0,0,newCanvas.width,newCanvas.height);ctx.globalCompositeOperation="source-over";var wmult=w/this.canvas.width;var hmult=h/this.canvas.height;if(surround){if(wmult>hmult){var destW=this.canvas.width*hmult;var xpos=(w-destW)/2;ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,xpos,0,destW,h)}else{var destH=this.canvas.height*wmult;var ypos=(h-destH)/2;ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,ypos,w,destH)}}else{if(wmult<hmult){var destW=this.canvas.width*hmult;var xpos=-(destW-w)/2;ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,xpos,0,destW,h)}else{var destH=this.canvas.height*wmult;var ypos=-(destH-h)/2;ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,ypos,w,destH)}}return newCanvas};AV.PaintWidget.prototype.exportImage=function(mime,callback){mime=mime||"image/png";this.uiLayerShow(false);this.recomposite();var supportsToDataURL=function(){var c=document.createElement("canvas");var data=c.toDataURL("image/png");return data.indexOf("data:image/png")==0};var dataURL;if(supportsToDataURL()){dataURL=this.canvas.toDataURL(mime)}else{dataURL=AV.toBitmapURL(this.canvas)}if(callback&&typeof callback==="function"){callback.apply(this,[dataURL])}return true};AV.PaintWidget.prototype.addLayer=function(layer){this.layers.push(layer);return this.layers.length-1};AV.PaintWidget.prototype.setMode=function(mode){if(this.active!==null){if(this.active.deactivate!==undefined){this.active.deactivate()}}if(mode!==null&&mode!==undefined&&mode!==""){var newactive=this.module[mode];if(newactive!==undefined){this.active=newactive;if(this.active.activate!==undefined){this.active.activate(this)}}}else{this.active=null}};AV.PaintWidget.prototype.undo=function(){if(this.active&&this.active.userUndo!==undefined){this.active.userUndo()}this.actions.undo();if(this.active&&this.active.userPostUndo!==undefined){this.active.userPostUndo()}};AV.PaintWidget.prototype.redo=function(){if(this.active&&this.active.userRedo!==undefined){this.active.userRedo()}this.actions.redo();if(this.active&&this.active.userPostRedo!==undefined){this.active.userPostRedo()}};AV.PaintWidget.prototype.getBacking=function(x,y,w,h){var c=this.canvas.getContext("2d");var id=c.getImageData(x,y,w,h);return id};AV.PaintWidget.prototype.getBackingAll=function(){var c=this.canvas.getContext("2d");return c.getImageData(0,0,this.canvas.width,this.canvas.height)};AV.PaintWidget.prototype.putBacking=function(layer,backing,x,y){var c=layer.canvas.getContext("2d");c.putImageData(backing,x,y)};AV.PaintWidget.prototype.rotate90=function(){var i,c;var _rotateOverlay90=function(l,angle){var t;l.rotate+=angle*Math.PI/180;if(angle==90){t=l.translateX;l.translateX=this.canvas.width-l.translateY;l.translateY=t}else if(angle==270){t=l.translateX;l.translateX=l.translateY;l.translateY=this.canvas.height-t}else if(angle==180){l.translateX=this.canvas.width-l.translateX;l.translateY=this.canvas.height-l.translateY}};return function(angle){angle%=360;if(angle<0){angle+=360}angle=parseInt(angle/90,10)*90;if(angle==0){return}if(angle%180!=0){this.setDimensions(this.canvas.height,this.canvas.width)}var tx;var ty;for(i=0;i<this.layers.length;i++){var l=this.layers[i];if(l.canvas!=null){if(l.tag=="module_text"){_rotateOverlay90(l,angle)}else{var newCanvas=document.createElement("canvas");newCanvas.width=this.canvas.width;newCanvas.height=this.canvas.height;c=newCanvas.getContext("2d");c.setTransform(1,0,0,1,0,0);c.translate(newCanvas.width/2,newCanvas.height/2);c.rotate(angle*3.14159265358979/180);c.translate(-l.canvas.width/2,-l.canvas.height/2);c.globalCompositeOperation="copy";c.drawImage(l.canvas,0,0);c.globalCompositeOperation="source-over";c.setTransform(1,0,0,1,0,0);l.canvas=l.drawable=newCanvas}}else if(l.image!=null){_rotateOverlay90(l,angle)}}this.recomposite()}}();AV.PaintWidget.prototype._dupLayerAttrs=function(dest,src){if(src.hidden==true){dest.hidden=true}if(src.alpha!=undefined){dest.alpha=src.alpha}dest.rotate=src.rotate;dest.scaleX=src.scaleX;dest.scaleY=src.scaleY;dest.translateX=src.translateX;dest.translateY=src.translateY;if(src.centerX!=null){dest.centerX=src.centerX}if(src.centerY!=null){dest.centerY=src.centerY}if(src.tag!=null){dest.tag=src.tag}if(src.module_data!=null){dest.module_data=src.module_data}};AV.PaintWidget.prototype.duplicateAllLayers=function(){var newLayers=[];var i,l,c;for(i=0;i<this.layers.length;i++){if(this.layers[i].name=="_ui"){continue}if(this.layers[i].canvas!=null){var newCanvas=document.createElement("canvas");newCanvas.width=this.layers[i].canvas.width;newCanvas.height=this.layers[i].canvas.height;c=newCanvas.getContext("2d");c.drawImage(this.layers[i].canvas,0,0,newCanvas.width,newCanvas.height);l=new AV.Layer({canvas:newCanvas,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i]);newLayers.push(l)}else if(this.layers[i].image!=null){l=new AV.Layer({image:this.layers[i].image,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i]);newLayers.push(l)}}return newLayers};AV.PaintWidget.prototype.duplicateAllLayersFrom=function(src){var i,c;for(i=0;i<src.length;i++){if(src[i].name=="_ui"){continue}var existing=this.getLayerByName(src[i].name);if(existing===null){existing=new AV.Layer({name:src[i].name});this.layers.push(existing)}if(src[i].canvas!=null){if(existing.canvas==null){existing.canvas=document.createElement("canvas")}existing.drawable=existing.canvas;existing.canvas.width=src[i].canvas.width;existing.canvas.height=src[i].canvas.height;c=existing.canvas.getContext("2d");c.drawImage(src[i].canvas,0,0,src[i].canvas.width,src[i].canvas.height);this._dupLayerAttrs(existing,src[i])}else if(src[i].image!=null){existing.image=src[i].image;existing.drawable=existing.image;this._dupLayerAttrs(existing,src[i])}}};AV.PaintWidget.prototype.resizeAllLayers=function(width,height,rescaleImages){var i,c,l;var newLayers=[];var oldwidth=this.width,scale;this.setDimensions(width,height);for(i=0;i<this.layers.length;i++){if(this.layers[i].canvas!=null){var newCanvas=document.createElement("canvas");newCanvas.width=width;newCanvas.height=height;c=newCanvas.getContext("2d");c.drawImage(this.layers[i].canvas,0,0,width,height);l=new AV.Layer({canvas:newCanvas,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i])}else if(this.layers[i].image!=null){l=new AV.Layer({image:this.layers[i].image,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i])}if(l){if(rescaleImages&&(l.image||l.tag==="module_text")){scale=width/oldwidth;l.translateX*=scale;l.translateY*=scale;l.scaleX*=scale;l.scaleY*=scale}newLayers.push(l)}}this.layers=newLayers;this.recomposite()};AV.PaintWidget.prototype.resizeAllLayersQnD=function(width,height){var i;this.setDimensions(width,height);for(i=0;i<this.layers.length;i++){if(this.layers[i].canvas!=null){this.layers[i].canvas.width=width;this.layers[i].canvas.height=height}}};AV.PaintWidget.prototype.flattenAllLayers=function(){var uiLayer=this.getLayerByName("_ui");this.uiLayerShow(false);this.recomposite();this.layers.length=0;var newCanvas=document.createElement("canvas");newCanvas.width=this.canvas.width;newCanvas.height=this.canvas.height;var l=new AV.Layer({canvas:newCanvas,name:"background"});this.layers.push(l);if(uiLayer){this.layers.push(uiLayer)}var cc=newCanvas.getContext("2d");cc.drawImage(this.canvas,0,0)};AV.PaintWidget.prototype.cropAllLayers=function(x0,y0,width,height){var i,c,l,thislayer;var cropType;var newLayers=[];this.setDimensions(width,height);for(i=0;i<this.layers.length;i++){thislayer=this.layers[i];if(thislayer.canvas!=null){if(thislayer.tag=="module_text"){cropType="textcanvas"}else{cropType="canvas"}}else if(thislayer.image!=null){cropType="image"}else{continue}switch(cropType){case"canvas":var newCanvas=document.createElement("canvas");newCanvas.width=width;newCanvas.height=height;c=newCanvas.getContext("2d");c.drawImage(this.layers[i].canvas,-x0,-y0,this.layers[i].canvas.width,this.layers[i].canvas.height);l=new AV.Layer({canvas:newCanvas,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i]);newLayers.push(l);break;case"image":l=new AV.Layer({image:this.layers[i].image,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i]);l.translateX-=x0;l.translateY-=y0;newLayers.push(l);break;case"textcanvas":var newCanvas=document.createElement("canvas");c=newCanvas.getContext("2d");newCanvas.width=thislayer.canvas.width;newCanvas.height=thislayer.canvas.height;c.drawImage(this.layers[i].canvas,0,0);l=new AV.Layer({canvas:newCanvas,name:this.layers[i].name});this._dupLayerAttrs(l,this.layers[i]);l.translateX-=x0;l.translateY-=y0;newLayers.push(l);break}}this.layers=newLayers;this.recomposite()};AV.PaintWidget.prototype.module={};AV.PaintWidget.prototype.module["bulge"]=function(){var _paintWidget;var _radius=100;var _power=0;var api={};var _doDistort=function(dest,src,width,height,r,power){var r2=r*2;var rr=r*r;var distort;if(power>=0){distort=-power/120}else{distort=-power/200}var a=1-distort;var b=distort/r;var destIndex=0;for(var destY=0;destY<height;destY++){var deltaY=destY-r;var deltaYY=deltaY*deltaY;for(var destX=0;destX<width;destX++){var deltaX=destX-r;var deltaRR=deltaX*deltaX+deltaYY;if(deltaRR<rr){var deltaR=Math.sqrt(deltaRR);var scale=.999999/(a+b*deltaR);var srcX=deltaX*scale+r;var srcY=deltaY*scale+r;var iSrcX=srcX|0;var iSrcY=srcY|0;var hiFracX=srcX-iSrcX;var hiFracY=srcY-iSrcY;var loFracX=1-hiFracX;var loFracY=1-hiFracY;var srcIndex=(iSrcX+iSrcY*width)*4;var rTop=src[srcIndex]*loFracX+src[srcIndex+4]*hiFracX;var gTop=src[srcIndex+1]*loFracX+src[srcIndex+5]*hiFracX;var bTop=src[srcIndex+2]*loFracX+src[srcIndex+6]*hiFracX;var aTop=src[srcIndex+3]*loFracX+src[srcIndex+7]*hiFracX;srcIndex+=width*4;var rBot=src[srcIndex]*loFracX+src[srcIndex+4]*hiFracX;var gBot=src[srcIndex+1]*loFracX+src[srcIndex+5]*hiFracX;var bBot=src[srcIndex+2]*loFracX+src[srcIndex+6]*hiFracX;var aBot=src[srcIndex+3]*loFracX+src[srcIndex+7]*hiFracX;dest[destIndex++]=rTop*loFracY+rBot*hiFracY;dest[destIndex++]=gTop*loFracY+gBot*hiFracY;dest[destIndex++]=bTop*loFracY+bBot*hiFracY;dest[destIndex++]=aTop*loFracY+aBot*hiFracY}else{dest[destIndex]=src[destIndex];destIndex++;dest[destIndex]=src[destIndex];destIndex++;dest[destIndex]=src[destIndex];destIndex++;dest[destIndex]=src[destIndex];destIndex++}}}};var _getDistortedPixels=function(canvas,x,y,r,power){var width=r*2+1;var height=r*2+1;var pixels=AV.cnvs.getImageDataRegion(canvas,x-r,y-r,width,height,true);
var distorteds=canvas.getContext("2d").createImageData(width,height);_doDistort(distorteds.data,pixels.data,width,height,r,power);return distorteds};var _bulgeUndo=function(layerName,backing,x,y){var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,x,y);c.globalCompositeOperation="source-over";_paintWidget.recomposite()};var _bulgeRedo=function(layerName,x,y,r,power){var layer=_paintWidget.getLayerByName(layerName);var canvas=layer.canvas;var distorteds=_getDistortedPixels(canvas,x,y,r,power);AV.cnvs.putImageDataRegion(canvas,distorteds,x-r,y-r);_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget;_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true)};api.deactivate=function(){_paintWidget.uiLayerShow(false)};api.userUndo=function(){_paintWidget.uiLayerShow(false)};api.userRedo=function(){_paintWidget.uiLayerShow(false)};api.setRadius=function(r){_radius=r};api.setPower=function(p){_power=p};api.updateUI=function(x,y){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var canvas=layer.canvas;if(canvas==null){return}if(x<0||x>=canvas.width||y<0||y>=canvas.height){return}var r=_radius;var power=_power;var distorteds=_getDistortedPixels(canvas,x,y,r,power);_paintWidget.uiLayerShow(true);_paintWidget.uiLayerClear();AV.cnvs.putImageDataRegion(_paintWidget.getLayerByName("_ui").canvas,distorteds,x-r,y-r);_paintWidget.uiLayerDrawCircleSelection(x,y,r,true);_paintWidget.recomposite()};api.apply=function(x,y){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var canvas=layer.canvas;if(canvas==null){return}if(x<0||x>=canvas.width||y<0||y>=canvas.height){return}var x0=x-_radius;var y0=y-_radius;var wh=_radius*2+1;var backing=AV.cnvs.copyCanvas(canvas,x0,y0,wh,wh);_paintWidget.actions.push([_bulgeUndo,this,[layer.name,backing,x0,y0]],[_bulgeRedo,this,[layer.name,x,y,_radius,_power]],{action:"bulge",center:[x,y],radius:_radius,power:_power});_paintWidget.actions.redo();return _radius};return api}();AV.PaintWidget.prototype.module["flip"]=function(){var _paintWidget;var api={};var _flipRun=function(canvas,horizontal,vertical){var c=canvas.getContext("2d");var c2;if(horizontal){c2=AV.cnvs.copyCanvas(canvas);AV.cnvs.clearCanvas(canvas);c.setTransform(-1,0,0,1,canvas.width,0);c.drawImage(c2,0,0)}if(vertical){c2=AV.cnvs.copyCanvas(canvas);AV.cnvs.clearCanvas(canvas);c.setTransform(1,0,0,-1,0,canvas.height);c.drawImage(c2,0,0)}c.setTransform(1,0,0,1,0,0)};var _flipHV=function(horizontal,vertical,flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var oldLayers;if(layer.canvas==null){return}if(flatten){oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.actions.push([_flipUndo,this,[oldLayers]],[_flipRedo,this,[layer.name,horizontal,vertical,flatten]],{action:"flip",horizontal:horizontal,vertical:vertical,flatten:flatten})}else{_paintWidget.actions.push([_flipRedo,this,[layer.name,horizontal,vertical,flatten]],[_flipRedo,this,[layer.name,horizontal,vertical,flatten]],{action:"flip",horizontal:horizontal,vertical:vertical,flatten:flatten})}_paintWidget.actions.redo()};var _flipUndo=function(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _flipRedo=function(layerName,horizontal,vertical,flatten){if(flatten){_paintWidget.flattenAllLayers()}var layer=_paintWidget.getLayerByName(layerName);_flipRun(layer.canvas,horizontal,vertical);_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget};api.flip=function(horizontal,vertical,flatten){_flipHV(horizontal,vertical,flatten)};api.readAction=function(data,next){if(data&&(data.horizontal||data.vertical)){api.flip(data.horizontal,data.vertical,data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["desaturate"]=function(){var _paintWidget;var api={};var _desaturationRun=function(data){for(var i=0;i<data.length;i+=4){data[i]=data[i+1]=data[i+2]=(data[i]+data[i+1]+data[i+2])/3|0}};var _desaturateUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _desaturateRedo=function(layerName,flatten){if(flatten){_paintWidget.flattenAllLayers()}var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");var backing=c.getImageData(0,0,layer.canvas.width,layer.canvas.height);_paintWidget.showWaitThrobber(true,function(){_desaturationRun(backing.data);c.putImageData(backing,0,0);_paintWidget.recomposite();_paintWidget.showWaitThrobber(false)})};api.activate=function(paintWidget){_paintWidget=paintWidget};api.makeThumb=function(canvas){_paintWidget.makeThumbFlat(canvas);var cc=canvas.getContext("2d");var pixels=cc.getImageData(0,0,canvas.width,canvas.height);_desaturationRun(pixels.data);cc.putImageData(pixels,0,0)};api.desaturate=function(flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];if(layer.canvas==null){return}var backing=null;var oldLayers=null;if(flatten){oldLayers=_paintWidget.duplicateAllLayers()}else{backing=AV.cnvs.copyCanvas(layer.canvas)}_paintWidget.actions.push([_desaturateUndo,this,[layer.name,backing,oldLayers]],[_desaturateRedo,this,[layer.name,flatten]],{action:"desaturate",flatten:flatten});_paintWidget.actions.redo()};return api}();AV.PaintWidget.prototype.module["saturation"]=function(){var _paintWidget;var _satchange=0;var _origBacking,_origBackingPixels,_newCanvasData,_oldLayers,_flatten;var _dirty;var api={};var _saturationRun=function(dest,src,val){var i,r,g,b,rNew,gNew,bNew;var v=val;var R=.213*(1-v);var G=.715*(1-v);var B=.072*(1-v);for(i=0;4*i<src.length;i++){r=src[4*i];g=src[4*i+1];b=src[4*i+2];rNew=(R+v)*r+G*g+B*b+.5|0;gNew=R*r+(G+v)*g+B*b+.5|0;bNew=R*r+G*g+(B+v)*b+.5|0;r=rNew>255?255:rNew<0?0:rNew;g=gNew>255?255:gNew<0?0:gNew;b=bNew>255?255:bNew<0?0:bNew;dest[4*i]=r;dest[4*i+1]=g;dest[4*i+2]=b;dest[4*i+3]=src[4*i+3]}};var _saturation=function(layerName,val,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;var cc;cc=layer.canvas.getContext("2d");if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName);cc=layer.canvas.getContext("2d")}_origBackingPixels=AV.cnvs.getCanvasPixelData(layer.canvas);_origBacking=AV.cnvs.copyCanvas(layer.canvas);_newCanvasData=cc.createImageData(layer.canvas.width,layer.canvas.height)}_satchange=val;_flatten=flatten;_saturationRun(_newCanvasData.data,_origBackingPixels.data,val);cc.putImageData(_newCanvasData,0,0);_paintWidget.recomposite()};var _pushState=function(){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_saturationUndo,this,[layer.name,_origBacking,_oldLayers]],[_saturationRedo,this,[layer.name,_satchange,_flatten]],{action:"saturation",value:_satchange,flatten:_flatten});_paintWidget.actions.redoFake()};var _saturationUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _saturationRedo=function(layerName,val,flatten){_saturation(layerName,val,flatten);_origBacking=null;_oldLayers=null;_dirty=true};api.applyPreview=function(val,flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];AV.util.nextFrame(function(){if(!_dirty){_paintWidget.actions.undoFake()}else{_paintWidget.actions.undo();_dirty=false}_saturation(layer.name,val,flatten);_pushState()})};api.resetBacking=function(){_origBacking=null};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=_origBackingPixels=null;_newCanvasData=null;_oldLayers=null;_satchange=0;_flatten=false;_dirty=false};api.deactivate=function(){api.reset()};api.reset=function(){_origBacking=null;_origBackingPixels=null;_newCanvasData=null;_oldLayers=null};api.readAction=function(data,next){if(data&&data.value!==undefined){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_saturation(layer.name,data.value,data.flatten);_pushState()}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["brightness"]=function(){var _paintWidget;var _brightnessProcessor=null;var _contrastProcessor=null;var _origBacking,_oldLayers,_flatten;var _bri,_con;var _dirty;var api={};var _brightnessRun=function(dest,bri,con){_brightnessProcessor=_brightnessProcessor||AV.require("../../../src/js/processors/tools/brightness");_contrastProcessor=_contrastProcessor||AV.require("../../../src/js/processors/tools/contrast");if(bri!==0){if(_brightnessProcessor.brightness){_brightnessProcessor.brightness(dest,bri)}}else if(con!==0){if(_contrastProcessor.contrast){_contrastProcessor.contrast(dest,con)}}};var _brightness=function(layerName,bri,con,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName)}_origBacking=AV.cnvs.copyCanvas(layer.canvas)}var cc=layer.canvas.getContext("2d");var newPixels=AV.cnvs.getCanvasPixelData(_origBacking);_bri=bri;_con=con;_flatten=flatten;_brightnessRun(newPixels.data,bri,con);cc.putImageData(newPixels,0,0);_paintWidget.recomposite()};var _brightnessUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _brightnessRedo=function(layerName,bri,con,flatten){_brightness(layerName,bri,con,flatten);_origBacking=null;_oldLayers=null;_dirty=true};var _pushState=function(){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var actionName=_bri!==0?"brightness":"contrast";var value=_bri!==0?_bri:_con;_paintWidget.actions.push([_brightnessUndo,this,[layer.name,_origBacking,_oldLayers]],[_brightnessRedo,this,[layer.name,_bri,_con,_flatten]],{action:actionName,value:value,flatten:_flatten});_paintWidget.actions.redoFake()};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=null;_oldLayers=null;_bri=0;_con=0;_flatten=false;_dirty=false};api.deactivate=function(){api.reset();_brightnessProcessor=null;_contrastProcessor=null};api.applyPreview=function(bri,con,flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];AV.util.nextFrame(function(){if(!_dirty){_paintWidget.actions.undoFake()}else{_paintWidget.actions.undo();_dirty=false}_brightness(layer.name,bri,con,flatten);_pushState()})};api.resetBacking=function(){_origBacking=null};api.reset=function(){_origBacking=null;_oldLayers=null};api.readAction=function(data,next){if(data&&data.action&&data.value!==undefined){var bri=0,con=0;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];if(data.action=="brightness"){bri=data.value}else if(data.action=="contrast"){con=data.value}_brightness(layer.name,bri,con,data.flatten);_pushState()}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["contrast"]=AV.PaintWidget.prototype.module["brightness"];AV.PaintWidget.prototype.module["colors"]=function(){var _paintWidget;var _r=0,_g=0,_b=0,_origBacking,_oldLayers,_origBackingPixels,_newCanvasData,_flatten;var api={};var _calcmult=function(mult){mult+=100;mult=mult*.75+50;return mult/100};var _colorsUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _colorsRedo=function(layerName,r,g,b,flatten){_set(layerName,r,g,b,flatten);_origBacking=null;_oldLayers=null};var _set=function(layerName,r,g,b,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;var cc;var rmult,gmult,bmult;cc=layer.canvas.getContext("2d");if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName);cc=layer.canvas.getContext("2d")}_origBackingPixels=AV.cnvs.getCanvasPixelData(layer.canvas);_origBacking=AV.cnvs.copyCanvas(layer.canvas);_newCanvasData=cc.createImageData(layer.canvas.width,layer.canvas.height)}_r=r;_b=b;_g=g;_flatten=flatten;rmult=_calcmult(r);gmult=_calcmult(g);bmult=_calcmult(b);_paintWidget.showWaitThrobber(true,function(){for(i=0;i<_origBackingPixels.data.length;){_newCanvasData.data[i]=_origBackingPixels.data[i]*rmult|0;i++;_newCanvasData.data[i]=_origBackingPixels.data[i]*gmult|0;i++;_newCanvasData.data[i]=_origBackingPixels.data[i]*bmult|0;i++;_newCanvasData.data[i]=_origBackingPixels.data[i];i++}cc.putImageData(_newCanvasData,0,0);_paintWidget.recomposite();_paintWidget.showWaitThrobber(false)})};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=null;_newCanvasData=null;_oldLayers=null;_r=_g=_b=0;_flatten=false};api.deactivate=function(){api.reset()};api.set=function(r,g,b,flatten){_paintWidget.dirty=true;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_set(layer.name,r,g,b,flatten)};api.reset=function(){if(_oldLayers){_paintWidget.duplicateAllLayersFrom(_oldLayers);_paintWidget.recomposite()}else if(_origBacking){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(_origBacking,0,0);c.globalCompositeOperation="source-over";_paintWidget.recomposite()}_origBacking=null;_origBackingPixels=null;_newCanvasData=null;_oldLayers=null};api.commit=function(){if(_origBacking==null){return}var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_colorsUndo,this,[layer.name,_origBacking,_oldLayers]],[_colorsRedo,this,[layer.name,_r,_g,_b,_flatten]],{action:"colors",red:_r,green:_g,blue:_b,flatten:_flatten});_paintWidget.actions.redoFake();_origBacking=null;_origBackingPixels=null;_newCanvasData=null;_oldLayers=null};return api}();AV.PaintWidget.prototype.module["straighten"]=function(){var _paintWidget;var _bbox;var _lastBbox;var api={};var _drawSelection=function(angle){var x0,y0,x1,y1,w,h;var l=_paintWidget.getLayerByName("_ui");if(_bbox.x0<_bbox.x1){x0=_bbox.x0;x1=_bbox.x1}else{x0=_bbox.x1;x1=_bbox.x0}if(_bbox.y0<_bbox.y1){y0=_bbox.y0;y1=_bbox.y1}else{y0=_bbox.y1;y1=_bbox.y0}w=x1-x0;h=y1-y0;var c=l.canvas.getContext("2d");c.globalCompositeOperation="copy";c.clearRect(0,0,l.canvas.width,l.canvas.height);c.globalCompositeOperation="source-over";if(angle){var centerX=_paintWidget.width/2;var centerY=_paintWidget.height/2;c.translate(centerX,centerY);c.rotate(-angle);c.translate(-centerX,-centerY)}c.fillStyle="#000000";c.globalAlpha=.6;var overflow=l.canvas.width>l.canvas.height?l.canvas.width:l.canvas.height;overflow=.5*overflow|0;c.fillRect(-overflow,-overflow,x0+overflow,l.canvas.height+2*overflow);c.fillRect(x1,-overflow,l.canvas.width-x1+overflow,l.canvas.height+2*overflow);c.fillRect(x0,-overflow,x1-x0,y0+overflow);c.fillRect(x0,y1,x1-x0,l.canvas.height-y1+2*overflow)};var _straightenUndo=function(oldLayers,width,height){_paintWidget.setDimensions(width,height);_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _straightenRedo=function(angle,w,h,flatten){var i,c,l;var destCanvas;if(flatten){_paintWidget.flattenAllLayers()}if(angle){for(i=0;i<_paintWidget.layers.length;i++){l=_paintWidget.layers[i];if(l.canvas!=null){destCanvas=document.createElement("canvas");destCanvas.width=w;destCanvas.height=h;c=destCanvas.getContext("2d");c.setTransform(1,0,0,1,0,0);c.translate(w/2,h/2);c.rotate(angle);c.translate(-l.canvas.width/2,-l.canvas.height/2);c.globalCompositeOperation="copy";c.drawImage(l.canvas,0,0);c.globalCompositeOperation="source-over";l.canvas=l.drawable=destCanvas}}_paintWidget.cropAllLayers(0,0,w,h);_paintWidget.recomposite()}};var straightenRect=function(angle,angleInDegrees,w,h,flatten){var oldLayers=_paintWidget.duplicateAllLayers();var oldWidth=_paintWidget.width;var oldHeight=_paintWidget.height;_paintWidget.actions.push([_straightenUndo,api,[oldLayers,oldWidth,oldHeight]],[_straightenRedo,api,[angle,w,h,flatten]],[{action:"rotate",angle:angleInDegrees,width:w,height:h,flatten:flatten},{action:"setfeathereditsize",width:w,height:h}],_paintWidget.c2a(w,h,true));_paintWidget.actions.redo()};api.activate=function(paintWidget){_paintWidget=paintWidget;_bbox=new AV.Bbox;_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true)};api.deactivate=function(){_paintWidget.uiLayerShow(false);_bbox=null};api.reset=function(){_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true);_paintWidget.recomposite()};api.set=function(angle){var w=_paintWidget.width;var h=_paintWidget.height;var centerX=w/2;var centerY=h/2;var x0=0;var x1=w;var y0=0;var y1=h;_bbox.x0=x0;_bbox.x1=x1;_bbox.y0=y0;_bbox.y1=y1;if(angle){var i;var cosa=Math.cos(angle);var sina=Math.sin(angle);var cosa_rev=Math.cos(-angle);var sina_rev=Math.sin(-angle);var x00=centerX+cosa*(x0-centerX)+sina*(y0-centerY);var x01=centerX+cosa*(x0-centerX)+sina*(y1-centerY);var x10=centerX+cosa*(x1-centerX)+sina*(y0-centerY);var x11=centerX+cosa*(x1-centerX)+sina*(y1-centerY);var y00=centerY+sina*-(x0-centerX)+cosa*(y0-centerY);var y01=centerY+sina*-(x0-centerX)+cosa*(y1-centerY);var y10=centerY+sina*-(x1-centerX)+cosa*(y0-centerY);var y11=centerY+sina*-(x1-centerX)+cosa*(y1-centerY);var rectEdges=[[x00,y00,x10,y10],[x10,y10,x11,y11],[x11,y11,x01,y01],[x01,y01,x00,y00]];var testLine1=[0,0,w,h];var testLine2=[w,0,0,h];var intersections=[];var addIntersectionPoint=function(p){var pox=centerX+cosa_rev*(p.x-centerX)+sina_rev*(p.y-centerY);var poy=centerY+sina_rev*-(p.x-centerX)+cosa_rev*(p.y-centerY);pox=pox|0;poy=poy|0;if(_bbox.contains(pox,poy)){intersections.push({x:p.x,y:p.y})}};for(i=0;i<rectEdges.length;i++){var l=rectEdges[i];var p={};if(AV.math.lineSegmentIntersection(l[0],l[1],l[2],l[3],testLine1[0],testLine1[1],testLine1[2],testLine1[3],p)){addIntersectionPoint(p)}if(AV.math.lineSegmentIntersection(l[0],l[1],l[2],l[3],testLine2[0],testLine2[1],testLine2[2],testLine2[3],p)){addIntersectionPoint(p)}}for(i=0;i<intersections.length;i++){var p=intersections[i];if(p.y>centerY){if(p.y<_bbox.y1)_bbox.y1=p.y}else{if(p.y>_bbox.y0)_bbox.y0=p.y}if(p.x>centerX){if(p.x<_bbox.x1)_bbox.x1=p.x}else{if(p.x>_bbox.x0)_bbox.x0=p.x}}}_paintWidget.uiLayerReset();_paintWidget.uiLayerShow(true);_drawSelection(angle);_paintWidget.recomposite();_lastBbox=_bbox;var straightenedWidth=_bbox.x1-_bbox.x0;return straightenedWidth?_paintWidget.width/straightenedWidth:1};api.commit=function(angle,angleInDegrees,flatten){_lastBbox=_lastBbox||_bbox;var x0=_lastBbox.x0+.5|0;var y0=_lastBbox.y0+.5|0;var x1=_lastBbox.x1+.5|0;var y1=_lastBbox.y1+.5|0;var w=x1-x0;var h=y1-y0;straightenRect(angle,angleInDegrees,w,h,flatten);_paintWidget.uiLayerShow(false)};api.readAction=function(data,next){var angle,angleInDegrees;if(data&&data.angle&&data.width&&data.height){angleInDegrees=data.angle;angle=angleInDegrees*Math.PI/180;straightenRect(angle,angleInDegrees,data.width,data.height,data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["rotate90"]=function(){var _paintWidget;var api={};var _rotate90Undo=function(oldLayers,width,height){_paintWidget.setDimensions(width,height);_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _rotate90Redo=function(angle,flatten){if(flatten){_paintWidget.flattenAllLayers()}_paintWidget.rotate90(angle)};api.activate=function(paintWidget){_paintWidget=paintWidget},api.rotate90=function(a,flatten){var oldLayers;var width;var height;var wh=_paintWidget.getScaledSize();var swappedWH=null;if(wh){swappedWH={width:wh.height,height:wh.width,hiresWidth:wh.hiresHeight,hiresHeight:wh.hiresWidth}}if(flatten){oldLayers=_paintWidget.duplicateAllLayers();width=_paintWidget.width;height=_paintWidget.height;_paintWidget.actions.push([_rotate90Undo,this,[oldLayers,width,height]],[_rotate90Redo,this,[a,flatten]],{action:"rotate90",angle:a,flatten:flatten},swappedWH)}else{_paintWidget.actions.push([_rotate90Redo,this,[-a,flatten]],[_rotate90Redo,this,[a,flatten]],{action:"rotate90",angle:a,flatten:flatten},swappedWH)}_paintWidget.actions.redo()};api.readAction=function(data,next){if(data&&data.angle){api.rotate90(data.angle,data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["resize"]=function(){var _paintWidget;var api={};var _resizeUndo=function(oldLayers,oldWidth,oldHeight){_paintWidget.setDimensions(oldWidth,oldHeight);_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _resizeRedo=function(width,height){_paintWidget.resizeAllLayers(width,height,true);_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget};api.resize=function(width,height,flatten){var oldLayers=_paintWidget.duplicateAllLayers(),localDims,oldWidth,oldHeight;if(flatten){_paintWidget.flattenAllLayers()}width=width+.5|0;height=height+.5|0;if(AV.controlsWidgetInstance){localDims=AV.controlsWidgetInstance.getScaledDims(width,height)}else{localDims={width:width,height:height}}oldWidth=_paintWidget.canvas.width;oldHeight=_paintWidget.canvas.height;_paintWidget.actions.push([_resizeUndo,this,[oldLayers,oldWidth,oldHeight]],[_resizeRedo,this,[localDims.width,localDims.height]],[{action:"resize",size:[width,height]},{action:"setfeathereditsize",width:localDims.width,height:localDims.height}],_paintWidget.a2c(width,height,true));_paintWidget.actions.redo()};api.readAction=function(data,next){if(data&&data.size&&data.size.length){api.resize(data.size[0],data.size[1],data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["crop"]=function(){var _paintWidget;var api={};var _cropUndo=function(oldLayers,oldWidth,oldHeight){_paintWidget.setDimensions(oldWidth,oldHeight);_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _cropRedo=function(x,y,w,h){_paintWidget.cropAllLayers(x,y,w,h);_paintWidget.recomposite()};var cropRect=function(x,y,w,h){var oldLayers=_paintWidget.duplicateAllLayers();var oldWidth=_paintWidget.canvas.width;var oldHeight=_paintWidget.canvas.height;var cropAction={action:"crop",upperleftpoint:[x,y],size:[w,h]};_paintWidget.actions.push([_cropUndo,api,[oldLayers,oldWidth,oldHeight]],[_cropRedo,api,[x,y,w,h]],[cropAction,{action:"setfeathereditsize",width:w,height:h}],_paintWidget.c2a(w,h,true));_paintWidget.actions.redo()};api.activate=function(paintWidget){_paintWidget=paintWidget};api.crop=function(bbox){bbox=bbox||new AV.Bbox;_paintWidget.uiLayerShow(false);var x0,y0,x1,y1,w,h;if(bbox.x0<bbox.x1){x0=bbox.x0;x1=bbox.x1}else{x0=bbox.x1;x1=bbox.x0}if(bbox.y0<bbox.y1){y0=bbox.y0;y1=bbox.y1}else{y0=bbox.y1;y1=bbox.y0}var l=_paintWidget.getLayerByName("_ui");if(x0<0){x0=0}if(y0<0){y0=0}if(x1>l.canvas.width){x1=l.canvas.width}if(y1>l.canvas.height){y1=l.canvas.height}w=x1-x0;h=y1-y0;cropRect(x0,y0,w,h)};api.readAction=function(data,next){if(data&&data.size&&data.upperleftpoint){cropRect(data.upperleftpoint[0],data.upperleftpoint[1],data.size[0],data.size[1])}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["overlay"]=function(){var _paintWidget;var api={};var _hideOverlay=function(name){var i=_paintWidget.findLayerIndexByName(name);if(i!=-1){_paintWidget.layerDelete(i)}_paintWidget.recomposite()};var _showOverlay=function(name,element,tx,ty,sx,sy,rot){var l=new AV.Layer({name:name,image:element});l.tag="module_overlay";l.centerX=l.drawable.width/2+.5|0;l.centerY=l.drawable.height/2+.5|0;if(rot!=null){l.translateX=tx;l.translateY=ty;l.rotate=rot;l.scaleX=sx;l.scaleY=sy}else{l.translateX=_paintWidget.width/2+.5|0;l.translateY=_paintWidget.height/2+.5|0}_paintWidget.layers.push(l);_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget};api.addOverlay=function(name,url,x,y,sx,sy,rot){var randId;if(!name){randId=Math.floor(Math.random()*4294967295).toString(16);name="_module_overlay-"+randId}var element=_paintWidget.overlayRegistry.getElement(url);var hiresurl=_paintWidget.overlayRegistry.getHiRes(url);var args=[name,element,x,y,sx,sy,rot];_paintWidget.actions.push([_hideOverlay,this,[name]],[_showOverlay,this,args],{action:"addsticker",url:hiresurl||url,id:name,center:[x,y],scale:[sx,sy],rotation:rot,external:hiresurl?1:0,size:[element.width,element.height],urls:[url,hiresurl]});_paintWidget.actions.redo();return name};api.readAction=function(data,next){var url,hiresurl,x,y,scaleX,scaleY;if(data&&data.url){if(data.center&&data.center.length){x=data.center[0];y=data.center[1]}if(data.scale&&data.scale.length){scaleX=data.scale[0];scaleY=data.scale[1]}if(data.urls&&data.urls.length){url=data.urls[0];hiresurl=data.urls[1]}else{url=data.url;hiresurl=data.url}_paintWidget.overlayRegistry.add(url,hiresurl);_paintWidget.overlayRegistry.getElement(url,function(){api.addOverlay("",url,x,y,scaleX,scaleY,data.rotation);if(next){next.call(this)}})}else{if(next){next.call(this)}}};return api}();AV.PaintWidget.prototype.module["effects"]=function(){var _paintWidget;var _proclistManager=null;var _filterCancelled=false;var _origBacking,_oldLayers;var _dirty;var api={};var _filter=function(layerName,id,filterParams,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}if(!_origBacking){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName)}_origBacking=AV.cnvs.copyCanvas(layer.canvas)}var canvas=layer.canvas;var cc=canvas.getContext("2d");var origBackingPixels=AV.cnvs.getCanvasPixelData(_origBacking);var newPixels=AV.cnvs.getCanvasPixelData(_origBacking);_proclistManager=_proclistManager||AV.require("./MoaLiteProclistManager");_proclistManager.MLPLRunEffect(_paintWidget.filterManager.getEffectById(id),newPixels,filterParams);cc.putImageData(newPixels,0,0);_paintWidget.recomposite()};var _pushState=function(filterData){var hiResData,effect;if(filterData){effect=_paintWidget.filterManager.getEffectById(filterData.filterName);hiResData={action:"effects",jsonstring:AV.JSON.stringify(effect),name:filterData.filterName,flatten:filterData.flatten};hiResData=AV.util?AV.util.extend(hiResData,filterData.filterParams):hiResData;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_filterUndo,this,[layer.name,_origBacking,_oldLayers]],[_filterRedo,this,[layer.name,filterData.filterName,filterData.filterParams,filterData.flatten]],hiResData);_paintWidget.actions.redoFake()}};var _filterUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _filterRedo=function(layerName,filterName,filterParams,flatten){_filter(layerName,filterName,filterParams,flatten);_origBacking=null;_oldLayers=null;_dirty=true};api.activate=function(paintWidget){_filterCancelled=false;_paintWidget=paintWidget;_dirty=false};api.deactivate=function(){if(_paintWidget.busy){_filterCancelled=true;_paintWidget.actions.undoFake();_paintWidget.busy=false}_origBacking=null;_oldLayers=null;_proclistManager=null};api.makeThumb=function(id,canvas){_paintWidget.makeThumbFlat(canvas);var width=canvas.width;var height=canvas.height;var cc=canvas.getContext("2d");var pixels=cc.getImageData(0,0,width,height);_proclistManager=_proclistManager||AV.require("./MoaLiteProclistManager");var effect=_paintWidget.filterManager.getEffectById(id);if(effect){_proclistManager.MLPLRunEffect(effect,pixels)}cc.putImageData(pixels,0,0)};api.applyPreview=function(id,filterParams,flatten){if(!_dirty){_paintWidget.actions.undoFake()}else{_paintWidget.actions.undo();_dirty=false}_paintWidget.dirty=true;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];if(layer.canvas==null){return}_filter(layer.name,id,filterParams,flatten);_pushState({filterName:id,filterParams:filterParams,flatten:flatten})};api.readAction=function(data,next){if(data&&data.name){api.applyPreview(data.name,data,data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["enhance"]=function(){var _paintWidget;var _processor=null;var _filterCancelled=false;var _origBacking,_oldLayers;var _dirty;var api={};var _filter=function(layerName,id,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}if(!_origBacking){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName)}_origBacking=AV.cnvs.copyCanvas(layer.canvas)}var canvas=layer.canvas;var cc=canvas.getContext("2d");var newPixels=AV.cnvs.getCanvasPixelData(_origBacking);_processor=_processor||AV.require("../../../src/js/processors/tools/enhance");if(_processor[id]){_processor[id](newPixels.data,canvas.width,canvas.height)}cc.putImageData(newPixels,0,0);_paintWidget.recomposite()};var _pushState=function(id,flatten){var hiResData={action:"effects",name:id,flatten:flatten};var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_filterUndo,this,[layer.name,_origBacking,_oldLayers]],[_filterRedo,this,[layer.name,id,flatten]],hiResData);_paintWidget.actions.redoFake()};var _filterUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _filterRedo=function(layerName,filterName,filterParams,flatten){_filter(layerName,filterName,filterParams,flatten);_origBacking=null;_oldLayers=null;_dirty=true};api.activate=function(paintWidget){_filterCancelled=false;_paintWidget=paintWidget;_dirty=false};api.deactivate=function(){if(_paintWidget.busy){_filterCancelled=true;_paintWidget.actions.undoFake();_paintWidget.busy=false}_origBacking=null;_oldLayers=null;_processor=null};api.applyPreview=function(id,flatten){if(!_dirty){_paintWidget.actions.undoFake()}else{_paintWidget.actions.undo();_dirty=false}_paintWidget.dirty=true;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];if(layer.canvas==null){return}_filter(layer.name,id,flatten);_pushState(id,flatten)};api.readAction=function(data,next){if(data&&data.id){api.applyPreview(data.id,data.flatten)}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["flatten"]=function(){var _paintWidget;var api={};var _flattenUndo=function(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers);_paintWidget.recomposite()};var _flattenRedo=function(width,height){_paintWidget.flattenAllLayers();_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget
};api.flatten=function(){var oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.actions.push([_flattenUndo,this,[oldLayers]],[_flattenRedo,this,[]],{action:"flatten"},null,{implicit:true});_paintWidget.actions.redo()};return api}();AV.PaintWidget.prototype.module["textwithfont"]=function(){var _TEXT_OUTLINE_FRACTION=1/12;var _paintWidget;var _outlineColor;var api={};var _textWidth=function(str,fontInfo){var lines=str.split("\n");var cc=_paintWidget.canvas.getContext("2d");var oldFont=cc.font;cc.font=fontInfo;var longest=0;var tm;var i;var pad=cc.measureText("W").width;for(i=0;i<lines.length;i++){tm=cc.measureText(lines[i]);var w=tm.width;if(w>longest){longest=w}}cc.font=oldFont;return longest+pad};var _textHeight=function(str,lineHeightPx){var lines=str.split("\n");return lineHeightPx*lines.length};var _textUndo=function(layername){var i=_paintWidget.findLayerIndexByName(layername);if(i>=0){_paintWidget.layerDelete(i);_paintWidget.recomposite()}};var _textRedo=function(name,str,fontName,fontStyle,fontSizePx,lineHeightPx,fontColor,outlineColor,opacity,x,y,rot){var fontInfo=(fontStyle?fontStyle+" ":"")+fontSizePx+"px "+fontName;var w=_textWidth(str,fontInfo);var h=_textHeight(str,lineHeightPx);var shadowWidth;opacity=opacity||1;var newCanvas=document.createElement("canvas");newCanvas.width=w;var drawPadding=fontSizePx;newCanvas.height=h+drawPadding*2;var l=new AV.Layer({canvas:newCanvas,name:name});l.tag="module_text";l.centerX=l.drawable.width/2+.5|0;l.centerY=l.drawable.height/2+.5|0;if(rot==null){l.rotate=0}else{l.rotate=rot}l.scaleX=1;l.scaleY=1;if(x==null){l.translateX=_paintWidget.width/2+.5|0;l.translateY=_paintWidget.height/2+.5|0}else{l.translateX=x;l.translateY=y}l.alpha=opacity;_paintWidget.layers.push(l);var cc=newCanvas.getContext("2d");cc.font=fontInfo;cc.textAlign="center";cc.textBaseline="bottom";cc.fillStyle=fontColor;cc.globalAlpha=1;var xpos=l.canvas.width/2+.5|0;var ypos=lineHeightPx+drawPadding;var lines=str.split("\n");var i;for(i=0;i<lines.length;i++){if(outlineColor){cc.strokeStyle=outlineColor;cc.lineWidth=fontSizePx*_TEXT_OUTLINE_FRACTION;cc.strokeText(lines[i],xpos,ypos)}cc.fillText(lines[i],xpos,ypos);ypos+=lineHeightPx}_paintWidget.recomposite()};api.activate=function(paintWidget){_paintWidget=paintWidget};api.deactivate=function(){};api.newText=function(str,font,fontSizePx,lineHeight,fontColor,outlineColor,opacity,x,y,rot){if(str==""){return}opacity=opacity||1;var randId=Math.floor(Math.random()*4294967295).toString(16);var name="_module_text-"+randId;if(!rot){rot=0}if(!x){x=_paintWidget.width/2+.5|0;y=_paintWidget.height/2+.5|0}var args;args=[name,str,font.value,font.style,fontSizePx,lineHeight,fontColor,outlineColor,opacity,x,y,rot];_paintWidget.actions.push([_textUndo,this,[name]],[_textRedo,this,args],{action:"addtext",id:name,text:str,font:font.label,size:fontSizePx,align:"center",color:AV.util.color_to_rgb(fontColor),outlinecolor:outlineColor?AV.util.color_to_rgb(outlineColor):undefined,center:[x,y],scale:[1,1],intensity:opacity,rotation:rot});_paintWidget.actions.redo();_paintWidget.recomposite()};api.readAction=function(data,next){var font,i,len,fonts;if(data&&data.text&&data.font&&AV.toolDefaults.textwithfont.presetsFont&&AV.util.addFontToPage&&AV.WebFont){fonts=AV.toolDefaults.textwithfont.presetsFont;len=fonts.length;for(i=0;i<len;i++){if(fonts[i].label===data.font){font=fonts[i];break}}AV.util.addFontToPage(font,function(font){var x,y,scaleX,scaleY;if(font){if(data.center&&data.center.length){x=data.center[0];y=data.center[1]}api.newText(data.text,font,data.size,data.size,data.color,data.outlinecolor,data.intensity,x,y,data.rotation)}if(next){next.call(this)}})}else if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["barrel"]=function(){var _paintWidget;var _origBacking,_origBackingPixels,_oldLayers,_flatten;var _newCanvasData;var _barrelchange=0;var api={};var _barrelRun=function(dest,src,width,height,val){if(val==0){var i;for(i=0;i<src.length;i++){dest[i]=src[i]}return}var centerX=(width-1)/2;var centerY=(height-1)/2;var extentX=centerX;var extentY=centerY;var cornerR2=extentX*extentX+extentY*extentY;var cornerR=Math.sqrt(cornerR2);var srcExtent;if(val>0){var degree=Math.pow(val/100,2)*8;srcExtent=cornerR}else{var degree=-Math.sqrt(-val/100)*.34;srcExtent=Math.min(extentY,extentX)}var dstExtent=AV.math.lowestPositiveQuadratic(degree/cornerR,1,-srcExtent);var scale=dstExtent/srcExtent*.999999;var destX;var destY;for(destY=0;destY<height;destY++){var destDy=scale*(destY-centerY);for(destX=0;destX<width;destX++){var destDx=scale*(destX-centerX);var destR2=destDx*destDx+destDy*destDy;var ratio=1+degree*Math.sqrt(destR2)/cornerR;var srcX=destDx*ratio+centerX;var srcY=destDy*ratio+centerY;var iSrcX=srcX|0;var iSrcY=srcY|0;var hiFracX=srcX-iSrcX;var hiFracY=srcY-iSrcY;var loFracX=1-hiFracX;var loFracY=1-hiFracY;var srcIndex=(iSrcX+iSrcY*width)*4;var rTop=src[srcIndex]*loFracX+src[srcIndex+4]*hiFracX;var gTop=src[srcIndex+1]*loFracX+src[srcIndex+5]*hiFracX;var bTop=src[srcIndex+2]*loFracX+src[srcIndex+6]*hiFracX;var aTop=src[srcIndex+3]*loFracX+src[srcIndex+7]*hiFracX;srcIndex+=width*4;var rBot=src[srcIndex]*loFracX+src[srcIndex+4]*hiFracX;var gBot=src[srcIndex+1]*loFracX+src[srcIndex+5]*hiFracX;var bBot=src[srcIndex+2]*loFracX+src[srcIndex+6]*hiFracX;var aBot=src[srcIndex+3]*loFracX+src[srcIndex+7]*hiFracX;var destIndex=(destX+destY*width)*4;dest[destIndex]=rTop*loFracY+rBot*hiFracY;dest[destIndex+1]=gTop*loFracY+gBot*hiFracY;dest[destIndex+2]=bTop*loFracY+bBot*hiFracY;dest[destIndex+3]=aTop*loFracY+aBot*hiFracY}}};var _barrel=function(layerName,val,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;var cc;cc=layer.canvas.getContext("2d");if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName);cc=layer.canvas.getContext("2d")}_origBackingPixels=AV.cnvs.getCanvasPixelData(layer.canvas);_origBacking=AV.cnvs.copyCanvas(layer.canvas);_newCanvasData=cc.createImageData(layer.canvas.width,layer.canvas.height)}_barrelchange=val;_flatten=flatten;_paintWidget.showWaitThrobber(true,function(){_barrelRun(_newCanvasData.data,_origBackingPixels.data,_origBackingPixels.width,_origBackingPixels.height,val);cc.putImageData(_newCanvasData,0,0);_paintWidget.recomposite();_paintWidget.showWaitThrobber(false)})};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=null;_newCanvasData=null;_oldLayers=null;_barrelchange=0;_flatten=false};var _barrelUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _barrelRedo=function(layerName,val,flatten){_barrel(layerName,val,flatten);_origBacking=null;_oldLayers=null};api.deactivate=function(){api.reset()};api.set=function(val,flatten){_paintWidget.dirty=true;var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_barrel(layer.name,val,flatten)};api.makeThumb=function(canvas,val){_paintWidget.makeThumbFlat(canvas);var cc=canvas.getContext("2d");var pixels=cc.getImageData(0,0,canvas.width,canvas.height);var newPixels=cc.createImageData(canvas.width,canvas.height);_barrelRun(newPixels.data,pixels.data,pixels.width,pixels.height,val);cc.putImageData(newPixels,0,0)};api.reset=function(){if(_oldLayers){_paintWidget.duplicateAllLayersFrom(_oldLayers);_paintWidget.recomposite()}else if(_origBacking){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(_origBacking,0,0);c.globalCompositeOperation="source-over";_paintWidget.recomposite()}_origBacking=null;_origBackingPixels=null;_newCanvasData=null;_oldLayers=null};api.commit=function(){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_barrelUndo,this,[layer.name,_origBacking,_oldLayers]],[_barrelRedo,this,[layer.name,_barrelchange,_flatten]],{action:"barrel",value:_barrelchange,flatten:_flatten});_paintWidget.actions.redoFake();_origBacking=null;_origBackingPixels=null;_newCanvasData=null;_oldLayers=null};return api}();AV.PaintWidget.prototype.module["sharpen"]=function(){var _paintWidget;var _origBacking,_oldLayers,_flatten;var _processor=null;var _sharpenchange=0;var api={};var _sharpenRun=function(dest,width,height,val){_processor=_processor||AV.require("../../../src/js/processors/sharpness");if(_processor.sharpen){_processor.sharpen(dest,width,height,val,1,"normal")}};var _sharpen=function(layerName,val,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;var cc;if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName)}_origBacking=AV.cnvs.copyCanvas(layer.canvas)}cc=layer.canvas.getContext("2d");var newPixels=AV.cnvs.getCanvasPixelData(layer.canvas);_sharpenchange=val;_flatten=flatten;_sharpenRun(newPixels.data,layer.canvas.width,layer.canvas.height,val);cc.putImageData(newPixels,0,0);_paintWidget.recomposite()};var _pushState=function(){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_sharpenUndo,this,[layer.name,_origBacking,_oldLayers]],[_sharpenRedo,this,[layer.name,_sharpenchange,_flatten]],{action:"tools",toolname:"sharpness",value:_sharpenchange});_paintWidget.actions.redoFake()};var _sharpenUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _sharpenRedo=function(layerName,val,flatten){_sharpen(layerName,val,flatten);_origBacking=null;_oldLayers=null};api.resetBacking=function(){_origBacking=null};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=null;_newCanvasData=null;_oldLayers=null;_sharpenchange=0;_flatten=false};api.deactivate=function(){_origBacking=null;_newCanvasData=null;_oldLayers=null;_processor=null};api.applyPreview=function(val,flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.showWaitThrobber(true,function(){_paintWidget.actions.undo();_sharpen(layer.name,val,flatten);_paintWidget.showWaitThrobber(false);_pushState()})};api.reset=function(){if(_oldLayers){_paintWidget.duplicateAllLayersFrom(_oldLayers);_paintWidget.recomposite()}else if(_origBacking){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(_origBacking,0,0);c.globalCompositeOperation="source-over";_paintWidget.recomposite()}_origBacking=null;_newCanvasData=null;_oldLayers=null};api.readAction=function(data,next){if(data&&data.value!==undefined){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_sharpen(layer.name,data.value,data.flatten);_paintWidget.showWaitThrobber(false);_pushState()}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["warmth"]=function(){var _paintWidget;var _processor=null;var _origBacking,_oldLayers,_flatten;var _warmthChange=0;var _dirty;var api={};var _warmth=function(layerName,val,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}var i;var cc;if(_origBacking==null){if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.getLayerByName(layerName)}_origBacking=AV.cnvs.copyCanvas(layer.canvas)}var cc=layer.canvas.getContext("2d");var newPixels=AV.cnvs.getCanvasPixelData(_origBacking);_warmthChange=val;_flatten=flatten;_processor=_processor||AV.require("../../../src/js/processors/tools/colortemp");if(_processor.colortemp){_processor.colortemp(newPixels.data,_warmthChange)}cc.putImageData(newPixels,0,0);_paintWidget.recomposite()};var _warmthUndo=function(layerName,backing,oldLayers){if(oldLayers){_paintWidget.duplicateAllLayersFrom(oldLayers)}else{var layer=_paintWidget.getLayerByName(layerName);var c=layer.canvas.getContext("2d");c.globalCompositeOperation="copy";c.drawImage(backing,0,0);c.globalCompositeOperation="source-over"}_paintWidget.recomposite()};var _warmthRedo=function(layerName,val,flatten){_warmth(layerName,val,flatten);_origBacking=null;_oldLayers=null;_dirty=true};var _pushState=function(){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_paintWidget.actions.push([_warmthUndo,this,[layer.name,_origBacking,_oldLayers]],[_warmthRedo,this,[layer.name,_warmthChange,_flatten]],{action:"colortemp",value:_warmthChange,flatten:_flatten});_paintWidget.actions.redoFake()};api.activate=function(paintWidget){_paintWidget=paintWidget;_origBacking=null;_oldLayers=null;_warmthChange=0;_flatten=false;_dirty=false};api.deactivate=function(){api.reset();_processor=null};api.applyPreview=function(val,flatten){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];AV.util.nextFrame(function(){if(!_dirty){_paintWidget.actions.undoFake()}else{_paintWidget.actions.undo();_dirty=false}_warmth(layer.name,val,flatten);_pushState()})};api.resetBacking=function(){_origBacking=null};api.reset=function(){_origBacking=null;_oldLayers=null};api.readAction=function(data,next){if(data&&data.value!==undefined){var layerIndex=_paintWidget.currentLayerIndex;var layer=_paintWidget.layers[layerIndex];_warmth(layer.name,data.value,data.flatten);_pushState()}if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["frames"]=function(){var _paintWidget;var _layerName;var _dirty;var api={};var _tileBorderApply=function(canvas,tiles,borderSize){var context=canvas.getContext("2d");var w=canvas.width;var h=canvas.height;var i;var xPosLastEnd,yPosLastEnd;var xPos,yPos;var goalPos,drawHeight,drawWidth;var avgBorderWidth=(tiles.l.w+tiles.t.h+tiles.r.w+tiles.b.h)/4;var leftWidth=borderSize*Math.min(w,h)*(tiles.l.w/avgBorderWidth);var rightWidth=borderSize*Math.min(w,h)*(tiles.r.w/avgBorderWidth);var topHeight=borderSize*Math.min(w,h)*(tiles.t.h/avgBorderWidth);var bottomHeight=borderSize*Math.min(w,h)*(tiles.b.h/avgBorderWidth);var leftHeight=leftWidth*(tiles.l.h/tiles.l.w);var rightHeight=rightWidth*(tiles.r.h/tiles.r.w);var topWidth=topHeight*(tiles.t.w/tiles.t.h);var bottomWidth=bottomHeight*(tiles.b.w/tiles.b.h);var leftWidthRound=Math.round(leftWidth);var rightWidthRound=Math.round(rightWidth);var topHeightRound=Math.round(topHeight);var bottomHeightRound=Math.round(bottomHeight);var nLeft=Math.max(1,Math.round((h-topHeight-bottomHeight)/leftHeight));var nRight=Math.max(1,Math.round((h-topHeight-bottomHeight)/rightHeight));var nTop=Math.max(1,Math.round((w-leftWidth-rightWidth)/topWidth));var nBottom=Math.max(1,Math.round((w-leftWidth-rightWidth)/bottomWidth));var leftHeight=(h-topHeight-bottomHeight)/nLeft;var rightHeight=(h-topHeight-bottomHeight)/nRight;var topWidth=(w-leftWidth-rightWidth)/nTop;var bottomWidth=(w-leftWidth-rightWidth)/nBottom;context.setTransform(leftWidthRound/tiles.tl.w,0,0,topHeightRound/tiles.tl.h,0,0);context.drawImage(tiles.tl.img,0,0);context.setTransform(rightWidthRound/tiles.tr.w,0,0,topHeightRound/tiles.tr.h,w-rightWidthRound,0);context.drawImage(tiles.tr.img,0,0);context.setTransform(rightWidthRound/tiles.br.w,0,0,bottomHeightRound/tiles.br.h,w-rightWidthRound,h-bottomHeightRound);context.drawImage(tiles.br.img,0,0);context.setTransform(leftWidthRound/tiles.bl.w,0,0,bottomHeightRound/tiles.bl.h,0,h-bottomHeightRound);context.drawImage(tiles.bl.img,0,0);yPosLastEnd=topHeightRound;xPos=0;for(i=0;i<nLeft;i++){goalPos=topHeight+i*leftHeight;yPos=yPosLastEnd;drawHeight=Math.round(goalPos-yPos+leftHeight);context.setTransform(leftWidthRound/tiles.l.w,0,0,drawHeight/tiles.l.h,xPos,yPos);context.drawImage(tiles.l.img,0,0);yPosLastEnd=yPos+drawHeight}xPosLastEnd=leftWidthRound;yPos=0;for(i=0;i<nTop;i++){goalPos=leftWidth+i*topWidth;xPos=xPosLastEnd;drawWidth=Math.round(goalPos-xPos+topWidth);context.setTransform(drawWidth/tiles.t.w,0,0,topHeightRound/tiles.t.h,xPos,yPos);context.drawImage(tiles.t.img,0,0);xPosLastEnd=xPos+drawWidth}yPosLastEnd=topHeightRound;xPos=w-rightWidthRound;for(i=0;i<nRight;i++){goalPos=topHeight+i*rightHeight;yPos=yPosLastEnd;drawHeight=Math.round(goalPos-yPos+rightHeight);context.setTransform(rightWidthRound/tiles.r.w,0,0,drawHeight/tiles.r.h,xPos,yPos);context.drawImage(tiles.r.img,0,0);yPosLastEnd=yPos+drawHeight}xPosLastEnd=leftWidthRound;yPos=h-bottomHeightRound;for(i=0;i<nBottom;i++){goalPos=leftWidth+i*bottomWidth;xPos=xPosLastEnd;drawWidth=Math.round(goalPos-xPos+bottomWidth);context.setTransform(drawWidth/tiles.b.w,0,0,bottomHeightRound/tiles.b.h,xPos,yPos);context.drawImage(tiles.b.img,0,0);xPosLastEnd=xPos+drawWidth}context.setTransform(1,0,0,1,0,0);_paintWidget.recomposite()};var _tileBorder=function(canvas,frameName,borderSize){_paintWidget.imageBorderManager.tileBorder(frameName,function(tilesObj){var knownBorderSizes={border1:.07,border2:.06,border3:.07,border4:.09,border5:.12,border6:.12,border7:.09,border8:.09,border9:.09,border11:.13,border12:.05,border13:.05};borderSize=borderSize||knownBorderSizes[frameName]||.1;_tileBorderApply(canvas,tilesObj,borderSize)})};var _runFrame=function(layerName,frameName,flatten){var layer=_paintWidget.getLayerByName(layerName);if(layer.canvas==null){return}_tileBorder(layer.canvas,frameName)};var _frameUndo=function(layerName){var i=_paintWidget.findLayerIndexByName(layerName);if(i!=-1){_paintWidget.layerDelete(i)}_paintWidget.recomposite()};var _frameRedo=function(layerName,frameName,flatten){_createLayerIfNecessary(layerName);_runFrame(layerName,frameName,flatten);_dirty=true};var _createLayerIfNecessary=function(name){name=name||_layerName;var layer=_paintWidget.getLayerByName(name);if(!layer){var dcanvas=document.createElement("canvas");dcanvas.width=_paintWidget.width;dcanvas.height=_paintWidget.height;layer=new AV.Layer({canvas:dcanvas,name:name});_paintWidget.addLayer(layer);_paintWidget.uiLayerReset()}if(layer.canvas.width!=_paintWidget.width){layer.canvas.width=_paintWidget.width}if(layer.canvas.height!=_paintWidget.height){layer.canvas.height=_paintWidget.height}return layer};api.activate=function(paintWidget){var randId=Math.floor(Math.random()*4294967295).toString(16);var name="_module_imageborder-"+randId;_layerName=name;_paintWidget=paintWidget;_dirty=false};api.deactivate=function(){_layerName=undefined;_dirty=false};api.applyPreview=function(frameName,flatten,callback){if(!_dirty){_paintWidget.actions.undoFake()}else{var layer=_paintWidget.getLayerByName(_layerName);if(layer&&layer.canvas){layer.canvas.width=layer.canvas.width}_paintWidget.actions.undoFake();_dirty=false}var hiResData={action:"imageborders",name:frameName,flatten:flatten};_paintWidget.dirty=true;_paintWidget.actions.push([_frameUndo,this,[_layerName]],[_frameRedo,this,[_layerName,frameName,flatten]],hiResData);AV.util.nextFrame(function(){_paintWidget.actions.redo();if(callback){callback()}})};api.makeThumb=function(canvas,frameName,borderSize){_tileBorder(canvas,frameName,borderSize)};api.readAction=function(data,next){if(data&&data.name){api.applyPreview(data.name,data.flatten,next)}else if(next){next.call(this)}};return api}();AV.PaintWidget.prototype.module["colorsplash"]=function(){var _paintWidget;var api={};var _origSrc,_newPixelData,src,dst,_tmp,_mask;var _processor;var _sessionAction;var _canvasBackingBeforeStroke;var _oldLayers;var _BRUSH_MODE_SETTINGS={smart:{IS_FREE_HAND:false,SIGMA_COLOR:10,REVERSE:0},free:{IS_FREE_HAND:true,SIGMA_COLOR:99999999,REVERSE:0},erase:{IS_FREE_HAND:true,SIGMA_COLOR:99999999,REVERSE:1}};var _initializeImageDataFromCanvas=function(flatten){flatten||(flatten=true);var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];if(layer.canvas==null){return}if(flatten){_oldLayers=_paintWidget.duplicateAllLayers();_paintWidget.flattenAllLayers();layer=_paintWidget.layers[_paintWidget.currentLayerIndex]}var dcanvas=AV.cnvs.copyCanvas(layer.canvas);var ctx=layer.canvas.getContext("2d");var w=_paintWidget.width,h=_paintWidget.height;_origSrc=AV.cnvs.getCanvasPixelData(dcanvas);src=_origSrc.data;_newPixelData=AV.cnvs.getCanvasPixelData(dcanvas);dst=_newPixelData.data;_tmp=AV.cnvs.getCanvasPixelData(dcanvas).data;var copyProcessor=AV.require("../../../src/js/processors/copy");_mask=copyProcessor.makeData(w*h);_processor=_processor||AV.require("../../../src/js/processors/tools/colorsplash");_processor.init(_tmp,w,h,_mask);_processor.preview(dst,src,_tmp,_mask,w,h);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite();return layer};var applyImage=function(imageData){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];layer.canvas.getContext("2d").putImageData(imageData,0,0);_paintWidget.recomposite()};api.getBrushSettingsForMode=function(mode){return _BRUSH_MODE_SETTINGS[mode]};api.commit=function(){_paintWidget.actions.push([applyImage,this,[_origSrc]],[applyImage,this,[_newPixelData]],_sessionAction);_paintWidget.actions.redoFake()};api.recordStroke=function(stroke){_sessionAction.strokes.push(stroke)};api.applySplash=function(x,y,startX,startY,reverse,sigmaR,sigmaC,alpha){var mask={};var w=_paintWidget.width,h=_paintWidget.height;_processor=_processor||AV.require("../../../src/js/processors/tools/selectsat");_processor.draw(src,w,h,_mask,{posX:x,posY:y,startX:startX,startY:startY,addMask:reverse,radius:sigmaR,sigmaC:sigmaC,alpha:1})};api.preview=function(minX,minY,maxX,maxY){var w=_paintWidget.width,h=_paintWidget.height;_processor.preview(dst,src,_tmp,_mask,w,h,minX,minY,maxX,maxY);var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};api.reset=function(){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");ctx.putImageData(_origSrc,0,0);_paintWidget.recomposite()};api.getColorAtPosition=function(x,y){x=Math.floor(x);y=Math.floor(y);var w=_paintWidget.width;var h=_paintWidget.height;if(x<0){x=0}else if(x>w-1){x=w-1}if(y<0){y=0}else if(y>h-1){y=h-1}if(src){var red=src[(w*y+x)*4];var green=src[(w*y+x)*4+1];var blue=src[(w*y+x)*4+2];var alpha=src[(w*y+x)*4+3]}return[red,green,blue,alpha]};api.initImage=function(){_initializeImageDataFromCanvas()};api.activate=function(paintWidget){_paintWidget=paintWidget;_sessionAction={action:"tools",toolname:"colorsplash",strokes:[]}};api.deactivate=function(){_processor=null};api.readAction=function(data,next){var i,j,stroke,point,strokeLen,strokePointsLen,startX,startY;if(data&&data.strokes){strokeLen=data.strokes.length;if(strokeLen>0){api.initImage();for(i=0;i<strokeLen;i++){stroke=data.strokes[i];api.recordStroke(stroke);if(stroke.pointlist){strokePointsLen=stroke.pointlist.length;for(j=0;j<strokePointsLen;j++){point=stroke.pointlist[j];if(j===0||stroke.brushmode==="free"){startX=point[0];startY=point[1]}api.applySplash(point[0],point[1],startX,startY,_BRUSH_MODE_SETTINGS[stroke.brushmode].REVERSE,stroke.radius,_BRUSH_MODE_SETTINGS[stroke.brushmode].SIGMA_COLOR,1)}}}api.preview(0,0,_paintWidget.width,_paintWidget.height);api.commit()}}if(next){next.call(this)}};api.resetImageData=function(){_initializeImageDataFromCanvas(true)};return api}();AV.PaintWidget.prototype.module["focus"]=function(){var _paintWidget;var api={};var _sessionAction;var _origSrc,_newPixelData,src,dst,_tmp,_mask;var _processor;var _initializeImageDataFromCanvas=function(){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];if(layer.canvas==null){return}var dcanvas=AV.cnvs.copyCanvas(layer.canvas);var ctx=layer.canvas.getContext("2d");var w=_paintWidget.width,h=_paintWidget.height;_origSrc=AV.cnvs.getCanvasPixelData(dcanvas);src=_origSrc.data;_newPixelData=AV.cnvs.getCanvasPixelData(dcanvas);dst=_newPixelData.data;_tmp=AV.cnvs.getCanvasPixelData(dcanvas).data;var copyProcessor=AV.require("../../../src/js/processors/copy");_mask=copyProcessor.makeData(w*h);_processor=_processor||AV.require("../../../src/js/processors/tools/tiltshift");_processor.init(_tmp,w,h,_mask);_processor.preview(dst,src,_tmp,_mask,w,h);ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};var _preview=function(){var w=_paintWidget.width,h=_paintWidget.height;_processor.preview(dst,src,_tmp,_mask,w,h,0,0,w,h);var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");ctx.putImageData(_newPixelData,0,0);_paintWidget.recomposite()};api.applyLinearBlur=function(x,y,sigmaR,angle){_processor=_processor||AV.require("../../../src/js/processors/tools/tiltshift");var w=_paintWidget.width,h=_paintWidget.height;_processor.draw(dst,w,h,_mask,{tiltshiftMode:"linear",posX:x,posY:y,sigmaR:sigmaR,angle:angle});_sessionAction={action:"tools",toolname:"tiltshift",x:x,y:y,radius:sigmaR,angle:angle*(180/Math.PI),tiltshiftmode:"linear"};_preview()};api.applyRadialBlur=function(x,y,sigmaR){_processor=_processor||AV.require("../../../src/js/processors/tools/tiltshift");var w=_paintWidget.width,h=_paintWidget.height;_processor.draw(dst,w,h,_mask,{tiltshiftMode:"radial",posX:x,posY:y,sigmaR:sigmaR});_sessionAction={action:"tools",toolname:"tiltshift",x:x,y:y,radius:sigmaR,tiltshiftmode:"radial"};_preview()};var applyImage=function(imageData){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];layer.canvas.getContext("2d").putImageData(imageData,0,0);_paintWidget.recomposite()};api.commit=function(){_paintWidget.actions.push([applyImage,this,[_origSrc]],[applyImage,this,[_newPixelData]],_sessionAction);_paintWidget.actions.redoFake()};api.reset=function(){var layer=_paintWidget.layers[_paintWidget.currentLayerIndex];var ctx=layer.canvas.getContext("2d");ctx.putImageData(_origSrc,0,0);_paintWidget.recomposite()};api.readAction=function(data,next){var i,len,point;if(data&&data.tiltshiftmode&&data.x&&data.y&&data.radius){if(data.tiltshiftmode==="radial"){api.applyRadialBlur(data.x,data.y,data.radius)}else{api.applyLinearBlur(data.x,data.y,data.radius,data.angle)}}api.commit();if(next){next.call(this)}};api.activate=function(paintWidget){_paintWidget=paintWidget;_initializeImageDataFromCanvas()};api.deactivate=function(){_processor=null};api.resetImageData=function(){_initializeImageDataFromCanvas(true)};return api}();AV.PaintWidget.prototype.module["drawing"]=function(){var _paintWidget;var _width=10,_color="#ffffff",_erase=false;var _brushModule=new AV.BrushModule({overflow:10,preserveBacking:true});var api=AV.util?AV.util.extend({},_brushModule):{};api.activate=function(paintWidget){_paintWidget=paintWidget;_brushModule.activate(_paintWidget)};api.apply=function(x,y){_brushModule.commit("drawing")};api.width=function(){return _width};api.setWidth=function(width){_width=width;_brushModule.setRadius(_width/2)};api.color=function(){return _color};api.setColor=function(color){_color=color;_brushModule.setColor(_color)};api.erase=function(){return _erase};api.setErase=function(erase){_erase=erase;_brushModule.setErase(_erase)};api.flatten=function(){_paintWidget.flattenAllLayers()};api.readAction=function(data,next){var i,len,point;if(data&&data.color&&data.radius&&data.pointlist){len=data.pointlist.length;api.setErase(data.erase);api.setColor(data.color);api.setWidth(2*data.radius);for(i=0;i<len;i++){point=data.pointlist[i];if(i===0){api.updateUIDown(point[0],point[1])}else{api.updateUIDraw(point[0],point[1])}}api.apply()}if(next){next.call(this)}};return api}();AV.SpotModule=function(o){var api={};var _processorParams=AV.util.extend({addMask:1,alpha:1},o.params);var _paintWidget;var _toolName=o.processorName;var _processor=AV.require("../../../src/js/processors/tools/"+_toolName);var _brushModule=new AV.SpotBrushModule({toolName:_toolName,processor:_processor,params:_processorParams});var api=AV.util?AV.util.extend({},_brushModule):{};api.activate=function(paintWidget){_paintWidget=paintWidget;_brushModule.activate(_paintWidget)};api.deactivate=function(){_processor=null;_brushModule.deactivate()};api.setParam=function(name,value){_processorParams[name]=value};api.readAction=function(data,next){var i,j,stroke,point,strokeLen,strokePointsLen,startX,startY;if(data&&data.strokes){strokeLen=data.strokes.length;api.activate(_paintWidget);if(strokeLen>0){api.reset();for(i=0;i<strokeLen;i++){stroke=data.strokes[i];var radius=stroke.radius;api.setRadius(radius);var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var scaledRadius=radius*zoomScale;if(stroke.pointlist){strokePointsLen=stroke.pointlist.length;api.startStroke();for(j=0;j<strokePointsLen;j++){point=stroke.pointlist[j];api.drawPoint(point[0],point[1],point[0],point[1],radius)}api.finializeStroke(radius)}}_paintWidget.actions.push([null,null,[]],[null,null,[]],api.getFlattenedActionList());_paintWidget.actions.redoFake()}}if(next){next.call(this)}};return api};AV.PaintWidget.prototype.module["blemish"]=new AV.SpotModule({processorName:"blemish",params:{alpha:.5}});AV.PaintWidget.prototype.module["redeye"]=new AV.SpotModule({processorName:"redeye",params:{alpha:.5}});AV.PaintWidget.prototype.module["whiten"]=new AV.SpotModule({processorName:"whiten",params:{alpha:.5}})}(window["AV"]||(window["AV"]={}),window,document);