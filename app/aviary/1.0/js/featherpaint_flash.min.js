!function(AV,window,document){AV.FilterManager=function(){var urls=[];var utils={};var borders={};var flares={};var tools={};var effects={};var idToEffect={};var filterPacks={};var loadingUrls={};var api=this;var _haveNotSeenUrl=function(url){var i,len=urls.length;for(i=0;i<len;i++){if(urls[i]===url){return false}}urls.push(url);return true};var _haveNotLoadedUrl=function(url){return!!loadingUrls[url]};var _fireAllCallbacksForUrl=function(url){var i,len,callback;if(loadingUrls[url]&&loadingUrls[url].length){len=loadingUrls[url].length;for(i=0;i<len;i++){callback=loadingUrls[url][i];if(callback){callback.call()}}}delete loadingUrls[url]};var _addCallbackForUrl=function(url,callback){loadingUrls[url]=loadingUrls[url]||[];loadingUrls[url].push(callback)};var _gatherProclistEffects=function(id,packs){var i,pack,effects,packLen;if(packs){for(i=0;i<packs.length;i++){pack=packs[i];if(pack&&pack["codename"]&&pack["codename"]+"_effects"===id){effects=pack.items;if(effects){filterPacks[id]=effects;packLen=effects.length;for(var j=0;j<packLen;j++){idToEffect[effects[j]["identifier"]]=effects[j]}}packs.splice(i,1);break}}}};api.getEffectById=function(id){return idToEffect[id]};api.getClickableFiltersForPack=function(id){return filterPacks[id]};api.loadPack=function(packId,url,callback){var onComplete=function(){_gatherProclistEffects(packId,AV.proclistPacks);if(callback)callback.call(this)};if(url&&_haveNotSeenUrl(url)){_addCallbackForUrl(url,onComplete);AV.util.loadFile(url,"js",function(ev){_fireAllCallbacksForUrl(url)})}else{if(_haveNotLoadedUrl(url)){_addCallbackForUrl(url,onComplete)}else{onComplete()}}};return api}}(window["AV"]||(window["AV"]={}),window,document);!function(exports){exports["AV"]=exports["AV"]||{};var AV=exports["AV"];AV.ImageBorderManager=function(){var urls=[];var idToEffect={};var filterPacks={};var api=this;var _haveNotSeenUrl=function(url){var i,len=urls.length;for(i=0;i<len;i++){if(urls[i]===url){return false}}urls.push(url);return true};var _gatherFilters=function(id,packs){var i,j,clickable,packlen,borderObj;if(packs){for(i=0;i<packs.length;i++){filterPacks[id]=packs[i];packlen=packs[i].length;for(j=0;j<packlen;j++){borderObj=packs[i][j];idToEffect[borderObj.border_name]=borderObj}}packs.splice(0,i+1)}};api.getEffectById=function(id){return idToEffect[id]};api.getClickableFiltersForPack=function(id){return filterPacks[id]};api.tileBorder=function(frameName,callback){var item=api.getEffectById(frameName);var itemImages=item.images;var imageObj0=new Image;var imageObj1=new Image;var imageObj2=new Image;var imageObj3=new Image;var imageObj4=new Image;var imageObj5=new Image;var imageObj6=new Image;var imageObj7=new Image;var tileNames=["tl","tr","br","bl","l","t","r","b"];var tileImgs=[imageObj0,imageObj1,imageObj2,imageObj3,imageObj4,imageObj5,imageObj6,imageObj7];var imagesToLoad=[];var tilesObj={};for(var i=0;i<tileNames.length;i++){var prop=tileNames[i];tilesObj[prop]={w:itemImages[prop].width,h:itemImages[prop].height,img:tileImgs[i]};imagesToLoad.push({img:tileImgs[i],src:itemImages[prop].src})}AV.util.loadImagesSync(imagesToLoad,function(){if(callback){callback.apply(this,[tilesObj])}})};api.loadPack=function(packId,url,callback){if(url&&_haveNotSeenUrl(url)){AV.util.loadFile(url,"js",function(ev){_gatherFilters(packId,AV["borderPacks"]);if(callback)callback.call(this)})}else{_gatherFilters(packId,AV["borderPacks"]);if(callback)callback.call(this)}};return api};return exports}(this);!function(AV,window,document){AV.OverlayRegistry=function(){var _registry={};var _loadSticker=function(url,callback){var hiResURL=url;var imgElementClean=document.createElement("img");imgElementClean.fullimageurl=hiResURL;var onload_handler=function(e){avpw$(imgElementClean).unbind("load",onload_handler);api.addElement(url,imgElementClean);if(callback){callback.apply(this,[e])}};avpw$(imgElementClean).load(onload_handler);avpw$(imgElementClean).attr("src",url)};var api=this;api.add=function(id,hiresurl){if(!_registry[id]){_registry[id]={}}if(hiresurl){_registry[id].hiresurl=hiresurl}};api.addElement=function(id,cleanImage){if(!_registry[id]){api.add(id)}_registry[id].element=cleanImage};api.getElement=function(id,callback){var el=null;if(!_registry[id]||!_registry[id].element){if(callback){_loadSticker(id,callback)}}else{el=_registry[id].element;if(callback){callback.apply(this,[el])}}return el};api.getHiRes=function(id){return _registry[id].hiresurl};return api}}(window["AV"]||(window["AV"]={}),window,document);!function(AV,window,document){var mediator=AV.Events;AV.ModeManager=function(){var _this=this;var activateCanvasForMode=function(mode){_this.setCurrentLayerByName("background");_this.uiLayerShow(false);if(_this.active!==null){if(_this.active.deactivate!==undefined){_this.active.deactivate()}}if(mode!==null&&mode!==undefined&&mode!==""){var newactive=_this.module[mode];if(newactive!==undefined){_this.active=newactive;if(_this.active.activate!==undefined){_this.active.activate(_this)}}}else{_this.active=null}};var init=function(context){if(context){_this=context}mediator.on("canvas:activate",activateCanvasForMode)};var shutdown=function(){mediator.off("canvas:activate",activateCanvasForMode)};var api={};api.init=init;api.shutdown=shutdown;return api}}(window["AV"]||(window["AV"]={}),window,document);if(typeof AV=="undefined"){AV={}}AV.Actions=function(){this.actionList=[];this.index=-1;return this};AV.Actions.prototype.undoImplicitActions=function(){};AV.Actions.prototype.canUndo=function(){return AV.FlashAPI._canUndo()};AV.Actions.prototype.canRedo=function(){return AV.FlashAPI._canRedo()};AV.Actions.prototype.undoToCheckpoint=function(){AV.FlashAPI.undoToCheckpoint()};AV.Actions.prototype.redoToCheckpoint=function(){return AV.FlashAPI.redoToCheckpoint()};AV.Actions.prototype.setCheckpoint=function(checkpoint){AV.FlashAPI.setCheckpoint(checkpoint)};AV.Actions.prototype.isACheckpoint=function(index){return AV.FlashAPI.isACheckpoint(index)};AV.Actions.prototype.truncate=function(suppressNotification){AV.FlashAPI.truncateActionList()};AV.Actions.prototype.getDims=function(){if(this.hiresWidth&&this.hiresHeight){return{width:this.hiresWidth,height:this.hiresHeight}}else{if(AV.paintWidgetInstance){return{width:AV.paintWidgetInstance.width,height:AV.paintWidgetInstance.height}}else{return null}}};AV.Actions.prototype.setDims=function(w,h){if(this.hiresWidth!=w||this.hiresHeight!=h){this.hiresWidth=w;this.hiresHeight=h;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.imageSizeTracker.setImageScaledIndicator()}}};AV.Actions.prototype.setOrigSize=function(w,h){this._origHiresWidth=w;this._origHiresHeight=h;this.setDims(w,h);AV.FlashAPI.setHiresSize(w,h)};AV.Actions.prototype.exportJSON=function(simplify){return AV.FlashAPI.getHistory()};!function(AV,window,document){AV.CropController=function(controls,paintWidget){var lastW,lastH;var _setSelection=function(x,y,w,h){AV.FlashAPI.changeProperty("upperleftpoint",[x,y]);AV.FlashAPI.changeProperty("size",[w,h]);lastW=w;lastH=h};var api=this;api.activate=function(){lastW=lastH=null};api.deactivate=function(){lastW=lastH=null};api.setInitialSelectionTo=function(w,h){var x=(paintWidget.width-w)/2+.5|0;var y=(paintWidget.height-h)/2+.5|0;_setSelection(x,y,w,h)};api.setInitialSelectionByRatio=function(w2h){var margin=24;var w=paintWidget.canvas.width;var h=paintWidget.canvas.height;var borderTB=margin;var borderLR=margin;var normw=w-2*borderLR;var normh=h-2*borderTB;var neww;var newh;neww=normh*w2h;newh=normh;if(neww>normw){neww=normw;newh=normw/w2h}neww=neww+.5|0;newh=newh+.5|0;api.setInitialSelectionTo(neww,newh)};api.setInitialSelection=function(){var l,r,t,b;var x,y,w,h;l=.09;t=.18;r=1-l;b=1-t;x=l*paintWidget.width+.5|0;y=t*paintWidget.height+.5|0;w=(r-l)*paintWidget.width+.5|0;h=(b-t)*paintWidget.height+.5|0;_setSelection(x,y,w,h)};api.setToolTipValues=function(){};api.isValidCrop=function(){if(lastW===0||lastH===0)return false;else return true};api.forceAspect=function(force){AV.FlashAPI.changeProperty("constrain",force)};api.crop=function(){};return api}}(window["AV"]||(window["AV"]={}),window,document);if(typeof AV=="undefined"){AV={}}AV.PaintWidget=function(width,height,actions,modeManager,filterManager,overlayRegistry,imageBorderManager){this.moduleLoadedCallback={};this.canvasReadyCallback=new avpw$.Deferred;this.canvas={width:width,height:height};this.setDimensions(width,height);this.active=null;this.dirty=false;this.actions=actions;this.actions.undoImplicitActions=function(){};this.actions.canUndo=function(){return AV.FlashAPI._canUndo()};this.actions.canRedo=function(){return AV.FlashAPI._canRedo()};this.actions.undo=function(){AV.FlashAPI._onUndo()};this.actions.redo=function(){AV.FlashAPI._onRedo()};this.actions.undoToCheckpoint=function(){AV.FlashAPI.undoToCheckpoint()};this.actions.redoToCheckpoint=function(){return AV.FlashAPI.redoToCheckpoint()};this.actions.setCheckpoint=function(checkpoint){AV.FlashAPI.setCheckpoint(checkpoint)};this.actions.isACheckpoint=function(idx){return AV.FlashAPI.isACheckpoint(idx)};this.actions.truncate=function(){AV.FlashAPI.truncateActionList()};this.actions.getDims=function(){var wh=null;if(AV.paintWidgetInstance){wh=wh||{};wh.width=AV.paintWidgetInstance.width;wh.height=AV.paintWidgetInstance.height}if(this.hiresWidth&&this.hiresHeight){wh=wh||{};wh.hiresWidth=this.hiresWidth;wh.hiresHeight=this.hiresHeight}return wh};this.actions.setDims=function(w,h){if(this.hiresWidth!=w||this.hiresHeight!=h){this.hiresWidth=w;this.hiresHeight=h;if(AV.controlsWidgetInstance){AV.controlsWidgetInstance.imageSizeTracker.setImageScaledIndicator()}}};this.actions.setOrigSize=function(w,h){this._origHiresWidth=w;this._origHiresHeight=h;this.setDims(w,h);AV.FlashAPI.setHiresSize(w,h)};this.actions.exportJSON=function(simplify){return AV.FlashAPI.getHistory()};if(modeManager&&modeManager.init){modeManager.init(this);this.modeManager=modeManager}this.filterManager=filterManager;this.overlayRegistry=overlayRegistry;this.imageBorderManager=imageBorderManager;return this};AV.PaintWidget.prototype.setOrigSize=function(w,h){this._origWidth=w+.5|0;this._origHeight=h+.5|0};AV.PaintWidget.prototype.getOrigSize=function(){return{width:this._origWidth,height:this._origHeight}};AV.PaintWidget.prototype.c2a=function(w,h,forceFloor){return{width:w,height:h}};AV.PaintWidget.prototype.a2c=function(w,h,forceFloor){var factor,newWidth,newHeight,currentDims=this.getScaledSize();if(currentDims.hiresWidth&&currentDims.hiresHeight){if(w!=currentDims.width||h!=currentDims.height){factor=currentDims.width/currentDims.hiresWidth;newWidth=w*factor;if(forceFloor)newWidth=newWidth+.5|0;factor=currentDims.height/currentDims.hiresHeight;newHeight=h*factor;if(forceFloor)newHeight=newHeight+.5|0;return{width:newWidth,height:newHeight,hiresWidth:w,hiresHeight:h}}else{return currentDims}}else{return{width:w,height:h}}};AV.PaintWidget.prototype.setBackground=function(imgElementClean){};AV.PaintWidget.prototype.uiLayerShow=function(show){};AV.PaintWidget.prototype.shutdown=function(){this.moduleLoadedCallback=null;this.actions=null;if(this.modeManager){this.modeManager.shutdown();this.modeManager=null}};AV.PaintWidget.prototype.moduleLoaded=function(modulename,callback){var pw=this,dfd,asyncCodeDeferreds=[];var completeDeferred=function(){dfd.done(function(){if(callback){callback.apply(this,[modulename])}});pw.moduleLoadedCallback[modulename]=dfd};var buildAsyncCodeDeferreds=function(assets){var i,url;for(i=0;i<assets.length;i++){url=assets[i].resourceUrl;if(url){!function(){var codeLoad=new avpw$.Deferred;if(assets[i].assetType===AV.controlsWidgetInstance.assetManager.types.EFFECT){pw.filterManager.loadPack(assets[i].assetId,url,function(){codeLoad.resolve()})}else if(assets[i].assetType===AV.controlsWidgetInstance.assetManager.types.IMAGEBORDER){pw.imageBorderManager.loadPack(assets[i].assetId,url,codeLoad.resolve)}else{codeLoad.resolve()}asyncCodeDeferreds.push(codeLoad)}()}}asyncCodeDeferreds.push(pw.canvasReadyCallback);dfd=avpw$.when.apply(pw,asyncCodeDeferreds);completeDeferred()};if(pw.moduleLoadedCallback){dfd=pw.moduleLoadedCallback[modulename]}if(!dfd){if(modulename==="effects"||modulename==="enhance"){if(AV.controlsWidgetInstance.assetManager){AV.controlsWidgetInstance.assetManager.getAssets("EFFECT",buildAsyncCodeDeferreds)}}else if(modulename==="frames"){if(AV.controlsWidgetInstance.assetManager){AV.controlsWidgetInstance.assetManager.getAssets("IMAGEBORDER",buildAsyncCodeDeferreds)}}else{dfd=avpw$.when(pw.canvasReadyCallback);completeDeferred()}}else{completeDeferred()}return dfd?dfd.isResolved():false};AV.PaintWidget.prototype.setDimensions=function(w,h){this.width=w;this.height=h;this.canvas.width=w;this.canvas.height=h};AV.PaintWidget.prototype.getScaledSize=function(){if(this.actions){return this.actions.getDims()}else{return{width:this.width,height:this.height}}};AV.PaintWidget.prototype.showWaitThrobber=function(show,callback){if(callback){setTimeout(callback,5)}};AV.PaintWidget.prototype.setCurrentLayerByName=function(name){return true};AV.PaintWidget.prototype.exportImage=function(mime,callback){return AV.FlashAPI.getImageData(mime,callback)};AV.PaintWidget.prototype.setMode=function(mode){if(this.active!==null){if(this.active.deactivate!==undefined){this.active.deactivate()}}if(mode!==null&&mode!==undefined&&mode!==""){var newactive=this.module[mode];if(newactive!==undefined){this.active=newactive;if(this.active.activate!==undefined){this.active.activate(this);this.dirty=true}}}else{this.active=null}};AV.PaintWidget.prototype.module={};AV.PaintWidget.prototype.module["saturation"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("saturation");AV.FlashAPI.changeProperty("value",1)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("saturation")};api.applyPreview=function(val,flatten){AV.FlashAPI.changeProperty("value",val);AV.FlashAPI.applyPreviewFromPlugin("saturation")};api.reset=function(){AV.FlashAPI.discardChangesFromPlugin("saturation")};return api}();AV.PaintWidget.prototype.module["whiten"]=function(){var _radius=10;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("whiten");AV.FlashAPI.changeProperty("radius",_radius)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("redeye")};api.radius=function(){return _radius};api.setRadius=function(r){_radius=r;if(AV.paintWidgetInstance&&AV.paintWidgetInstance.active){AV.FlashAPI.changeProperty("radius",_radius)}};return api}();AV.PaintWidget.prototype.module["redeye"]=function(){var _radius=10;var _mode="redeye";var api={};api.setMode=function(m){_mode=m};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("redeye");AV.FlashAPI.changeProperty("radius",_radius)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("redeye")};api.radius=function(){return _radius};api.setRadius=function(r){_radius=r;if(AV.paintWidgetInstance&&AV.paintWidgetInstance.active){AV.FlashAPI.changeProperty("radius",_radius)}};api.commit=function(){};return api}();AV.PaintWidget.prototype.module["blemish"]=function(){var _radius=5;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("blemish");AV.FlashAPI.changeProperty("radius",_radius)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("blemish")};api.radius=function(){return _radius};api.setRadius=function(radius){_radius=radius;AV.FlashAPI.changeProperty("radius",_radius)};api.commit=function(){};return api}();AV.PaintWidget.prototype.module["flip"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("flip")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("flip")};api.flip=function(horizontal,vertical,flatten){vertical=vertical?1:0;horizontal=horizontal?1:0;AV.FlashAPI.changeProperty("vertical",vertical);AV.FlashAPI.changeProperty("horizontal",horizontal);AV.FlashAPI.commitChangesFromPlugin("flip")};return api}();AV.PaintWidget.prototype.module["desaturate"]=function(){var api={};api.activate=function(paintWidget){};api.makeThumb=function(canvas){};api.desaturate=function(flatten){};return api}();AV.PaintWidget.prototype.module["brightness"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("brightness");AV.FlashAPI.changeProperty("brightnessvalue",1)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("brightness")};api.applyPreview=function(bri,con,flatten){AV.FlashAPI.changeProperty("brightnessvalue",bri);AV.FlashAPI.applyPreviewFromPlugin("brightness")};api.reset=function(){AV.FlashAPI.discardChangesFromPlugin("brightness")};return api}();AV.PaintWidget.prototype.module["contrast"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("contrast");AV.FlashAPI.changeProperty("contrastvalue",1)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("contrast")};api.applyPreview=function(bri,con,flatten){AV.FlashAPI.changeProperty("contrastvalue",con);AV.FlashAPI.applyPreviewFromPlugin("contrast")};api.reset=function(){AV.FlashAPI.discardChangesFromPlugin("contrast")};return api}();AV.PaintWidget.prototype.module["colors"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("colors")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("colors")};api.set=function(r,g,b,flatten){AV.FlashAPI.changeProperty("red",r);AV.FlashAPI.changeProperty("green",g);AV.FlashAPI.changeProperty("blue",b)};api.reset=function(){AV.FlashAPI.changeProperty("red",0);AV.FlashAPI.changeProperty("green",0);AV.FlashAPI.changeProperty("blue",0)};api.commit=function(){AV.FlashAPI.commitChangesFromPlugin("colors")};return api}();AV.PaintWidget.prototype.module["drawing"]=function(){var _width=10,_color="#ffffff",_erase=false;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("drawing")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("drawing")};api.width=function(){return _width};api.setWidth=function(width){_width=width;AV.FlashAPI.changeProperty("radius",width/2)};api.color=function(){return _color};api.setColor=function(color){AV.FlashAPI.changeProperty("color",AV.util.color_to_int(color));_color=color};api.erase=function(){return _erase};api.setErase=function(erase){_erase=erase;erase=erase?1:0;AV.FlashAPI.changeProperty("erase",erase)};api.flashReset=function(){api.setWidth(_width);api.setErase(_erase);api.setColor(_color)};return api}();AV.PaintWidget.prototype.module["rotate90"]=function(){var _paintWidget;var _origWidth,_origHeight;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("rotate90");_origWidth=paintWidget.width;_origHeight=paintWidget.height;_paintWidget=paintWidget};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("rotate90");_paintWidget=null};api.rotate90=function(a){AV.FlashAPI.changeProperty("angle",a);if(a%180){_paintWidget.setDimensions(_origHeight,_origWidth)}else{_paintWidget.setDimensions(_origWidth,_origHeight)}AV.FlashAPI.commitChangesFromPlugin("rotate90")};return api}();AV.PaintWidget.prototype.module["resize"]=function(){var _paintWidget;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("resize");AV.FlashAPI.changeProperty("keep_proportions",0);_paintWidget=paintWidget};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("resize")};api.resize=function(width,height,flatten){AV.FlashAPI.changeProperty("size",[width,height])};return api}();AV.PaintWidget.prototype.module["crop"]=function(){var _paintWidget;var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("crop");_paintWidget=paintWidget};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("crop")};api.crop=function(){AV.FlashAPI.executePlugin()};return api}();AV.PaintWidget.prototype.module["overlay"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("overlay")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("overlay")};api.addOverlay=function(id,url,x,y,sx,sy,rot){AV.FlashAPI.changeProperty("sticker_url",url);AV.FlashAPI.executePlugin()};return api}();AV.PaintWidget.prototype.module["text"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("text")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("text")};api.newText=function(str,fontName,fontSizePx,fontColor,shadowColor,x,y,sx,sy,rot){AV.FlashAPI.changeProperty("text",str);AV.FlashAPI.changeProperty("font_color",AV.util.color_to_int(fontColor));AV.FlashAPI.executePlugin()};return api}();AV.PaintWidget.prototype.module["blur"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("blur");AV.FlashAPI.changeProperty("radius",0)};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("blur")};api.applyPreview=function(radius,flatten){AV.FlashAPI.changeProperty("radius",radius);AV.FlashAPI.applyPreviewFromPlugin("blur")};api.reset=function(){AV.FlashAPI.discardChangesFromPlugin("blur")};return api}();AV.PaintWidget.prototype.module["barrel"]=function(){var _barrelchange=0;var api={};api.activate=function(paintWidget){};api.deactivate=function(){};api.set=function(val,flatten){};api.makeThumb=function(canvas,val){};api.reset=function(){};api.commit=function(){};return api}();AV.PaintWidget.prototype.module["bulge"]=function(){var _radius=100;var _power=0;var api={};api.activate=function(paintWidget){};api.deactivate=function(){};api.setRadius=function(r){_radius=r};return api}();AV.PaintWidget.prototype.module["sharpen"]=function(){var api={};api.activate=function(paintWidget){AV.FlashAPI.activatePlugin("sharpen")};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("sharpen")};api.applyPreview=function(val,flatten){AV.FlashAPI.changeProperty("value",val);AV.FlashAPI.applyPreviewFromPlugin("sharpen")};api.reset=function(){AV.FlashAPI.discardChangesFromPlugin("sharpen")};return api}();AV.PaintWidget.prototype.module["effects"]=function(){var _paintWidget;var _proclistManager=null;var _lastFilter;var _cleanData,_cleanWidth,_cleanHeight;var _saveDataFromFlash=function(data,width,height){_cleanData=AV.FlashAPI.pibeca.decode(data,width,height);_cleanWidth=width;_cleanHeight=height};var api={};api.activate=function(paintWidget){AV.canvasDataReceiver=_saveDataFromFlash;AV.FlashAPI.activatePlugin("effects");_paintWidget=paintWidget};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("effects");AV.canvasDataReceiver=null;_proclistManager=null};api.getFilterPacksInOrder=function(){return filterPacksOrdered};api.getFilterPackName=function(id){return filterPackNames[id]};api.getClickableFiltersForPack=function(id){return filterPacks[id]};api.makeThumb=function(id,canvas){};api.applyPreview=function(id,filterParams,flatten){var size=_cleanData.length;var effect=_paintWidget.filterManager.getEffectById(id);AV.FlashAPI.changeProperty("jsonstring",AV.JSON.stringify(effect));var output=[];var output=new Array(size);for(var i=0;i<size;i++){output[i]=_cleanData[i]}_proclistManager=_proclistManager||AV.require("./MoaLiteProclistManager");_proclistManager.MLPLRunEffect(_paintWidget.filterManager.getEffectById(id),{data:output,width:_cleanWidth,height:_cleanHeight},filterParams);var s=AV.FlashAPI.pibeca.encode(output);AV.FlashAPI.changeProperty("bitmapdata",s);AV.FlashAPI.applyPreviewFromPlugin("effects")};return api}();AV.PaintWidget.prototype.module["enhance"]=function(){var _paintWidget;var _processor;var _lastFilter;var _cleanData,_cleanWidth,_cleanHeight;var _saveDataFromFlash=function(data,width,height){_cleanData=AV.FlashAPI.pibeca.decode(data,width,height);_cleanWidth=width;_cleanHeight=height};var api={};api.activate=function(paintWidget){AV.canvasDataReceiver=_saveDataFromFlash;AV.FlashAPI.activatePlugin("effects");_paintWidget=paintWidget};api.deactivate=function(){AV.FlashAPI.deactivatePlugin("effects");AV.canvasDataReceiver=null;_processor=null};api.applyPreview=function(id,flatten){if(_cleanData&&_cleanData.length){var size=_cleanData.length;AV.FlashAPI.changeProperty("filtername",id);var output=new Array(size);for(var i=0;i<size;i++){output[i]=_cleanData[i]}_processor=_processor||AV.require("../../../src/js/processors/tools/enhance");if(_processor[id]){_processor[id](output,_cleanWidth,_cleanHeight)}var s=AV.FlashAPI.pibeca.encode(output);AV.FlashAPI.changeProperty("bitmapdata",s);AV.FlashAPI.applyPreviewFromPlugin("effects")}};return api}();