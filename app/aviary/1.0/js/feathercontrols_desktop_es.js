/*! jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.avpw_jQuery=a.avpw$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);
(function(f){f.miniColors=function(){var k=function(d,c){var a=c.pageX,b=c.pageY,e=d.find(".miniColors-colors").offset();c.originalEvent.changedTouches&&(a=c.originalEvent.changedTouches[0].pageX,b=c.originalEvent.changedTouches[0].pageY);a=a-e.left-5;b=b-e.top-5;-5>=a&&(a=-5);144<=a&&(a=144);-5>=b&&(b=-5);144<=b&&(b=144);a=Math.round(0.67*(a+5));0>a&&(a=0);100<a&&(a=100);b=100-Math.round(0.67*(b+5));0>b&&(b=0);100<b&&(b=100);e=d.data("hsb");e.s=a;e.b=b;g(d,e,!0)},l=function(d,c){var a=c.pageY,b=
d.find(".miniColors-colors").offset();c.originalEvent.changedTouches&&(a=c.originalEvent.changedTouches[0].pageY);a=a-b.top-1;-1>=a&&(a=-1);149<=a&&(a=149);a=Math.round(2.4*(150-a-1));0>a&&(a=0);360<a&&(a=360);b=d.data("hsb");b.h=a;g(d,b,!0)},m=function(d,c){var a,b;a=Math.ceil(c.s/0.67);0>a&&(a=0);150<a&&(a=150);b=150-Math.ceil(c.b/0.67);0>b&&(b=0);150<b&&(b=150);a-=5;b-=5;d.find(".miniColors-colorPicker").css("top",b+"px").css("left",a+"px").show();a=150-c.h/2.4;0>a&&(h=0);150<a&&(h=150);a-=1;d.find(".miniColors-huePicker").css("top",
a+"px").show()},g=function(d,c,a){m(d,c);d.data("hsb",c);var b=i(j(c));a&&d.trigger("updateInput",{hex:b});d.find(".miniColors-colors").css("backgroundColor","#"+i(j({h:c.h,s:100,b:100})));d.trigger("setColor",{hex:b})},j=function(d){var c,a,b;c=Math.round(d.h);var e=Math.round(255*d.s/100),d=Math.round(255*d.b/100);if(0===e)c=a=b=d;else{var e=(255-e)*d/255,f=(d-e)*(c%60)/60;360===c&&(c=0);60>c?(c=d,b=e,a=e+f):120>c?(a=d,b=e,c=d-f):180>c?(a=d,c=e,b=e+f):240>c?(b=d,c=e,a=d-f):300>c?(b=d,a=e,c=e+f):
360>c?(c=d,a=e,b=d-f):b=a=c=0}return{r:Math.round(c),g:Math.round(a),b:Math.round(b)}},i=function(d){var d=[d.r.toString(16),d.g.toString(16),d.b.toString(16)],c,a=d.length,b;for(c=0;c<a;c++)b=d[c],1===b.length&&(d[c]="0"+b);return d.join("")};this.setSelectorColor=g;this.buildSelector=function(d){var c=f('<div style="display: none;" class="miniColors-selector"></div>');c.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>');
c.find(".miniColors-colors").css("backgroundColor","#"+i(j({h:d.h,s:100,b:100})));m(c,d);c.bind("selectstart",function(){return!1});c.data("hsb",d);return c};this.bindSelectorEvents=function(d){var c=!1,a;f(document).bind("mousedown.miniColors touchstart.miniColors",function(b){c=!0;var e=f(b.target).parents().andSelf();e.hasClass("miniColors-colors")&&(b.preventDefault(),a="colors",k(d,b));e.hasClass("miniColors-hues")&&(b.preventDefault(),a="hues",l(d,b));e.hasClass("miniColors-selector")?b.preventDefault():
e.hasClass("miniColors")||d.trigger("clickOutsideBounds")});f(document).bind("mouseup.miniColors touchend.miniColors",function(b){b.preventDefault();c=!1;a=void 0}).bind("mousemove.miniColors touchmove.miniColors",function(b){b.preventDefault();c&&("colors"===a&&k(d,b),"hues"===a&&l(d,b))})};this.unBindSelectorEvents=function(){f(document).unbind(".miniColors")};this.forceClose=function(){selector&&selector.trigger("clickOutsideBounds")};return this}})(avpw_jQuery);
//fgnass.github.com/spin.js#v1.2.8
/**
 * Modified spin.js: 
 *		* no positioning via style
 *		* namespace as new AV.Spinner()
 */!function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",a.cssRules.length),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function v(e){if(!this.spin)return new v(e);this.opts=h(e||{},v.defaults,d)}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style",{type:"text/css"});return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};v.defaults={},h(v.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{width:0,zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r)),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;(function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),function(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=c(o("group"),{behavior:"url(#default#VML)"});!l(t,"transform")&&t.adj?(a.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(t,n){function s(){return c(e("group",{coordsize:i+" "+i,coordorigin:-r+" "+ -r}),{width:i,height:i})}function l(t,i,o){u(a,u(c(s(),{rotation:360/n.lines*t+"deg",left:~~i}),u(c(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:o}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,i=2*r,o=-(n.width+n.length)*2+"px",a=c(s(),{position:"absolute",top:o,left:o}),f;if(n.shadow)for(f=1;f<=n.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=n.lines;f++)l(f);return u(t,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):s=l(t,"animation")}(),AV.Spinner=v}(window,document);if(typeof AV=="undefined"){AV={}}!function(template){var tmpl=template["desktop"]={};tmpl.saveBlock=function(){return['<div class="avpw_mode_action avpw_mode_action_right">','<a id="avpw_save_button" href="javascript:void(0)" class="avpw_button avpw_primary_button">'+AV.getLocalizedString("Save")+"</a>","</div>"].join("")};tmpl.closeButton=function(o){return["<div "+(o.id?'id="'+o.id+'" ':"")+'title="'+o.text+'">',"<div "+(o.id?'id="'+o.id+'_inner" ':"")+'class="avpw_close_button '+(o.className||"")+'">','<div class="avpw_close_inner">',"&times;","</div>","</div>","</div>"].join("")};tmpl.cancelButton=function(o){return['<a href="javascript:void(0)" id="'+o.id+'" class="avpw_button avpw_back_button">',AV.getLocalizedString(o.label),"</a>"].join("")};tmpl.inAppPurchaseFrame=function(o){return['<iframe width="100%" height="170" class="avpw_popup_frame" id="avpw_purchase_frame" name="avpw_purchase_frame" src="'+o.src+'" style="display: none;"></iframe>'].join("")};tmpl.controls=function(o){return['<div id="avpw_fullscreen_bg" style="display: none;"></div>','<div style="display:none;" id="avpw_controls" class="avpw avpw_main_mode">',"",'<div id="avpw_tool_content_header">','<span id="avpw_breadcrumb_header" class="avpw_label">',AV.getLocalizedString("Photo Editor"),"</span>",'<span class="avpw_label" id="avpw_breadcrumb_sep" style="display: none;"> : </span>','<span class="avpw_label" id="avpw_breadcrumb_toolname"></span>',tmpl.closeButton({id:"avpw_control_cancel_pane",text:AV.getLocalizedString("Cancel"),className:"avpw_main_close"}),"</div>","",'<div id="avpw_tool_content_wrapper">',"",'<div id="avpw_tool_main_container" class="avpw_tool_pager">',"",'<a id="avpw_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_control_main_scroll_panel" class="avpw_clip">','<div id="avpw_control_main_scrolling_region" class="avpw_scroll_strip">',"</div>",'<div id="avpw_tools_pager">',"<ul>","</ul>","</div>","</div>","","",'<a id="avpw_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","",o.internalSaveBlock,"","</div>","",'<div id="avpw_tool_options_container" style="display:none;">','<div id="avpw_tool_container">','<div id="avpw_controlpanel_brightness" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',tmpl.slider({id:"avpw_brightness_slider",divider:true}),"</div>","",'<div id="avpw_controlpanel_contrast" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',tmpl.slider({id:"avpw_contrast_slider",divider:true}),"</div>","",'<div id="avpw_controlpanel_saturation" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',tmpl.slider({id:"avpw_saturation_slider",divider:true}),"</div>","",'<div id="avpw_controlpanel_warmth" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',tmpl.slider({id:"avpw_warmth_slider",divider:true}),"</div>","",'<div id="avpw_controlpanel_sharpness" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',tmpl.slider({id:"avpw_sharpness_slider",divider:true}),"</div>","",'<div id="avpw_controlpanel_forcecrop" class="avpw_controlpanel avpw_tool_fixed">','<div id="avpw_force_crop_sub_text">Crop your photo to:</div>','<div id="avpw_force_crop_label"></div>',"</div>","",'<div id="avpw_controlpanel_orientation" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_orientation">','<div class="avpw_inset_button_group avpw_inset_group">','<div id="avpw_rotate_left" class="avpw_inset_button avpw_inset_button_first">','<div class="avpw_orientation_button_inner">',"</div>","</div>",'<div id="avpw_rotate_right" class="avpw_inset_button avpw_inset_button_last">','<div class="avpw_orientation_button_inner">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_spacer avpw_divider"></div>','<div class="avpw_inset_button_group avpw_inset_group">','<div id="avpw_flip_h" class="avpw_inset_button avpw_inset_button_first">','<div class="avpw_orientation_button_inner">',"</div>","</div>",'<div id="avpw_flip_v" class="avpw_inset_button avpw_inset_button_last">','<div class="avpw_orientation_button_inner">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Left"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Right"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group">','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Horizontal"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Vertical"),"</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_crop" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_scroll">','<a id="avpw_crop_presets_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_crop_presets_scroll_window" class="avpw_clip">','<div id="avpw_crop_presets_scroll_region" class="avpw_scroll_strip">',"</div>",'<div class="avpw_shadowbar avpw_shadowbar_n"></div>',"</div>",'<a id="avpw_crop_presets_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>","</div>","",'<div id="avpw_controlpanel_resize" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_resize">','<div class="avpw_resize_form_block avpw_resize_width">','<input class="avpw_text_input avpw_number_input" id="avpw_resize_width" type="text" value="640" maxlength="5"/>','<div class="avpw_label">',AV.getLocalizedString("Width"),"</div>","</div>",'<div class="avpw_resize_form_block avpw_resize_constrain">','<div  class="avpw_inset_group avpw_inset_button_group avpw_checkmark_button">','<div id="avpw_constrain_prop" class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last" title="'+AV.getLocalizedString("Maintain proportions")+'">','<div class="avpw_lock_icon">','<div class="avpw_lock_icon_top">','<div class="avpw_lock_icon_top_inner"></div>',"</div>",'<div class="avpw_lock_icon_sep"></div>','<div class="avpw_lock_icon_bottom"></div>',"</div>","</div>","</div>","</div>",'<div class="avpw_resize_form_block avpw_resize_height">','<input class="avpw_text_input avpw_number_input" id="avpw_resize_height" type="text" value="480" maxlength="5"/>','<div class="avpw_label">',AV.getLocalizedString("Height"),"</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_redeye" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>","",'<div id="avpw_controlpanel_whiten" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>","",'<div id="avpw_controlpanel_blemish" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>","",'<div id="avpw_controlpanel_effects" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_advanced_window">','<div class="avpw_advanced_region">','<div id="avpw_effects_effects" class="avpw_tool_scroll">','<a id="avpw_filter_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_filter_body_scroll_window" class="avpw_clip">','<div id="avpw_filter_body_scroll_region" class="avpw_scroll_strip" style="display: none;">',"</div>",'<div class="avpw_shadowbar avpw_shadowbar_n"></div>',"</div>",'<a id="avpw_filter_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>",'<div id="avpw_effects_options">','<div class="avpw_tool_cutout_centered_fixed_size">','<div class="avpw_effects_frame_container">','<div  class="avpw_inset_group avpw_inset_button_group avpw_inset_button_group_first avpw_inset_button_group_last avpw_checkmark_button">','<div id="avpw_effects_frame_toggle" class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last">','<div class="avpw_frame_toggle_icon">',"</div>","</div>","</div>",'<div class="avpw_label">',AV.getLocalizedString("Frame"),"</div>","</div>","</div>","</div>","</div>","</div>",tmpl.advancedToolsSplitter(),"</div>","",'<div id="avpw_controlpanel_enhance" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_enhance">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first">','<div id="avpw_enhance_icon_one" class="avpw_enhance_button_inner">',AV.getLocalizedString("Enhance"),"</div>","</div>",'<div class="avpw_inset_button">','<div id="avpw_enhance_icon_two" class="avpw_enhance_button_inner">',AV.getLocalizedString("Night"),"</div>","</div>",'<div class="avpw_inset_button avpw_inset_button_last">','<div id="avpw_enhance_icon_four" class="avpw_enhance_button_inner">',AV.getLocalizedString("Balance"),"</div>","</div>","</div>",'<div class="avpw_inset_group">','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Hi-Def"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Illuminate"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Color Fix"),"</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_drawing" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_drawing">','<div class="avpw_outer-center">','<div class="avpw_inner-center">','<div class="avpw_inset_color_widget avpw_inset_group avpw_inset_button_group">',tmpl.colorPickerIcon(),'<div id="avpw_drawing_colors" class="avpw_inset_color_choices avpw_inset_button avpw_inset_button_last avpw_inset_button_down">',"</div>","</div>",'<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last avpw_colorsplash_eraser">','<div class="avpw_colorsplash_eraser_icon avpw_colorsplash_inner_icon">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer avpw_divider"></div>',tmpl.brushSizesSet({id:"avpw_drawing_brushes",sizes:[8,13,18,21,25],hideLabel:true}),'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_inset_color_widget_label avpw_label">',AV.getLocalizedString("Color Picker"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_button_label avpw_label">',AV.getLocalizedString("Eraser"),"</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">',AV.getLocalizedString("Brush Size"),"</div>","</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_overlay" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_scroll">','<a id="avpw_overlay_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_overlay_images_scroll_window" class="avpw_clip">','<div id="avpw_overlay_pack_scroll_region" class="avpw_scroll_strip">',"</div>",'<div class="avpw_overlay_roll"></div>','<div id="avpw_overlay_images_scroll_region" class="avpw_overlay_strip avpw_scroll_strip" style="display: none;">',"</div>",'<div class="avpw_shadowbar avpw_shadowbar_n"></div>',"</div>",'<a id="avpw_overlay_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>","</div>","",'<div id="avpw_controlpanel_frames" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_scroll">','<a id="avpw_imageborders_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_imageborders_images_scroll_window" class="avpw_clip">','<div id="avpw_imageborders_images_scroll_region" class="avpw_frames_strip avpw_scroll_strip" style="display: none;">',"</div>",'<div class="avpw_shadowbar avpw_shadowbar_n"></div>',"</div>",'<a id="avpw_imageborders_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>","</div>","",'<div id="avpw_controlpanel_text" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_half_height">','<div class="avpw_inset_color_widget avpw_inset_group avpw_inset_button_group">',tmpl.colorPickerIcon(),'<div id="avpw_text_colors" class="avpw_inset_color_choices avpw_inset_button avpw_inset_button_last avpw_inset_button_down">',"</div>","</div>","</div>",'<div class="avpw_tool_half_height">','<button id="avpw_add_text" class="avpw_button">',AV.getLocalizedString("Add Text"),"</button>",'<input type="text" id="avpw_text_area" name="avpw_text_area" class="avpw_text_input" />','<input type="hidden" id="avpw_text_font" value="sans-serif" />','<input type="hidden" id="avpw_text_font_size" value="60" />',"</div>","</div>","",'<div id="avpw_controlpanel_textwithfont" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_fixed">','<div class="avpw_outer-center">','<div class="avpw_inner-center">','<div class="avpw_inset_color_widget avpw_inset_group avpw_inset_button_group">',tmpl.colorPickerIcon(),'<div id="avpw_textwithfont_colors" class="avpw_inset_color_choices avpw_inset_button avpw_inset_button_last avpw_inset_button_down">',"</div>","</div>",'<div id="avpw_font_browser" class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last">','<div class="avpw_dropdown_icon">','<div class="avpw_dropdown_icon_inner">',"</div>","</div>",'<div id="avpw_font_browser_preview" class="avpw_font_label avpw_label avpw_isa_dropdown_display">',"</div>","</div>","</div>",'<div id="avpw_textwithfont_addtext" class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button_with_plus avpw_inset_button avpw_inset_button_first avpw_inset_button_last">','<div class="avpw_plus_icon"></div>',"</div>","</div>",'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label">',AV.getLocalizedString("Color Picker"),"</div>",'<div class="avpw_inset_button_label avpw_label avpw_font_spacer">&nbsp;</div>','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Add Text"),"</div>","</div>","</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_colorsplash" class="avpw_controlpanel">','<div class="avpw_outer-center">','<div class="avpw_inner-center avpw_tool_cutout_centered_colorsplash">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_colorsplash_freebrush">','<div class="avpw_colorsplash_freebrush_icon avpw_colorsplash_inner_icon">',AV.getLocalizedString("Free Color"),"</div>","</div>",'<div class="avpw_inset_button avpw_colorsplash_smartbrush avpw_inset_button_down">','<div class="avpw_colorsplash_smartbrush_icon avpw_colorsplash_inner_icon">',AV.getLocalizedString("Smart Color"),"</div>","</div>",'<div class="avpw_inset_button avpw_inset_button_last avpw_colorsplash_eraser">','<div class="avpw_colorsplash_eraser_icon avpw_colorsplash_inner_icon">',AV.getLocalizedString("Eraser"),"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer avpw_divider"></div>',tmpl.brushSizesSet({id:"avpw_colorsplash_brushes",sizes:[8,13,18,21,25],hideLabel:true}),'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Free Color"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Smart Color"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_button_label avpw_label">',AV.getLocalizedString("Eraser"),"</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">',AV.getLocalizedString("Brush Size"),"</div>","</div>","</div>","</div>","",'<div id="avpw_controlpanel_focus" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_tiltshift">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_tiltshift_circle_button">','<div class="avpw_tiltshift_circle_icon avpw_tiltshift_inner_icon">',"</div>","</div>",'<div class="avpw_inset_button avpw_inset_button_last avpw_tiltshift_rectangle_button">','<div class="avpw_tiltshift_rectangle_icon avpw_tiltshift_inner_icon">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Radial"),"</div>",'<div class="avpw_inset_button_label avpw_label">',AV.getLocalizedString("Linear"),"</div>","</div>","</div>","</div>","","</div>",'<div class="avpw_mode_action avpw_mode_action_left">',tmpl.cancelButton({id:"avpw_all_effects",label:"Cancel"}),tmpl.cancelButton({id:"avpw_up_one_level",label:"Cancel"}),"</div>",'<div class="avpw_mode_action avpw_mode_action_right">','<a href="javascript:void(0)" id="avpw_apply_container" class="avpw_button avpw_primary_button">',AV.getLocalizedString("Apply"),"</a>","</div>","","</div>","</div>","",'<div id="avpw_canvas_embed" class="avpw_canvas_background"></div>',"",'<div id="avpw_footer">','<div id="avpw_history">','<div id="avpw_history_undo" class="avpw_button avpw_history_button avpw_history_button_first avpw_history_disabled">','<span class="avpw_history_icon">',"Undo","</span>","</div>",'<div id="avpw_history_redo" class="avpw_button avpw_history_button avpw_history_button_last avpw_history_disabled">','<span class="avpw_history_icon">',"Redo","</span>","</div>",'<div id="avpw_history_undo_blocker" class="avpw_history_blocker avpw_history_blocker_first"></div>','<div id="avpw_history_redo_blocker" class="avpw_history_blocker avpw_history_blocker_last"></div>',"</div>",'<p class="avpw_footer_text" id="avpw_size_indicator"></p>','<p id="avpw_powered_branding" class="avpw_footer_text avpw_powered_text">',"</p>","</div>","",'<div id="avpw_messaging" style="display: none;">','<div id="avpw_messaging_inner">',"</div>",'<div id="avpw_messages" style="display: none;">',tmpl.aviaryAppPopups(),"</div>","</div>","","</div>"].join("")};tmpl.eggIcon=function(o){return['<div class="avpw_icon avpw_tool_icon" id="avpw_main_'+o.optionName+'" data-header="'+o.capOptionName+'" data-toolname="'+o.optionName+'">','<div class="avpw_icon_image avpw_tool_icon_image">','<div class="avpw_tool_icon_inner"></div>',"</div>",'<div class="avpw_icon_waiter avpw_center_contents">',"</div>",'<span class="avpw_icon_label avpw_label">'+o.capOptionName+"</span>","</div>"].join("")};tmpl.emptyEggIcon=function(){return""};tmpl.genericScrollPanel=function(o){return['<div style="width: '+o.panelWidth+'px;" class="avpw_scroll_page '+o.panelClass+'">\n','<span class="avpw_scroll_page_inner">\n',o.panelHTML,"</span>\n","</div>\n"].join("")};tmpl.aviaryScrollPanel=function(o){return['<div style="width: '+o.panelWidth+'px;" class="avpw_scroll_page '+o.panelClass+'">\n','<span class="avpw_scroll_page_inner">\n','<div class="avpw_info">','<a href="'+AV.launchData["getWidgetURL"]+'" target="_blank" class="avpw_button avpw_info_right">'+AV.getLocalizedString("Get this editor")+"</a>\n",'<a href="'+AV.launchData["giveFeedbackURL"]+'" target="_blank" class="avpw_button avpw_info_left">'+AV.getLocalizedString("Give feedback")+"</a>\n",'<div class="avpw_info_inner">','<a id="avpw_logo_large" href="http://www.aviary.com/" target="_blank">',"Aviary","</a>",'<p class="avpw_version_text">',"v"+AV.build["version"],"</p>","</div>","</div>","</span>","</div>"].join("")};tmpl.poweredByFooterLogo=function(o){return['<a class="avpw_cursor">',AV.getLocalizedString("Powered by")+" ",'<span id="avpw_logo">',"&nbsp;","</span>","</a>"].join("")};tmpl.aviaryAppPopups=function(){return['<div id="avpw_aviary_beensaved" class="avpw_app_popup">\n','<p class="avpw_message_text">'+AV.getLocalizedString("Your work was saved!")+"</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resume_aftersave" class="avpw_button" href="#Resume">'+AV.getLocalizedString("Resume")+"</a>\n",'<a id="avpw_close_aftersave" class="avpw_button avpw_primary_button" href="#Close">'+AV.getLocalizedString("Close")+"</a>","</div>\n","<br />",'<div class="avpw_center_contents">\n','<a class="avpw_button" href="'+AV.launchData["getWidgetURL"]+'" target="_blank">'+AV.getLocalizedString("Get this editor")+"</a>\n","</div>\n","</div>\n",'<div id="avpw_resize_invalid" class="avpw_app_popup">\n','<p class="avpw_message_text">',AV.getLocalizedString("Width and height must be greater than zero and less than the maximum ({max}px)").replace("{max}",'<span id="avpw_resize_invalid_max_size"></span>'),"</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resize_invalid_confirm" class="avpw_button" href="#Confirm">'+AV.getLocalizedString("OK")+"</a>\n","</div>\n","</div>\n",'<div id="avpw_purchase_pack" class="avpw_app_popup">\n',tmpl.closeButton({id:"avpw_purchase_pack_close",text:AV.getLocalizedString("Cancel")}),'<div id="avpw_purchase_pack_contents">\n',"</div>\n","</div>\n",'<div id="avpw_resize_unlocked" class="avpw_app_popup">\n','<p class="avpw_message_text">',AV.getLocalizedString("Are you sure? This can distort your image")+".","</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resize_unlocked_confirm" class="avpw_button" href="#Confirm">'+AV.getLocalizedString("OK")+"</a>\n",'<a id="avpw_resize_unlocked_cancel" class="avpw_button" href="#Confirm">'+AV.getLocalizedString("Cancel")+"</a>\n","</div>\n","</div>\n",'<div id="avpw_aviary_quitareyousure" class="avpw_app_popup">','<p class="avpw_message_text">'+AV.getLocalizedString("Wait! You didn't save your work. Are you certain that you want to close this editor?")+"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_resume_editing" class="avpw_button" href="#Resume">'+AV.getLocalizedString("Resume")+"</a>\n",'<a id="avpw_close_nosave" class="avpw_button" href="#Close">'+AV.getLocalizedString("Close")+"</a>\n",'<a id="avpw_close_save" class="avpw_button avpw_primary_button" href="#Save">'+AV.getLocalizedString("Save")+"</a>","</div>","</div>",'<div id="avpw_aviary_aviaryfeedback" class="avpw_app_popup">','<div class="avpw_popup_split_box">','<h2 class="avpw_mode_warning">Support</h2>',"<p>Have a suggestion on how we can improve this photo editor? Let us know.</p>",'<a href="'+AV.launchData["giveFeedbackURL"]+'" target="_blank" class="avpw_button avpw_primary_button">'+AV.getLocalizedString("Send Feedback")+"</a>","</div>",'<div class="avpw_vertical_separator"></div>','<div class="avpw_popup_split_box">','<h2 class="avpw_mode_warning">About this Editor</h2>',"<p>Aviary is the world's leading photo editing platform. Developers: learn how to add it to your web app in minutes.</p>",'<a href="'+AV.launchData["getWidgetURL"]+'" target="_blank" class="avpw_button avpw_primary_button">'+AV.getLocalizedString("Visit Aviary.com")+"</a>","</div>",'<div class="avpw_horizontal_separator"></div>','<div class="">','<div class="avpw_message_buttons avpw_center_contents">','<div id="avpw_close_feedbackok" class="avpw_button">Close</div>',"</div>","</div>","</div>",'<div id="avpw_aviary_unsupported" class="avpw_app_popup">','<p class="avpw_message_text">',AV.getLocalizedString("Please install {Adobe Flash Player} (version {min} or higher), or use a supported browser: {Chrome}, {Firefox}, {Safari}, {Opera}, or {Internet Explorer} (version 9 or higher).").replace("{Adobe Flash Player}",'<a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash Player</a>').replace("{min}",AV.build.MINIMUM_FLASH_PLAYER_VERSION).replace("{Chrome}",'<a href="http://www.google.com/chrome/" target="_blank">Chrome</a>').replace("{Firefox}",'<a href="http://www.mozilla.org/firefox/" target="_blank">Firefox</a>').replace("{Safari}",'<a href="http://www.apple.com/safari/" target="_blank">Safari</a>').replace("{Opera}",'<a href="http://www.opera.com/" target="_blank">Opera</a>').replace("{Internet Explorer}",'<a href="http://www.beautyoftheweb.com/" target="_blank">Internet Explorer</a>'),"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_close_unsupported" class="avpw_button" href="#Close">'+AV.getLocalizedString("Close")+"</a>\n","</div>","</div>",'<div id="avpw_aviary_crop_invalid_dimensions" class="avpw_app_popup">','<p class="avpw_message_text">',AV.getLocalizedString("Your photo is smaller than the required size. Please choose a new one to proceed."),"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_close_forcecrop_close" class="avpw_button" href="#Close">'+AV.getLocalizedString("Close")+"</a>\n","</div>","</div>"].join("")};tmpl.scrollPanelPip=function(o){return'<li class="avpw_page avpw_is_navpip" pagenum="'+o.i+'" id="avpw_navpip_'+o.i+'">&bull;</li>\n'};tmpl.slider=function(o){return['<div class="avpw_slider_container avpw_isa_slider_container">','<div class="avpw_slider_bookend avpw_slider_bookend_left avpw_slider_label">',"-","</div>",'<div class="avpw_slider_outer_bg_outline_circle"></div>','<div class="avpw_slider_positioned" id="'+o.id+'">','<div class="avpw_slider_outer_bg_circle"></div>','<div class="avpw_slider_inner_bg_outline_circle"></div>','<div class="avpw_slider_positioned_inner">','<div class="avpw_slider_inner_bg_circle"></div>','<div class="avpw_slider_bounds" >','<div class="avpw_slider_goo"></div>',o.divider?'<div class="avpw_slider_divider"></div>':"",'<a class="avpw_slider_handle"></a>',"</div>","</div>","</div>",'<div class="avpw_slider_bookend avpw_slider_bookend_right avpw_slider_label">',"+","</div>","</div>"].join("")};tmpl.zoomModeOverlay=function(){return['<div id="avpw_zoom_mode_overlay">','<div id="avpw_zoom_mode_text">','<h2 class="avpw_mode_warning">',AV.getLocalizedString("Zoom Mode"),"</h2>",AV.getLocalizedString("Click to release"),"</div>","</div>"].join("")};tmpl.zoomControls=function(){return['<div id="avpw_zoom_container">','<div id="avpw_zoom_button">','<div id="avpw_zoom_icon"></div>',"</div>",'<div class="avpw_zoom_slider_container avpw_isa_slider_container">','<div class="avpw_slider_bookend avpw_slider_bookend_left">-</div>','<div id="avpw_zoom_inner"></div>','<div id="avpw_zoom_slider">','<a id="avpw_zoom_handle"></a>',"</div>",'<div class="avpw_slider_bookend avpw_slider_bookend_right">+</div>',"</div>","</div>"].join("")};tmpl.presetIndicator=function(){return['<div class="avpw_preset_indicator_outer">','<div class="avpw_preset_indicator">',"</div>","</div>"].join("")};tmpl.cropCustomControl=function(o){return['<div class="avpw_crop_custom_control avpw_isa_preset_crop" data-crop="Custom">','<div class="avpw_crop_custom_control_left">','<div class="avpw_crop_preset_visual"></div>','<div class="avpw_preset_label avpw_label">',AV.getLocalizedString("Custom"),"</div>","</div>",'<div class="avpw_crop_custom_control_right">','<input id="avpw_crop_custom_width" class="avpw_text_input avpw_number_input" type="text" placeholder="width" maxlength="5"  />','<input id="avpw_crop_custom_height" class="avpw_text_input avpw_number_input" type="text" placeholder="height" maxlength="5" />','<div class="avpw_crop_lock_group"><input id="avpw_crop_custom_lock_dims" type="checkbox" /> <span>'+AV.getLocalizedString("Lock Dimensions")+"</span> </div>","</div>","</div>"].join("")};tmpl.cropPreset=function(o){var topOffset=20,leftOffset=-3;var dims=o.label.split(":");var maxDim=30,targetW=30,targetH=30;var w=o.width,h=o.height;var ratio;if(w===h){targetH=targetW=maxDim}else if(w>h){targetW=maxDim;ratio=maxDim/w;targetH=h*ratio}else{targetH=maxDim;ratio=maxDim/h;targetW=w*ratio}var styleStr="width:"+targetW+"px;height:"+targetH+"px;margin-left:"+(-targetW/2+leftOffset)+"px;margin-top:"+-(targetH-topOffset)/2+"px";return['<div class="avpw_preset_crop_icon avpw_preset_icon avpw_icon avpw_with_indicator avpw_isa_preset_crop" data-crop="'+o.label+'">',o.strict||o.labeled?"":tmpl.cropPresetFlippedIndicator(),'<div class="avpw_crop_preset_visual" style="'+styleStr+'"></div>','<div class="avpw_preset_label avpw_label">',o.label,"</div>",tmpl.presetIndicator(),"</div>"].join("")};tmpl.cropPresetFlippedIndicator=function(o){return['<div class="avpw_crop_preset_flipped_indicator_shadow">','<div class="avpw_crop_preset_flipped_indicator_left"></div>','<div class="avpw_crop_preset_flipped_indicator_right"></div>',"</div>",'<div class="avpw_crop_preset_flipped_indicator">','<div class="avpw_crop_preset_flipped_indicator_left"></div>','<div class="avpw_crop_preset_flipped_indicator_right"></div>',"</div>"].join("")};tmpl.brushIcon=function(o){var classes="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush";if(o.isFirst){classes+=" avpw_inset_button_first"}else if(o.isLast){classes+=" avpw_inset_button_last"}return['<div class="'+classes+'" data-size="'+o.size+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_'+o.size+'">',"</div>","</div>"].join("")};tmpl.brushIconLarge=function(o){return['<div class="avpw_preset_icon avpw_icon avpw_with_indicator avpw_isa_preset_brush" data-size="'+o.size+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_'+o.size+'">',"</div>",tmpl.presetIndicator(),"</div>"].join("")};tmpl.brushColorIcon=function(o){return['<div class="avpw_brush_color_icon avpw_icon avpw_isa_preset_color" data-color="'+o.color+'">','<div class="avpw_preset_color_image" style="background: '+o.color+';">',"</div>",o.extra?o.extra:"","</div>"].join("")};tmpl.brushSizesSet=function(o){o||(o={});o.sizes||(o.sizes=AV.brushWidths);var idHTML="";if(o.id&&o.id!=""){idHTML='id="'+o.id+'"'}return["<div "+idHTML+' class="avpw_inset_button_group avpw_inset_group avpw_brush_set">','<div class="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush avpw_inset_button_first" data-size="'+o.sizes[0]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_1"></div>',"</div>",'<div class="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush avpw_collapsible" data-size="'+o.sizes[1]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_2"></div>',"</div>",'<div class="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush" data-size="'+o.sizes[2]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_3"></div>',"</div>",'<div class="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush avpw_collapsible" data-size="'+o.sizes[3]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_4"></div>',"</div>",'<div class="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush avpw_inset_button_last" data-size="'+o.sizes[4]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_5"></div>',"</div>","</div>",o.hideLabel?"":'<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">'+AV.getLocalizedString("Brush Size")+"</div>"].join("")};tmpl.colorPickerIcon=function(o){return['<div class="avpw_inset_color_picker avpw_inset_button avpw_inset_button_first avpw_isa_color_picker" data-color="">','<div class="avpw_preset_icon avpw_icon">','<div class="avpw_preset_color_image avpw_custom_color_image avpw_isa_color_feedback">',"</div>",'<div class="avpw_dropdown_icon">','<div class="avpw_dropdown_icon_inner">',"</div>","</div>","</div>","</div>"].join("")};tmpl.colorPickerContainer=function(o){return['<div class="avpw_dropdown_popup avpw_color_picker_dropdown_popup">','<div class="avpw_dropdown_tail"></div>','<div class="avpw_color_picker_background"></div>','<div class="avpw_color_picker_preview avpw_isa_color_feedback">',"</div>",'<a class="avpw_button avpw_color_picker_confirm">',AV.getLocalizedString("Set Color"),"</a>","</div>"].join("")};tmpl.brushPreviewOverlay=function(o){return['<div id="avpw_brush_preview_container" class="avpw_brush_preview avpw_selection_overlay_selected">','<canvas height="100" width="100" class="avpw_brush_preview_display"></canvas>',"</div>"].join("")};tmpl.cropLayer=function(o){return['<div class="avpw_crop_layer">','<div class="avpw_crop_outside avpw_crop_outside_n"></div>','<div class="avpw_crop_outside avpw_crop_outside_s"></div>','<div class="avpw_crop_outside avpw_crop_outside_e"></div>','<div class="avpw_crop_outside avpw_crop_outside_w"></div>',tmpl.alignmentGrid({numLines:3,lineWidth:1}),'<div class="avpw_crop_handle avpw_crop_handle_tl"></div>','<div class="avpw_crop_handle avpw_crop_handle_tr"></div>','<div class="avpw_crop_handle avpw_crop_handle_bl"></div>','<div class="avpw_crop_handle avpw_crop_handle_br"></div>',tmpl.cropLayerToolTip(),"</div>"].join("")
};tmpl.cropLayerToolTip=function(o){return['<div id="avpw_crop_tooltip">','w: <span id="avpw_crop_tooltip_w">800</span><br/>','h: <span id="avpw_crop_tooltip_h">600</span>',"</div>"].join("")};tmpl.frameThicknessIcon=function(o){var framesize=o.thickness+"px";var max=24-2*o.thickness;var boxSize=max+"px";return['<div class="avpw_preset_icon avpw_icon avpw_isa_preset_thickness" data-thickness="'+o.thickness+'">','<div class="avpw_preset_thickness_image" ','style="border-width: '+framesize+";","width: "+boxSize+";","height: "+boxSize+';"',">","</div>","</div>"].join("")};tmpl.fontGroupPopup=function(o){return['<div id="avpw_font_popup" class="avpw_dropdown_popup" style="display: none;">','<div class="avpw_dropdown_tail"></div>','<div class="avpw_dropdown_popup_inner">','<ul class="avpw_dropdown_popup_list">',"</ul>","</div>","</div>"].join("")};tmpl.fontGroupPopupItem=function(o){var className="";if(o.label&&o.label.toLowerCase){className="avpw_font_"+o.label.toLowerCase().replace(/\ /g,"");if(o.custom){className+=" avpw_font_custom_image"}}return['<li class="avpw_preset_font avpw_dropdown_popup_list_item avpw_isa_dropdown_item" data-value="'+o.label+'">','<div class="avpw_font_image '+className+'">',o.label,"</div>","</li>"].join("")};tmpl.fontSizePopup=function(o){return['<div id="avpw_font_size_popup" class="avpw_dropdown_popup" style="display: none;">','<div class="avpw_dropdown_tail"></div>','<div class="avpw_dropdown_popup_inner">','<ul class="avpw_dropdown_popup_list">',"</ul>","</div>","</div>"].join("")};tmpl.fontSizePopupItem=function(o){return['<li class="avpw_preset_font_size avpw_dropdown_popup_list_item avpw_isa_dropdown_item" data-value="'+o.value+'">',o.label,"</li>"].join("")};tmpl.selectionOverlay=function(o){return['<div id="'+(o.id?o.id:"")+'" style="z-index:'+o.zIndex+';" class="avpw_selection_overlay">',o.body?o.body:"",'<div class="avpw_selection_overlay_size_handle"></div>',tmpl.closeButton({className:"avpw_selection_overlay_close_button",text:AV.getLocalizedString("Remove")}),"</div>"].join("")};tmpl.imageOverlayBody=function(o){return['<img class="avpw_selection_overlay_image" src="'+(o.src||"")+'"></img>'].join("")};tmpl.textEntryOverlayBody=function(o){return['<canvas class="avpw_textwithfont_writer"></canvas>','<textarea class="avpw_textwithfont_entry" cols="20" rows="1" wrap="soft" spellcheck="false">',"</textarea>"].join("")};tmpl.textEntryOverlayProxy=function(o){return['<pre class="avpw_textwithfont_overlay_proxy">','<span class="avpw_proxy_get_height"> </span>',"</pre>"].join("")};tmpl.textEntryOutlineStyle=function(o){var sincosPI4=.707;var sinPI8=.383;var cosPI8=.924;var size=o.size?o.size/2:1;return["-"+size+"px 0 "+o.color+",","-"+cosPI8*size+"px -"+sinPI8*size+"px "+o.color+",","-"+sincosPI4*size+"px -"+sincosPI4*size+"px "+o.color+",","-"+sinPI8*size+"px -"+cosPI8*size+"px "+o.color+",","0 -"+size+"px "+o.color+",",sinPI8*size+"px "+cosPI8*size+"px "+o.color+",",sincosPI4*size+"px -"+sincosPI4*size+"px "+o.color+",",cosPI8*size+"px "+sinPI8*size+"px "+o.color+",",size+"px 0 "+o.color+",",cosPI8*size+"px "+sinPI8*size+"px "+o.color+",",sincosPI4*size+"px "+sincosPI4*size+"px "+o.color+",",sinPI8*size+"px "+cosPI8*size+"px "+o.color+",","0 "+size+"px "+o.color+",","-"+sinPI8*size+"px "+cosPI8*size+"px "+o.color+",","-"+sincosPI4*size+"px "+sincosPI4*size+"px "+o.color+",","-"+cosPI8*size+"px "+sinPI8*size+"px "+o.color].join("")};tmpl.blankPreset=function(){return['<div class="avpw_preset_icon avpw_icon avpw_preset_icon_disabled">',"</div>"].join("")};tmpl.blankCropPreset=function(){return['<div class="avpw_preset_crop_icon avpw_preset_icon avpw_icon avpw_preset_icon_disabled">',"</div>"].join("")};tmpl.stickerThumbnail=function(o){return['<div class="avpw_icon avpw_overlay_icon avpw_isa_control_selector_overlay" thumburl="'+o.thumburl+'" fullimageurl="'+o.url+'">','<div class="avpw_icon_image avpw_overlay_image avpw_header_inline_center">','<img draggable="false" src="'+o.thumburl+'" fullimageurl="'+o.url+'"></img>',"</div>",'<div class="avpw_icon_waiter avpw_center_contents avpw_isa_overlay_waiter">',"</div>","</div>"].join("")};tmpl.stickerRollInner=function(o){return['<img draggable="false" height="60" width="60" class="avpw_stickerpack_image" ','src="'+o.thumburl+'"></img>','<span class="avpw_icon_label avpw_label">'+o.label+"</span>"].join("")};tmpl.stickerRoll=function(o){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_stickerpack_icon avpw_isa_control_selector_stickerpack" data-pack="'+o.id+'">',tmpl.stickerRollInner(o),"</div>"].join("")};tmpl.stickerRollDisabled=function(o){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_stickerpack_icon avpw_isa_control_selector_stickerinfo" data-pack="'+o.id+'">',tmpl.stickerRollInner(o),'<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")};tmpl.filterThumbnail=function(o){var preview=o.thumburl?'<img draggable="false" height="63" width="63" class="avpw_filter_icon_image" src="'+o.thumburl+'"></img>':'<canvas draggable="false" height="63" width="63" class="avpw_filter_icon_image avpw_isa_previewcanvas"></canvas>';return['<div class="avpw_icon avpw_filter_icon avpw_isa_control_selector_filter" data-frame="'+o.frame+'" data-filtername="'+o.id+'">',tmpl.presetIndicator(),preview,'<span class="avpw_icon_label avpw_label">'+o.label+"</span>",'<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")};tmpl.filterCanisterInner=function(o){return['<img draggable="false" height="75" width="54" class="avpw_filterpack_image" ','src="'+o.thumburl+'"></img>','<span class="avpw_icon_label avpw_label">'+o.label+"</span>"].join("")};tmpl.filterCanister=function(o){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_filterpack_icon avpw_isa_control_selector_filterpack" data-pack="'+o.id+'">',tmpl.filterCanisterInner(o),"</div>"].join("")};tmpl.filterCanisterDisabled=function(o){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_filterpack_icon avpw_isa_control_selector_filterinfo" data-pack="'+o.id+'">',tmpl.filterCanisterInner(o),'<img draggable="false" height="75" width="54" class="avpw_filterpack_tag_image" src="'+o.tagurl+'"></img>','<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")};tmpl.frameThumbnail=function(o){return['<div class="avpw_filter_icon avpw_icon avpw_isa_control_selector_frame" data-framename="'+(o.frameName?o.frameName:0)+'">',tmpl.presetIndicator(),'<canvas height="63" width="63" class="avpw_filter_icon_image" style="background-image: url('+AV.build["feather_baseURL"]+'images/border_thumb.jpg);"></canvas>','<span class="avpw_icon_label avpw_label">'+o.label+"</span>","</div>"].join("")};tmpl.straightenSlider=function(){return['<div class="avpw_straighten_ui avpw_straighten_ui_animate" id="avpw_straighten_container">','<div class="avpw_straighten_ui_grid avpw_straighten_ui_grid_animate" id="avpw_straighten_grid"></div>','<a id="avpw_straighten_handle">',"</a>","</div>"].join("")};tmpl.alignmentGridBox=function(o){return['<div class="avpw_ui_grid_box '+o.classes+'" style="'+o.styles+'">','<div class="avpw_ui_grid_box_inner avpw_ui_grid_box_inner_n" style="'+o.northStyles+'"></div>','<div class="avpw_ui_grid_box_inner avpw_ui_grid_box_inner_w" style="'+o.westStyles+'"></div>',"</div>"].join("")};tmpl.alignmentGrid=function(o){var numLines=o.numLines||3;var lineWidth=o.lineWidth||1;var i,j;var left,top,size=100/numLines;var styles,classes,northStyles,westStyles;var html='<div style="border-right-width: '+lineWidth+"px; border-bottom-width: "+lineWidth+"px; margin: -"+lineWidth/2+"px 0 0 -"+lineWidth/2+'px;" class="avpw_ui_grid">';for(i=0;i<numLines;i++){for(j=0;j<numLines;j++){top=i*100/numLines;left=j*100/numLines;styles=["left: "+left+"%;","top: "+top+"%;","width: "+size+"%;","height: "+size+"%;"].join("");northStyles=["left: "+lineWidth+"px;","height: "+lineWidth+"px;"].join("");westStyles=["width: "+lineWidth+"px;"].join("");classes="";if(i===numLines/2){classes+="avpw_ui_middle_grid ";northStyles=["left: 0;","height: "+lineWidth+"px;"].join("")}if(j===numLines/2){classes+="avpw_ui_center_grid "}html+=tmpl.alignmentGridBox({classes:classes,styles:styles,northStyles:northStyles,westStyles:westStyles})}}html+="</div>";return html};tmpl.canvasControls=function(){return['<div class="avpw_canvas_controls" id="avpw_canvas_controls_layer">',"</div>"].join("")};tmpl.flashCanvasBox=function(o){return['<table role="presentation" border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">','<tr><td width="100%" height="100%" valign="middle" align="center">','<div id="'+o.id+'"></div>',"</td></tr>","</table>"].join("")};tmpl.advancedToolsSplitter=function(){return['<div class="avpw_advanced_splitter">','<div class="avpw_advanced_splitter_inner">','<div class="avpw_advanced_splitter_control">','<div class="avpw_advanced_splitter_bottom_shadow"></div>','<div class="avpw_advanced_splitter_bottom"></div>','<div class="avpw_advanced_splitter_middle">','<a class="avpw_advanced_splitter_up_arrow"></a>','<a class="avpw_advanced_splitter_down_arrow"></a>',"</div>","</div>","</div>","</div>"].join("")}}(AV.template=AV.template||{});if(typeof AV=="undefined"){AV={}}!function(lang){lang["es"]={Classic:"Clásico",Grunge:"Desgastado",Nostalgia:"Nostálgico",Original:"Original",Tidal:"De marea",Viewfinder:"Visor","Toy Camera":"Cámara de Juguete","Add beautiful light leaks, colors, and distortions with this artistic pack of toy lens effects.":"Añadir bonitas fugas de luz, colores y distorsiones con este paquete artístico de efectos de lente de juguete.","Chill out with this hip pack of 6 washed out effects. Perfect for parties or a day at the beach.":"Relájese con este fabuloso paquete de 6 efectos deslavados. Perfecto para fiestas o un día en la playa.","Enjoy the awesome look and feel of the original Aviary effects with this pack of 12 classics.":"Disfrute del sensacional aspecto y tacto de efectos Aviary con este paquete de 12 clásicos.","Get started with this free pack of effects that make every photo look beautiful.":"Comienza con este paquete de efectos gratuito que embellecen todas las fotos.","No need to be a real rock star to take photos like one. Add some volume to your life with these 6 gritty effects.":"Añade un poco de polvo y desgaste a tus fotos con estos seis efectos mugrientos.","See your world through the lenses of some super-cool cameras with these 6 high-tech effects.":"Ve tu mundo un poco diferente con estos seis efectos de cámara de alta tecnología.","Turn your life’s moments into classic, vintage memories with these 6 timeless effects.":"Rememora preciados momentos y buenos tiempos con nuestros seis efectos de nostalgia de ensueño.","Get started with this free pack of beautiful, high resolution frames.":"Empieza con este paquete gratuito de hermosos marcos de alta resolución.",Animals:"Animales",Football:"Fútbol americano",Galaxy:"Galaxy",Halloween:"Halloween",Hats:"Sombreros",Helmets:"Cascos",Holiday:"Festivo",Mustaches:"Bigotes",Space:"Espacio",Thanksgiving:"Acción de Gracias","Available for a limited time only, this pack features monster masks, creepy costumes and more! Includes 30 spooky stickers.":"Solo disponible durante un tiempo limitado, este paquete incluye máscaras de monstruos, disfraces espeluznantes y otras pegatinas de miedo. Incluye 30 cromos fantasmales.","Celebrate the most wonderful time of the year with this holiday-themed pack of Christmas, Hanukkah and Winter stickers.":"Celebre la época más maravillosa del año con este paquete temático de 30 etiquetas adhesivas de Navidad, Hanukkah e Invierno.","Cover up that dome with a healthy dose of hats! Perfect for your new disguise or simply hiding that bad hair day! Includes 15 head-covering hats.":"¡Cubra esa cabeza con esta saludable dosis de 15 sombreros! Perfectos para su nuevo disfraz ¡o simplemente para ocultar ese mal día de su cabellera!","Decorate all of your photos with this fun and totally free pack of hats, eyewear, neckwear, speech bubbles, shapes and more!":"Incluye una gran variedad de sombreros divertidos, collares, bocadillos, sombras y más, ¡este paquete incluye cromos irresistibles para pegar sobre tus fotos!","Featuring a variety of wacky, weird, strong, and sturdy helmets, this pack is perfect for any dangerous situation! Includes 15 super-safe stickers.":"Presentando 15 cascos alocados, raros, fuertes y sólidos, ¡este paquete es perfecto para cualquier situación peligrosa!","Get started with this fun and free pack of high resolution stickers.":"Comienza con este paquete de pegatinas de alta resolución divertido y gratuito.","Go even further into space with this stellar pack of nebulae, stars, and beautiful bursts.":"¡Adéntrate en las profundidades del espacio con este paquete estelar de nebulosas, estrellas, explosiones y mucho más!","Just in time for the season, this pack of fun football stickers is perfect for your game day photos! Includes 15 sporty stickers and bonus jersey numbers!":"Justo a tiempo para la temporada, este paquete de cromos divertidos es perfecto para jugar con las fotos que hagas en el gran partido. Incluye 15 cromos de deporte, ADEMÁS DE un conjunto extra de números de camiseta! ","Make your Turkey Day extra special with this fun pack of Thanksgiving hats and Autumn-themed goodies!  Includes 15 delicious stickers.":"¡Haga de su Día del Pavo algo extra especial con este divertido paquete temático de 15 gorros de Día de Gracias y Otoño!","Spice up friends’ faces with these hip, silly, iconic and ironic mustaches. Includes 15 super-stylish ‘staches, PLUS 3 bonus beards!":"Dale vida a las caras de tus amigos con una gran variedad de bigotes: clásicos, tontos, icónicos, aquel que llevaba el moderno que siempre veías en la cafetería. Incluye 15 “bigotestilosos”. ¡ADEMÁS, también incluimos 3 barbas extra porque te queremos!","Transform your friends into wild animals with this pack of animal snouts, tails, mouths ears and more!  Includes 15 furry stickers.":"¡Convierte a tus amigos en animales bonitos, mimosos, fieros y juguetones con el paquete de cromos de animales! Incluye 15 cromos peludos.","Your photos will be out of this world with this cosmic pack of planets and more! Free for a limited time":"¡Tus fotos saldrán fuera de este mundo con este paquete cósmico de planetas y mucho más! Gratis por tiempo limitado.","Your photos will be out of this world with this cosmic pack of planets and more!":"¡Tus fotos saldrán fuera de este mundo con este paquete cósmico de planetas y mucho más! ","Go even further into space with this stellar pack of nebulae, stars, and beautiful bursts.":"Viaja aún más lejos en el espacio con este paquete estelar de nebulosas, estrellas, y bellos brotes estelares.","1 4x6 image":"1 imagen de 4 x 6","A filter pack has been updated. Click ok to reload the packs list.":"Se ha actualizado un paquete de filtro. Haz clic en “aceptar” para volver a cargar la lista de paquetes","A sticker pack has been updated. Click ok to reload the packs list.":"Se ha actualizado un paquete de pegatina. Haz clic en “aceptar” para volver a cargar la lista de paquetes","A sticker pack has been updated. We need to reload the current panel.":"Se ha actualizado un paquete de pegatina. Necesitamos volver a cargar el panel actual","A sticker pack has been updated. We need to reload the current panel. Do you want to apply the current sticker?":"Se ha actualizado un paquete de pegatina. Necesitamos volver a cargar el panel actual. ¿Quieres aplicar la pegatina actual?",About:"Sobre","About this editor":"Acerca de este editor",Accounts:"Cuentas","Active Tools":"Herramientas activas",Activity:"Actividad",Add:"Añadir","Add a comment":"Añade un comentario","Add a Tilt Shift effect":"Añadir un efecto maqueta (Tilt Shift)","Add Text":" + texto",Adjust:"Ajustar","Adjust color tone":"Ajustar el tono de color",Albums:"Álbumes","Already purchased? Tap below to restore all your in-app purchases for free.":"¿Ya lo has comprado? Pulsa más abajo para restaurar todas tus compras integradas gratuitamente.","Always ask me to share after editing":"Preguntarme siempre si deseo compartir después de editar","An error occurred":"Ha ocurrido un error","And we're adding more Effects, Stickers, and Frames all the time - so stay tuned!":"Y añadimos nuevos Efectos, Calcomanías y Marcos todo el tiempo, así que ¡manténte en sintonía!","App Store":"App Store",Apply:"Aplicar","Applying action %2$i of %2$i":"Aplicando acción %2$i de %2$i","Applying effects":"Aplicando efectos","Are you sure you don't want to share this photo?":"¿Estás seguro de que no quieres compartir esta foto?","Are you sure you want to discard changes from this tool?":"¿Estás seguro de que quieres desechar los cambios de esta herramienta?","Are you sure you want to remove this sticker?":"¿Estás seguro de que quieres quitar esta pegatina?","Are you sure?":"¿Está seguro?","Are you sure? This can distort your image":"¿Estás seguro? Esto puede distorsionar la imagen",Artist:"Artista",Attention:"Atención",Auto:"Auto",Aviary:"Aviary","Aviary Editor":"Aviary Editor","Aviary is a free embeddable photo editor that developers can add to their app in just minutes.":"Aviary es un SDK disponible para iOS y Android que te permite agregar capacidades de edición de fotos y efectos a tu aplicación con sólo un par de líneas de código.","Aviary is the world's leading photo editing platform. Developers: learn how to add it to your app in minutes.":"Aviary es la plataforma de edición fotográfica líder en el mundo. Desarrolladores: aprenda a añadirlo a su aplicación en unos minutos.","Aviary SDK Feedback":"Feedback del SDK Aviary","Awesome new Effects & Stickers":"Nuevos Efectos y Adhesivos impresionantes ",Back:"Volver",Backlit:"Contraluz",Balance:"Equilibrio","Beautiful new interface":"Preciosa nueva interfaz","Best for everyday use (recommended)":"Mejor para uso diario (recomendado)","Best for printing and maintaining a high level of detail":"Mejor para imprimir y mantener alto nivel de detalle","Best for quick saves and basic sharing":"Mejor para guardado rápido y compartición básica","Biggest size":"Tamaño grande",Blemish:"Mancha",Blur:"Difuminar","Bottom line":"Línea inferior","Brand new Effects make your photos look beautiful. Check out the new Woodland pack - perfect for outdoor photos!":"Nuevos efectos hacen que tus fotos se vean bellas. Revisa el nuevo paquete de efectos Woodland: ¡es perfecto para fotos al aire libre!",Brightness:"Brillo",Brush:"Cepillo","Brush Size":"Punto","Brush softness":"Pincel suave","Calculated in store":"Calculado en tienda","Calculating Discount":"Calculando descuento",Camera:"Cámara",Cancel:"Cancelar",Cellular:"Móvil","Check out this photo":"Eche un vistazo a esta foto","Checking for content updates...":"Comprobando actualizaciones de contenido...",Checkout:"Caja","Choose a Quantity":"Elija una cantidad","Choose a Size":"Elija un tamaño","Choose Color":"Elegir color","Choose the destination folder":"Elige la carpeta de destino",Circle:"Círculo",Close:"Cerrar",Cloud:"Nube",Color:"Color","Color Fix":"Retoques de color","Color Picker":"Seleccionador de Color",Colors:"Colores",Configure:"Configurar",Confirm:"Confirmar","Contact Info":"Información de contacto","Contact Info":"Información de contacto",Contrast:"Contraste","Couldn't save photo":"No se pudo guardar la foto","Coupon Code (Optional)":"Código de cupón (opcional)",Crop:"Recortar","Crop again":"Intentar de nuevo","Current Location":"Ubicación actual",Custom:"Personal",Delete:"Borrar","Delete selected":"Eliminar seleccionados",Demo:"Demo","Destination folder":"Carpeta de destino",Details:"Detalles","Developers: Get this editor!":"Desarrolladores: ¡Usen este editor!",Disable:"Desactivar","Disabled Tools":"Herramientas desactivadas",Discard:"Desechar",Disconnect:"Desconectar","Don't ask me again":"No volver a preguntarme","Don't Share":"No comparte",Done:"Listo",Download:"Descargar","Drag corners to resize crop area":"Arrastre las esquinas para cambiar el tamaño",Draw:"Dibujo","e-mail address":"Correo electrónico",Edit:"Editar","Edit Bottom Text":"Editar texto inferior","Edit this Photo":"Editar esta foto","Edit Top Text":"Editar texto superior","Edited with Aviary: %@":"Editado con Aviary: %@",Editor:"Editor",Effect:"Efecto",Effects:"Efectos",Email:"Correo electrónico",Email:"Email",Enhance:"Realzar","Enter city, state or zip":"Ingresa ciudad, estado o código postal","Enter text here":"Escribir texto aquí",Eraser:"Borrador",Eraser:"Borrador",Error:"Error","Estimated Pickup Time":"Hora de recolección estimada",Exit:"Salida",Featured:"Destacado","Featured Effects: Toy Camera":"Efectos especiales: Toy Camera",Feedback:"Feedback","File saved":"Archivo guardado",Finish:"Terminar","Finished Printing":"Impresión finalizada","First Name":"Nombre",Flip:"Voltear",Focus:"Enfoque",Frame:"Marco",Frames:"Marcos",Free:"Libre",Free:"Libre","Free Color":"Color libre",Freeform:"Sin límites.","Fresh Effects & Stickers":"Efectos y pegatinas frescos",Gallery:"Galería",General:"General","Get More":"Más","Get this editor":"Obtener este editor","Get this pack!":"¡Obtén este paquete!","Review Aviary in the Google Play Store!":"¡Valóranos con 5 estrellas!","Give feedback":"Observaciones","Go!":"¡Adelante!",Greeneye:"Ojo verde","Happy editing!":"¡Feliz Edición!","Hard Brushes":"Pincelada fuerte","Have a suggestion to improve this photo editor? Let us know.":"¿Alguna sugerencia para mejorar este editor de fotografía? Háganoslo saber.",Height:"Alto","Help / Support":"Ayuda / Asistencia","Hi-Def":"Alta definición",Hide:"Ocultar",Illuminate:"Iluminar","Image saved in %1$s. Do you want to see the saved image?":"Imagen guardada en %1$s. ¿Quieres ver la imagen guardada?","In order to send emails, you need to set up an email account in the Settings app.":"Para enviar emails, ha de establecer una cuenta de email en los ajustes de la aplicación.",Install:"Instalar","Install Aviary's free pack of beautiful high resolution frames to get started.":"Instala el paquete gratuito de preciosos marcos de alta resolución de Aviary para comenzar. ","Install Aviary's free pack of beautiful high resolution stickers to get started.":"Instala el paquete gratuito de preciosas pegatinas de alta resolución de Aviary para comenzar.","Install this free pack of beautiful high resolution frames to get started.":"Instale este pack gratuito de bonitos marcos en alta resolución y empiece a usarlo.","Install this free pack of beautiful high resolution stickers to get started.":"Instale este pack gratuito de bonitas pegatinas en alta resolución y empiece a usarlo.",Installed:"Instalado",Installing:"Instalando",Intensity:"Intensidad","Interested? We'll send you some info.":"¿Interesado? Te enviaremos información.","Invalid input.":"Datos no válidos.","Keep editing":"Seguir editando","Large (up to 5MP)":"Grance (hasta 5MP)","Last Name":"Apellido","Learn more!":"¡Más información!","Leave Aviary?":"¿Salir de Aviary?","Leave editor":"Salir del editor","Leave the App?":"¿Abandonar la aplicación?","Loading Image...":"Cargando imagen...","Loading...":"Cargando",Locator:"Localizador","Log out":"Salir","Logged In Social Networks":"Identificado en las redes sociales","Login Failed":"Ha ocurrido un error al iniciar sesión","Love %@":"Valoración %@","Love %@?":"Te gusta %@?","Maintain proportions":"Mantener proporciones",Max:"Máx","Max Save Size":"Tamaño Max. de Guardado","Maximum (up to 15MP)":"Máximo (hasta 15 MP)","Medium size":"Tamaño medio",Meme:"Meme","miles away":"millas de distancia",Min:"Mín",Mirror:"Espejo",More:"Más","More great photo apps":"Otras fantásticas aplicaciones de fotos",Networks:"Redes","New 'Focus' tool shifts focal point":'Nueva herramienta de "Enfoque" que cambia el punto focal',"New 'Warmth' tool modifies tone":'Nueva herramienta de "Calidez" que modifica el tono',"New Effects":"Nuevos Efectos","New Stickers":"Nuevos Adhesivos","New Frames":"Nuevos Marcos",Next:"Siguiente",Night:"Noche","No %@ Accounts":"No %@ Cuentas","No apps installed":"No hay aplicaciones instaladas","No Connection":"Sin conexión","No effects found for this pack.":"No se encontraron efectos para este paquete","No stickers defined in Feather_Stickers.":"No hay etiquetas definidas en Feather_Stickers","No thanks":"No, gracias","No, thanks.":"No, gracias. ",None:"Ninguno","Normal (up to 3MP)":"Normal (hasta 3MP)",OK:"Ok",Okay:"Ok","Old Photo":"Foto antigua","Oops, there was an error trying to save the image to the Aviary folder. Do you want to try to save it to the default camera folder?":"¡Vaya!, ha habido un error al intentar guardar la imagen en la carpeta de Aviary. ¿Quieres intentar guardarla en la carpeta predeterminada de la cámara?","Oops, there was an error while saving the image.":"¡Vaya!, ha habido un error al guardar la imagen.","Oops! I crashed, but a report has been sent to my developer to help him fix the issue!":"¡Vaya! ¡He tenido un fallo, pero he enviado un informe a mi desarrollador para ayudarle a solucionar el problema!",Open:"Abrir","Open In...":"Abrir en...",Options:"Opciones",Order:"Orden",Orientation:"Orientado",Original:"Original","Original (no limit)":"Original (sin límite)","Original size":"Tamaño original","Output Folder":"Carpeta de salida","Output Image Size":"Tamaño de la imagen",Password:"Contraseña",Phone:"Teléfono","Photo Editor":"Editor de fotos","Photo Sources":"Fuentes de fotos",Photos:"Fotos","Pick a Photo":"Elegir una foto","Pick-up & Pay Location":"Ubicación de recolección y pago","Pick-Up Location":"Ubicación de recolección",Pinch:"Contraer","Please Connect":"Por favor, conéctate","Please enter a valid email address.":"Por favor ingrese un email válido.","Please enter a valid phone number.":"Por favor ingrese un número telefónico válido.","Please enter your first name.":"Por favor ingrese su nombre.","Please enter your last name.":"Por favor ingrese su apellido.",Power:"Poder","Powered by":"Desarrollado por","Powered by Aviary.com":"Desarrollado por Aviary.com","Preset Sizes":"Tamaño",Prev:"Anterior",Preview:"Vista previa",Price:"Precio",Print:"imprimir","Print to":"Imprimir en","Print to Walgreens":"Imprimir en Walgreens ","Print\\nPreview":"Print\\nPreview",Prints:"Impresiones",Prints:"Impresiones","Privacy Info":"Información de privacidad",Quantity:"Cantidad","Rate %@":"Valoración %@","Rate %@ in the App Store!":"¡Califica %@ en la App Store!","Rate us in the App Store!":"¡Califícanos en la App Store!","Recalculating Price":"Recalculando precio",Rectangle:"Rectángulo",Redeye:"Ojos rojos",Redo:"Rehacer","Remind me later":"Recordar luego",Remove:"Suspender",Reset:"Restablecer",Resize:"Reducir",Restore:"Restablecer",Resume:"Resumen","Revert to original?":"¿Volver al original?",Rotate:"Girar",Saturation:"Saturación",Save:"Guardar","Saving...":"Guardando...",Select:"Seleccionar","Select Account":"Seleccionar cuenta","Select Quantity":"Seleccione una cantidad","Select Size":"Seleccione un tamaño",Send:"Enviar","Send Feedback":"Enviar feedback","Set color":"Selecciona color","Set up Mail":"Establecer email",Settings:"Configuración",Shape:"Figura",Shapes:"Figuras",Share:"Comparte","Share failed.":"Ha ocurrido un error al compartir.","Share failed.":"Hubo un error al compartir.","Share this photo":"Comparte esta foto",Sharing:"Compartir","Sharing Prompt":"Compartir mensaje","Sharing screen":"Pantalla compartir","Sharing...":"Compartir...",Sharpen:"Afinar",Sharpness:"Nitidez",Size:"Tamaño",Size:"Tamaño",Skip:"Omitir","Sleek, streamlined interface design":"Diseño de interfaz elegante y aerodinámico","Small size":"Tamaño pequeño","Smart Color":"Color inteligente",Smooth:"Alise","Social Networks":"Redes sociales","Soft Brushes":"Pincelada suave","Sorry, there's no application on your device to handle this action. Do you want to download it now from the market?":"Lo sentimos, no hay ninguna aplicación en tu teléfono para ejecutar esta acción. ¿Quieres descargarla ahora en el mercado?","Sorry, there's no application on your phone to handle this action.":"Lo sentimos, no hay ninguna aplicación en tu teléfono para ejecutar esta acción",Splash:"Salpicadura",Square:"Cuadrado",Sticker:"Pegatina",Stickers:"Pegatinas",Store:"Tienda",Submit:"Enviar",Submit:"Enviar","Submitting...":"Enviando...","Sure!":"¡Claro!",Tax:"Impuestos",Terms:"Términos","Terms of Use":"Términos de uso",Text:"Texto","Thank you for making Photo Editor by Aviary one of the most popular photo apps for Android. To show our gratitude for all of your amazing feedback, we'd like to introduce you to Photo Editor, version 3.0!":"Gracias por hacer que Photo Editor de Aviary sea una de las apps de fotos más populares para Android. Para demostrar nuestra gratitud por sus increíbles opiniones, ¡queremos mostrarte Photo Editor, versión 3.0!","The 'Enhance' tool as been…enhanced! Hi-Def smartly sharpens and defines, Illuminate fixes poor lighting issues, and Color Fix does amazing color correction.":"¡La herramienta 'Mejorar' ha sido...mejorada! Hi-Def inteligentemente enfoca y define, Iluminar arregla problemas de baja luz, y Arreglo de Color realiza correcciones de colores increíbles. ","The coupon code you have entered is invalid.":"El código de cupón ingresado no es válido.","There is another image editing window open.  Close it without saving and continue?":"Hay otra imagen con el editor abierto. ¿Quiere cerrarla sin guardar los cambios y continuar?","There was an error downloading the image, please try again later.":"Ocurrió un error al descargar la imagen, prueba otra vez más tarde","This all new version has been completely redesigned and features a sleek, streamlined interface. It's faster, cleaner, and even easier to use. Plus: ":"Esta versión totalmente nueva está completamente rediseñada y tiene una interfaz elegante y simplificada. Es más rápida, más limpia y aún más fácil de usar. Además:","This beautiful new effects pack adds light leaks, cool colors, and visual distortions to your photos. Do you want to check it out?":"Este paquete de hermosos efectos nuevos añade filtros de luz, fabulosos colores y distorsiones visuales para tus fotos. ¿Quieres echar un vistazo?","This is an in store pick-up":"* Este pedido debe ser recogido en la tienda","This is an in store pick-up":"Esta es una recolección en tienda","Tip: Never want to share? You can disable this sharing screen in the app settings.":"Truco: ¿No quieres compartir nunca? Puedes inhabilitar esta pantalla de compartir en los ajustes de la aplicación.",Tool:"Herramienta","Tool Order":"Ordenar herramienta","Tool Selection":"Herramienta de Selección",Tools:"Utilidades","Top line":"Línea superior",Undo:"Deshacer",Update:"Actualizar",Version:"Versión",Vibration:"Vibración",View:"Ver","View Image":"Ver imagen","Visit Aviary.com/iOS":"Visite Aviary.com/iOS","Wait! You didn't save your work. Are you certain that you want to close this editor?":"¡Espera! No has guardado los cambios. ¿Estás seguro que deseas cerrar este editor?","Waiting to share.":"Esperando para compartir",Warmth:"Calor","We can't find any %@ accounts linked to this device. Please go into the Settings app, find the %@ settings, and add your %@ account.":"No encontramos ninguna cuenta [[[%@]]] relacionada con este dispositivo. Accede a los Ajustes de la aplicación, encuentra el ajuste [[[%@]]] y añade tu cuenta [[[%@]]].","We were unable to connect to Walgreens. Please check your internet connection and resubmit your order.":"No pudimos conectarnos con Walgreens. Por favor verifique su conexión a internet y reenvíe su orden.","We were unable to connect to Walgreens. Please check your internet connection and try again.":"No pudimos conectarnos con Walgreens. Por favor asegúrate de tener conexión a Internet e intenta de nuevo.","We were unable to determine your location. Please enable Location Services in your device settings and try again.":"No pudimos determinar su ubicación. Por favor active Servicios de Ubicación en su dispositivo e intente de nuevo.","We were unable to determine your location. Please try again.":"No pudimos determinar su ubicación. Por favor intente de nuevo.","We were unable to locate any stores matching your search criteria.":"No pudimos ubicar ninguna tienda que coincida con sus criterios de búsqueda.","We were unable to process your order with Walgreens. Please make sure that your information is correct and resubmit your order":"No pudimos procesar tu pedido con Walgreens. Por favor asegúrate de que la información provista es correcta y envía nuevamente el pedido","We're sorry.":"Lo sentimos.","Welcome to Frames!":"¡Bienvenido a Marcos!","Welcome to Photo Editor, v2.0!":"¡Bienvenido a Photo Editor v2.0!","Welcome to Stickers!":"¡Bienvenido a Pegatinas!","Whats new":"Novedades",Whiten:"Blanquear",Width:"Ancho","Width and height must be greater than zero and less than the maximum ({max}px)":"El ancho y el alto deben ser superiores a cero e inferiores al máximo ({max} px)",WiFi:"Wi-Fi","You are about to delete this photo from your Gallery, not just from Aviary. This action cannot be undone.":"Usted eliminará esta fotografía desde su Galería, no desde Aviary. Esta acción no puede ser deshecha.","You are not connected to the internet. Please reconnect and try again.":"No estás conectado a internet. Conéctate y vuelve a intentarlo.","You can change this property in the Settings panel.":"Puedes cambiar esta propiedad en el panel de Configuración","You did not successfully login to %@. Please go to the Settings app and make sure that the credentials for the account you are trying to use are valid.":"No ha sido posible acceder a %@. Por favor, vaya a la configuración de la aplicación y asegúrese de que las credenciales de la cuenta que está intentando utilizar sean válidas.","You did not successfully login to %@. Please try again.":"Ha ocurrido un error al iniciar sesión en [[[%@]]]. Por favor, inténtalo de nuevo.","You don't have any apps installed that can handle images. Go download some!":"No tienes ninguna aplicación instalada que pueda manipular imágenes. ¡Descarga alguna!","You will not be charged until you pick up your prints":"* No generarás cargos hasta que recojas tus impresiones","You will not be charged until you pick up your prints":"No se le hará ningún cargo hasta recoger sus impresiones","You will now be taken to Safari. Would you like to continue?":"Ahora será llevado a Safari. ¿Desea continuar?","You're about to lose all the changes you've made. Are you sure you want to revert to the original image?":"Estás a punto de perder todos los cambios que realizaste. ¿Estás seguro de que quieres volver a la imagen original?","You're about to lose the changes you've made in this tool. Are you sure you want to leave?":"Estás a punto de perder los cambios que has efectuado con esta herramienta. ¿Estás seguro que deseas salir?","Your image was cropped.":"Tu imagen fue recortada.","Your image was temporarily shrunk to make it easier to edit it. When you hit Save, you will save the full display size.":"Tu imagen ha sido reducida temporalmente para que sea más fácil de editar. Cuando grabes, se guardará el tamaño original.","Your pack was unable to finish downloading. Please check your internet connection and try again.":"No se pudo terminar de descargar su pack. Por favor, compruebe su conexión a internet e inténtelo de nuevo.","Your photo is being saved. Share it with friends!":"Tu foto se está guardando. ¡Compártela con tus amigos!","Your photo is being sent to Walgreens for printing. Depending on your connection, this may take some time.":"Su foto está siendo enviada a Walgreens para su impresión. Dependiendo de su conexión, esto podría demorar unos minutos.","Your photo will be ready for pickup on %@ at %@ at %@. A receipt has been sent to %@.":"Tu foto estará lista para ser recogida el %@ a las %@ en %@. Un recibo ha sido enviado a %@. ","Your work was saved!":"¡Tu trabajo se ha guardado!",Zoom:"Zoom","Zoom Mode":"Modo Zoom","* This is an in store pick-up":"* Se recogerá el producto en tienda","*You will not be charged until you pick up your prints":"* No se le cobrará hasta que recojas tus impresiones","Check out fresh Stickers and Effects, like the new Woodland pack - perfect for the great outdoors.":"Echa un vistazo a los nuevos Adheribles y Efectos, como el paquete Arbolado, perfecto para magníficos exteriores.","Don't miss out on new effects!":"¡No te pierdas los nuevos efectos!",Dropbox:"Buzón","I agree to the terms":"Acepto los términos","Integrated Camera & Gallery get you editing your snaps in an instant.":"La Cámara y Galería integradas te permiten editar tus capturas en un instante.",Loading:"Cargando","New 'Warmth' tool modifies tone ":"La nueva herramienta 'Calidez' modifica el tono","Tap your edited masterpiece to compare with the original photo.":"Puntee en su obra maestra editada para comparar con la foto original.","Tip: Never want to share?\\nYou can disable this sharing screen in the app settings.":"Consejo: ¿No deseas compartir nunca?\\nPuedes desactivar la pantalla compartir en los ajustes de la aplicación.","We're Sorry":"Lo sentimos","Welcome to Photo Editor, v2.2!":"¡Bienvenido a Photo Editor, v2.2!","What's New":"Novedades","Yes, please!":"¡Sí, por favor!","You must agree to the Terms of Service before submitting your order.":"Debes aceptar los Términos y Condiciones antes de enviar tu orden.","Aviary Supply Shop":"Aviary Tienda","A sticker":"Una calcomanía","Rotate counter clockwise":"Rotar en sentido antihorario","Rotate clockwise":"Rotar en sentido horario","Flip horizontal":"Voltear horizontal","Flip vertical":"Voltear vertical","Increase value":"Incrementar valor","Decrease value":"Reducir valor","Toggle zoom":"Alternar zoom",Size:"Tamaño",Color:"Color",Unavailable:"No disponible",Free:"Gratis",Restore:"Restablecer",Installed:"Instalar",Error:"Error",Retry:"Reintentar","Download failed":"Descarga falló",Installed:"Instalado","If you’ve already purchased this pack please re-install from Google Play to restore this pack.":"Si ya ha comprado este paquete por favor reinstálelo desde la tienda Google Play para restablecerlo.","Plugin succesfully installed":"Se instaló con éxito el plugin","Failed to download the previews":"No se pudieron descargar las vistas previas","Already purchased? Tap below to restore all your in-app purchases for free. ":"¿Ya compró? Toque abajo para restablecer todas sus compras dentro de la aplicación, gratis.","Restore All":"Restablecer Todo","Review Aviary in the Google Play Store!":"¡Dé su opinión sobre Aviary en la tienda Google Play!","Supply Shop":"Tienda de Suministros","No purchase made":"No se ha realizado ninguna compra.  Por favor intente de nuevo.","Failed to start download. Please try again later":"Compra fallida. Por favor intente de nuevo.","Add Effects":"Añadir efectos","Restore All in Progress":"Restaurar todo en progreso","Failed to download the required informations":"No se ha podido descargar la información requerida","Restore All Failed":"Restaurar todo falló","%1$d Plugins Installed":"%1$d complementos instalados","%1$d more":"%1$d más","Some items could not be restored":"Algunos elementos no pudieron ser restaurados","Plase try again later":"Inténtalo de nuevo más tarde","%1$s item(s) could not be restored":"%1$s artículo(s) no se pudieron restaurar","No item needs to be restored":"Ningún artículo necesita ser restaurado","Restore All Completed":"Restaurar todo completado","Request sent. Please check the notification area of your device more more info":"Solicitud enviada. Compruebe el área de notificaciones de su dispositivo más más información","Aviary has a new In-App Billing System!":"¡Aviary tiene un nuevo sistema de facturación dentro de la aplicación!","If you've ever purchased an Aviary plugin, listen up!  The following instructions will guide you on how to migrate your old plugins to this new version of Aviary.":"Si alguna vez ha comprado un complemento de Aviary, ¡escuche! Las siguientes instrucciones le guiarán sobre cómo migrar los viejos complementos a esta nueva versión de Aviary.","Check for plugins":"Compruebe si hay complementos","First, make sure you have all of your previously purchased plugins installed on your device. You can download these plugins again from the Google Play Store for free.":"En primer lugar, asegúrese de que tiene todos sus complementos previamente adquiridos instalados en su dispositivo. Puede descargar estos complementos de nuevo desde la tienda Play Google de forma gratuita.","Restore your purchases":"Restaure sus compras","Once you have all of your plugins installed, return to Aviary and click the 'Restore' button in the Shop to migrate all of your packs in Aviary for free. Happy editing!":'Una vez que tenga todos los complementos instalados, vuelva a Aviary y haga clic en el botón "Restaurar" en la Tienda para migrar todos los paquetes de Aviary de forma gratuita. ¡Que tenga una buena edición!',"Heads up!":"¡Importante!",Shop:"Tienda","You have all the plugins installed":"Tienes todos los plugins instalados",Report:"Informar","This will collect information about your current device state, to send as an e-mail message. It will take a little time from starting the bug report until it is ready to be sent. Please be patient.":"Esto recopilará información sobre el estado de tu dispositivo actual y la enviará en un correo electrónico. Tomará algo de tiempo desde que se informa del error hasta que esté listo para ser enviado. Por favor, ten paciencia.","Report a bug":"Informar de un error",Miscellaneous:"Varios",Sharing:"Compartir","Email Photo":"Fotografía del correo electrónico","Your photo is smaller than the required size. Please choose a new one to proceed.":"El tamaño de su foto es inferior al requerido. Por favor elija una nueva para continuar. ","Lock Dimensions":"Bloquear dimensiones"}
}(AV.lang=AV.lang||{});!function(AV,window,document){AV.Pager=function(o){var api=this;var pips;var currentPage=0,previousPage=0,pageCount=parseInt((o.itemCount-1)/o.itemsPerPage,10)+1,firstPageOffset=0;var buildPages=function(){var i,p,c;var allPanelsHTML="";if(o.firstPageTemplate){allPanelsHTML+=o.firstPageTemplate.apply(this,[o.firstPageContents])}for(p=i=0;p<pageCount;p++){var panelHTML="";for(c=0;c<o.itemsPerPage&&i<o.itemCount;c++){panelHTML+=o.itemBuilder.apply(this,[i]);i++}if(o.pageTemplate){allPanelsHTML+=o.pageTemplate({panelHTML:panelHTML,panelWidth:o.pageWidth,panelClass:c===o.itemsPerPage?"avpw_scroll_page_complete":"avpw_scroll_page_incomplete"})}else{allPanelsHTML+=panelHTML}}if(o.lastPageTemplate){allPanelsHTML+=o.lastPageTemplate.apply(this,[o.lastPageContents])}var extraItems=0;var overflowItems=0;var firstPageOffsetItems=0;var fillCount,halfFillCount,remainder,fhtml,f;if(o.firstPageTemplate||o.lastPageTemplate){if(o.firstPageTemplate){if(o.firstPageWidth){extraItems+=o.firstPageWidth*(o.itemsPerPage/o.pageWidth)}else{pageCount++}}if(o.lastPageTemplate){if(o.lastPageWidth){extraItems+=o.lastPageWidth*(o.itemsPerPage/o.pageWidth)}else{pageCount++}}overflowItems=o.itemCount%o.itemsPerPage;if(extraItems){firstPageOffset=o.pageWidth/o.itemsPerPage-o.firstPageWidth%(o.pageWidth/o.itemsPerPage)|0;firstPageOffsetItems=firstPageOffset*(o.itemsPerPage/o.pageWidth);if(overflowItems>0){if(overflowItems+extraItems+firstPageOffsetItems>o.itemsPerPage){pageCount++}}else{pageCount++}}}if(!o.pageTemplate&&o.fillRemainingSpace){remainder=(o.itemCount+extraItems+firstPageOffsetItems)%o.itemsPerPage;if(remainder){fillCount=o.itemsPerPage-remainder;if(pageCount===1&&o.centerContents){halfFillCount=fillCount/2|0;fhtml="";for(f=0;f<halfFillCount;f++){fhtml+=o.fillRemainingSpace.apply(this)}allPanelsHTML=fhtml+allPanelsHTML;for(f=0;f<halfFillCount;f++){allPanelsHTML+=o.fillRemainingSpace.apply(this)}}else{for(f=0;f<fillCount;f++){allPanelsHTML+=o.fillRemainingSpace.apply(this)}}}}return allPanelsHTML};var buildPips=function(){var navPipsHTML="";for(var i=0;i<pageCount;i++){navPipsHTML+=o.pipTemplate({i:i})}return navPipsHTML};var setPip=function(){pips.removeClass("avpw_page_selected");pips.filter('[pagenum="'+currentPage+'"]').addClass("avpw_page_selected")};var updateArrows=function(){if(currentPage===0){avpw$(o.leftArrow).removeClass("avpw_prev_enabled").addClass("avpw_prev_disabled")}else{avpw$(o.leftArrow).removeClass("avpw_prev_disabled").addClass("avpw_prev_enabled")}if(currentPage==pageCount-1){avpw$(o.rightArrow).removeClass("avpw_next_enabled").addClass("avpw_next_disabled")}else{avpw$(o.rightArrow).removeClass("avpw_next_disabled").addClass("avpw_next_enabled")}};var getTargetFromPage=function(page){page=page||0;var target=page*o.pageWidth;if(page!==0){target-=firstPageOffset}return target};var changePage=function(warp,callback){var e=o.pageContainer,target;if(currentPage<0){currentPage=0;return}else if(currentPage>pageCount-1){currentPage=pageCount-1;return}target=getTargetFromPage(currentPage);var TRANSFORM_PROPERTY=AV.support.getVendorProperty("transform");if(TRANSFORM_PROPERTY){var style;if(currentPage>0){style="translateX(-"+target+"px)"}else{style="translateX(0)"}e[0].style[TRANSFORM_PROPERTY]=style}else{if(currentPage>0){e[0].style.left="-"+target+"px"}else{e[0].style.left="0"}}updateArrows();if(o.onPageChange){o.onPageChange.apply(this,[currentPage])}if(pips){setPip()}};var pageLeft=function(){previousPage=currentPage;currentPage+=-1;changePage.call(this);return false};var pageRight=function(){previousPage=currentPage;currentPage+=1;changePage.call(this);return false};var longPress=function(){var duration=o.longPressDuration||200;var pressed=false;var timer=null;var elThis=this;var changePageWhilePressed=function(inc){timer=window.setInterval(function(){if(pressed&&inc){previousPage=currentPage;currentPage+=inc;changePage.call(elThis)}else{window.clearInterval(timer);timer=null}},duration)};var arrowLeftDown=function(){window.clearInterval(timer);timer=null;pageLeft.call(this);pressed=true;changePageWhilePressed.call(this,-1)};var arrowRightDown=function(){window.clearInterval(timer);timer=null;pageRight.call(this);pressed=true;changePageWhilePressed.call(this,1)};var arrowUp=function(){pressed=false};return{bindEvents:function(){avpw$(o.leftArrow).bind("mousedown",arrowLeftDown).bind("mouseup",arrowUp);avpw$(o.rightArrow).bind("mousedown",arrowRightDown).bind("mouseup",arrowUp)},unbindEvents:function(){avpw$(o.leftArrow).unbind("mousedown",arrowLeftDown).unbind("mouseup",arrowUp);avpw$(o.rightArrow).unbind("mousedown",arrowRightDown).unbind("mouseup",arrowUp)}}}();var bindSwipeGesture=function(element,leftFunc,rightFunc){var x0,x1;var y0,y1;var swipeThreshold=30;var swipeVerticalArea=60;if(element.length){element=element[0]}element.ontouchstart=function(ev){var touch=AV.util.getTouch(ev);if(touch){x0=touch.pageX;y0=touch.pageY}};element.ontouchmove=function(ev){var touch=AV.util.getTouch(ev);if(touch){x1=touch.pageX;y1=touch.pageY}return false};element.ontouchend=function(ev){var distX=x1-x0;var distY=y1-y0;if(Math.abs(distX)>swipeThreshold&&Math.abs(distY)<swipeVerticalArea){if(distX>swipeThreshold){leftFunc()}else{rightFunc()}}x1=x0=undefined}};var unbindSwipeGesture=function(element){if(element.length){element=element[0]}element.ontouchstart=element.ontouchmove=element.ontouchend=null};var onElementSelected=function(ev){if(o.itemsPerPage&&!o.pageTemplate){var element=ev.currentTarget;var containerLeft=o.pageContainer.offset().left;var left=avpw$(element).offset().left-containerLeft;if(left>=getTargetFromPage(currentPage+1)){currentPage++;changePage()}else if(left<getTargetFromPage(currentPage)){currentPage--;changePage()}}};var bindEvents=function(){if(pageCount===1){return}if(o.bindLongPress){longPress.bindEvents()}else{avpw$(o.leftArrow).bind("click",function(){return pageLeft.call(this)});avpw$(o.rightArrow).bind("click",function(){return pageRight.call(this)})}bindSwipeGesture(o.pageContainer,pageLeft,pageRight);if(pips){pips.bind("click",function(e){var t=e.currentTarget;var page=avpw$(t).attr("pagenum");previousPage=currentPage;currentPage=parseInt(page);changePage();return false})}o.pageContainer.delegate(".avpw_icon","click",onElementSelected)};var unbindEvents=function(){if(pageCount===1){return}if(o.bindLongPress){longPress.unbindEvents()}else{avpw$(o.leftArrow).unbind("click");avpw$(o.rightArrow).unbind("click")}unbindSwipeGesture(o.pageContainer);if(pips){pips.unbind("click")}o.pageContainer.undelegate(".avpw_icon","click")};var init=function(){o.pageContainer.html(buildPages());if(pageCount===1){avpw$(o.leftArrow).hide();avpw$(o.rightArrow).hide();if(o.centerContents){o.pageContainer.css("width","auto");o.pageContainer.addClass("avpw_scroll_strip_centered")}}else{avpw$(o.leftArrow).show();avpw$(o.rightArrow).show();o.pageContainer.removeClass("avpw_scroll_strip_centered")}bindEvents()};api.shutdown=function(){unbindEvents();o.pageContainer.html("");if(pips){o.pipContainer.html("")}};api.changePage=changePage;api.pageLeft=pageLeft;api.pageRight=pageRight;api.setCurrentPage=function(p){previousPage=currentPage;currentPage=p};api.getCurrentPage=function(){return currentPage};api.getLastPage=function(){return pageCount-1};api.getPageCount=function(){return pageCount};api.setPageCount=function(c){pageCount=c};init();return api}}(window["AV"]||(window["AV"]={}),window,document);!function(AV,window,document){var mediator=AV.Events;var attachSmartClickHandler=function($elm,callback){var onCancelHandler=function(e){var $this=avpw$(this);$this.unbind("mouseup mouseout touchend")};var onDownHandler=function(e){var $this=avpw$(this);$this.bind("mouseup touchend",onUpHandler);$this.bind("mouseout",onCancelHandler);e.stopPropagation();return false};var onUpHandler=function(e){var $this=avpw$(this);$this.unbind("mouseup mouseout touchend",onUpHandler);e.stopPropagation();if(callback){AV.util.nextFrame(callback);return false}return true};$elm.bind("mousedown touchstart",onDownHandler);$elm.click(function(e){e.preventDefault()})};AV.colorChoices=["#000000","#ffffff","rgb(255, 0, 0)","rgb(255, 132, 0)","rgb(255,240,0)","rgb(0,255,0)","rgb(0,0,255)","rgb(198,0,255)"];AV.brushWidths=[5,15,30,45,70];AV.buildBlankPreset=function(){return AV.template[AV.launchData.layout].blankPreset()};AV.buildBlankCropPreset=function(){return AV.template[AV.launchData.layout].blankCropPreset()};AV.toolDefaults={redeye:{presets:AV.brushWidths,files:[AV.build["feather_baseURL"]+"redeye.swf"]},greeneye:{initialvalue:10,presets:[3,7,12,20],presetsScaled:[2,5,9,15]},whiten:{initialvalue:10,presets:AV.brushWidths,files:[AV.build["feather_baseURL"]+"redeye.swf"]},blemish:{initialvalue:5,presets:AV.brushWidths,files:[AV.build["feather_baseURL"]+"blemish.swf"]},bulge:{radius:100,maxradius:200,power:50},pinch:{radius:100,maxradius:200,power:50},drawing:{initialColor:AV.colorChoices[7],presetsWidth:AV.brushWidths,presetsColor:AV.colorChoices,files:[AV.build["feather_baseURL"]+"drawing.swf"]},text:{presetsColor:AV.colorChoices,files:[AV.build["feather_baseURL"]+"text.swf"]},textwithfont:{presetsColor:AV.colorChoices,presetsFont:[{label:"Abril Fatface",value:"Abril Fatface"},{label:"Acme",value:"Acme"},{label:"Anton",value:"Anton"},{label:"Arial Black",value:"Arial Black",system:true},{label:"Bangers",value:"Bangers"},{label:"Bevan",value:"Bevan"},{label:"Black Ops One",value:"Black Ops One"},{label:"Butterfly Kids",value:"Butterfly Kids"},{label:"Cabin Sketch",value:"Cabin Sketch"},{label:"Cardo",value:"Cardo"},{label:"Chelsea Market",value:"Chelsea Market"},{label:"Chewy",value:"Chewy"},{label:"Covered By Your Grace",value:"Covered By Your Grace"},{label:"Dawning of a New Day",value:"Dawning of a New Day"},{label:"Delius Unicase",value:"Delius Unicase"},{label:"Didact Gothic",value:"Didact Gothic"},{label:"Doppio One",value:"Doppio One"},{label:"Droid Serif",value:"Droid Serif"},{label:"EB Garamond",value:"EB Garamond"},{label:"Economica",value:"Economica",familyStyle:"bolditalic",style:"italic"},{label:"Francois One",value:"Francois One"},{label:"Fredoka One",value:"Fredoka One"},{label:"Georgia",value:"Georgia",system:true},{label:"Give You Glory",value:"Give You Glory"},{label:"Impact",value:"Impact",system:true},{label:"IM Fell English",value:"IM Fell English"},{label:"Italiana",value:"Italiana"},{label:"Kranky",value:"Kranky"},{label:"La Belle Aurore",value:"La Belle Aurore"},{label:"Ledger",value:"Ledger"},{label:"Lobster Two",value:"Lobster Two"},{label:"Luckiest Guy",value:"Luckiest Guy"},{label:"Mr Dafoe",value:"Mr Dafoe"},{label:"Mystery Quest",value:"Mystery Quest"},{label:"Oswald",value:"Oswald",familyStyle:"bold"},{label:"Overlock",value:"Overlock"},{label:"Patua One",value:"Patua One"},{label:"Playball",value:"Playball"},{label:"Princess Sofia",value:"Princess Sofia"},{label:"PT Mono",value:"PT Mono"},{label:"PT Sans Narrow",value:"PT Sans Narrow",familyStyle:"bold"},{label:"PT Serif Caption",value:"PT Serif Caption"},{label:"Quicksand",value:"Quicksand"},{label:"Rochester",value:"Rochester"},{label:"Rokkitt",value:"Rokkitt"},{label:"Sansita One",value:"Sansita One"},{label:"Schoolbell",value:"Schoolbell"},{label:"Shadows Into Light Two",value:"Shadows Into Light Two"},{label:"Shojumaru",value:"Shojumaru"},{label:"Special Elite",value:"Special Elite"},{label:"Stint Ultra Expanded",value:"Stint Ultra Expanded"},{label:"Tahoma",value:"Tahoma",system:true},{label:"Times New Roman",value:"Times New Roman",system:true},{label:"Trebuchet MS",value:"Trebuchet MS",system:true},{label:"Ultra",value:"Ultra"},{label:"Varela Round",value:"Varela Round"},{label:"Verdana",value:"Verdana",system:true},{label:"Voltaire",value:"Voltaire"},{label:"Zeyada",value:"Zeyada"}]},sharpness:{presets:[-100,-33,33,100],files:[AV.build["feather_baseURL"]+"blur.swf",AV.build["feather_baseURL"]+"sharpen.swf"]},saturation:{presets:[0,.66,1.33,2],presetsFlash:[{value:0},{value:.66},{value:1.33},{value:2}],files:[AV.build["feather_baseURL"]+"saturation.swf"]},warmth:{presets:[-100,-33,33,100]},brightness:{presets:[-100,-33,33,100],presetsFlash:[{brightnessvalue:.33,contrastvalue:1},{brightnessvalue:.77,contrastvalue:1},{brightnessvalue:1.22,contrastvalue:1},{brightnessvalue:1.66,contrastvalue:1}],files:[AV.build["feather_baseURL"]+"brightness.swf"]},contrast:{presets:[-100,-33,33,100],presetsFlash:[{contrastvalue:.33,brightnessvalue:1},{contrastvalue:.77,brightnessvalue:1},{contrastvalue:1.22,brightnessvalue:1},{contrastvalue:1.66,brightnessvalue:1}],files:[AV.build["feather_baseURL"]+"contrast.swf"]},colors:{min:-133,max:67,initialValue:-33,files:[AV.build["feather_baseURL"]+"colors.swf"]},orientation:{presetsFlash:[{vertical:false,horizontal:false},{vertical:false,horizontal:true},{vertical:true,horizontal:false},{vertical:true,horizontal:true}],files:[AV.build["feather_baseURL"]+"flip.swf",AV.build["feather_baseURL"]+"rotate90.swf"]},crop:{files:[AV.build["feather_baseURL"]+"crop.swf",AV.build["feather_baseURL"]+"resize.swf"]},resize:{files:[AV.build["feather_baseURL"]+"resize.swf"]},overlay:{files:[AV.build["feather_baseURL"]+"overlay.swf"]},effects:{files:[AV.build["feather_baseURL"]+"effects.swf"],optionalFrame:["singe","sancarmen","purple","thresh","aqua","andy","edgewood","joecool"]},enhance:{presets:["autoenhance","nightenhance","labcorrect"],files:[AV.build["feather_baseURL"]+"effects.swf"]},frames:{presetsThickness:[1,2,3,4,5,6]},colorsplash:{presets:AV.brushWidths}};AV.buildColorPicker=function(defaultColor,updateElement,onConfirmColor,onCancelColor){var TOP_POSITION_OFFSET=74;var color=avpw$(updateElement).data("color");var s=null;var sContainer=null;var colorHsb;var rgb2hsb=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;hsb.s=max!==0?255*delta/max:0;if(hsb.s!==0){if(rgb.r===max){hsb.h=(rgb.g-rgb.b)/delta}else if(rgb.g===max){hsb.h=2+(rgb.b-rgb.r)/delta}else{hsb.h=4+(rgb.r-rgb.g)/delta}}else{hsb.h=-1}hsb.h*=60;if(hsb.h<0){hsb.h+=360}hsb.s*=100/255;hsb.b*=100/255;return hsb};var hex2rgb=function(hex){hex=parseInt(hex.indexOf("#")>-1?hex.substring(1):hex,16);return{r:hex>>16,g:(hex&65280)>>8,b:hex&255}};var hex2hsb=function(hex){var hsb=rgb2hsb(hex2rgb(hex));if(hsb.s===0)hsb.h=360;return hsb};var getColorData=function(){return avpw$(updateElement).data("color")};var setColorData=function(colorStr){avpw$(updateElement).data("color",colorStr)};var changeColorPickerIcon=function(colorStr){colorStr=colorStr||getColorData();var colorFeedback=avpw$(updateElement).find(".avpw_isa_color_feedback");if(colorStr){colorFeedback.css("background-color",colorStr).addClass("avpw_custom_color_image_with_preview")}else{colorFeedback.removeClass("avpw_custom_color_image_with_preview")}};var changeColorPickerPreview=function(colorStr){colorStr=colorStr||getColorData();sContainer.find(".avpw_isa_color_feedback").css("background-color",colorStr)};var positionColorPicker=function(){var offset=avpw$(updateElement).offset();var controlsOffset=avpw$("#avpw_controls").offset();offset.left+=avpw$(updateElement).width()/2;offset.left-=sContainer.width()/2;offset.left-=controlsOffset.left;offset.top-=controlsOffset.top;sContainer.css({left:offset.left+"px",top:offset.top+TOP_POSITION_OFFSET+"px"})};var hideColorPicker=function(){if(!sContainer)return;AV.miniColors.unBindSelectorEvents();sContainer.undelegate(".avpw_color_picker_confirm","mousedown touchstart");s.unbind();sContainer.hide().remove();sContainer=s=null;if(AV.featherUseFlash){AV.FlashAPI.showCanvas()}};if(AV.miniColors){color=color||defaultColor||"#ffffff";colorHsb=hex2hsb(color);s=AV.miniColors.buildSelector(colorHsb);sContainer=avpw$(".avpw_color_picker_dropdown_popup");if(sContainer&&sContainer.length){sContainer.unbind();sContainer.detach()}else{sContainer=avpw$(AV.template[AV.launchData.layout].colorPickerContainer())}AV.miniColors.bindSelectorEvents(s);avpw$("#avpw_controls").append(sContainer.append(s));sContainer.delegate(".avpw_color_picker_confirm","mousedown touchstart",function(ev){ev.stopPropagation();ev.preventDefault();if(onConfirmColor){onConfirmColor.apply(this,[color])}setColorData(color);changeColorPickerIcon(color);hideColorPicker()});s.bind("clickOutsideBounds",function(ev){changeColorPickerIcon("");hideColorPicker();if(onCancelColor){onCancelColor.call(this)}}).bind("setColor",function(ev,data){color="#"+data.hex;changeColorPickerPreview(color);if(onConfirmColor){onConfirmColor.apply(this,[color,true])}}).show();changeColorPickerPreview(color);positionColorPicker();if(AV.featherUseFlash){AV.FlashAPI.hideCanvas()}return{hideColorPicker:hideColorPicker}}};AV.ControlsWidget.prototype.populateCropPresets=function(presets){var landscape,delim,s1,s2,w,h,wTemp,canvasWidth,canvasHeight,wh;var strict=AV.launchData.cropPresetsStrict;var hiresMode=this.imageSizeTracker.isUsingHiResDimensions(AV.launchData);if(AV.featherUseFlash||hiresMode){wh=this.paintWidget.getScaledSize();canvasWidth=wh.hiresWidth||wh.width;canvasHeight=wh.hiresHeight||wh.height}else{canvasWidth=this.paintWidget.width;canvasHeight=this.paintWidget.height}landscape=canvasWidth/canvasHeight>1;var filteredPresets=[];for(var i=0;i<presets.length;i++){var preset,val,label,labeled=presets[i]instanceof Array;val=labeled?presets[i][1]:presets[i];label=labeled?presets[i][0]:presets[i];delim=val.indexOf("x");if(label.toLowerCase()==="custom"){labeled=true;preset={label:label,width:canvasWidth*.85,height:canvasHeight*.75,constrain:false,resize:false}}else if(label.toLowerCase()==="original"){labeled=true;preset={label:label,width:canvasWidth,height:canvasHeight,constrain:true,resize:false}}else{if(delim!=-1){s1=val.substr(0,delim);s2=val.substr(delim+1);w=parseInt(s1,10);h=parseInt(s2,10);if(w>=canvasWidth||h>=canvasHeight){continue}if(!strict&&(h>=canvasWidth||w>=canvasHeight)){continue}if(!labeled&&!strict&&(landscape&&w/h<1||!landscape&&w/h>1)){label=h+"x"+w;wTemp=w;w=h;h=wTemp}preset={label:label,width:w,height:h,constrain:true,resize:true}}else{delim=val.indexOf(":");if(delim==-1&&avpw$.trim(val)!==""){continue}else{s1=val.substr(0,delim);s2=val.substr(delim+1);w=parseInt(s1,10);h=parseInt(s2,10);if(!labeled&&!strict&&(landscape&&w/h<1||!landscape&&w/h>1)){label=h+":"+w;wTemp=w;w=h;h=wTemp}preset={label:label,width:w,height:h,constrain:true,resize:false}}}}if(preset){preset.strict=strict;preset.labeled=labeled;filteredPresets.push(preset)}}return filteredPresets};AV.Dropdown=function(o){var TOP_POSITION_OFFSET=74;var _OPEN_CLASSNAME="avpw_dropdown_open";var _ACTIVE_CLASSNAME="avpw_dropdown_popup_list_item_selected";var _updateElement=o.updateElement;var _popupElement=o.popupElement;var _defaultValue=o.defaultValue;var _preventClose=o.preventClose||false;var _disableReposition=o.disableReposition||false;var _disableClick=o.disableClick||false;var _popupElementList;var _updateElementDisplay;var _onShow=o.onShow;var _onHide=o.onHide;var _update=function(value,element){value=value||_defaultValue;if(_updateElementDisplay&&_updateElementDisplay.length){_updateElementDisplay.html(value)}if(_popupElement&&_popupElement.length){_popupElement.find(".avpw_isa_dropdown_item").removeClass(_ACTIVE_CLASSNAME);element=element||_popupElement.find('[data-value="'+value+'"]');if(element&&element.length){element.addClass(_ACTIVE_CLASSNAME)}}};var _dropdownItemClicked=function(ev){var element=ev.currentTarget;var $el=avpw$(element);value=$el.data("value");_update(value,element);if(_preventClose){ev.stopPropagation();ev.preventDefault()}if(o.onItemClicked&&!_disableClick){o.onItemClicked.apply(this,[value])}};var _addPopupToParent=function(){if(o.popupParent&&o.popupParent.length){o.popupParent.append(_popupElement)}};var _positionDropdown=function(){if(_disableReposition)return;var offset=_updateElement.offset();var controlsOffset=avpw$("#avpw_controls").offset();offset.left+=_updateElement.width()/2;offset.left-=_popupElement.width()/2;offset.left-=controlsOffset.left;offset.top-=controlsOffset.top;_popupElement.css({left:offset.left+"px",top:offset.top+TOP_POSITION_OFFSET+"px"})};var _populateWithTemplatedData=function(dataArray,templateFunc){if(_popupElement){var i,dataItem;var html=document.createDocumentFragment();for(i=0;i<dataArray.length;i++){dataItem=avpw$(templateFunc(dataArray[i]));html.appendChild(dataItem[0])}if(_popupElementList&&_popupElementList.length){_popupElementList.html(html)}else{_popupElement.html(html)}}};var _bindClickToShow=function(){_updateElement.bind("click",_updateElementClicked)};var _unbindClickToShow=function(){_updateElement.unbind("click",_updateElementClicked)};var _removePopupFromParent=function(){if(_popupElement&&_popupElement.length){_popupElement.remove()}};var _showPopup=function(){if(_popupElement&&_popupElement.length){_bindEvents();_popupElement.slideDown(50);_updateElement.addClass(_OPEN_CLASSNAME);if(_onShow)_onShow.call(this)}};var _hidePopup=function(){if(_popupElement&&_popupElement.length){_updateElement.removeClass(_OPEN_CLASSNAME);_popupElement.slideUp(50);_unbindEvents();if(_onHide)_onHide.call(this)}};var _updateElementClicked=function(ev){ev.preventDefault();ev.stopPropagation();if(_popupElement&&_popupElement.is(":visible")){_hidePopup()}else{_showPopup()}};var init=function(){_popupElementList=_popupElement.find(".avpw_dropdown_popup_list");_updateElementDisplay=_updateElement.find(".avpw_isa_dropdown_display");_addPopupToParent();_bindClickToShow();if(o.items&&o.itemTemplate){_populateWithTemplatedData(o.items,o.itemTemplate)}_update()};var _bindEvents=function(){if(_popupElement){_popupElement.delegate(".avpw_isa_dropdown_item","click",_dropdownItemClicked)}avpw$(window).bind("click",_hidePopup);mediator.on("layout:resize",_positionDropdown)};var _unbindEvents=function(){if(_popupElement){_popupElement.undelegate(".avpw_isa_dropdown_item","click")}avpw$(window).unbind("click",_hidePopup);mediator.off("layout:resize",_positionDropdown)};var api=this;api.position=_positionDropdown;api.getPopupElement=function(){return _popupElement};api.show=_showPopup;api.hide=_hidePopup;api.update=_update;api.shutdown=function(){_unbindEvents();_unbindClickToShow();_removePopupFromParent();_popupElementList=undefined;_updateElementDisplay=undefined;_defaultValue=undefined;_updateElement=undefined;_popupElement=undefined};init();return api};AV.PacksAndItems=function(o){var _browser=o.browser;var _packBrowser=o.packBrowser;var _pager=o.pager;var _packPager=o.packPager;var _buildPacksHTML=o.buildPacksHTML;var _buildPackItemsHTML=o.buildPackItemsHTML;var _currentPack=o.currentPack;var _supportsAnimation=AV.support.getVendorProperty("transition");var api=this;var _updateCancelButton=function(label,onClick){var HIDDEN_CLASS="avpw_back_button_hidden";var TRANSITION_DURATION=100;var cancelBtn=avpw$("#avpw_all_effects");var backBtn=avpw$("#avpw_up_one_level");var update=function(instant){if(label){backBtn.text(label);if(onClick){backBtn.bind("click",onClick)}cancelBtn.hide();if(!instant){backBtn.addClass(HIDDEN_CLASS);backBtn.show();window.setTimeout(function(){backBtn.removeClass(HIDDEN_CLASS)},TRANSITION_DURATION)}else{backBtn.show()}}else{backBtn.unbind("click");backBtn.hide();if(!instant){cancelBtn.addClass(HIDDEN_CLASS);cancelBtn.show();window.setTimeout(function(){cancelBtn.removeClass(HIDDEN_CLASS)},TRANSITION_DURATION)}else{cancelBtn.show()}}};if(cancelBtn.is(":visible")){cancelBtn.addClass(HIDDEN_CLASS);window.setTimeout(function(){update();cancelBtn.removeClass("hidden")},TRANSITION_DURATION)}else if(backBtn.is(":visible")){backBtn.addClass(HIDDEN_CLASS);window.setTimeout(function(){update();backBtn.removeClass(HIDDEN_CLASS)},TRANSITION_DURATION)}else{update(true)}};var _setPack=function(packId){if(_currentPack!==packId){_currentPack=packId||_currentPack}};var _transitionFromPacksToItems=function(el){_packBrowser.find(".avpw_pack_icon_selected").removeClass("avpw_pack_icon_selected");avpw$(el).addClass("avpw_pack_icon_selected");if(_supportsAnimation){var prop=AV.support.getVendorProperty("transform");var dims=AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"getDims");var offscreenDistance=dims.INNER_BROWSER_WIDTH+"px";_browser[0].style[prop]="translateX("+offscreenDistance+")";_browser.addClass("avpw_transition_to_pack_contents");_browser.show();window.setTimeout(function(){var prop=AV.support.getVendorProperty("transform");el.style[prop]="translateX("+offscreenDistance+")";avpw$(el).removeClass("avpw_pack_icon_selected");window.setTimeout(function(){_packBrowser.hide();if(_packPager){_packPager.shutdown();_packPager=null}if(_buildPackItemsHTML){_buildPackItemsHTML()}window.setTimeout(function(){_browser.removeClass("avpw_transition_to_pack_contents")},200)},600)},100)}else{_packBrowser.hide();if(_packPager){_packPager.shutdown();_packPager=null}if(_buildPackItemsHTML){_buildPackItemsHTML()}_browser.show()}};var _transitionFromItemsToPacks=function(){if(_supportsAnimation){var prop=AV.support.getVendorProperty("transform");var dims=AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"getDims");var offscreenDistance=dims.INNER_BROWSER_WIDTH+"px";_browser[0].style[prop]="translateX("+offscreenDistance+")";window.setTimeout(function(){if(_pager){_pager.shutdown();_pager=null}_updateCancelButton();if(_buildPacksHTML){_buildPacksHTML()}_packBrowser.show()},400)}else{if(_pager){_pager.shutdown();_pager=null}_updateCancelButton();if(_buildPacksHTML){_buildPacksHTML()}_packBrowser.show()}};var _backButtonClicked=function(ev){api.onBackButtonClicked();_transitionFromItemsToPacks();return false};api.onPackClicked=function(ev){var element=ev.currentTarget;var pack=avpw$(element).data("pack");_setPack(pack);_updateCancelButton(AV.getLocalizedString("Back"),_backButtonClicked);_transitionFromPacksToItems(element);return false};api.onPackInfoClicked=function(ev){var element=ev.currentTarget;_packOfInterest=element;var packId=avpw$(element).data("pack");AV.controlsWidgetInstance.assetManager.showAssetPurchaseView(packId,api.onPurchaseButtonClicked);return false};api.onBackButtonClicked=function(){};api.onPurchaseButtonClicked=function(pack){};api.getCurrentPack=function(){return _currentPack};api.setCurrentPack=function(pack){_setPack(pack)};api.getPackOfInterest=function(){return _packOfInterest};api.updateCancelButton=_updateCancelButton;return api};!function($){$.fn.slider=function(o){o=AV.util.extend({max:100,min:0,value:50},o);var _min=0;var _value=_min;var _max=0;var _handle=null;var _goo=null;var _divideGoo=false;var _sliderContainer=null;var _slider=this;var _sliderMaxPos;var _mouseMoveThrottleTimer=null;var _mouseMoveThrottleDelay=0;var _lastUIHash=null;var _convertFromValueToPos=function(value){var pos=_max!==_min?(value-_min)/(_max-_min):0;return pos};var _convertFromPosToValue=function(pos){var value=_min+pos*(_max-_min);return parseFloat(value.toFixed(5))};var _refreshValue=function(posX){var handlePos;if(posX){_sliderMaxPos=_sliderMaxPos||_slider.outerWidth()||1;handlePos=posX-_slider.offset().left;handlePos=handlePos/_sliderMaxPos;handlePos=handlePos>1?1:handlePos;handlePos=handlePos<0?0:handlePos;_value=_convertFromPosToValue(handlePos)}else{handlePos=_convertFromValueToPos(_value)}if(_goo.length){if(_divideGoo){if(handlePos>.5){_goo.css({left:"50%",width:(handlePos-.5)*100+"%"})}else{_goo.css({left:handlePos*100+"%",width:(.5-handlePos)*100+"%"})}}else{_goo.css({left:"0",width:handlePos*100+"%"})}}_handle.css("left",handlePos*100+"%")};var _messager=function(message,value){switch(message){case"value":if(arguments.length<1){return _value}else{_value=value;_refreshValue()}break;case"destroy":_shutdown();break;default:break}};var _startSlide=function(uiHash){_slider.trigger("slidestart",[uiHash]);if(_mouseMoveThrottleDelay){_lastUIHash=null;_mouseMoveThrottleTimer=window.setInterval(function(){if(_lastUIHash){_slider.trigger("slide",[_lastUIHash]);_lastUIHash=null}},_mouseMoveThrottleDelay)}};var _stopSlide=function(uiHash){_slider.trigger("slidechange",[uiHash]);if(_mouseMoveThrottleDelay){window.clearInterval(_mouseMoveThrottleTimer)}};var _onHandleMouseDown=function(ev){$(document).bind("mousemove",_onHandleMouseMove).bind("mouseup blur",_onHandleMouseUp);_startSlide({value:_value});return false};var _onHandleMouseMove=function(ev){var touch=AV.util.getTouch(ev);_refreshValue(touch?touch.pageX:ev.pageX);var uiHash={value:_value};if(_mouseMoveThrottleDelay){_lastUIHash=uiHash}else{_slider.trigger("slide",[uiHash])}};var _onHandleMouseUp=function(ev){$(document).unbind("mousemove",_onHandleMouseMove).unbind("mouseup blur",_onHandleMouseUp);_stopSlide({value:_value});return false};var _onHandleTouchStart=function(ev){_handle.parent().bind("touchmove",_onHandleMouseMove).bind("touchend",_onHandleTouchEnd);_startSlide({value:_value});return false};var _onHandleTouchEnd=function(ev){_handle.parent().unbind("touchmove",_onHandleMouseMove).unbind("touchend",_onHandleTouchEnd);_stopSlide({value:_value});return false};var _onSliderClick=function(ev){var touch=AV.util.getTouch(ev);_refreshValue(touch?touch.pageX:ev.pageX);var uiHash={value:_value};_slider.trigger("slidechange",[uiHash])};var _init=function(){_value=o.value;_min=o.min;_max=o.max;_goo=_slider.find(".avpw_slider_goo").eq(0);_divideGoo=!!_slider.find(".avpw_slider_divider").length;_handle=_slider.find("a").eq(0);_sliderContainer=_slider.parents(".avpw_isa_slider_container");if(o.delay){_mouseMoveThrottleDelay=o.delay}if(_sliderContainer.length){_sliderContainer.bind("mousedown",_onHandleMouseDown);if(_mouseMoveThrottleDelay){_sliderContainer.bind("mousedown",_onSliderClick)}else{_sliderContainer.bind("click",_onSliderClick)}if($.support.touch){_sliderContainer.bind("touchstart",_onHandleTouchStart);if(_mouseMoveThrottleDelay){_sliderContainer.bind("touchstart",_onSliderClick)}}}if($.support.touch){_handle.bind("touchstart",_onHandleTouchStart)}_handle.bind("mousedown",_onHandleMouseDown)};var _shutdown=function(){_handle.unbind("mousedown mouseup blur touchstart");if(_sliderContainer.length){_sliderContainer.unbind("mousedown",_onSliderClick).unbind("mousedown",_onHandleMouseDown).unbind("touchstart",_onSliderClick).unbind("touchstart",_onHandleTouchStart).unbind("click",_onSliderClick);_sliderContainer=null}_goo=null;_handle=null;window.clearInterval(_mouseMoveThrottleTimer);_mouseMoveThrottleTimer=null;_mouseMoveThrottleDelay=0;_lastUIHash=null};_init();_slider.slider=_messager;return _slider}}(avpw_jQuery);!function($,w){$.fn.pressed=function(className){var addClassHandler=function(e){var $this=$(this);$this.addClass(className);$this.bind("mouseup mouseout touchend",removeClassHandler);return true};var removeClassHandler=function(e){var $this=$(this);$this.removeClass(className);$this.unbind("mouseup mouseout touchend",removeClassHandler);return true};this.bind("mousedown touchstart",addClassHandler);return this}}(avpw_jQuery,window);AV.ControlsWidget.prototype.layout.aviary=function(){var mode="fullscreen";var inToolMode=false;var dims={TITLE_HEIGHT:30,HEADER_HEIGHT:108,FOOTER_HEIGHT:35,MINIMUM_WIDGET_HEIGHT:396,MODE_ACTION_WIDTH:119,BOOKEND_WIDTH:48,INNER_BOOKEND_WIDTH:40,CANVAS_MARGIN:0,CANVAS_PADDING:10,MINIMUM_WIDGET_WIDTH:712,TOOL_ICON_WIDTH:70,PRESET_ICON_WIDTH:54,PRESET_CROP_ICON_WIDTH:82,GENERIC_LEAD_IN_WIDTH:10,BORDER_ICON_WIDTH:85,STICKER_ICON_WIDTH:80,STICKER_ROLL_WIDTH:80,FILTER_IMAGE_WIDTH:65,FILTER_CANISTER_WIDTH:63,FILTER_LEAD_IN_WIDTH:93,TEXT_ADD_TEXT_BUTTON_WIDTH:120+1,CANVAS_HEIGHT:undefined,CANVAS_WIDTH:undefined,TOOLS_BROWSER_WIDTH:undefined,INNER_BROWSER_WIDTH:undefined,TOOL_CONTAINER_WIDTH:undefined};var THEME_OVERRIDES={modern:{MODE_ACTION_WIDTH:0,BOOKEND_WIDTH:48,HEADER_HEIGHT:56+108,GENERIC_LEAD_IN_WIDTH:0,CANVAS_PADDING:10}};var theme=AV.launchData.theme;if(THEME_OVERRIDES[theme]){avpw$.extend(dims,THEME_OVERRIDES[theme])}var zoomSlider,zoomControls,zoomModeOverlay,zoomShowTimer,zoomHideTimer;var $undoButton,$redoButton,$undoBlocker,$redoBlocker,$canvasControlsElement;var api={};
var applyDynamicDimensions=function(){var controlsEl=avpw$("#avpw_controls");var totalWidth=controlsEl.width();var totalHeight=controlsEl.height();if(!totalWidth||totalWidth<dims.MINIMUM_WIDGET_WIDTH){totalWidth=dims.MINIMUM_WIDGET_WIDTH}if(!totalHeight||totalHeight<dims.MINIMUM_WIDGET_HEIGHT){totalHeight=dims.MINIMUM_WIDGET_HEIGHT}dims.CANVAS_HEIGHT=totalHeight-(dims.TITLE_HEIGHT+dims.HEADER_HEIGHT+dims.FOOTER_HEIGHT);dims.CANVAS_WIDTH=totalWidth-2*dims.CANVAS_MARGIN;dims.TOOL_CONTAINER_WIDTH=totalWidth-2*dims.MODE_ACTION_WIDTH;dims.TOOLS_BROWSER_WIDTH=totalWidth-(2*dims.BOOKEND_WIDTH+dims.MODE_ACTION_WIDTH);dims.INNER_BROWSER_WIDTH=dims.TOOL_CONTAINER_WIDTH-(2*dims.INNER_BOOKEND_WIDTH+2+dims.GENERIC_LEAD_IN_WIDTH)};var placeCanvasControls=function(){var $embed_element=api.getEmbedElement();var transformProp=AV.support.getVendorProperty("transform");if(transformProp){zoomControls=avpw$(AV.template[AV.launchData.layout].zoomControls());$embed_element.append(zoomControls);zoomControls.delegate("#avpw_zoom_button","mousedown",function(){if(zoomControls.hasClass("avpw_zoom_open")){api.disableZoomMode()}else{api.enableZoomMode()}return false});zoomModeOverlay=avpw$(AV.template[AV.launchData.layout].zoomModeOverlay());avpw$("#avpw_tool_content_wrapper").append(zoomModeOverlay).bind("click",api.disableZoomMode);zoomModeOverlay.bind("click",api.disableZoomMode);api.showZoomButton()}$embed_element.append(AV.template[AV.launchData.layout].canvasControls())};var updateBreadcrumbDisplay=function(toolName){var toolLabel;if(toolName){toolLabel=AV.util.getUserFriendlyToolName(toolName);toolLabel=AV.getLocalizedString(toolLabel);avpw$("#avpw_breadcrumb_header").hide();avpw$("#avpw_breadcrumb_toolname").html(toolLabel);AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[false,false]);inToolMode=true}else{avpw$("#avpw_breadcrumb_header").show();avpw$("#avpw_breadcrumb_toolname").html("");inToolMode=false;AV.controlsWidgetInstance.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[AV.paintWidgetInstance.actions.canUndo(),AV.paintWidgetInstance.actions.canRedo()])}};var onCanvasTransform=function(bbox){if(bbox){api.getCanvasControlsElement().css({top:bbox.y0+dims.CANVAS_PADDING+"px",left:bbox.x0+dims.CANVAS_PADDING+"px",width:bbox.w+"px",height:bbox.h+"px"})}};api.getDims=function(){return dims};api.onClose=function(instant){var delay=AV.launchData.closeDelay;if(mode==="fullscreen"){if(instant||delay===0){avpw$("#avpw_fullscreen_bg").hide()}else{avpw$("#avpw_fullscreen_bg").fadeOut(delay)}}if(!AV.launchData.noCloseButton){if(instant||delay===0){avpw$("#avpw_control_cancel_pane").hide()}else{avpw$("#avpw_control_cancel_pane").fadeOut(delay)}}};api.onShutdown=function(){mediator.off("layout:resize",applyDynamicDimensions);mediator.off("layout:resize",api.scaleCanvas);mediator.off("tool:open",updateBreadcrumbDisplay);mediator.off("tool:close",updateBreadcrumbDisplay);if(zoomSlider){zoomSlider.shutdown();zoomSlider=null}if(zoomControls){zoomControls.undelegate().detach().remove();zoomControls=null}if(zoomModeOverlay){zoomModeOverlay.unbind().detach().remove();zoomModeOverlay=null}avpw$("#avpw_tool_content_wrapper").unbind("click",api.disableZoomMode);var embedElement=api.getEmbedElement();avpw$(embedElement).children().remove();avpw$(embedElement).hide();$undoButton=$redoButton=undefined;$undoBlocker=$redoBlocker=undefined;$canvasControlsElement=undefined};api.getToolsPerPage=function(){return dims.TOOLS_BROWSER_WIDTH/dims.TOOL_ICON_WIDTH|0};api.getPresetsPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.PRESET_ICON_WIDTH|0};api.getCropPresetsPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.PRESET_CROP_ICON_WIDTH|0};api.getBordersPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.BORDER_ICON_WIDTH|0};api.getStickersPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.STICKER_ICON_WIDTH|0};api.getStickerPacksPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.STICKER_ROLL_WIDTH|0};api.getFiltersPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.FILTER_IMAGE_WIDTH|0};api.getFilterPacksPerPage=function(){return dims.INNER_BROWSER_WIDTH/dims.FILTER_CANISTER_WIDTH|0};api.getEmbedElement=function(imgElement){return avpw$("#avpw_canvas_embed")};api.getCanvasControlsElement=function(){$canvasControlsElement=$canvasControlsElement||avpw$("#avpw_canvas_controls_layer");return $canvasControlsElement};api.getMaxDims=function(){return{width:dims.CANVAS_WIDTH-2*dims.CANVAS_PADDING,height:dims.CANVAS_HEIGHT-2*dims.CANVAS_PADDING}};api.getScaledImageDims=function(imgElement){var maxDims=api.getMaxDims();var scaledDims,scaledWidth,scaledHeight;if(imgElement){scaledDims=AV.util.getScaledDims(imgElement.width,imgElement.height,maxDims.width,maxDims.height);scaledWidth=scaledDims.width;scaledHeight=scaledDims.height;avpw$(imgElement).css({width:scaledWidth+"px",height:scaledHeight+"px",marginLeft:"-"+(scaledWidth/2|0)+"px",marginTop:"-"+(scaledHeight/2|0)+"px"})}return scaledDims||maxDims};api.getScaledImageDims_Flash=function(imgElement){var max=dims.CANVAS_HEIGHT<dims.CANVAS_WIDTH?dims.CANVAS_HEIGHT:dims.CANVAS_WIDTH;max=max-2*dims.CANVAS_PADDING;var imageDims=AV.util.getScaledDims(imgElement.width,imgElement.height,max);return imageDims};api.placeControls=function(inlineSite){var delay=AV.launchData.closeDelay;mode=inlineSite?"embed":"fullscreen";var $avpw_holder=avpw$("#avpw_holder");$avpw_holder.addClass("avpw_is_"+mode);if(mode==="embed"){$avpw_holder.detach();inlineSite=AV.util.getImageElem(inlineSite);$avpw_holder.appendTo(inlineSite)}else{if(delay===0){avpw$("#avpw_fullscreen_bg").show()}else{avpw$("#avpw_fullscreen_bg").fadeIn(delay)}}applyDynamicDimensions();if(!AV.launchData.noCloseButton){if(delay===0){avpw$("#avpw_control_cancel_pane").show()}else{avpw$("#avpw_control_cancel_pane").fadeIn(delay)}}avpw$("#avpw_up_one_level").hide();placeCanvasControls()};api.showCanvasControlsElement=function(){api.getCanvasControlsElement().addClass("avpw_canvas_controls_ready")};api.hideCanvasControlsElement=function(){api.getCanvasControlsElement().removeClass("avpw_canvas_controls_ready")};api.placeControls_Flash=api.placeControls;api.launchStage2_Flash=function(){};api.disableControls=function(){if(AV.featherUseFlash){AV.FlashAPI.hideCanvas()}var messageContainer=avpw$("#avpw_messaging");messageContainer.show();AV.util.nextFrame(function(){messageContainer.addClass("avpw_messaging_confirmation");avpw$("#avpw_tool_content_wrapper").addClass("avpw_disabled_outer_container")})};api.enableControls=function(immediate){if(AV.featherUseFlash){AV.FlashAPI.showCanvas()}var messageContainer=avpw$("#avpw_messaging");messageContainer.removeClass("avpw_messaging_confirmation");avpw$("#avpw_tool_content_wrapper").removeClass("avpw_disabled_outer_container");if(immediate){messageContainer.hide()}else{window.setTimeout(function(){messageContainer.hide()},400)}};api.scaleCanvas=function(w,h){var scaledDims=api.getMaxDims();w=w||scaledDims.width;h=h||scaledDims.height;if(AV.featherUseFlash){}else{if(AV.controlsWidgetInstance.canvasUI){AV.controlsWidgetInstance.canvasUI.viewport.fitLayout(w,h)}}api.setZoom()};api.updateImageScaledIndicator=function(){var wh;if(AV.paintWidgetInstance){if(AV.controlsWidgetInstance.imageSizeTracker.isDisplayingImageSize(AV.launchData)){wh=AV.paintWidgetInstance.getScaledSize();avpw$("#avpw_size_indicator").html((wh.hiresWidth||wh.width)+" x "+(wh.hiresHeight||wh.height))}}else{avpw$("#avpw_size_indicator").html("")}};api.setZoom=function(){var ratio;var transformProp=AV.support.getVendorProperty("transform");if(transformProp){ratio=AV.controlsWidgetInstance.canvasUI?1/AV.controlsWidgetInstance.canvasUI.viewport.getRatio():1;if(zoomSlider){zoomSlider.shutdown();zoomSlider=null}zoomSlider=new AV.controlsWidgetInstance.Slider({element:document.getElementById("avpw_zoom_slider"),min:ratio,max:1.5,defaultValue:ratio,onslide:function(ev,ui){AV.controlsWidgetInstance.canvasUI.viewport.zoomByRatio(ui.value)},onchange:function(ev,ui){AV.controlsWidgetInstance.canvasUI.viewport.zoomByRatio(ui.value)}});zoomSlider.reset();zoomSlider.addListeners()}};api.enableZoomMode=function(){var controls=AV.controlsWidgetInstance;if(zoomControls){zoomControls.addClass("avpw_zoom_open");if(controls.canvasUI){controls.canvasUI.enablePan()}var noModal=controls.toolManager.notify(controls.toolManager.getActiveTool(),"onEnableZoomMode");if(!noModal){zoomModeOverlay.addClass("avpw_zoom_open")}}};api.disableZoomMode=function(suppressEvents){var controls=AV.controlsWidgetInstance;if(zoomControls){zoomControls.removeClass("avpw_zoom_open");controls.toolManager.notify(controls.toolManager.getActiveTool(),"onDisableZoomMode");zoomModeOverlay.removeClass("avpw_zoom_open")}};api.showZoomButton=function(){if(zoomControls){if(zoomHideTimer){window.clearTimeout(zoomHideTimer);zoomHideTimer=null}zoomControls.show();zoomShowTimer=window.setTimeout(function(){zoomControls.addClass("avpw_zoom_visible")},100)}};api.hideZoomButton=function(){if(zoomControls){if(zoomShowTimer){window.clearTimeout(zoomShowTimer);zoomShowTimer=null}zoomControls.removeClass("avpw_zoom_visible");zoomHideTimer=window.setTimeout(function(){zoomControls.hide()},200)}};api.updateUndoRedo=function(canUndo,canRedo){if(inToolMode){return}$undoButton=$undoButton||avpw$("#avpw_history_undo");$redoButton=$redoButton||avpw$("#avpw_history_redo");$undoBlocker=$undoBlocker||avpw$("#avpw_history_undo_blocker");$redoBlocker=$redoBlocker||avpw$("#avpw_history_redo_blocker");if(canUndo){$undoButton.removeClass("avpw_history_disabled");$undoBlocker.hide()}else{$undoButton.addClass("avpw_history_disabled");$undoBlocker.show()}if(canRedo){$redoButton.removeClass("avpw_history_disabled");$redoBlocker.hide()}else{$redoButton.addClass("avpw_history_disabled");$redoBlocker.show()}};api.showView=function(win,doc){var timer;return function(view,fadetime){var ms=200;var main_container=doc.getElementById("avpw_tool_main_container");var tool_container=doc.getElementById("avpw_tool_options_container");var avpw_controls=avpw$("#avpw_controls");if(timer){win.clearTimeout(timer);timer=undefined}switch(view){case"editpanel":avpw_controls.removeClass("avpw_main_mode");timer=win.setTimeout(function(){main_container.style.display="none";tool_container.style.display="block";avpw_controls.addClass("avpw_editpanel_mode")},ms);break;case"main":avpw_controls.removeClass("avpw_editpanel_mode");timer=win.setTimeout(function(){tool_container.style.display="none";main_container.style.display="block";avpw_controls.addClass("avpw_main_mode")},ms);break}}}(window,document);api.bindEvents=function(){mediator.on("layout:resize",applyDynamicDimensions);mediator.on("layout:resize",api.scaleCanvas);mediator.on("canvas:resize",onCanvasTransform);mediator.on("tool:open",updateBreadcrumbDisplay);mediator.on("tool:close",updateBreadcrumbDisplay)};api.bindEvents();return api}();AV.ControlsWidget.prototype.bindControls=function(){var _this=this;avpw$(window).bind("resize",this.windowResized);avpw$("#avpw_controls").bind("mousedown",function(e){var mousedown_tag=e.target.tagName.toLowerCase();if(mousedown_tag!="input"&&mousedown_tag!="textarea"&&mousedown_tag!="object"){e.preventDefault()}});if(AV.launchData.debug){avpw$("#avpw_logo").click(function(){console.log(this.paintWidget.actions.exportJSON(true));return false}.AV_bindInst(this))}avpw$(".avpw_button").pressed("avpw_button_down");avpw$(".avpw_tool_icon").pressed("avpw_tool_icon_down");avpw$(".avpw_checkmark_button .avpw_inset_button").pressed("avpw_inset_button_down");attachSmartClickHandler(avpw$("#avpw_save_button","#avpw_tool_main_container"),this.onSaveButtonClicked.AV_bindInst(this));avpw$("#avpw_control_cancel_pane_inner").click(this.cancel.AV_bindInst(this));avpw$("#avpw_control_main_scrolling_region").delegate(".avpw_tool_icon","click",function(){mediator.trigger("tool:open",avpw$(this).data("toolname"),this);return false});avpw$("#avpw_resume_editing").click(function(){_this.messager.hide("avpw_aviary_quitareyousure");return false});avpw$("#avpw_close_feedbackok").click(function(){mediator.trigger("modal:hide","avpw_aviary_aviaryfeedback");return false});avpw$("#avpw_resume_aftersave").click(function(){_this.messager.hide("avpw_aviary_beensaved");return false});avpw$("#avpw_close_aftersave").click(function(){_this.cancel.AV_bindInst(_this)();_this.messager.hide("avpw_aviary_beensaved");return false});var backToMainMode=function(){_this.toolsPager.changePage(true);mediator.trigger("tool:close");return false};attachSmartClickHandler(avpw$("#avpw_all_effects","#avpw_tool_options_container"),function(){if(!_this.paintWidget.actions.isACheckpoint()){_this.paintWidget.actions.undoToCheckpoint()}_this.paintWidget.actions.truncate();mediator.trigger("tool:cancel");return backToMainMode()});var finishCommit=function(){_this.paintWidget.actions.setCheckpoint(true);_this.paintWidget.actions.truncate();backToMainMode()};mediator.on("tool:commitDone",finishCommit);attachSmartClickHandler(avpw$("#avpw_apply_container"),function(){AV.util.nextFrame(function(){mediator.trigger("tool:commit")});return false});avpw$("#avpw_close_save").click(function(){_this.messager.hide("avpw_aviary_quitareyousure",_this.onSaveButtonClicked.AV_bindInst(_this));return false});avpw$("#avpw_close_nosave").click(function(){AV.paintWidgetCloser();return false});avpw$("#avpw_close_unsupported").click(function(){AV.paintWidgetCloser();return false});avpw$("#avpw_close_forcecrop_close").click(function(){AV.paintWidgetCloser();return false});avpw$("#avpw_history_undo").click(function(){mediator.trigger("tool:undo")});avpw$("#avpw_history_redo").click(function(){mediator.trigger("tool:redo")});avpw$(".avpw_prev").bind("mousedown",function(){avpw$(this).addClass("avpw_prev_down")}).bind("mouseup mouseout",function(){avpw$(this).removeClass("avpw_prev_down")});avpw$(".avpw_next").bind("mousedown",function(){avpw$(this).addClass("avpw_next_down")}).bind("mouseup mouseout",function(){avpw$(this).removeClass("avpw_next_down")})};AV.ControlsWidget.prototype.unbindControls=function(){avpw$(window).unbind("resize",this.windowResized);avpw$("#avpw_controls").unbind("mousedown");if(AV.launchData.debug){avpw$("#avpw_logo").unbind()}avpw$(".avpw_button").unbind("mousedown");avpw$(".avpw_tool_icon").unbind("mousedown");avpw$(".avpw_checkmark_button .avpw_inset_button").unbind("mousedown");avpw$("#avpw_save_button").unbind("click");avpw$("#avpw_control_cancel_pane_inner").unbind("click");avpw$("#avpw_control_main_scrolling_region").undelegate(".avpw_tool_icon","click");avpw$("#avpw_resume_editing").unbind();avpw$("#avpw_tool_options_container").undelegate("#avpw_all_effects","click");mediator.off("tool:commitDone");avpw$("#avpw_changes_resume").unbind("click");avpw$("#avpw_changes_discard").unbind("click");avpw$("#avpw_close_nosave").unbind();avpw$("#avpw_close_save").unbind();avpw$("#avpw_close_unsupported").unbind();avpw$("#avpw_close_forcecrop_close").unbind();avpw$("#avpw_resume_aftersave").unbind("click");avpw$("#avpw_close_aftersave").unbind("click");avpw$("#avpw_history_undo").unbind("click");avpw$("#avpw_history_redo").unbind("click");avpw$(".avpw_prev").unbind("mousedown").unbind("mouseup");avpw$(".avpw_next").unbind("mousedown").unbind("mouseup");if(this.brushPreview){this.brushPreview.destroy()}};AV.ControlsWidget.prototype.brushPreview=function(win){var FADE_IN_DELAY=100;var PERSIST_DELAY=1e3;var FADE_OUT_DELAY=400;var overlay,brushCanvas,showTimer,hideTimer;var api={};var setup=function(){overlay=avpw$(AV.template[AV.launchData.layout].brushPreviewOverlay());brushCanvas=overlay.find(".avpw_brush_preview_display");avpw$("#avpw_controls").append(overlay)};api.show=function(radius,color){if(AV.featherUseFlash){return}if(!(overlay&&overlay.length)){setup()}AV.controlsWidgetInstance._drawUICircle(brushCanvas,radius,"#fff");overlay.removeClass("avpw_brush_preview_visible");overlay.removeClass("avpw_brush_preview_fadeout");overlay.show();win.clearTimeout(showTimer);win.clearTimeout(hideTimer);AV.util.nextFrame(function(){overlay.addClass("avpw_brush_preview_visible");showTimer=win.setTimeout(function(){overlay.removeClass("avpw_brush_preview_visible");overlay.addClass("avpw_brush_preview_fadeout")},FADE_IN_DELAY+PERSIST_DELAY);hideTimer=win.setTimeout(function(){overlay.hide()},FADE_IN_DELAY+PERSIST_DELAY+FADE_OUT_DELAY)})};api.destroy=function(){win.clearTimeout(showTimer);win.clearTimeout(hideTimer);if(overlay&&overlay.length){overlay.remove()}overlay=null;brushCanvas=null;showTimer=hideTimer=null};return api}(window);AV.ControlsWidget.prototype.tool["brightness"]=function(){var _controls;var _presets=AV.toolDefaults.brightness.presets;var _slider;var _defaultValue;var _lastValue;var _shouldReset=false;var api={};var sliderChanged=function(ev,ui){_lastValue=ui.value;var brightnessValue=_lastValue/100;if(AV.featherUseFlash){brightnessValue=brightnessValue*.6/100+1}_controls.paintWidget.module["brightness"].applyPreview(brightnessValue,0,true)};api.init=function(controls){_defaultValue=0;var sliderConfig={element:document.getElementById("avpw_brightness_slider"),min:_presets[0]*100,max:_presets[3]*100,defaultValue:_defaultValue,onchange:sliderChanged};if(!AV.featherUseFlash){AV.util.extend(sliderConfig,{onslide:sliderChanged,delay:100})}_controls=controls;_slider=new _controls.Slider(sliderConfig)};api.cancel=function(){_shouldReset=true};api.panelWillOpen=function(){_lastValue=_defaultValue};api.panelDidOpen=function(){_slider.addListeners()};api.panelWillClose=function(){_slider.removeListeners()};api.panelDidClose=function(){if(_shouldReset){api.resetUI();_shouldReset=false}};api.onUndo=function(opts){if(!opts){api.resetUI()}_controls.paintWidget.module["brightness"].resetBacking()};api.onRedo=function(opts){if(!opts&&_slider){_slider.setValue(_lastValue)}};api.resetUI=function(){_slider.reset()};api.shutdown=function(){if(_slider){_slider.shutdown();_slider=undefined}_lastValue=_defaultValue=undefined;_controls=null};return api}();AV.ControlsWidget.prototype.tool["colorsplash"]=function(){var _controls;var _presets=AV.toolDefaults.colorsplash.presets;var api={};var _mouseDown;var _startX,_startY;var _lastPos=null;var SIGMA_R_SMALL=8;var SIGMA_R_SMALL_2=13;var SIGMA_R_MEDIUM=18;var SIGMA_R_MEDIUM_2=21;var SIGMA_R_LARGE=25;var DOM_FACTOR=3;var _sigmaRadius=SIGMA_R_MEDIUM;var _BRUSH_SIZE=SIGMA_R_MEDIUM*DOM_FACTOR;var _brushModeName="free";var _isFreeHandBrushMode,_sigmaColor,_reverse;var _innerCursorPadding=0;var _brushElm;var _brushCanvas;var centerOffset=7;var _brushElmSize=_BRUSH_SIZE+centerOffset*2;var strokeSize=3;var _mouseDownScaleRatio=.9;var _currentPointList;var _createBrushIfNecessary=function(){_brushElm=document.createElement("div");_brushElm.className="avpw_colorsplash_brush";_brushCanvas=document.createElement("canvas");_brushElmSize=_BRUSH_SIZE+centerOffset*2;_brushCanvas.width=150;_brushCanvas.height=150;_brushElm.appendChild(_brushCanvas);_controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(_brushElm);avpw$(_brushCanvas).css({marginTop:-(_brushElmSize/2)+"px",marginLeft:-(_brushElmSize/2)+"px"})};var _animateOriginalImage=function(){var originalImageCanvas=_controls.paintWidget.canvas;var imagePeelCanvas=avpw$(originalImageCanvas).clone();var imageData=originalImageCanvas.getContext("2d").getImageData(0,0,originalImageCanvas.width,originalImageCanvas.height);imagePeelCanvas[0].getContext("2d").putImageData(imageData,0,0);imagePeelCanvas.css({"z-index":1,position:"absolute"});avpw$(originalImageCanvas).after(imagePeelCanvas);avpw$(imagePeelCanvas).fadeOut(800,function(){avpw$(this).remove()})};var _removeBrush=function(){avpw$(_brushElm).fadeOut(function(){avpw$(this).remove()})};var _drawBrushColor=function(color){if(!_brushCanvas)return;_brushCanvas.width=_brushCanvas.width;var ctx=_brushCanvas.getContext("2d");var halfPoint=Math.round(_BRUSH_SIZE/2);ctx.shadowColor="white";ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.shadowBlur=1;ctx.lineWidth=5;ctx.strokeStyle="rgba("+color[0]+","+color[1]+","+color[2]+",1)";ctx.beginPath();ctx.arc(halfPoint+centerOffset,halfPoint+centerOffset,halfPoint-2,Math.PI,0,false);ctx.stroke();ctx.lineWidth=2;ctx.strokeStyle="white";ctx.beginPath();ctx.arc(halfPoint+centerOffset,halfPoint+centerOffset,halfPoint+2,0,2*Math.PI,false);ctx.stroke();ctx.lineWidth=2;ctx.strokeStyle="white";ctx.beginPath();ctx.arc(halfPoint+centerOffset,halfPoint+centerOffset,halfPoint-5,0,2*Math.PI,false);ctx.stroke();var opacity=!_mouseDown?.7:.35;ctx.shadowBlur=0;ctx.lineWidth=2;ctx.strokeStyle="rgba(0,0,0,"+opacity+")";ctx.beginPath();ctx.arc(halfPoint+centerOffset,halfPoint+centerOffset,halfPoint-4,0,2*Math.PI,false);ctx.stroke();ctx.lineWidth=2;ctx.strokeStyle="rgba(0,0,0,"+opacity+")";ctx.beginPath();ctx.arc(halfPoint+centerOffset,halfPoint+centerOffset,halfPoint+1,0,2*Math.PI,false);ctx.stroke()};var _setBrushSize=function(){avpw$(this).addClass("avpw_inset_button_down").siblings().removeClass("avpw_inset_button_down");var sizeSelected=avpw$(this).data("size");_BRUSH_SIZE=sizeSelected*DOM_FACTOR;_sigmaRadius=sizeSelected;if(_sigmaRadius<SIGMA_R_MEDIUM)_innerCursorPadding=5;else _innerCursorPadding=0;avpw$(_brushCanvas).css({marginTop:-((_BRUSH_SIZE+centerOffset*2)/2)+"px",marginLeft:-((_BRUSH_SIZE+centerOffset*2)/2)+"px"});_brushElmSize=_BRUSH_SIZE+centerOffset*2;_controls.brushPreview.show(_sigmaRadius*1.3);_drawBrushColor([0,0,0,0])};var _setBrushMode=function(){avpw$(".avpw_colorsplash_freebrush,.avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser").not(this).removeClass("avpw_inset_button_down");avpw$(this).addClass("avpw_inset_button_down");var settings;if(avpw$(this).hasClass("avpw_colorsplash_freebrush")){_brushModeName="free";mediator.trigger("usage:interact","colorsplash","FreeBrushClicked")}else if(avpw$(this).hasClass("avpw_colorsplash_smartbrush")){_brushModeName="smart";mediator.trigger("usage:interact","colorsplash","SmartBrushClicked")}else if(avpw$(this).hasClass("avpw_colorsplash_eraser")){_brushModeName="erase";mediator.trigger("usage:interact","colorsplash","EraserBrushClicked")}settings=_controls.paintWidget.module["colorsplash"].getBrushSettingsForMode(_brushModeName);_isFreeHandBrushMode=settings.IS_FREE_HAND;_sigmaColor=settings.SIGMA_COLOR;_reverse=settings.REVERSE};api.init=function(controls){_controls=controls;var toolArea=avpw$("#avpw_controlpanel_colorsplash");toolArea.delegate(".avpw_isa_preset_brush","mousedown",_setBrushSize);toolArea.delegate(".avpw_colorsplash_freebrush,.avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser","mousedown",_setBrushMode)};api.cancel=function(){_controls.paintWidget.module["colorsplash"].reset()};api.panelWillOpen=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api);_controls.canvasUI.setMouseCursor("none");avpw$(".avpw_canvas_background").css("cursor","none")}_mouseDown=false};api.panelDidOpen=function(){avpw$(".avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser").removeClass("avpw_inset_button_down");avpw$(".avpw_colorsplash_freebrush").addClass("avpw_inset_button_down");var settings;_brushModeName="free";settings=_controls.paintWidget.module["colorsplash"].getBrushSettingsForMode(_brushModeName);_isFreeHandBrushMode=settings.IS_FREE_HAND;_sigmaColor=settings.SIGMA_COLOR;_reverse=settings.REVERSE;avpw$("#avpw_zoom_container").css("cursor","default");_controls.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement");_createBrushIfNecessary();_animateOriginalImage();_controls.paintWidget.module["colorsplash"].initImage();avpw$(_brushElm).hide().fadeIn();avpw$("#avpw_controlpanel_colorsplash").find(".avpw_isa_preset_brush").eq(2).trigger("mousedown")};api.panelWillClose=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}_removeBrush();avpw$(".avpw_canvas_background").css("cursor","default");_controls.layoutNotify(AV.launchData["openType"],"hideCanvasControlsElement")};api.mouseDownEvent=function(coords,ev,withinCanvas){if(!withinCanvas){return}_mouseDown=true;var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var x=coords.canvasControlsX*zoomScale+.5|0;var y=coords.canvasControlsY*zoomScale+.5|0;var scaledRadius=_sigmaRadius*zoomScale;_startX=x;_startY=y;if(x<0||x>_controls.paintWidget.width-1||y<0||y>_controls.paintWidget.height-1||_startX<0||_startX>_controls.paintWidget.width-1||_startY<0||_startY>_controls.paintWidget.height-1)return;_currentPointList=[];_controls.paintWidget.module["colorsplash"].applySplash(x,y,_startX,_startY,_reverse,scaledRadius,_sigmaColor,1);_currentPointList.push([x,y]);var minX=x;var minY=y;var maxX=x;var maxY=y;var paddedBrushRadius=scaledRadius*1.5;minX-=paddedBrushRadius;minY-=paddedBrushRadius;maxX+=paddedBrushRadius;maxY+=paddedBrushRadius;_controls.paintWidget.module["colorsplash"].preview(minX,minY,maxX,maxY);return false};api.mouseMoveEvent=function(coords,ev){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var x=coords.canvasControlsX*zoomScale+.5|0;var y=coords.canvasControlsY*zoomScale+.5|0;var scaledRadius=_sigmaRadius*zoomScale;if(_brushElm){avpw$(_brushElm).css({top:coords.canvasControlsY+"px",left:coords.canvasControlsX+"px"});if(_mouseDown){if(_isFreeHandBrushMode){_startX=x;_startY=y}if(_lastPos!=null){var distance=Math.sqrt(Math.pow(_lastPos.x-x,2)+Math.pow(_lastPos.y-y,2));if(distance<.6*_sigmaRadius){return}var fillPoints=_generatePointList([[_lastPos.x,_lastPos.y],[x,y]]);var minX=x;var minY=y;var maxX=x;var maxY=y;var xPos,yPos;var paddedBrushRadius=scaledRadius*1.5;for(var i=0;i<fillPoints.length;i++){xPos=fillPoints[i][0]+.5|0;yPos=fillPoints[i][1]+.5|0;if(xPos<minX){minX=xPos}if(xPos>maxX){maxX=xPos}if(yPos<minY){minY=yPos}if(yPos>maxY){maxY=yPos}_controls.paintWidget.module["colorsplash"].applySplash(xPos,yPos,_startX,_startY,_reverse,scaledRadius,_sigmaColor,1);_currentPointList.push([xPos,yPos])}minX-=paddedBrushRadius;minY-=paddedBrushRadius;maxX+=paddedBrushRadius;maxY+=paddedBrushRadius;_controls.paintWidget.module["colorsplash"].preview(minX,minY,maxX,maxY)}_lastPos={x:x,y:y}}}_drawBrushColor(_controls.paintWidget.module["colorsplash"].getColorAtPosition(x,y))};api.mouseUpEvent=function(coords,ev){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var x=coords.canvasControlsX*zoomScale;var y=coords.canvasControlsY*zoomScale;_drawBrushColor(_controls.paintWidget.module["colorsplash"].getColorAtPosition(x,y));var scaledRadius=_sigmaRadius*zoomScale;if(_mouseDown){var stroke={radius:scaledRadius,brushmode:_brushModeName,pointlist:_currentPointList};_controls.paintWidget.module["colorsplash"].recordStroke(stroke);_mouseDown=false}_drawBrushColor(_controls.paintWidget.module["colorsplash"].getColorAtPosition(x,y));_lastPos=null;return false};api.mouseOutEvent=function(coords,ev,withinCanvas){return false};var getQuadMid=function(points,x0,y0,x1,y1,cpx,cpy){var brushSize=Math.floor(_BRUSH_SIZE*.2);var distdist=(x1-x0)*(x1-x0)+(y1-y0)*(y1-y0);if(distdist<brushSize*brushSize){return null}var ax,bx,ay,by,mx,my;if(cpx!==undefined){ax=(cpx+x0)/2;bx=(cpx+x1)/2;ay=(cpy+y0)/2;by=(cpy+y1)/2;mx=(ax+bx)/2;my=(ay+by)/2}else{mx=(x0+x1)/2;my=(y0+y1)/2}getQuadMid(points,x0,y0,mx,my,ax,ay);points.push([mx|0,my|0]);getQuadMid(points,mx,my,x1,y1,bx,by)};var _generatePointList=function(pointList){var lastpoint;var i=0;var midpoints=[];for(i=0;i<pointList.length-1;++i){var point1=pointList[i];var point2=pointList[i+1];var midpoint=[(point1[0]+point2[0])/2|0,(point1[1]+point2[1])/2|0];if(i===0){getQuadMid(midpoints,point1[0],point1[1],midpoint[0],midpoint[1])}else{getQuadMid(midpoints,lastpoint[0],lastpoint[1],midpoint[0],midpoint[1],point1[0],point1[1])}lastpoint=midpoint;midpoints.push(midpoint);if(i===pointList.length-2){getQuadMid(midpoints,midpoint[0],midpoint[1],point2[0],point2[1]);midpoints.push(point2)}}return midpoints};var _hideMouseCursor=function(){avpw$(".avpw_canvas_background").css("cursor","none");avpw$("#avpw_zoom_container").css("cursor","default")};var _showMouseCursor=function(){avpw$(".avpw_canvas_background").css("cursor","default");avpw$("#avpw_zoom_container").css("cursor","default")};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api);avpw$(_brushElm).fadeOut()}_showMouseCursor();return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api);avpw$(_brushElm).fadeIn()}_hideMouseCursor()};api.commit=function(){_controls.paintWidget.module["colorsplash"].commit()};api.shutdown=function(){avpw$("#avpw_controlpanel_colorsplash").undelegate();_removeBrush();_controls=null};api.onUndoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module["colorsplash"].resetImageData();return false}};api.onRedoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module["colorsplash"].resetImageData();return false}};return api}();AV.ControlsWidget.prototype.tool["contrast"]=function(){var _controls;var _presets=AV.toolDefaults.contrast.presets;var _slider;var _defaultValue;var _lastValue;var _shouldReset=false;var api={};var sliderChanged=function(ev,ui){_lastValue=ui.value;var contrastValue=_lastValue/100;if(AV.featherUseFlash){contrastValue=contrastValue*.6/100+1}_controls.paintWidget.module["contrast"].applyPreview(0,contrastValue,true)};api.init=function(controls){_defaultValue=0;var sliderConfig={element:document.getElementById("avpw_contrast_slider"),min:_presets[0]*100,max:_presets[3]*100,defaultValue:_defaultValue,onchange:sliderChanged};if(!AV.featherUseFlash){AV.util.extend(sliderConfig,{onslide:sliderChanged,delay:100})}_controls=controls;_slider=new _controls.Slider(sliderConfig)};api.cancel=function(){_shouldReset=true};api.panelWillOpen=function(){_lastValue=_defaultValue};api.panelDidOpen=function(){_slider.addListeners()};api.panelWillClose=function(){_slider.removeListeners()};api.panelDidClose=function(){if(_shouldReset){api.resetUI();_shouldReset=false}};api.onUndo=function(opts){if(!opts){api.resetUI()}_controls.paintWidget.module["contrast"].resetBacking()};api.onRedo=function(opts){if(!opts&&_slider){_slider.setValue(_lastValue)}};api.resetUI=function(){_slider.reset()};api.shutdown=function(){if(_slider){_slider.shutdown();_slider=undefined}_controls=null};return api}();AV.ControlsWidget.prototype.tool["crop"]=function(){var _controls;var _fixedSize=null;var _presets;var _presetsFromConfig;var _defaultPreset;var _pager;var _cropPresetLabelApplied;var _cropController;var _mouseDown=false;var $avpw_crop_presets;var api={};var _containsCustom=false;var _buildPreset=function(i){var preset=_presets[i];if(!preset)return"";if(preset.label==="Custom"){_containsCustom=true;return""}preset.label=AV.getLocalizedString(preset.label);return AV.template[AV.launchData.layout].cropPreset(preset)};var _isActive=function($el){return $el.hasClass("avpw_preset_icon_active")};var _setActive=function($el){$el.siblings().removeClass("avpw_preset_icon_active");$el.siblings().removeClass("avpw_crop_preset_flipped");$el.addClass("avpw_preset_icon_active")};var _crop=function(){_controls.paintWidget.module["crop"].crop(_cropController.crop());if(_fixedSize){_controls.paintWidget.setMode("resize");_controls.paintWidget.module["resize"].resize(_fixedSize.width,_fixedSize.height,true);_controls.paintWidget.setMode("crop")}};var _flipPresets=function($el){avpw$("#avpw_crop_presets_scroll_region").toggleClass("avpw_crop_all_flipped");$el.parent().children().not(".avpw_preset_icon_disabled").each(function(i,el){if(avpw$(el).hasClass(".avpw_crop_custom_control"))return;var preset=_presets[i];if(!preset){return}var label=preset.label;var labeled=preset.labeled;var $labelEl=avpw$(el).find(".avpw_label");var currentLabel=$labelEl.html();var delim=preset.resize?"x":":";var delimIndex,s1,s2,w,h;if(!labeled){if(currentLabel===label){delimIndex=label.indexOf(delim);if(delim!=-1){s1=label.substr(0,delimIndex);s2=label.substr(delimIndex+1);w=parseInt(s1,10);h=parseInt(s2,10);currentLabel=h+delim+w}}else{currentLabel=label
}$labelEl.html(currentLabel);preset.flipped=!preset.flipped}})};var _lastConstrain=false;var _cropPresetClicked=function(ev){var $this=avpw$(this);var crop=AV.util.findItemByKeyValueFromArray("label",$this.data("crop"),_presets);var canvasDims,w,h;if($this.hasClass("avpw_crop_custom_control")){CustomCropController.enableMode(true);return}CustomCropController.enableMode(false);AV.util.nextFrame(function(){_fixedSize=null;if(crop){if(!crop.labeled&&!crop.strict&&_isActive($this)){_flipPresets($this)}if(crop.flipped){$this.addClass("avpw_crop_preset_flipped");w=crop.height;h=crop.width}else{$this.removeClass("avpw_crop_preset_flipped");w=crop.width;h=crop.height}if(crop.resize){_fixedSize={width:w,height:h};canvasDims=_controls.paintWidget.a2c(w,h,true);CustomCropController.enableTooltip(true);_cropController.setInitialSelectionTo(canvasDims.width,canvasDims.height);CustomCropController.enableTooltip(false)}else{if(w&&h){CustomCropController.enableTooltip(true);_cropController.setInitialSelectionByRatio(w/h)}}_cropController.forceAspect(crop.constrain);_lastConstrain=crop.constrain;_cropPresetLabelApplied=crop.label}_setActive($this)});return false};var _buildPresets=function(){if(_pager){_pager.shutdown()}_presets=_controls.populateCropPresets(_presetsFromConfig);var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");var itemWidth=dims.PRESET_CROP_ICON_WIDTH;var itemsPerPage=_controls.layoutNotify(AV.launchData["openType"],"getCropPresetsPerPage");var pageWidth=itemWidth*itemsPerPage;var presetCount=_presets.length+1;var $pagerContainer=avpw$("#avpw_crop_presets_scroll_region");$pagerContainer.css({width:(presetCount+itemsPerPage)*itemWidth+"px"});_pager=new AV.Pager({leftArrow:avpw$("#avpw_crop_presets_lftArrow"),rightArrow:avpw$("#avpw_crop_presets_rghtArrow"),itemCount:presetCount,itemsPerPage:itemsPerPage,pageWidth:pageWidth,itemBuilder:_buildPreset,pageContainer:$pagerContainer});_pager.changePage();if(_containsCustom){CustomCropController.init($pagerContainer)}};var CustomCropController=function(){var api={};var _inputWidth,_inputHeight,_shouldLockDimensions=false;var _customModeEnabled=false;var canvasDims;var _$customCropControl,_$customWidth,_$customHeight,_$lockDimsInput,_$lockDimsLabel;var isValid;var _fixedSize;var _shouldShowHiResDims=false;var _keyDown=function(ev){return AV.util.keyDownHandlerNumber.apply(this,[ev,function(ev){AV.util.nextFrame(function(){if(ev.currentTarget.value===""){if(ev.data.currentProp==="width"){_inputWidth=canvasDims.width}else{_inputHeight=canvasDims.height}_updateCustomCrop(true);_updateCropToolTip(_inputWidth,_inputHeight);return}isValid=true;var newValue=parseInt(ev.currentTarget.value);if(ev.data.currentProp==="width"){if(newValue>canvasDims.width||newValue<1){isValid=false}else{_inputWidth=newValue}}else{if(newValue>canvasDims.height||newValue<1){isValid=false}else{_inputHeight=newValue}}if(isValid){if(_shouldLockDimensions)mediator.on("tool:crop:change",_updateCropToolTip);_updateCustomCrop(true);if(_shouldLockDimensions)mediator.off("tool:crop:change",_updateCropToolTip);avpw$(ev.currentTarget).removeClass("avpw_invalid_input")}else{avpw$(ev.currentTarget).addClass("avpw_invalid_input")}})}])};var _preventUpdateCascade=false;var _updateCustomCrop=function(preventInputUpdate,preventScaling){if(preventInputUpdate)_preventUpdateCascade=true;var inputWidth=_inputWidth||canvasDims.width;var inputHeight=_inputHeight||canvasDims.height;var scaledDims;if(preventScaling){scaledDims={width:inputWidth,height:inputHeight}}else{scaledDims=_controls.paintWidget.a2c(inputWidth,inputHeight,true)}_cropController.setInitialSelectionTo(scaledDims.width,scaledDims.height);_cropController.forceAspect(_shouldLockDimensions);_lastConstrain=_shouldLockDimensions;_preventUpdateCascade=false;if(!preventInputUpdate){mediator.trigger("tool:crop:change",_inputWidth,_inputHeight,preventInputUpdate)}if(_fixedSize)_fixedSize={width:inputWidth,height:inputHeight}};api.resetInputs=function(){};api.triggerValidation=function(force){if(!isValid||force){_$customWidth.trigger("keydown");_$customHeight.trigger("keydown")}};var _buildCustomCropController=function($pagerContainer){_$customCropControl=avpw$(AV.template[AV.launchData.layout].cropCustomControl({}));$pagerContainer.prepend(_$customCropControl);_$customWidth=$pagerContainer.find("#avpw_crop_custom_width");_$customHeight=$pagerContainer.find("#avpw_crop_custom_height");_$lockDimsInput=$pagerContainer.find("#avpw_crop_custom_lock_dims");_$lockDimsLabel=$pagerContainer.find(".avpw_crop_lock_group").find("span");_shouldLockDimensions=false;_$customWidth.bind("keydown",{currentProp:"width"},_keyDown).bind("focus",function(){api.enableMode(true);return false}).bind("blur",function(){api.resetInputs();api.triggerValidation()});_$customHeight.bind("keydown",{currentProp:"height"},_keyDown).bind("focus",function(){api.enableMode(true);return false}).bind("blur",function(){api.resetInputs();api.triggerValidation()});_$lockDimsInput.change(function(){_setLockMode(avpw$(this).is(":checked"))});_$lockDimsLabel.bind("click",function(){_$lockDimsInput.click()})};var _setLockMode=function(flag){_shouldLockDimensions=flag;if(_shouldLockDimensions){mediator.off("tool:crop:change",_updateCropInputFields);mediator.off("tool:crop:change",_updateCropToolTip);if(!_inputWidth&&!_inputHeight){_fixedSize={width:canvasDims.hiresWidth||canvasDims.width,height:canvasDims.hiresHeight||canvasDims.height}}else if(!_$customWidth.hasClass("avpw_invalid_input")&&!_$customHeight.hasClass("avpw_invalid_input")){_fixedSize={width:_inputWidth,height:_inputHeight}}_updateCustomCrop(true,false)}else{mediator.on("tool:crop:change",_updateCropInputFields);mediator.on("tool:crop:change",_updateCropToolTip);_updateCustomCrop(true,false);_fixedSize=null}};api.getFixedSize=function(){if(!_customModeEnabled)return null;if(_fixedSize){return _fixedSize}else{var w=_inputWidth,h=_inputHeight;if(_shouldShowHiResDims){var dims=_controls.paintWidget.a2c(w,h,true);w=dims.hiresWidth;h=dims.hiresHeight}return{width:w,height:h}}};var _preventUpdateCascade;var _updateCropInputFields=function(w,h,preventInputUpdate){if(_preventUpdateCascade)return;if(_shouldShowHiResDims){var dims=_controls.paintWidget.c2a(w,h,true);w=dims.hiresWidth;h=dims.hiresHeight}_$customWidth.val(w);_inputWidth=w;_$customHeight.val(h);_inputHeight=h;if(!isValid){api.triggerValidation()}};var _updateCropToolTip=function(w,h){if(_shouldShowHiResDims){if(_customModeEnabled){AV.util.nextFrame(function(){_cropController.setToolTipValues(_inputWidth,_inputHeight)})}else{var dims=_controls.paintWidget.c2a(w,h,false);_cropController.setToolTipValues(dims.hiresWidth+.5|0,dims.hiresHeight+.5|0)}}else{_cropController.setToolTipValues(w,h)}};var _firstEnable;api.init=function(container){_firstEnable=false;_buildCustomCropController(container);mediator.on("tool:crop:change",_updateCropToolTip);_fixedSize=null;_inputWidth=_inputHeight=undefined};api.enableMode=function(flag){if(flag===_customModeEnabled)return;_customModeEnabled=flag;canvasDims=_controls.paintWidget.getScaledSize();if(canvasDims.hiresWidth&&canvasDims.hiresHeight){_shouldShowHiResDims=true;canvasDims.width=canvasDims.hiresWidth;canvasDims.height=canvasDims.hiresHeight}else{_shouldShowHiResDims=false}if(_customModeEnabled){_setActive(_$customCropControl);_updateCustomCrop(true);if(!_shouldLockDimensions)mediator.on("tool:crop:change",_updateCropInputFields);api.triggerValidation(true)}else{mediator.off("tool:crop:change",_updateCropInputFields);mediator.off("tool:crop:change",_updateCropToolTip);mediator.on("tool:crop:change",_updateCropToolTip);if(_$customWidth&&_$customHeight){_$customWidth.blur();_$customHeight.blur()}_fixedSize=null}};api.enableTooltip=function(flag){mediator.off("tool:crop:change",_updateCropToolTip);if(flag){mediator.on("tool:crop:change",_updateCropToolTip)}};api.focusIn=function(){_$customWidth.focus()};api.shutdown=function(){api.enableMode(false);mediator.off("tool:crop:change",_updateCropInputFields);mediator.off("tool:crop:change",_updateCropToolTip)};return api}();var _onResize=function(){_buildPresets();_cropController.setInitialSelection()};api.resetUI=function(){_controls.layoutNotify(AV.launchData["openType"],"scaleCanvas");AV.util.nextFrame(function(){var customPreset;if(_defaultPreset){customPreset=avpw$("#avpw_crop_presets_scroll_region").find('.avpw_isa_preset_crop[data-crop="'+_defaultPreset+'"]')}else{customPreset=avpw$("#avpw_crop_presets_scroll_region").find('.avpw_isa_preset_crop[data-crop="Custom"]')}if(customPreset.length){customPreset.trigger("click")}else{avpw$("#avpw_crop_presets_scroll_region").find(".avpw_isa_preset_crop").eq(0).trigger("click")}})};api.init=function(controls){_controls=controls;_presetsFromConfig=AV.launchData["cropPresets"];if(typeof presetsFromConfig==="string"){_presetsFromConfig=_presetsFromConfig.split(",")}_defaultPreset=AV.launchData["cropPresetDefault"];_cropController=new AV.CropController(controls,controls.paintWidget)};api.shutdown=function(){_unbindControls();CustomCropController.enableMode(false);if(_pager){_pager.shutdown();_pager=null}_fixedSize=null;_controls=null;_cropController=null};api.onRedoComplete=function(){api.resetUI()};api.onUndoComplete=function(){api.resetUI()};api.panelWillOpen=function(){_containsCustom=false;_fixedSize=null;_mouseDown=false;if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton");mediator.on("layout:resize",_onResize);_cropPresetLabelApplied=undefined;if(_controls.canvasUI){_controls.canvasUI.viewport.setPadding(25)}};api.panelDidOpen=function(){_buildPresets();if(_pager){_pager.setCurrentPage(0);_pager.changePage()}_cropController.activate(mediator);api.resetUI();avpw$("#avpw_crop_presets_scroll_region").removeClass("avpw_crop_all_flipped");avpw$("#avpw_controls").addClass("avpw_crop_mode");_bindControls()};var _bindControls=function(){avpw$("#avpw_crop_presets_scroll_region").delegate(".avpw_isa_preset_crop,.avpw_crop_custom_control","click",_cropPresetClicked);avpw$("#avpw_controls").delegate("#avpw_crop_flip_button","click",function(){_flipPresets(avpw$("#avpw_crop_presets_scroll_region").find("#avpw_preset_crop_icon").first());_cropController.flipIt();_cropController.forceAspect(_lastConstrain)})};var _unbindControls=function(){avpw$("#avpw_crop_presets_scroll_region").undelegate(".avpw_isa_preset_crop,.avpw_crop_custom_control","click");avpw$("#avpw_controls").undelegate("#avpw_crop_flip_button","click")};api.panelWillClose=function(){_unbindControls();if(_controls.canvasUI){_controls.canvasUI.viewport.setPadding(0)}mediator.trigger("layout:resize");avpw$("#avpw_controls").removeClass("avpw_crop_mode");CustomCropController.enableMode(false);CustomCropController.shutdown();if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}if(_cropController){_cropController.deactivate()}avpw$("#avpw_crop_presets_scroll_region").undelegate(".avpw_isa_preset_crop","click");if(_pager){_pager.shutdown();_pager=null}_controls.layoutNotify(AV.launchData["openType"],"showZoomButton");mediator.off("layout:resize",_onResize)};api.mouseDownEvent=function(coords){var continueInteraction=_cropController.updateUIDown(coords.canvasX,coords.canvasY);if(continueInteraction){_mouseDown=true}return false};api.mouseMoveEvent=function(coords){if(!_mouseDown){return}_cropController.updateUIMove(coords.canvasX,coords.canvasY);return false};api.mouseUpEvent=function(coords){if(!_mouseDown){return}_controls.canvasUI.setMouseCursor();_cropController.apply(coords.canvasX,coords.canvasY);_mouseDown=false;return false};api.commit=function(){if(!_cropController.isValidCrop()){CustomCropController.triggerValidation();return false}_fixedSize=_fixedSize||CustomCropController.getFixedSize()||null;CustomCropController.enableMode(false);_crop();return _cropPresetLabelApplied};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};return api}();AV.ControlsWidget.prototype.tool["drawing"]=function(){var _controls;var _presetsWidth=AV.toolDefaults.drawing.presetsWidth;var _presetsColor=AV.toolDefaults.drawing.presetsColor;var _mouseDown;var _colorPicker;var api={};var _updateBrushPreview=function(){var zoomScale=1;if(_controls.canvasUI){zoomScale=_controls.canvasUI.viewport.getRatio()}var erase=_controls.paintWidget.module["drawing"].erase();var radius=_controls.paintWidget.module["drawing"].width();radius/=zoomScale;radius=radius/2+.5|0;if(_controls.brushPreview){_controls.brushPreview.show(radius,!erase?_controls.paintWidget.module["drawing"].color():null)}};var _deselectColor=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active");avpw$(".avpw_inset_color_widget").find(".avpw_inset_color_picker").removeClass("avpw_inset_button_down")};var _deselectErase=function(){avpw$(".avpw_colorsplash_eraser").removeClass("avpw_inset_button_down")};var _setActive=function($el){_deselectColor();_deselectErase();$el.addClass("avpw_inset_button_down")};var _brushClicked=function(ev){ev.preventDefault();var $el=avpw$(this);var zoomScale=1;if(_controls.canvasUI){zoomScale=_controls.canvasUI.viewport.getRatio()}var size=$el.data("size")*zoomScale|0;_controls.paintWidget.module["drawing"].setWidth(size);avpw$("#avpw_drawing_brushes .avpw_inset_button_down").removeClass("avpw_inset_button_down");$el.addClass("avpw_inset_button_down");_updateBrushPreview()};var _setColor=function(color){_deselectErase();_controls.paintWidget.module["drawing"].setErase(false);_controls.paintWidget.module["drawing"].setColor(color)};var _colorClicked=function(ev){ev.preventDefault();var $el=avpw$(this);_setColor($el.data("color"));_deselectColor();$el.addClass("avpw_preset_icon_active");_updateBrushPreview()};var _colorPickerClicked=function(ev){ev.preventDefault();ev.stopPropagation();var element=ev.currentTarget;var $element=avpw$(element);if($element.hasClass("avpw_inset_button_down")&&_colorPicker){_colorPicker.hideColorPicker();_colorPicker=null;return}_setActive($element);if(avpw$(".avpw_color_picker_dropdown_popup").length){_colorPicker.hideColorPicker();_colorPicker=null}_controls.paintWidget.module["drawing"].setErase(false);_colorPicker=AV.buildColorPicker(_controls.paintWidget.module["drawing"].color(),element,function(color,isLiveColorUpdate){_setColor(color);avpw$("#avpw_controlpanel_drawing").find(".avpw_isa_color_feedback").css("background",color);if(isLiveColorUpdate)return;_updateBrushPreview();if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}},function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}});if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}};var _eraserClicked=function(ev){ev.preventDefault();_controls.paintWidget.module["drawing"].setErase(true);_setActive(avpw$(this));_updateBrushPreview()};var _bindEvents=function(){avpw$(".avpw_isa_preset_brush","#avpw_drawing_brushes").on("mousedown touchstart",_brushClicked);avpw$(".avpw_isa_preset_color","#avpw_drawing_colors").on("mousedown touchstart",_colorClicked);avpw$(".avpw_colorsplash_eraser","#avpw_controlpanel_drawing").on("mousedown touchstart",_eraserClicked);avpw$(".avpw_isa_color_picker","#avpw_controlpanel_drawing").on("mousedown touchstart",_colorPickerClicked)};var _unbindEvents=function(){avpw$(".avpw_isa_preset_brush","#avpw_drawing_brushes").off("mousedown touchstart",_brushClicked);avpw$(".avpw_isa_preset_color","#avpw_drawing_colors").off("mousedown touchstart",_colorClicked);avpw$(".avpw_colorsplash_eraser","#avpw_controlpanel_drawing").off("mousedown touchstart",_eraserClicked);avpw$(".avpw_isa_color_picker","#avpw_controlpanel_drawing").off("mousedown touchstart",_colorPickerClicked)};var _buildPresets=function(){var i,opts;var colorCount=_presetsColor.length;var html="";for(i=0;i<colorCount;i++){opts={color:_presetsColor[i]};html+=AV.template[AV.launchData.layout].brushColorIcon(opts)}avpw$("#avpw_drawing_colors").html(html)};api.init=function(controls){_controls=controls};api.panelWillOpen=function(){if(!AV.featherUseFlash){_controls.paintWidget.setMode("flatten");_controls.paintWidget.module["flatten"].flatten()}_mouseDown=false;_buildPresets();_bindEvents();if(_controls.canvasUI){_controls.canvasUI.subscribe(api);_controls.canvasUI.setMouseCursor("none")}if(avpw$.miniColors){AV.miniColors=new avpw$.miniColors}};api.panelDidOpen=function(){avpw$("#avpw_controlpanel_drawing").find(".avpw_isa_color_feedback").css("background","");AV.util.nextFrame(function(){avpw$("#avpw_drawing_brushes").find(".avpw_isa_preset_brush").eq(2).trigger("mousedown");avpw$("#avpw_drawing_brushes").find(".avpw_isa_preset_brush").eq(2).trigger("touchdown");avpw$("#avpw_drawing_colors").find(".avpw_isa_preset_color").eq(0).trigger("mousedown");avpw$("#avpw_drawing_colors").find(".avpw_isa_preset_color").eq(0).trigger("touchdown");_setActive(avpw$("#avpw_controlpanel_drawing").find(".avpw_isa_color_picker"))});_controls.paintWidget.setCurrentLayerByName("drawing")};api.panelWillClose=function(){_unbindEvents();if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api);_controls.canvasUI.setMouseCursor()}_controls.paintWidget.uiLayerShow(false);if(_colorPicker)_colorPicker.hideColorPicker();_colorPicker=null;AV.miniColors=null};api.shutdown=function(){_controls=null};api.commit=function(){_controls.paintWidget.module["drawing"].flatten()};api.mouseDownEvent=function(coords,ev,withinCanvas){if(_mouseDown||!withinCanvas){return}_mouseDown=true;if(_colorPicker){_colorPicker.hideColorPicker();_colorPicker=null}_controls.paintWidget.module["drawing"].updateUIDown(coords.canvasX,coords.canvasY);_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton");return false};api.mouseMoveEvent=function(coords){if(!_mouseDown){_controls.paintWidget.module["drawing"].updateUIMove(coords.canvasX,coords.canvasY);return}_controls.paintWidget.module["drawing"].updateUIDraw(coords.canvasX,coords.canvasY);return false};api.mouseUpEvent=function(coords){if(!_mouseDown){return}_mouseDown=false;_controls.paintWidget.module["drawing"].apply(coords.canvasX,coords.canvasY);_controls.layoutNotify(AV.launchData["openType"],"showZoomButton")};api.mouseOutEvent=function(){_controls.paintWidget.uiLayerShow(false)};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api);_controls.canvasUI.setMouseCursor()}_controls.paintWidget.uiLayerShow(false);return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api);_controls.canvasUI.setMouseCursor("none")}};return api}();AV.ControlsWidget.prototype.tool["effects"]=function(){var SLIDER_DELAY=400;var _EFFECT_THUMBNAIL_CLASS="avpw_isa_control_selector_filter";var _ACTIVE_CHECKMARK_CLASS="avpw_inset_button_active";var _ACTIVE_EFFECT_CLASS="avpw_preset_icon_active";var _optionalFrame=AV.toolDefaults.effects.optionalFrame;var _slider;var _defaultIntensityValue;var _lastIntensityValue;var _useFrame;var _toggleFrame;var _randomSeed;var _controls;var _currentFilters;var _loadStarted;var _advancedMode;var _browser;var _pager=null;var _packsInOrder;var _lastButton;var api={};var _setActiveButton=function(buttonEl){buttonEl=buttonEl||avpw$("."+_EFFECT_THUMBNAIL_CLASS).eq(0);avpw$("."+_EFFECT_THUMBNAIL_CLASS).removeClass(_ACTIVE_EFFECT_CLASS);buttonEl.addClass(_ACTIVE_EFFECT_CLASS)};var _runFilter=function(){var id,throbber;if(_lastButton){id=_lastButton.data("filtername");throbber=_lastButton.children(".avpw_icon_waiter");_controls.waitThrobber.spin(throbber[0]);AV.util.nextFrame(function(){if(AV.onRunFilter){AV.onRunFilter.apply(this,[id,_lastIntensityValue,_useFrame])}else{_controls.paintWidget.module["effects"].applyPreview(id,{seed:_randomSeed,intensity:_lastIntensityValue,border:_useFrame},true)}_controls.waitThrobber.stop()})}};var _buildPreviews=function(){if(!_currentFilters){return}avpw$("#avpw_filter_body_scroll_region").find(".avpw_isa_previewcanvas").each(function(idx,el){var id=_currentFilters[idx]["identifier"];_controls.paintWidget.module["effects"].makeThumb(id,el)})};var _sliderChanged=function(ev,ui){_lastIntensityValue=ui.value;_runFilter()};var _frameToggleClicked=function(ev){ev.preventDefault();var button=avpw$("#avpw_effects_frame_toggle");_useFrame=!_useFrame;if(_useFrame){button.addClass(_ACTIVE_CHECKMARK_CLASS)}else{button.removeClass(_ACTIVE_CHECKMARK_CLASS)}_runFilter()};var _filterClicked=function(ev){var button;button=avpw$(ev.currentTarget);id=button.data("filtername");if(id==="original"||button.hasClass("avpw_preset_icon_active")){api.cancel();_hideAdvancedToggle()}else{_randomSeed=Math.floor(Math.random()*(4294967296-1));_lastButton=button;_runFilter();_toggleFrame=button.data("frame");_showAdvancedToggle();_setActiveButton(button)}return false};var _buildFilterThumb=function(i){if(!_currentFilters){return}var label=_currentFilters[i]["displayName"];var id=_currentFilters[i]["identifier"];var thumburl=AV.featherUseFlash?AV.build["feather_baseURL"]+"images/filters/"+id+".jpg":"";var i,len=_optionalFrame.length,filterHasFrame=false;for(i=0;i<len;i++){if(id===_optionalFrame[i]){filterHasFrame=true;break}}return AV.template[AV.launchData.layout].filterThumbnail({label:AV.getLocalizedString(label),id:id,thumburl:thumburl,frame:filterHasFrame})};var _buildFilterCanister=function(i){var asset=_packsInOrder[i];var id=asset.assetId;var label=asset.displayName;var purchased=asset.purchased||!asset.needsPurchase;var template=AV.template[AV.launchData.layout][purchased?"filterCanister":"filterCanisterDisabled"];return template({label:AV.getLocalizedString(label),id:id,thumburl:AV.build["feather_baseURL"]+"images/filterpacks/"+id+".png",tagurl:AV.build["feather_baseURL"]+"images/filterpacks/purchaseable.png"})};var _buildPresets=function(){if(!_currentFilters){return}if(_pager){_pager.shutdown()}var filterCount=_currentFilters.length;var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");var itemWidth=dims.FILTER_IMAGE_WIDTH;var itemsPerPage=_controls.layoutNotify(AV.launchData["openType"],"getFiltersPerPage");var pageWidth=itemWidth*itemsPerPage;_browser.css({width:filterCount*itemWidth+"px",paddingRight:pageWidth+"px"});_pager=new AV.Pager({leftArrow:avpw$("#avpw_filter_lftArrow"),rightArrow:avpw$("#avpw_filter_rghtArrow"),itemCount:filterCount,itemsPerPage:itemsPerPage,pageWidth:pageWidth,itemBuilder:_buildFilterThumb,pageContainer:_browser});_pager.changePage();api.resetUI();avpw$("."+_EFFECT_THUMBNAIL_CLASS).eq(0).trigger("click");if(!AV.featherUseFlash){AV.util.nextFrame(function(){_buildPreviews()})}};var _shutDownUI=function(){if(_pager){_pager.shutdown();_pager=null}if(_browser&&_browser.length){_browser.hide()}};var _buildPackItemsHTML=function(){var i,len,filters=[];if(AV.filtersInOrder){filters=AV.filtersInOrder}else{len=_packsInOrder.length;for(i=0;i<len;i++){filters=filters.concat(_controls.paintWidget.filterManager.getClickableFiltersForPack(_packsInOrder[i].assetId))}}filters=filters?filters.slice(0):[];filters.unshift({displayName:"Original",identifier:"original"});_currentFilters=filters;if(_loadStarted){return}_loadStarted=true;if(_currentFilters.length>0){_buildPresets()}else{_browser.html(AV.getLocalizedString("No effects found for this pack"))}_loadStarted=false};var _basicToAdvanced=function(){var button,toolPanel=avpw$("#avpw_controlpanel_effects");if(_toggleFrame){toolPanel.addClass("avpw_effect_with_frame");button=avpw$("#avpw_effects_frame_toggle");if(_useFrame){button.addClass(_ACTIVE_CHECKMARK_CLASS)}else{button.removeClass(_ACTIVE_CHECKMARK_CLASS)}}else{toolPanel.removeClass("avpw_effect_with_frame")}toolPanel.addClass("avpw_advanced_mode");_advancedMode=true;avpw$("#avpw_controlpanel_effects").addClass("avpw_advanced_mode")};var _advancedToBasic=function(){_advancedMode=false;avpw$("#avpw_controlpanel_effects").removeClass("avpw_advanced_mode")};var _toggleAdvancedMode=function(ev){if(_advancedMode){_advancedToBasic()}else{_basicToAdvanced()}return false};var _hideAdvancedToggle=function(){var toggle=avpw$("#avpw_controlpanel_effects").find(".avpw_advanced_splitter_control");if(toggle.is(":visible")){toggle.fadeOut(100)}else{toggle.css("display","none")}};var _showAdvancedToggle=function(){if(!AV.featherUseFlash){avpw$("#avpw_controlpanel_effects").find(".avpw_advanced_splitter_control").fadeIn(100)}};api.resetUI=function(){_setActiveButton();_slider.reset();_advancedToBasic();_hideAdvancedToggle()};api.init=function(controls){_controls=controls;_lastIntensityValue=1;_useFrame=true;_browser=avpw$("#avpw_filter_body_scroll_region");_browser.delegate("."+_EFFECT_THUMBNAIL_CLASS,"click",_filterClicked);avpw$("#avpw_controlpanel_effects").delegate(".avpw_effects_frame_container","click",_frameToggleClicked);avpw$("#avpw_controlpanel_effects").delegate(".avpw_advanced_splitter_control","click",_toggleAdvancedMode);_defaultIntensityValue=1;_slider=new _controls.Slider({element:document.getElementById("avpw_effects_slider"),min:0,max:_defaultIntensityValue,defaultValue:_defaultIntensityValue,delay:SLIDER_DELAY,onchange:_sliderChanged,onslide:_sliderChanged})};api.panelWillOpen=function(){_shutDownUI();_lastButton=null;_lastValue=_defaultIntensityValue;_toggleFrame=undefined;_hideAdvancedToggle()};api.panelDidOpen=function(){_controls.assetManager.getAssets("EFFECT",function(assets){_packsInOrder=assets;_browser.show();_buildPackItemsHTML();if(_pager){_pager.changePage(true)}_slider.addListeners()});mediator.on("layout:resize",_buildPresets);_hideAdvancedToggle()};api.panelWillClose=function(){_slider.removeListeners();mediator.off("layout:resize",_buildPresets)};api.panelDidClose=function(){_advancedToBasic()};api.cancel=function(){api.resetUI();if(_controls.paintWidget.actions.isACheckpoint&&!_controls.paintWidget.actions.isACheckpoint()){_controls.paintWidget.actions.undoToCheckpoint()}};api.commit=function(){if(_lastButton&&_lastButton.length){return _lastButton.data("filtername")}};api.onUndo=function(opts){if(!opts){api.resetUI()}};api.onRedo=function(opts){if(!opts){if(_lastButton&&_lastButton.length){_setActiveButton(_lastButton)}if(_slider){_slider.setValue(_lastValue)}}};api.shutdown=function(){_shutDownUI();if(_slider){_slider.shutdown();_slider=undefined}if(_browser&&_browser.length){_browser.undelegate("."+_EFFECT_THUMBNAIL_CLASS,"click")}avpw$("#avpw_controlpanel_effects").undelegate(".avpw_advanced_checkbox","click");avpw$("#avpw_controlpanel_effects").undelegate(".avpw_advanced_splitter_control","click");_controls=null;_browser=null};return api}();AV.ControlsWidget.prototype.tool["enhance"]=function(){var _controls;var _lastButton;var _presets=AV.toolDefaults.enhance.presets;var api={};var _setActiveButton=function(buttonEl){buttonEl.siblings().removeClass("avpw_inset_button_down");buttonEl.addClass("avpw_inset_button_down")};var _filterClicked=function(ev){var id,$this;$this=avpw$(this);if($this.hasClass("avpw_inset_button_down")){$this.removeClass("avpw_inset_button_down");api.cancel()}else{_setActiveButton($this);id=_presets[$this.index()];_controls.showWaitThrobber(true,function(){_controls.paintWidget.module["enhance"].applyPreview(id,true);_controls.showWaitThrobber(false)});_lastButton=$this}return false};var _addListeners=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").bind("mousedown touchstart",_filterClicked)};var _removeListeners=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").unbind("mousedown touchstart").removeClass("avpw_inset_button_down")};api.resetUI=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").removeClass("avpw_inset_button_down")};api.init=function(controls){_controls=controls};api.panelWillOpen=function(){_lastButton=null};api.panelDidOpen=function(){_addListeners()};api.panelWillClose=function(){_removeListeners()};api.cancel=function(){api.resetUI();if(!_controls.paintWidget.actions.isACheckpoint()){_controls.paintWidget.actions.undoToCheckpoint()}};api.commit=function(){if(_lastButton&&_lastButton.length){return _presets[_lastButton.index()]}};api.onUndo=function(opts){if(!opts){api.resetUI()}};api.onRedo=function(opts){if(!opts&&_lastButton&&_lastButton.length){_setActiveButton(_lastButton)}};api.shutdown=function(){_controls=null};return api}();AV.ControlsWidget.prototype.tool["forcecrop"]=function(){var _controls;var _fixedSize=null;var _presets;var _presetsFromConfig;var _defaultPreset;var _pager;var _cropPresetLabelApplied;var _cropController;var _mouseDown=false;var $avpw_crop_presets;var api={};var _crop=function(){_controls.paintWidget.module["crop"].crop(_cropController.crop());if(_fixedSize){_controls.paintWidget.setMode("resize");_controls.paintWidget.module["resize"].resize(_fixedSize.width,_fixedSize.height,true);_controls.paintWidget.setMode("crop")}};var _lastConstrain=false;var _setCropByPreset=function(crop){_fixedSize=null;if(crop){w=crop.width;h=crop.height;if(crop.resize){_fixedSize={width:w,height:h};_updateCropToolTip(w,h);mediator.off("tool:crop:change",_updateCropToolTip);canvasDims=_controls.paintWidget.a2c(w,h,true);_cropController.setInitialSelectionTo(canvasDims.width,canvasDims.height)}else{mediator.on("tool:crop:change",_updateCropToolTip);if(w&&h){_cropController.setInitialSelectionByRatio(w/h)}}_cropController.forceAspect(crop.constrain);_lastConstrain=crop.constrain;_cropPresetLabelApplied=crop.label}};var _onResize=function(){_setMainCrop()};api.resetUI=function(){_controls.layoutNotify(AV.launchData["openType"],"scaleCanvas")};api.init=function(controls){_controls=controls;_presetsFromConfig=AV.launchData["cropPresets"];if(typeof presetsFromConfig==="string"){_presetsFromConfig=_presetsFromConfig.split(",")}_defaultPreset=AV.launchData["cropPresetDefault"];_cropController=new AV.CropController(controls,controls.paintWidget)};api.shutdown=function(){if(_pager){_pager.shutdown();_pager=null}avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_force_crop_mode");_fixedSize=null;_controls=null;_cropController=null};api.onRedoComplete=function(){api.resetUI()};api.onUndoComplete=function(){api.resetUI()};api.panelWillOpen=function(){_fixedSize=null;_mouseDown=false;_controls.paintWidget.module["crop"].activate(_controls.paintWidget);if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_cropController.activate(mediator);_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton");mediator.on("layout:resize",_onResize);avpw$("#avpw_controls").addClass("avpw_crop_mode avpw_force_crop_mode");_cropPresetLabelApplied=undefined};var forcePreset;api.panelDidOpen=function(){api.resetUI();_presets=_controls.populateCropPresets(AV.launchData.forceCropPreset);forcePreset=_presets[0];if(!forcePreset){_controls.messager.show("avpw_aviary_crop_invalid_dimensions",true);return}var forceMessage=AV.launchData.forceCropMessage||AV.getLocalizedString("Please crop your photo to");avpw$("#avpw_force_crop_sub_text").html(forceMessage);avpw$("#avpw_force_crop_label").html(_presets[0].label);mediator.on("tool:crop:change",_updateCropToolTip);_setMainCrop()};var _updateCropToolTip=function(w,h){_cropController.setToolTipValues(w,h)};var _setMainCrop=function(){_setCropByPreset(forcePreset)};api.panelWillClose=function(){mediator.off("tool:crop:change",_updateCropToolTip);avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_force_crop_mode");if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}if(_cropController){_cropController.deactivate()}_controls.layoutNotify(AV.launchData["openType"],"showZoomButton");mediator.off("layout:resize",_onResize)};api.mouseDownEvent=function(coords){var continueInteraction=_cropController.updateUIDown(coords.canvasX,coords.canvasY);if(continueInteraction){_mouseDown=true}return false};api.mouseMoveEvent=function(coords){if(!_mouseDown){return}_cropController.updateUIMove(coords.canvasX,coords.canvasY);return false};api.mouseUpEvent=function(coords){if(!_mouseDown){return
}_controls.canvasUI.setMouseCursor();_cropController.apply(coords.canvasX,coords.canvasY);_mouseDown=false;return false};api.commit=function(){_crop();return _cropPresetLabelApplied};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};return api}();AV.ControlsWidget.prototype.tool["frames"]=function(){var _controls;var _currentItems;var _loadStarted;var _FRAME_THUMBNAIL_CLASS="avpw_isa_control_selector_frame";var _ACTIVE_EFFECT_CLASS="avpw_preset_icon_active";var _browser;var _pager=null;var _packsInOrder;var _lastButton;var api={};var _makeFrame=function(){if(_lastButton){frameName=_lastButton.data("framename");_controls.paintWidget.module["frames"].applyPreview(frameName,true)}};var _setActiveButton=function(buttonEl){buttonEl=buttonEl||avpw$("."+_FRAME_THUMBNAIL_CLASS).eq(0);avpw$("."+_FRAME_THUMBNAIL_CLASS).removeClass(_ACTIVE_EFFECT_CLASS);buttonEl.addClass(_ACTIVE_EFFECT_CLASS)};var _borderClicked=function(ev){ev.preventDefault();var button=ev.currentTarget;var frameName=avpw$(button).attr("data-framename");if(frameName==="original"||avpw$(button).hasClass("avpw_preset_icon_active")){api.cancel()}else{_lastButton=avpw$(button);_setActiveButton(_lastButton);_makeFrame()}};var _buildImageBorderThumb=function(i){if(!_currentItems){return}var label=_currentItems[i].display_name;var frameName=_currentItems[i].border_name;return AV.template[AV.launchData.layout].frameThumbnail({label:label,frameName:frameName})};var _buildPresets=function(){if(!_currentItems){return}if(_pager){_pager.shutdown()}var overlayCount=_currentItems.length;var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");var itemWidth=dims.BORDER_ICON_WIDTH;var itemsPerPage=_controls.layoutNotify(AV.launchData["openType"],"getBordersPerPage");var pageWidth=itemWidth*itemsPerPage;avpw$("#avpw_imageborders_images_scroll_region").css({width:overlayCount*itemWidth+"px",paddingRight:pageWidth+"px"}).show();_pager=new AV.Pager({leftArrow:avpw$("#avpw_imageborders_lftArrow"),rightArrow:avpw$("#avpw_imageborders_rghtArrow"),itemCount:overlayCount,itemsPerPage:itemsPerPage,pageWidth:pageWidth,itemBuilder:_buildImageBorderThumb,pageContainer:avpw$("#avpw_imageborders_images_scroll_region")});_pager.changePage();AV.util.nextFrame(function(){_buildBorderPreviews();api.resetUI()})};var _buildBorderPreviews=function(){if(!_currentItems){return}avpw$("."+_FRAME_THUMBNAIL_CLASS).each(function(){var frameName=avpw$(this).attr("data-framename");var canvas=avpw$(this).find("canvas")[0];if(frameName&&frameName!=="original"){_controls.paintWidget.module["frames"].makeThumb(canvas,frameName,.25)}})};var _shutDownUI=function(){if(_pager){_pager.shutdown();_pager=null}if(_browser&&_browser.length){_browser.hide()}};var _buildPackItemsHTML=function(){var i,len,filters=[];len=_packsInOrder.length;for(i=0;i<len;i++){filters=filters.concat(_controls.paintWidget.imageBorderManager.getClickableFiltersForPack(_packsInOrder[i].assetId))}filters=filters?filters.slice(0):[];filters.unshift({display_name:"None",border_name:"original"});_currentItems=filters;if(_loadStarted){return}_loadStarted=true;if(_currentItems.length>0){_buildPresets()}else{_browser.html(AV.getLocalizedString("No effects found for this pack"))}_loadStarted=false};api.init=function(controls){_controls=controls;_browser=avpw$("#avpw_imageborders_images_scroll_region");_browser.delegate("."+_FRAME_THUMBNAIL_CLASS,"mouseup",_borderClicked)};api.panelWillOpen=function(){_lastButton=null;mediator.on("layout:resize",_buildPresets)};api.panelDidOpen=function(){_controls.assetManager.getAssets("IMAGEBORDER",function(assets){_packsInOrder=assets;_browser.show();_buildPackItemsHTML();if(_pager){_pager.changePage(true)}})};api.resetUI=function(){_setActiveButton()};api.cancel=function(){api.resetUI();if(_controls.paintWidget.actions.isACheckpoint&&!_controls.paintWidget.actions.isACheckpoint()){_controls.paintWidget.actions.undoToCheckpoint()}};api.commit=function(){if(_lastButton&&_lastButton.length){return _lastButton.data("framename")}};api.onUndo=function(opts){if(!opts){api.resetUI()}};api.onRedo=function(opts){if(!opts){if(_lastButton&&_lastButton.length){_setActiveButton(_lastButton)}}mediator.off("layout:resize",_buildPresets)};api.shutdown=function(){_shutDownUI();if(_browser&&_browser.length){_browser.undelegate()}_controls=null;_browser=null};return api}();AV.ControlsWidget.prototype.tool["orientation"]=function(){var _EXTRA_CANVAS_MARGIN=10;var _ANIMATE_DURATION=200;var _MAX_STRAIGHTEN=45;var _supportsAnimation;var _transformProp;var _controls;var _currentZoomedWidth=null;var _currentZoomedHeight=null;var _straightenAngle=null;var _straightenAngleInDegrees=null;var _flatten;var _flippedH=false;var _flippedV=false;var _rotation=0;var _rewindFlippedH=false;var _rewindFlippedV=false;var _rewindRotation=0;var _straightenUI;var _straightenSlider;var _lastHandlePos;var api={};var _isFlippedAnd3D=function(){return _supportsAnimation&&(_flippedH||_flippedV)&&!(_flippedH&&_flippedV)};var _zoomOut=function(){var dims=_controls.layoutNotify(AV.launchData["openType"],"getMaxDims");var minViewportDim=dims.height<dims.width?dims.height:dims.width;minViewportDim-=_EXTRA_CANVAS_MARGIN;minViewportDim=minViewportDim<AV.launchData["maxSize"]?minViewportDim:AV.launchData["maxSize"];if(_controls.canvasUI){_controls.canvasUI.viewport.resize(minViewportDim,minViewportDim);if(_supportsAnimation){window.setTimeout(_controls.canvasUI.resetOffset,_ANIMATE_DURATION)}else{_controls.canvasUI.resetOffset()}}};var _zoomBackIn=function(){_controls.layoutNotify(AV.launchData["openType"],"scaleCanvas")};var _onResize=function(){_zoomOut();_initStraightenUI();if(_lastHandlePos){_straightenSlider.setValue(_lastHandlePos);_updateStraightenUI(null,{value:_lastHandlePos})}};var _setRotationStyle=function(x,y,z){if(_controls.canvasUI){_controls.canvasUI.viewport.rotate(x,y,z)}};var _resetRotationStyle=function(){_setRotationStyle(0,0,0)};var _drawStraightenGrid=function(numLines){avpw$("#avpw_straighten_grid").html(avpw$(AV.template[AV.launchData.layout].alignmentGrid({numLines:numLines})))};var _initStraightenUI=function(){if(_controls.canvasUI&&_transformProp){var ratio=_controls.canvasUI.viewport.getRatio();var cw=_controls.paintWidget.width/ratio;var ch=_controls.paintWidget.height/ratio;if(_controls.canvasUI.viewport.rotateBoundsBy90(_rotation)){var w=cw;cw=ch;ch=w}var centerX=cw/2|0;if(_straightenSlider){_straightenSlider.shutdown();_straightenSlider=undefined}_straightenSlider=new _controls.Slider({element:_straightenUI,min:-.5,max:.5,defaultValue:0,onstart:_onHandleDragStart,onchange:_onHandleDragStop,onslide:_updateStraightenUI});_straightenSlider.addListeners();avpw$("#avpw_straighten_handle").css({left:"50%"});_controls.paintWidget.setMode("straighten");_controls.paintWidget.module["straighten"].reset();_straightenAngle=null;_straightenAngleInDegrees=null;_currentZoomedWidth=cw;_currentZoomedHeight=ch;_drawStraightenGrid(8);_straightenUI.addClass("avpw_straighten_ui_ready")}};var _onHandleDragStart=function(ev,ui){if(_rotation%360||_flippedH||_flippedV){_commitVisualChanges()}if(_controls.canvasUI){_controls.canvasUI.addCanvasClass("avpw_ready_for_straighten")}avpw$("#avpw_straighten_grid").addClass("avpw_straighten_ui_grid_ready");_controls.paintWidget.setMode("straighten");_controls.paintWidget.module["straighten"].set(_straightenAngle)};var _onHandleDragStop=function(ev,ui){if(_controls.canvasUI){_controls.canvasUI.removeCanvasClass("avpw_ready_for_straighten")}avpw$("#avpw_straighten_grid").removeClass("avpw_straighten_ui_grid_ready");_controls.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[true,false])};var _updateStraightenUI=function(ev,ui){var sign,ratio,rotateX,rotateY;var handlePos=ui.value;_lastHandlePos=handlePos;if(_transformProp){sign=AV.math.sign(handlePos);_straightenAngleInDegrees=(1-Math.cos(handlePos*Math.PI))*_MAX_STRAIGHTEN*sign;_straightenAngle=_straightenAngleInDegrees*Math.PI/180;if(_supportsAnimation){rotateX=_flippedV?180:0;rotateY=_flippedH?180:0;_setRotationStyle(rotateX,rotateY,_straightenAngleInDegrees)}else{_setRotationStyle(_straightenAngleInDegrees)}ratio=_controls.paintWidget.module["straighten"].set(_straightenAngle);if(_controls.canvasUI&&_currentZoomedWidth&&_currentZoomedHeight){_controls.canvasUI.viewport.resizeFake(_currentZoomedWidth*ratio,_currentZoomedHeight*ratio)}}};var _applyAnimation=function(animFunc,commitFunc){if(_supportsAnimation&&!AV.featherUseFlash){if(animFunc){animFunc.call(this)}_straightenUI.removeClass("avpw_straighten_ui_animate");_straightenUI.removeClass("avpw_straighten_ui_ready");window.setTimeout(function(){_straightenUI.addClass("avpw_straighten_ui_animate");_onResize()},_ANIMATE_DURATION);var rotateX=_flippedV?180:0;var rotateY=_flippedH?180:0;_setRotationStyle(rotateX,rotateY,_rotation)}else if(_transformProp&&!AV.featherUseFlash){_straightenUI.removeClass("avpw_straighten_ui_ready");_resetRotationStyle();if(commitFunc){commitFunc.call(this)}_onResize()}else{if(commitFunc){commitFunc.call(this)}}};var _clearRewind=function(){_rewindFlippedV=_rewindFlippedH=false;_rewindRotation=0};var _clearState=function(){_flippedV=_flippedH=false;_rotation=0;_straightenAngle=null;_straightenAngleInDegrees=null;_clearRewind()};var _resetForExternalAction=function(){if(_controls.canvasUI&&_supportsAnimation&&!AV.featherUseFlash){_controls.canvasUI.removeCanvasClass("avpw_ready_for_orient");_straightenUI.removeClass("avpw_straighten_ui_animate");_straightenUI.removeClass("avpw_straighten_ui_ready");window.setTimeout(function(){_controls.canvasUI.addCanvasClass("avpw_ready_for_orient");_straightenUI.addClass("avpw_straighten_ui_animate");_onResize()},_ANIMATE_DURATION)}else{_straightenUI.removeClass("avpw_straighten_ui_ready");_onResize()}};var _commitVisualChanges=function(){if(_controls.canvasUI){_controls.canvasUI.removeCanvasClass("avpw_ready_for_orient")}var finalRotation=_rotation%360;if(finalRotation!==0&&_supportsAnimation){_controls.paintWidget.setMode("rotate90");_controls.paintWidget.module["rotate90"].rotate90(finalRotation,_flatten)}if(_flippedH||_flippedV){_controls.paintWidget.setMode("flip");_controls.paintWidget.module["flip"].flip(_flippedH,_flippedV,_flatten)}_clearRewind();_rewindFlippedH=_flippedH?!_rewindFlippedH:_rewindFlippedH;_rewindFlippedV=_flippedV?!_rewindFlippedV:_rewindFlippedV;_rewindRotation+=-(_rotation%360);_flippedV=_flippedH=false;_rotation=0;_resetRotationStyle();_zoomOut();if(_controls.canvasUI){_controls.canvasUI.addCanvasClass("avpw_ready_for_orient")}};var _rewindVisualAndCommittedChanges=function(callback){var rotateX=0,rotateY=0,rotateZ=0;if(_supportsAnimation&&!AV.featherUseFlash){if(_rewindRotation||_rewindFlippedV||_rewindFlippedH){rotateX=_rewindFlippedV?180:0;rotateY=_rewindFlippedH?180:0;rotateZ=_rewindRotation}_setRotationStyle(rotateX,rotateY,rotateZ);window.setTimeout(function(){_resetRotationStyle();if(callback){callback.call(this)}},_ANIMATE_DURATION)}else if(_transformProp&&!AV.featherUseFlash){_resetRotationStyle();if(callback){callback.call(this)}}else{if(callback){callback.call(this)}}};var _overrideBackButtonClick=function(ev){var $target=avpw$(ev.currentTarget);ev.stopPropagation();ev.preventDefault();_rewindVisualAndCommittedChanges(function(){$target.unbind("click").trigger("click")})};var addListeners=function(){avpw$("#avpw_flip_h").bind("click",function(){_lastHandlePos=null;if(AV.featherUseFlash){_controls.paintWidget.setMode("flip");_controls.paintWidget.module["flip"].flip(true,false)}else{_applyAnimation(function(){_flippedH=!_flippedH},function(){_controls.paintWidget.setMode("flip");_controls.paintWidget.module["flip"].flip(true,false,true)})}_controls.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[true,false])});avpw$("#avpw_flip_v").bind("click",function(){_lastHandlePos=null;if(AV.featherUseFlash){_controls.paintWidget.setMode("flip");_controls.paintWidget.module["flip"].flip(false,true)}else{_applyAnimation(function(){_flippedV=!_flippedV},function(){_controls.paintWidget.setMode("flip");_controls.paintWidget.module["flip"].flip(false,true,true)})}_controls.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[true,false])});avpw$("#avpw_rotate_left").bind("click",function(){_lastHandlePos=null;var change=!_isFlippedAnd3D()?-90:90;_applyAnimation(function(){_rotation+=change},function(){_controls.paintWidget.setMode("rotate90");_controls.paintWidget.module["rotate90"].rotate90(change,_flatten)});_controls.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[true,false])});avpw$("#avpw_rotate_right").bind("click",function(){_lastHandlePos=null;var change=!_isFlippedAnd3D()?90:-90;_applyAnimation(function(){_rotation+=change},function(){_controls.paintWidget.setMode("rotate90");_controls.paintWidget.module["rotate90"].rotate90(change,_flatten)});_controls.layoutNotify(AV.launchData["openType"],"updateUndoRedo",[true,false])});avpw$("#avpw_controlpanel_orientation").find(".avpw_inset_button").pressed("avpw_inset_button_down");avpw$("#avpw_all_effects").bind("click",_overrideBackButtonClick)};var removeListeners=function(){avpw$("#avpw_controlpanel_orientation").find(".avpw_inset_button").unbind();avpw$("#avpw_all_effects").unbind("click",_overrideBackButtonClick)};var commitAllToActionList=function(){if(_transformProp&&!AV.featherUseFlash){_commitVisualChanges();if(_straightenAngle&&_straightenAngle!==0){_controls.paintWidget.setMode("straighten");_controls.paintWidget.module["straighten"].commit(_straightenAngle,_straightenAngleInDegrees,_flatten)}}};api.init=function(controls){_controls=controls;_supportsAnimation=!AV.featherUseFlash&&AV.support.getVendorProperty("transformStyle");_transformProp=AV.support.getVendorProperty("transform");_straightenUI=avpw$(AV.template[AV.launchData.layout].straightenSlider());_flatten=true};api.panelWillOpen=function(){_clearState();addListeners();if(_controls.canvasUI){_controls.canvasUI.disablePan()}mediator.on("layout:resize",_onResize);var canvasControls=_controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement");canvasControls.append(_straightenUI);_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton");_controls.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement")};api.panelDidOpen=function(){if(_controls.canvasUI&&_supportsAnimation){_controls.canvasUI.addCanvasClass("avpw_ready_for_orient");_straightenUI.addClass("avpw_straighten_ui_animate")}_onResize()};api.panelWillClose=function(){removeListeners();if(_controls.canvasUI){_controls.canvasUI.enablePan()}if(_straightenSlider){_straightenSlider.shutdown();_straightenSlider=undefined}_zoomBackIn();mediator.off("layout:resize",_onResize);if(_controls.canvasUI&&_supportsAnimation){_controls.canvasUI.removeCanvasClass("avpw_ready_for_orient");_straightenUI.removeClass("avpw_straighten_ui_animate");_straightenUI.removeClass("avpw_straighten_ui_ready")}else if(_transformProp){_straightenUI.removeClass("avpw_straighten_ui_ready")}_straightenUI.detach();_controls.layoutNotify(AV.launchData["openType"],"showZoomButton");_controls.layoutNotify(AV.launchData["openType"],"hideCanvasControlsElement");_resetRotationStyle();_lastHandlePos=null};api.commit=function(){commitAllToActionList()};api.shutdown=function(){removeListeners();_controls=null;_straightenSlider=undefined;_straightenUI=null};api.onUndo=function(opts){var isDirty=!!(_rotation%360)||_flippedH||_flippedV||_straightenAngle&&_straightenAngle!==0;if(isDirty){commitAllToActionList();_clearState()}_resetForExternalAction()};api.onRedo=function(opts){_resetForExternalAction()};return api}();AV.ControlsWidget.prototype.tool["overlay"]=function(){var _STICKER_OVERLAY_WIDTH=139;var _STICKER_FULL_WIDTH=400;var _OVERLAY_BORDER_WIDTH=9;var _STICKER_THUMB_SCALE=.375;var _DRAG_THRESHOLD=5;var _controls;var _currentItems;var _loadStarted;var _stickerLoading;var _browser;var _packBrowser;var _pager=null;var _packPager=null;var _packsAndItems;var _packsInOrder;var _packsById;var _textOverlayModes={OFF_STATE:0,DRAG_STATE:1};var _overlayController;var _dragOrigin=null;var _dropOrigin=null;var _dragUrl;var _dragIndicator;var api={};var _getStickerIdentifierFromURL=function(url){var identifier=url;if(identifier.indexOf("/")!==-1){identifier=identifier.split("/").pop();if(identifier.indexOf(".")!==-1){identifier=identifier.split(".")[0]}}return identifier};var _loadPack=function(id,url,callback){AV.util.loadFile(url,"js",function(){_packsById[id]=AV["stickerPacks"];AV["stickerPacks"]=null;if(callback&&typeof callback==="function"){callback.call(this)}})};var _openDirectlyIntoStickers=function(){_packBrowser.hide();_browser.show();_buildPackItemsHTML();if(_pager){_pager.changePage(true)}};var _purchaseButtonClicked=function(pack){var throbber=avpw$(_packsAndItems.getPackOfInterest()).children(".avpw_icon_waiter");_controls.waitThrobber.spin(throbber[0]);_controls.assetManager.hideAssetPurchasePopup();_loadPack(pack.assetId,pack.resourceUrl,function(){_controls.waitThrobber.stop();mediator.trigger("tool:open","overlay")})};var _loadSticker=function(url,callback){var cleanElement;if(false){cleanElement=new Image;cleanElement.crossOrigin="Anonymous";cleanElement.src=url;_controls.paintWidget.overlayRegistry.addElement(url,cleanElement);if(callback){callback.call(this)}}else{cleanElement=_controls.paintWidget.overlayRegistry.getElement(url,function(el){_stickerLoading=false;if(callback){callback.call(this)}})}if(cleanElement){return true}else{_stickerLoading=true;return false}};var _addStickerOverlay=function(url,x,y,sx,sy){var left,top;var w,h,ratio,offsetW,style;var randId=Math.floor(Math.random()*4294967295).toString(16);var id="text_overlay-"+randId;var textOverlayObject;var textOverlayElement=avpw$(AV.template[AV.launchData.layout].selectionOverlay({id:id,body:AV.template[AV.launchData.layout].imageOverlayBody({src:url})}));ratio=1;if(_controls.canvasUI){ratio=_controls.canvasUI.viewport.getRatio()}offsetW=_STICKER_OVERLAY_WIDTH+2*_OVERLAY_BORDER_WIDTH;left=x/ratio-offsetW/2;top=y/ratio-offsetW/2;style={left:left+"px",top:top+"px",width:_STICKER_OVERLAY_WIDTH+"px",height:_STICKER_OVERLAY_WIDTH+"px"};textOverlayElement.css(style);textOverlayObject={id:id,url:url,initialCoordsX:0,initialCoordsY:0,element:textOverlayElement};_overlayController.newOverlay(textOverlayObject)};var _addStickerOverlayToCanvas=function(textOverlay){var id,url;var centerX,centerY,scale,rotation;var ratio;if(textOverlay.url){id=textOverlay.id;url=textOverlay.url;ratio=AV.controlsWidgetInstance.canvasUI?AV.controlsWidgetInstance.canvasUI.viewport.getRatio():1;rotation=textOverlay.rotation||0;centerX=textOverlay.centerX*ratio+.5|0;centerY=textOverlay.centerY*ratio+.5|0;scale=textOverlay.width*ratio/_STICKER_FULL_WIDTH;_controls.paintWidget.module["overlay"].addOverlay(id,url,centerX+.5|0,centerY+.5|0,scale,scale,rotation)}};var _addStickerFromURL=function(url,element,x,y){if(AV.featherUseFlash){_controls.paintWidget.module["overlay"].addOverlay("",url);return}else{var stickerIsCached=_loadSticker(url,function(){_addStickerOverlay(url,x,y,_STICKER_THUMB_SCALE,_STICKER_THUMB_SCALE);if(!stickerIsCached){_controls.onEggWaitThrobber.stop()}});if(!stickerIsCached&&element){var throbber=avpw$(element).children(".avpw_isa_overlay_waiter");_controls.onEggWaitThrobber.spin(throbber[0])}}mediator.trigger("usage:tool","overlay","stickerclicked",_getStickerIdentifierFromURL(url))};var _clearDraggedSticker=function(){_dragUrl=null;_dragOrigin=null;_stickerLoading=false;if(_dragIndicator&&_dragIndicator.length){_dragIndicator.detach().remove()}};var _updateDragIndicatorPosition=function(ev){if(_dragIndicator&&_dragIndicator.length){var touch=AV.util.getTouch(ev);if(touch){x=touch.pageX;y=touch.pageY}else{x=ev.originalEvent.pageX;y=ev.originalEvent.pageY}_dragIndicator.css({left:x+"px",top:y+"px"})}};var _stickerMouseDown=function(ev){var x,y,touch,$target;_clearDraggedSticker();$target=avpw$(ev.currentTarget);_dragUrl=$target.attr("fullimageurl");if(AV.featherUseFlash){return}touch=AV.util.getTouch(ev);if(touch){x=touch.pageX;y=touch.pageY}else{x=ev.originalEvent.pageX;y=ev.originalEvent.pageY}_dragOrigin={x:x,y:y};avpw$(window).bind("mousemove",_stickerDragStart).bind("touchmove",_stickerDragStart).bind("mouseup",_stickerMouseUp).bind("touchend",_stickerMouseUp);_dragIndicator=$target.clone()};var _stickerDragStart=function(ev){var x,y,x0=0,y0=0;if(_dragOrigin){x0=_dragOrigin.x;y0=_dragOrigin.y}var touch=AV.util.getTouch(ev);if(touch){x=touch.pageX;y=touch.pageY;avpw$(AV.paintWidgetInstance.canvas).trigger("touchstart")}else{x=ev.originalEvent.pageX;y=ev.originalEvent.pageY}if(x0-x>_DRAG_THRESHOLD||x-x0>_DRAG_THRESHOLD||y0-y>_DRAG_THRESHOLD||y-y0>_DRAG_THRESHOLD){avpw$(window).unbind("mousemove",_stickerDragStart).unbind("touchmove",_stickerDragStart).bind("mousemove",_updateDragIndicatorPosition).bind("touchmove",_updateDragIndicatorPosition);_updateDragIndicatorPosition(ev);_dragIndicator.addClass("avpw_overlay_icon_dropped");avpw$("body").append(_dragIndicator);_loadSticker(_dragUrl)}};var _stickerMouseUp=function(ev){avpw$(window).unbind("mousemove",_stickerDragStart).unbind("touchmove",_stickerDragStart).unbind("mousemove",_updateDragIndicatorPosition).unbind("touchmove",_updateDragIndicatorPosition).unbind("mouseup",_stickerMouseUp).unbind("touchend",_stickerMouseUp);var dropCoords=_controls.canvasUI.getCoordinatesFromEventWithinCanvasBounds(ev);if(dropCoords){if(_stickerLoading){var pollingTimer=window.setInterval(function(){if(!_stickerLoading){if(dropCoords){_addStickerFromURL(_dragUrl,ev.currentTarget,dropCoords.canvasX,dropCoords.canvasY)}window.clearInterval(pollingTimer);pollingTimer=null;_clearDraggedSticker()}},100)}else{_addStickerFromURL(_dragUrl,ev.currentTarget,dropCoords.canvasX,dropCoords.canvasY);_clearDraggedSticker()}}else{if(_dragIndicator&&_dragIndicator.length){_dragIndicator.addClass("avpw_overlay_icon_return_ready");AV.util.nextFrame(function(){_dragIndicator.addClass("avpw_overlay_icon_returned");if(_dragOrigin){_dragIndicator.css({top:_dragOrigin.y+"px",left:_dragOrigin.x+"px"})}window.setTimeout(function(){_clearDraggedSticker()},400)})}}};var _stickerClicked=function(ev){var element=ev.currentTarget;var url=avpw$(element).attr("fullimageurl");var coords,x,y;if(url&&url===_dragUrl){if(_controls.canvasUI){coords=_controls.canvasUI.getViewportCenter();if(coords){x=coords.canvasX;y=coords.canvasY}}if(_stickerLoading){var pollingTimer=window.setInterval(function(){if(!_stickerLoading){_addStickerFromURL(url,element,x,y);window.clearInterval(pollingTimer);pollingTimer=null}},100)}else{_addStickerFromURL(url,element,x,y)}}_dragOrigin=null;_dragUrl=null;avpw$(window).unbind("mousemove",_stickerDragStart).unbind("touchmove",_stickerDragStart).unbind("mousemove",_updateDragIndicatorPosition).unbind("touchmove",_updateDragIndicatorPosition)};var _buildStickerThumb=function(i){if(!_currentItems){return}var url=_currentItems[i][0];var thumburl=_currentItems[i][1];var hiresurl=_currentItems[i][2];_controls.paintWidget.overlayRegistry.add(url,hiresurl);return AV.template[AV.launchData.layout].stickerThumbnail({url:url,thumburl:thumburl})};var _buildStickerRoll=function(i){var asset=_packsInOrder[i];var id=asset.assetId;var label=asset.displayName;var purchased=asset.purchased||!asset.needsPurchase;var template=AV.template[AV.launchData.layout][purchased?"stickerRoll":"stickerRollDisabled"];return template({label:AV.getLocalizedString(label),id:id,thumburl:AV.build["feather_baseURL"]+"images/stickerpacks/"+id+".png",tagurl:AV.build["feather_baseURL"]+"images/stickerpacks/purchaseable.png"})};var _buildPresets=function(){if(!_currentItems){return}if(_pager){_pager.shutdown()}var overlayCount=_currentItems.length;var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");var itemWidth=dims.STICKER_ICON_WIDTH;var itemsPerPage=_controls.layoutNotify(AV.launchData["openType"],"getStickersPerPage");var pageWidth=itemWidth*itemsPerPage;avpw$("#avpw_overlay_images_scroll_region").css({width:overlayCount*itemWidth+"px",paddingRight:pageWidth+"px"});_pager=new AV.Pager({leftArrow:avpw$("#avpw_overlay_lftArrow"),rightArrow:avpw$("#avpw_overlay_rghtArrow"),itemCount:overlayCount,itemsPerPage:itemsPerPage,pageWidth:pageWidth,itemBuilder:_buildStickerThumb,pageContainer:avpw$("#avpw_overlay_images_scroll_region")});_pager.changePage()};var _shutDownUI=function(){if(_pager){_pager.shutdown();_pager=null}if(_packPager){_packPager.shutdown();_packPager=null}if(_packsAndItems){_packsAndItems.updateCancelButton()}if(_browser&&_browser.length){_browser.hide()}if(_packBrowser&&_packBrowser.length){_packBrowser.show()}_dropOrigin=null;_dragUrl=null;_dragIndicator=null};var _buildPacksHTML=function(){if(_loadStarted){return}_loadStarted=true;if(_packsInOrder.length>0){if(_packPager){_packPager.shutdown()}var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");var itemWidth=dims.STICKER_ROLL_WIDTH;var itemsPerPage=_controls.layoutNotify(AV.launchData["openType"],"getStickerPacksPerPage");var pageWidth=itemWidth*itemsPerPage;_packBrowser.css({width:_packsInOrder.length*itemWidth+"px",paddingRight:pageWidth+"px"});_packPager=new AV.Pager({leftArrow:avpw$("#avpw_overlay_lftArrow"),rightArrow:avpw$("#avpw_overlay_rghtArrow"),itemCount:_packsInOrder.length,itemsPerPage:itemsPerPage,pageWidth:pageWidth,itemBuilder:_buildStickerRoll,pageContainer:_packBrowser});_packPager.changePage()}_loadStarted=false};var _buildPackItemsHTML=function(){var stickers=_packsById[_packsAndItems.getCurrentPack()];_currentItems=stickers;if(_loadStarted){return}_loadStarted=true;if(_currentItems.length>0){_buildPresets()}else{_browser.html(AV.getLocalizedString("No stickers defined in Feather_Stickers"))}_loadStarted=false};api.init=function(controls){_controls=controls;_packsById={};_packBrowser=avpw$("#avpw_overlay_pack_scroll_region");_browser=avpw$("#avpw_overlay_images_scroll_region");_packsAndItems=new AV.PacksAndItems({currentPack:"original_stickers",browser:_browser,packBrowser:_packBrowser,pager:_pager,packPager:_packPager,buildPacksHTML:_buildPacksHTML,buildPackItemsHTML:_buildPackItemsHTML});_packsAndItems.onPurchaseButtonClicked=_purchaseButtonClicked;if(AV.OverlayController){_overlayController=new AV.OverlayController(controls,controls.paintWidget,{modes:_textOverlayModes,handlePosition:AV.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT,aspectRatio:1})}};api.panelWillOpen=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_shutDownUI();_packsAndItems.setCurrentPack();_controls.assetManager.getAssets("STICKER",function(assets){_packsInOrder=assets;var onStickersDataLoaded;var stickersDataLoaded=false;if(_packsInOrder.length===1){if(_packsById[_packsInOrder[0].assetId]){_openDirectlyIntoStickers()}else{onStickersDataLoaded=function(){if(!stickersDataLoaded){_openDirectlyIntoStickers();stickersDataLoaded=true}}}}else{_buildPacksHTML();if(_packPager){_packPager.changePage(true)}}for(var i=0;i<_packsInOrder.length;i++){var id=_packsInOrder[i].assetId;var url=_packsInOrder[i].resourceUrl;if(!_packsById[id]&&url){_loadPack(id,url,onStickersDataLoaded)}}});_packBrowser.delegate(".avpw_isa_control_selector_stickerpack","click",_packsAndItems.onPackClicked).delegate(".avpw_isa_control_selector_stickerinfo","click",_packsAndItems.onPackInfoClicked);_browser.delegate(".avpw_isa_control_selector_overlay","mousedown touchstart",_stickerMouseDown).delegate(".avpw_isa_control_selector_overlay","mouseup",_stickerClicked);if(_overlayController){_overlayController.activate()}mediator.on("layout:resize",_buildPresets)};api.panelWillClose=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}_packsAndItems.updateCancelButton();_clearDraggedSticker();if(_packBrowser&&_packBrowser.length){_packBrowser.undelegate()}if(_browser&&_browser.length){_browser.undelegate()}if(_overlayController){_overlayController.deactivate()}mediator.off("layout:resize",_buildPresets)};api.shutdown=function(){_shutDownUI();_clearDraggedSticker();_controls=null;_packBrowser=null;_browser=null;_packsById=null;_packsAndItems=null};api.mouseDownEvent=function(coords,ev){return _overlayController.updateUIDown(coords,ev,null,null,function(overlay){if(overlay&&overlay.url){mediator.trigger("usage:tool","overlay","stickerdeleted",_getStickerIdentifierFromURL(overlay.url))}})};api.mouseMoveEvent=function(coords){_overlayController.updateUIMove(coords);return false};api.mouseUpEvent=function(coords,ev){_overlayController.apply(coords,ev)};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};api.commit=function(){var overlaysToApply=[];if(_overlayController){_overlayController.commit(function(overlay){_addStickerOverlayToCanvas(overlay);if(overlay&&overlay.url){overlaysToApply.push(_getStickerIdentifierFromURL(overlay.url))}})}return overlaysToApply.join(",")};return api}();AV.ControlsWidget.prototype.tool["resize"]=function(){var _controls;var $avpw_resize_width,$avpw_resize_height,$avpw_constrain_prop;var _currentProp;var _constrainProportions;var _lastValidWidth;var _lastValidHeight;var _maxSize;var _hiresMode=false;var _distortWarned=false;var _ACTIVE_CHECKMARK_CLASS="avpw_inset_button_active";var api={};var _updateConstrainProportions=function(override){if(override===true||override===false){_constrainProportions=override}else{if(_constrainProportions&&!_distortWarned){_controls.messager.show("avpw_resize_unlocked",true);return false}_constrainProportions=!_constrainProportions}if(_constrainProportions){$avpw_constrain_prop.addClass(_ACTIVE_CHECKMARK_CLASS);_dimensionChanged()}else{$avpw_constrain_prop.removeClass(_ACTIVE_CHECKMARK_CLASS)}};var _redrawUIStuff=function(){var w,h,wh;if(AV.featherUseFlash||_hiresMode){wh=_controls.paintWidget.getScaledSize();w=wh.width;h=wh.height}else{w=_controls.paintWidget.width;h=_controls.paintWidget.height}$avpw_resize_width.val(w);$avpw_resize_height.val(h);_lastValidWidth=w;_lastValidHeight=h};var _resizeIsWaiting=function(){var w=$avpw_resize_width.val();var h=$avpw_resize_height.val();var w0=_controls.paintWidget.width;var h0=_controls.paintWidget.height;return w!==w0||h!==h0};var _saveLastValidDimensions=function(){var w=parseInt($avpw_resize_width.val());var h=parseInt($avpw_resize_height.val());if(!isNaN(w)&&w>0&&w<=_maxSize&&!isNaN(h)&&h>0&&h<=_maxSize){_lastValidWidth=w;_lastValidHeight=h}};var _validateDimensions=function(){var w=parseInt($avpw_resize_width.val());var h=parseInt($avpw_resize_height.val());if(w===_lastValidWidth&&h===_lastValidHeight){_resizeImage(w,h);return true}else{_controls.messager.show("avpw_resize_invalid",true);return false}};var _resizeImage=function(w,h){if(!isNaN(w)&&!isNaN(h)){_controls.paintWidget.module["resize"].resize(w,h,true)}};var _dimensionChanged=function(){var scale;var width;var height;AV.util.nextFrame(function(){if(_constrainProportions){if(_currentProp==="width"){width=parseInt($avpw_resize_width.val());if(!width||isNaN(width)){width=_controls.paintWidget.width}scale=width/_controls.paintWidget.width;height=_controls.paintWidget.height*scale|0;if(height<1){height=1}$avpw_resize_height.val(height)}else{height=parseInt($avpw_resize_height.val());if(!height||isNaN(height)){height=_controls.paintWidget.height}scale=height/_controls.paintWidget.height;width=_controls.paintWidget.width*scale|0;if(width<1){width=1}$avpw_resize_width.val(width)}}_saveLastValidDimensions()})};var _selectText=function(ev){avpw$(this).addClass("avpw_text_input_focused").select()};var _deselectText=function(ev){avpw$(this).removeClass("avpw_text_input_focused")};var _keyDownOLD=function(ev){if(ev.keyCode==9||ev.keyCode==27||ev.keyCode==65&&(ev.ctrlKey===true||ev.metaKey===true)||ev.keyCode>=35&&ev.keyCode<=39){return
}else{if((ev.keyCode<48||ev.keyCode>57)&&(ev.keyCode<96||ev.keyCode>105)&&ev.keyCode!==46&&ev.keyCode!==8){ev.preventDefault()}else{_currentProp=ev.data.currentProp;_dimensionChanged()}}};var _keyDown=function(ev){return AV.util.keyDownHandlerNumber.apply(this,[ev,function(ev){_currentProp=ev.data.currentProp;_dimensionChanged()}])};api.init=function(controls){_controls=controls;_hiresMode=_controls.imageSizeTracker.isUsingHiResDimensions(AV.launchData);_maxSize=AV.launchData["hiresMaxSize"]||AV.launchData["maxSize"];$avpw_resize_width=$avpw_resize_width||avpw$("#avpw_resize_width");$avpw_resize_width.bind("keydown",{currentProp:"width"},_keyDown).bind("focus",_selectText).bind("blur",_deselectText);$avpw_resize_height=$avpw_resize_height||avpw$("#avpw_resize_height");$avpw_resize_height.bind("keydown",{currentProp:"height"},_keyDown).bind("focus",_selectText).bind("blur",_deselectText);$avpw_constrain_prop=$avpw_constrain_prop||avpw$("#avpw_constrain_prop");$avpw_constrain_prop.click(_updateConstrainProportions);avpw$("#avpw_constrain_prop_label").click(function(){$avpw_constrain_prop.trigger("click")});avpw$("#avpw_resize_invalid_confirm").click(function(){_controls.messager.hide("avpw_resize_invalid");$avpw_resize_width.val(_lastValidWidth);$avpw_resize_height.val(_lastValidHeight);return false});avpw$("#avpw_resize_unlocked_confirm").click(function(){_distortWarned=true;_controls.messager.hide("avpw_resize_unlocked");_updateConstrainProportions();return false});avpw$("#avpw_resize_unlocked_cancel").click(function(){_distortWarned=true;_controls.messager.hide("avpw_resize_unlocked");return false});avpw$("#avpw_resize_invalid_max_size").html(_maxSize)};api.panelWillOpen=function(){_redrawUIStuff();_updateConstrainProportions(true);_distortWarned=false;_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton")};api.panelDidOpen=function(){$avpw_resize_width.trigger("focus");_controls.layoutNotify(AV.launchData["openType"],"scaleCanvas")};api.panelWillClose=function(){_controls.layoutNotify(AV.launchData["openType"],"showZoomButton")};api.onRedoComplete=function(){_redrawUIStuff()};api.onUndoComplete=function(){_redrawUIStuff()};api.commit=function(){var proceed=true;if(_resizeIsWaiting()){proceed=_validateDimensions()}if(proceed){proceed=_lastValidWidth+","+_lastValidHeight}return proceed};api.shutdown=function(){if($avpw_resize_width){$avpw_resize_width.unbind()}if($avpw_resize_height){$avpw_resize_height.unbind()}if($avpw_constrain_prop){$avpw_constrain_prop.unbind()}avpw$("avpw_constrain_prop_label").unbind("click");avpw$("#avpw_resize_invalid_confirm").unbind("click");avpw$("#avpw_resize_unlocked_confirm").unbind("click");avpw$("#avpw_resize_unlocked_cancel").unbind("click");_controls=null};return api}();AV.ControlsWidget.prototype.tool["saturation"]=function(){var _controls;var _presets=AV.toolDefaults.saturation.presets;var _slider;var _defaultValue;var _lastValue;var _shouldReset=false;var api={};var sliderChanged=function(ev,ui){_lastValue=ui.value;_controls.paintWidget.module["saturation"].applyPreview(_lastValue/100,true)};api.init=function(controls){_defaultValue=100;var sliderConfig={element:document.getElementById("avpw_saturation_slider"),min:_presets[0]*100,max:_presets[3]*100,defaultValue:_defaultValue,onchange:sliderChanged};if(!AV.featherUseFlash){AV.util.extend(sliderConfig,{onslide:sliderChanged,delay:400})}_controls=controls;_slider=new _controls.Slider(sliderConfig)};api.cancel=function(){_shouldReset=false};api.panelWillOpen=function(){_lastValue=_defaultValue};api.panelDidOpen=function(){_slider.addListeners()};api.panelWillClose=function(){_slider.removeListeners()};api.panelDidClose=function(){if(_shouldReset){api.resetUI();_shouldReset=false}};api.onUndo=function(opts){if(!opts){api.resetUI()}_controls.paintWidget.module["saturation"].resetBacking()};api.onRedo=function(opts){if(!opts&&_slider){_slider.setValue(_lastValue)}};api.resetUI=function(){_slider.reset()};api.shutdown=function(){if(_slider){_slider.shutdown();_slider=undefined}_controls=null};return api}();AV.ControlsWidget.prototype.tool["sharpness"]=function(){var _controls;var _presets=AV.toolDefaults.sharpness.presets;var _slider;var _defaultValue;var _lastValue;var _shouldReset=false;var _moduleToApply="blur";var api={};var sliderChanged=function(ev,ui){_lastValue=ui.value;if(AV.featherUseFlash){_controls.paintWidget.module["blur"].reset()}_controls.paintWidget.module["sharpen"].reset();if(!AV.featherUseFlash||_lastValue>0){_moduleToApply="sharpen";_controls.paintWidget.setMode("sharpen");_controls.paintWidget.module["sharpen"].applyPreview(_lastValue,true)}else if(_lastValue<0){var sharpnessValue=_lastValue;sharpnessValue=-sharpnessValue*.15|0;_moduleToApply="blur";_controls.paintWidget.setMode("blur");_controls.paintWidget.module["blur"].applyPreview(sharpnessValue,true)}};api.init=function(controls){_defaultValue=0;_controls=controls;_slider=new _controls.Slider({element:document.getElementById("avpw_sharpness_slider"),min:_presets[0],max:_presets[3],defaultValue:_defaultValue,onchange:sliderChanged})};api.cancel=function(){_shouldReset=false};api.panelWillOpen=function(){_lastValue=_defaultValue};api.panelDidOpen=function(){_slider.addListeners()};api.panelWillClose=function(){_slider.removeListeners()};api.panelDidClose=function(){if(_shouldReset){api.resetUI();_shouldReset=false}};api.onUndo=function(opts){if(!opts){api.resetUI()}_controls.paintWidget.module["sharpen"].resetBacking()};api.onRedo=function(opts){if(!opts&&_slider){_slider.setValue(_lastValue)}};api.resetUI=function(){_slider.reset()};api.shutdown=function(){if(_slider){_slider.shutdown();_slider=undefined}_lastValue=_defaultValue=undefined;_controls=null};return api}();AV.ControlsWidget.SpotTool=function(toolNamespace){var _controls;var _presets=AV.toolDefaults[toolNamespace].presets;var _mouseDown;var api={};var _updateBrushPreview=function(){var zoomScale=1;if(_controls.canvasUI){zoomScale=_controls.canvasUI.viewport.getRatio()}var radius=_controls.paintWidget.module[toolNamespace].radius();radius/=zoomScale;radius=radius+.5|0;if(_controls.brushPreview){_controls.brushPreview.show(radius)}};var _setActive=function($el){$el.siblings().removeClass("avpw_preset_icon_active");$el.addClass("avpw_preset_icon_active")};var _setBrush=function(ev){ev.preventDefault();var $el=avpw$(this);var zoomScale=1;if(_controls.canvasUI){zoomScale=_controls.canvasUI.viewport.getRatio()}var size=$el.data("size")*zoomScale/2|0;_controls.paintWidget.module[toolNamespace].setRadius(size);_setActive($el);_updateBrushPreview()};var _bindEvents=function(){avpw$("#avpw_controlpanel_"+toolNamespace).on("mousedown touchstart",".avpw_isa_preset_brush",_setBrush);if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};var _unbindEvents=function(){avpw$("#avpw_controlpanel_"+toolNamespace).off(".avpw_isa_preset_brush","mousedown touchstart");if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}};var _buildPresets=function(){avpw$("#avpw_controlpanel_"+toolNamespace+" .avpw_tool_cutout_centered_spot_tool").html(AV.template[AV.launchData.layout].brushSizesSet({sizes:[8,13,18,21,25]}))};api.init=function(controls){_controls=controls};api.commit=function(){_controls.paintWidget.module[toolNamespace].commit()};api.panelWillOpen=function(){if(!AV.featherUseFlash){_controls.paintWidget.setMode("flatten");_controls.paintWidget.module["flatten"].flatten()}_buildPresets();mediator.trigger("canvas:showBrushCursor");_bindEvents();if(_controls.canvasUI){_controls.canvasUI.setMouseCursor("none")}};api.panelDidOpen=function(){avpw$("#avpw_controlpanel_"+toolNamespace).find(".avpw_isa_preset_brush").eq(2).trigger("mousedown");_hideMouseCursor()};api.panelWillClose=function(){_unbindEvents();_controls.paintWidget.uiLayerShow(false);_showMouseCursor();mediator.trigger("canvas:hideBrushCursor")};var _hideMouseCursor=function(){avpw$(".avpw_canvas_background").css("cursor","none");avpw$("#avpw_zoom_container").css("cursor","default")};var _showMouseCursor=function(){avpw$(".avpw_canvas_background").css("cursor","default");avpw$("#avpw_zoom_container").css("cursor","default")};api.shutdown=function(){_controls=null};api.mouseDownEvent=function(coords,ev,withinCanvas){if(_mouseDown||!withinCanvas){return}_mouseDown=true;var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var scaledRadius=_controls.paintWidget.module[toolNamespace].radius()*zoomScale;var x=coords.canvasX;var y=coords.canvasY;_controls.paintWidget.module[toolNamespace].updateUIDown(x,y,scaledRadius);return false};api.mouseMoveEvent=function(coords){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var scaledRadius=_controls.paintWidget.module[toolNamespace].radius()*zoomScale;var x=coords.canvasX;var y=coords.canvasY;_controls.paintWidget.module[toolNamespace].updateUIMove(coords.canvasX,coords.canvasY,_mouseDown,scaledRadius);return false};api.mouseUpEvent=function(coords){if(!_mouseDown){return}_mouseDown=false;var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var scaledRadius=_controls.paintWidget.module[toolNamespace].radius()*zoomScale;_controls.paintWidget.module[toolNamespace].updateUIUp();_controls.paintWidget.module[toolNamespace].commitStroke(scaledRadius)};api.mouseOutEvent=function(){_controls.paintWidget.uiLayerShow(false)};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api);_controls.canvasUI.setMouseCursor()}_showMouseCursor();_controls.paintWidget.uiLayerShow(false);return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api);_controls.canvasUI.setMouseCursor("none")}_hideMouseCursor()};api.onUndoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module[toolNamespace].resetImageData();return false}};api.onRedoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module[toolNamespace].resetImageData();return false}};return api};AV.ControlsWidget.prototype.tool["blemish"]=new AV.ControlsWidget.SpotTool("blemish");AV.ControlsWidget.prototype.tool["whiten"]=new AV.ControlsWidget.SpotTool("whiten");AV.ControlsWidget.prototype.tool["redeye"]=new AV.ControlsWidget.SpotTool("redeye");AV.ControlsWidget.prototype.tool["text"]=function(){var _controls;var _textColor;var _presetsColor=AV.toolDefaults.text.presetsColor;var _textShadowColor;var _helpTextShown;var _didJustAddText=false;var _mouseDown=false;var api={};var _buildColorPreset=function(i){var color=_presetsColor[i];return AV.template[AV.launchData.layout].brushColorIcon({color:color})};var _deselectColor=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active")};var _setActive=function($el){_deselectColor();$el.addClass("avpw_preset_icon_active")};var _setColor=function(color){var shadowColor,outlineColor;if(color&&AV.util.color_is_light(color)){shadowColor="#000"}else{shadowColor="#fff"}if(AV.util.color_is_light(color)){outlineColor="#969696"}else{outlineColor="#fff"}_textColor=color;_textShadowColor=shadowColor};var _colorClicked=function(ev){ev.preventDefault();var $el=avpw$(this);_setColor($el.data("color"));_setActive($el);_didJustAddText=false};var _colorPickerClicked=function(ev){ev.preventDefault();ev.stopPropagation();var element=ev.currentTarget;AV.buildColorPicker(_textColor,element,function(color){_setColor(color);if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_setActive(avpw$(element))},function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}});if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}};var textAdd=function(ev,ui){if(!_didJustAddText){var coords,x,y;var size=avpw$("#avpw_text_font_size").val();var color=_textColor;var shadowColor=_textShadowColor;var font=avpw$("#avpw_text_font").val();var text=avpw$("#avpw_text_area").val();var scale;var baseSize=60;if(_controls.canvasUI){coords=_controls.canvasUI.getViewportCenter();if(coords){x=coords.canvasX;y=coords.canvasY}}if(size==""){size=avpw$("#avpw_text_font_size").attr("value")}if(size==""){size="60"}if(font==""){font=avpw$("#avpw_text_font").attr("value")}if(font==""){font="sans-serif"}if(font=="sans-serif"){font='"Arial", sans-serif'}scale=parseFloat(size)/baseSize;_controls.paintWidget.module["text"].newText(text,font,baseSize,color,shadowColor,x,y,scale,scale,0);_didJustAddText=true;avpw$("#avpw_text_area").trigger("blur")}return false};var _removeHelpText=function(el){el[0].value="";_helpTextShown=false;el.addClass("avpw_text_input_focused")};var _addHelpText=function(el){el[0].value=AV.getLocalizedString("Enter text here");_helpTextShown=true;el.removeClass("avpw_text_input_focused")};var textAreaFocus=function(ev){if(_helpTextShown){_removeHelpText(avpw$(this))}_didJustAddText=false};var captureEnterKey=function(ev){if(ev.which==13){avpw$("#avpw_add_text").trigger("click");return false}};var _bindEvents=function(){avpw$("#avpw_controlpanel_text").delegate(".avpw_isa_preset_color","click",_colorClicked).delegate(".avpw_isa_color_picker","click",_colorPickerClicked);avpw$("#avpw_text_area").bind("focus",textAreaFocus).bind("keydown",captureEnterKey);avpw$("#avpw_add_text").click(textAdd)};var _unbindEvents=function(){avpw$("#avpw_controlpanel_text").undelegate(".avpw_isa_preset_color","click").undelegate(".avpw_isa_color_picker","click");avpw$("#avpw_text_area").unbind();avpw$("#avpw_add_text").unbind("click")};var _buildPresets=function(){var i,opts;var colorCount=_presetsColor.length;var html="";for(i=0;i<colorCount;i++){opts={color:_presetsColor[i]};html+=AV.template[AV.launchData.layout].brushColorIcon(opts)}avpw$("#avpw_text_colors").html(html);var dims=_controls.layoutNotify(AV.launchData["openType"],"getDims");avpw$("#avpw_text_area").css("width",dims.INNER_BROWSER_WIDTH-dims.TEXT_ADD_TEXT_BUTTON_WIDTH-80+"px")};api.init=function(controls){_controls=controls;_buildPresets()};api.panelWillOpen=function(){_mouseDown=false;_didJustAddText=false;_addHelpText(avpw$("#avpw_text_area"));_bindEvents();if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}if(avpw$.miniColors){AV.miniColors=new avpw$.miniColors}mediator.on("layout:resize",_buildPresets)};api.panelDidOpen=function(){_addListeners()};api.panelWillClose=function(){_removeListeners();_controls.paintWidget.module["effects"].deactivate()};api.panelDidOpen=function(){avpw$("#avpw_text_colors").find(".avpw_isa_preset_color").eq(0).trigger("click")};api.panelWillClose=function(){_unbindEvents();if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}avpw$("#avpw_text_area").trigger("blur");AV.miniColors=null;mediator.off("layout:resize",_buildPresets)};api.shutdown=function(){_controls=null};api.mouseDownEvent=function(coords){if(_mouseDown){return}var proceedMode=_controls.paintWidget.module["text"].updateUIDown(coords.canvasX,coords.canvasY);if(proceedMode!==false){_mouseDown=true;if(proceedMode==="rotate"){_controls.canvasUI.setMouseCursor("pointer")}else if(proceedMode==="translate"){_controls.canvasUI.setMouseCursor("move")}}return false};api.mouseMoveEvent=function(coords){if(!_mouseDown){return}_controls.paintWidget.module["text"].updateUIMove(coords.canvasX,coords.canvasY);return false};api.mouseUpEvent=function(coords){if(!_mouseDown){return}_didJustAddText=false;_controls.canvasUI.setMouseCursor();_controls.paintWidget.module["text"].apply(coords.canvasX,coords.canvasY);_mouseDown=false};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};return api}();AV.ControlsWidget.prototype.tool["textwithfont"]=function(){var _DEFAULT_TEXT=AV.getLocalizedString("Enter text here");var _DEFAULT_FONT={label:"Arial Black",value:"'Arial Black','Arial-BoldMT','ArialMT','Arial','sans-serif'"};var _DEFAULT_FONT_SIZE=24;var _TEXT_HELP_CLASS="avpw_textwithfont_overlay_helptext";var _DISABLE_USER_SELECT_CLASS="avpw_selection_overlay_disable_user_select";var _ACTIVE_CHECKMARK_CLASS="avpw_inset_button_active";var _MINIMUM_TEXT_OVERLAY_WIDTH=60;var _TEXT_OVERLAY_BORDER_WIDTH=10;var _TEXT_OUTLINE_FRACTION=1/12;var _controls;var _presetsColor=AV.toolDefaults.textwithfont.presetsColor;var _presetsFont=AV.toolDefaults.textwithfont.presetsFont;var _fontDictionary=null;var _textOverlayModes={OFF_STATE:0,DRAG_STATE:1,EDIT_STATE:2};var _overlayController;var _OVERLAY_TOP_MARGIN=18;var _newOverlayTopOffset;var _MAX_OVERLAY_TOP_MARGIN=4*(_OVERLAY_TOP_MARGIN+2*_DEFAULT_FONT_SIZE);var _fontDropdown;var _textOverlayProxy;var _mouseDown=false;var _sizeMouseDown=false;var _initialRotation;var _textSizeAtScale1;var _textFont=_DEFAULT_FONT;var _textSize=_DEFAULT_FONT_SIZE;var _textColor=_presetsColor[0];var _textOpacity=1;var _useOutline=false;var _colorPicker;var api={};var _updateUIWithFont=function(font){font=font||_DEFAULT_FONT;_textFont=font;_applyFontToFontSelector(font);mediator.trigger("usage:interact","textwithfont","fontchanged",font.label);var currentOverlay=_overlayController.currentOverlay();if(currentOverlay){_applyFontToText(currentOverlay,font);_applyFontToProxy(font);_applyStyleFromOverlayProxyToOverlay(currentOverlay);_overlayController.saveDimensions();_drawPreviewText()}};var _drawPreviewText=function(overlayObject){overlayObject=overlayObject||_overlayController.currentOverlay();var $canvas,canvas,ratio,dims,size,padding,fontStyle;if(overlayObject){$canvas=overlayObject.element.find(".avpw_textwithfont_writer");dims=_getOverlayProxyDimensions();size=overlayObject.textSize;padding=size/2+.5|0;canvas=$canvas[0];$canvas.css({"margin-top":"-"+padding+"px"});canvas.height=dims.height+size;canvas.width=dims.width;if(canvas&&overlayObject.text){fontStyle=overlayObject.textFont.style;var fontInfo=(fontStyle?fontStyle+" ":"")+overlayObject.textSize+"px "+overlayObject.textFont.value;var cc=canvas.getContext("2d");ratio=AV.controlsWidgetInstance.canvasUI?AV.controlsWidgetInstance.canvasUI.viewport.getRatio():1;cc.font=fontInfo;cc.textAlign="center";cc.textBaseline="bottom";cc.fillStyle=overlayObject.textColor;cc.globalAlpha=1;var xpos=canvas.width/2+.5|0;var ypos=size;var lines=overlayObject.text.split("\n");var i;var textHeight=lines.length*size;var topOffset=(canvas.height-textHeight)/2+.5|0;ypos+=topOffset;for(i=0;i<lines.length;i++){if(overlayObject.textOutline){outlineColor=AV.util.color_is_light(overlayObject.textColor)?"#000000":"#ffffff";cc.strokeStyle=outlineColor;cc.lineWidth=size*_TEXT_OUTLINE_FRACTION;cc.strokeText(lines[i],xpos,ypos)}cc.fillText(lines[i],xpos,ypos);ypos+=size}}}};var _addFontToPage=function(fontName,preventUIUpdate){var font=_fontDictionary[fontName];if(AV.util.addFontToPage&&AV.WebFont){_overlayController.hideCurrentOverlay();avpw$("#avpw_font_browser_preview").hide();AV.util.addFontToPage(font,function(font){if(preventUIUpdate){avpw$("#avpw_font_browser_preview").show();return}font=avpw$.extend(font,{value:font.value+(","+_DEFAULT_FONT.value)});_updateUIWithFont(font);avpw$("#avpw_font_browser_preview").show();AV.util.nextFrame(_overlayController.showCurrentOverlay)})}};var _addTextEntryOverlay=function(){_addHelpText();var w,h,ratio,offsetW,style;var randId=Math.floor(Math.random()*4294967295).toString(16);var id="text_overlay-"+randId;var textOverlayObject;var textOverlayElement=avpw$(AV.template[AV.launchData.layout].selectionOverlay({id:id,body:AV.template[AV.launchData.layout].textEntryOverlayBody()}));ratio=1;if(_controls.canvasUI){ratio=_controls.canvasUI.viewport.getRatio()}offsetW=_MINIMUM_TEXT_OVERLAY_WIDTH+2*_TEXT_OVERLAY_BORDER_WIDTH;style={left:(_controls.paintWidget.width/ratio-offsetW)/2+"px",top:_newOverlayTopOffset+"px",width:_MINIMUM_TEXT_OVERLAY_WIDTH+"px"};textOverlayElement.css(style);textOverlayObject={id:id,helpTextShown:false,initialCoordsX:0,initialCoordsY:0,element:textOverlayElement};_applyFontToText(textOverlayObject,_textFont);_applyFontToProxy(_textFont);_applySizeToText(textOverlayObject,_textSize||_DEFAULT_FONT_SIZE);_applySizeToProxy(_textSize||_DEFAULT_FONT_SIZE);_applyColorToText(textOverlayObject,_textColor||_presetsColor[0]);_applyOpacityToText(textOverlayObject,_textOpacity||1);_overlayController.newOverlay(textOverlayObject);_addHelpText();_updateNewOverlayTopOffset(true)};var _addTextEntryOverlayProxy=function(){_textOverlayProxy=avpw$(AV.template[AV.launchData.layout].textEntryOverlayProxy());_controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").append(_textOverlayProxy)};var _removeTextEntryOverlayProxy=function(){if(_textOverlayProxy&&_textOverlayProxy.length){_textOverlayProxy.remove()}};var _addTextToCanvas=function(textOverlay){var centerX,centerY,size,rotation,color,outlineColor,opacity,font,text;var ratio;text=textOverlay.text;if(!text||text===_DEFAULT_TEXT){return}ratio=AV.controlsWidgetInstance.canvasUI?AV.controlsWidgetInstance.canvasUI.viewport.getRatio():1;size=textOverlay.textSize*ratio+.5|0;rotation=textOverlay.rotation||0;color=textOverlay.textColor;if(textOverlay.textOutline){outlineColor=AV.util.color_is_light(textOverlay.textColor)?"#000000":"#ffffff"}opacity=textOverlay.textOpacity;font=textOverlay.textFont;centerX=textOverlay.centerX*ratio+.5|0;centerY=textOverlay.centerY*ratio+.5|0;_applySizeToProxy(textOverlay.textSize);_applyFontToProxy(textOverlay.textFont);_controls.paintWidget.module["textwithfont"].newText(text,font,size,size,color,outlineColor,opacity,centerX,centerY,rotation)};var _buildColorPreset=function(i){var color=_presetsColor[i];return AV.template[AV.launchData.layout].brushColorIcon({color:color})};var _deselectColor=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active")};var _setActive=function($el){_deselectColor();$el.addClass("avpw_preset_icon_active")};var _setColor=function(color){var shadowColor,outlineColor;if(color&&AV.util.color_is_light(color)){shadowColor="#000"}else{shadowColor="#fff"}if(AV.util.color_is_light(color)){outlineColor="#969696"}else{outlineColor="#fff"}_textColor=color;_applyColorToText(_overlayController.currentOverlay(),color)};var _colorClicked=function(ev){ev.preventDefault();var $el=avpw$(this);var color=$el.data("color");_setColor(color);_setActive($el);mediator.trigger("usage:interact","textwithfont","colorchanged",color)};var _colorPickerClicked=function(ev){ev.preventDefault();ev.stopPropagation();var element=ev.currentTarget;_colorPicker=AV.buildColorPicker(_textColor,element,function(color){_setColor(color);avpw$("#avpw_controlpanel_textwithfont").find(".avpw_isa_color_feedback").css("background",color);if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_setActive(avpw$(element))},function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}});if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}};var _setOutline=function(useOutline){var button=avpw$("#avpw_textwithfont_outline_toggle");if(useOutline){button.addClass(_ACTIVE_CHECKMARK_CLASS)}else{button.removeClass(_ACTIVE_CHECKMARK_CLASS)}_applyOutlineToText();_useOutline=useOutline};var _applyFontToFontSelector=function(font){font=font||_DEFAULT_FONT;avpw$("#avpw_font_browser_preview").css({"font-family":font.value,"font-style":font.style||"normal"});if(_fontDropdown){_fontDropdown.update(font.label)}};var _updateColorSelectedWithColor=function(color){var $el=avpw$("#avpw_textwithfont_colors").find(".avpw_isa_preset_color").filter('[data-color="'+color+'"]').eq(0);_setColor(color);if($el&&$el.length){_setActive($el)}else{$el=avpw$("#avpw_controlpanel_textwithfont").find(".avpw_isa_color_picker");_setActive($el)}};var _addTextClicked=function(ev){ev.preventDefault();var currentOverlay=_overlayController.currentOverlay();if(currentOverlay&&currentOverlay.element){currentOverlay.element.find(".avpw_textwithfont_entry").trigger("blur")}_addTextEntryOverlay();mediator.trigger("usage:interact","textwithfont","textadded")};var _setTextDimensionsFromOverlayData=function(overlay){if(overlay&&overlay.element){overlay.element.find(".avpw_textwithfont_entry").css({"font-family":overlay.textFont.value,"font-size":overlay.textSize+"px","font-style":overlay.textFont.style||"normal"})}};var _applyFontToText=function(overlayObject,font){overlayObject=overlayObject||_overlayController.currentOverlay();if(overlayObject){overlayObject.textFont=font;_drawPreviewText();_setTextDimensionsFromOverlayData(overlayObject)}};var _applyFontToProxy=function(font){font=font||_DEFAULT_FONT;if(_textOverlayProxy&&_textOverlayProxy.length){_textOverlayProxy.css({"font-family":font.value,"font-style":font.style||"normal"})}};var _applySizeToText=function(overlayObject,size){overlayObject=overlayObject||_overlayController.currentOverlay();if(overlayObject){overlayObject.textSize=size;_setTextDimensionsFromOverlayData(overlayObject);_drawPreviewText();_applyOutlineToText(overlayObject)}};var _applySizeToProxy=function(size){var textPadding;if(_textOverlayProxy&&_textOverlayProxy.length){textPadding=size||0;_textOverlayProxy.css({"font-size":size,padding:"0 "+textPadding+"px"})}};var _applyColorToText=function(overlayObject,color){overlayObject=overlayObject||_overlayController.currentOverlay();if(overlayObject){overlayObject.textColor=color;_drawPreviewText(overlayObject);if(overlayObject.mode===_textOverlayModes.EDIT_STATE){_applyOutlineToText(overlayObject,color);overlayObject.element.find(".avpw_textwithfont_entry").css("color",color)}}};var _applyOutlineToText=function(overlayObject,color){overlayObject=overlayObject||_overlayController.currentOverlay();if(overlayObject){color=color||overlayObject.textColor;var outlineStyle="";if(_useOutline){overlayObject.textOutline=true;if(color&&AV.util.color_is_light(color)){outlineStyle=AV.template[AV.launchData.layout].textEntryOutlineStyle({size:_TEXT_OUTLINE_FRACTION*overlayObject.textSize,color:"#000"})}else{outlineStyle=AV.template[AV.launchData.layout].textEntryOutlineStyle({size:_TEXT_OUTLINE_FRACTION*overlayObject.textSize,color:"#fff"})}}else{overlayObject.textOutline=false}_drawPreviewText();if(overlayObject.mode===_textOverlayModes.EDIT_STATE){overlayObject.element.find(".avpw_textwithfont_entry")[0].style.textShadow=outlineStyle}}};var _applyOpacityToText=function(overlayObject,opacity){overlayObject=overlayObject||_overlayController.currentOverlay();if(overlayObject){overlayObject.textOpacity=opacity}};var _drawPreviewTextSizeFromScale=function(scale){var newTextSize;var currentOverlay=_overlayController.currentOverlay();if(currentOverlay&&_textSizeAtScale1){newTextSize=_textSizeAtScale1*scale|0;_applySizeToText(currentOverlay,newTextSize);_applySizeToProxy(newTextSize)}};var _resizeCurrentTextEntryOverlayWithScale=function(scale){var topLeftX,topLeftY,width,aspectRatio,height;var currentOverlay=_overlayController.currentOverlay();if(currentOverlay){topLeftX=currentOverlay.topLeftX;topLeftY=currentOverlay.topLeftY;width=currentOverlay.width;aspectRatio=currentOverlay.aspectRatio;height=width*aspectRatio;currentOverlay.element.css({left:topLeftX-width*.5*(scale-1)+"px",top:topLeftY-height*.5*(scale-1)+"px",width:width*scale+"px",height:height*scale+"px"})}};var _setProxyText=function(text){if(_textOverlayProxy&&_textOverlayProxy.length){_textOverlayProxy.find(".avpw_proxy_get_height").html(" "+text+" ")}};var _applyStyleFromOverlayProxyToOverlay=function(overlay){var origLeft,origWidth,left,width,height,dw;if(overlay&&overlay.element&&_textOverlayProxy&&_textOverlayProxy.length){dims=_getOverlayProxyDimensions();width=dims.width||0;height=dims.height||0;origLeft=overlay.topLeftX;origWidth=overlay.width;dw=(origWidth-width)/2+.5|0;left=origLeft+dw;overlay.element.css({width:width+"px",left:left+"px",height:height+"px"})}};var _getOverlayProxyDimensions=function(){var dims={};var width,height;if(_textOverlayProxy&&_textOverlayProxy.length){width=_textOverlayProxy.outerWidth();height=_textOverlayProxy.find(".avpw_proxy_get_height").height();dims.height=height;dims.width=width}return dims};var _removeHelpText=function(){var currentOverlay=_overlayController.currentOverlay();var el;if(currentOverlay){el=currentOverlay.element.find(".avpw_textwithfont_entry");if(el&&el.length){el.val("");_setProxyText("");_applyStyleFromOverlayProxyToOverlay(currentOverlay);currentOverlay.helpTextShown=false;currentOverlay.element.removeClass(_TEXT_HELP_CLASS)}}};var _addHelpText=function(){var currentOverlay=_overlayController.currentOverlay();var el;if(currentOverlay){el=currentOverlay.element.find(".avpw_textwithfont_entry");if(el&&el.length){if(!el.val()){el.val(_DEFAULT_TEXT);_setProxyText(_DEFAULT_TEXT);_applyStyleFromOverlayProxyToOverlay(currentOverlay);currentOverlay.text=_DEFAULT_TEXT;currentOverlay.helpTextShown=true;currentOverlay.element.addClass(_TEXT_HELP_CLASS);_drawPreviewText()}}}};var _showEditableText=function(){var currentOverlay=_overlayController.currentOverlay();_applyColorToText(currentOverlay,_textColor||_presetsColor[0]);_applyOpacityToText(currentOverlay,_textOpacity||1)};var _hideEditableText=function(){var currentOverlay=_overlayController.currentOverlay();if(currentOverlay){currentOverlay.element.find(".avpw_textwithfont_entry").css({color:"transparent","text-shadow":""})}};var _textOverlayKeyDown=function(ev){var currentOverlay=_overlayController.currentOverlay();if(currentOverlay&&currentOverlay.mode===_textOverlayModes.EDIT_STATE){if(currentOverlay.helpTextShown){_removeHelpText()}}else{if(ev.target){avpw$(ev.target).trigger("blur")}}};var _textOverlayKeyUp=function(ev){var currentOverlay=_overlayController.currentOverlay();var text;if(currentOverlay){if(currentOverlay.helpTextShown){_removeHelpText()}text=currentOverlay.element.find(".avpw_textwithfont_entry").eq(0).val();currentOverlay.text=text;_setProxyText(text);if(_mouseDown||_sizeMouseDown){return}_applyStyleFromOverlayProxyToOverlay(currentOverlay);_overlayController.saveDimensions()}};var _trimOverlaySpace=function(){var currentOverlay=_overlayController.currentOverlay();if(currentOverlay){_applyStyleFromOverlayProxyToOverlay(currentOverlay)}};var _bindEvents=function(){avpw$("#avpw_controlpanel_textwithfont").delegate(".avpw_isa_preset_color","click",_colorClicked).delegate(".avpw_isa_color_picker","click",_colorPickerClicked);avpw$("#avpw_textwithfont_addtext").bind("click",_addTextClicked);_controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").delegate(".avpw_selection_overlay","keydown",_textOverlayKeyDown).delegate(".avpw_selection_overlay","keyup",_textOverlayKeyUp);avpw$("#avpw_controlpanel_textwithfont").find(".avpw_inset_button").pressed("avpw_inset_button_down")};var _unbindEvents=function(){avpw$("#avpw_controlpanel_textwithfont").undelegate(".avpw_isa_preset_color","click").undelegate(".avpw_isa_color_picker","click");avpw$("#avpw_textwithfont_addtext").unbind("click",_addTextClicked);_controls.layoutNotify(AV.launchData["openType"],"getCanvasControlsElement").undelegate(".avpw_selection_overlay","keydown").undelegate(".avpw_selection_overlay","keyup");avpw$("#avpw_controlpanel_textwithfont").find(".avpw_inset_button").unbind()};var _buildFontDictionary=function(){var i,len,font;_fontDictionary={};if(_presetsFont){len=_presetsFont.length;for(i=0;i<len;i++){font=_presetsFont[i];_fontDictionary[_presetsFont[i].label]=font}}};var _buildPresets=function(){var i,opts;var colorCount=_presetsColor.length;var html="";for(i=0;i<colorCount;i++){opts={color:_presetsColor[i]};html+=AV.template[AV.launchData.layout].brushColorIcon(opts)}avpw$("#avpw_textwithfont_colors").html(html)};var _updateNewOverlayTopOffset=function(drop){var change=2*_textSize+_OVERLAY_TOP_MARGIN;if(drop){_newOverlayTopOffset+=change}else{_newOverlayTopOffset-=change}if(_newOverlayTopOffset>_MAX_OVERLAY_TOP_MARGIN||_newOverlayTopOffset<0){_newOverlayTopOffset=_OVERLAY_TOP_MARGIN}};api.init=function(controls){_controls=controls;if(AV.launchData.textColorPresets){_presetsColor=AV.launchData.textColorPresets}_buildPresets();_buildFontDictionary();_fontDropdown=new AV.Dropdown({defaultValue:_DEFAULT_FONT.label,updateElement:avpw$("#avpw_font_browser"),popupElement:avpw$(AV.template[AV.launchData.layout].fontGroupPopup()),popupParent:avpw$("#avpw_controls"),items:_presetsFont,itemTemplate:AV.template[AV.launchData.layout].fontGroupPopupItem,onItemClicked:_addFontToPage});
_controls.layoutNotify(AV.launchData["openType"],"subscribeToResize",["buildTextWithFontPresets",function(){_buildPresets();if(_fontDropdown){_fontDropdown.position()}}]);_overlayController=new AV.OverlayController(controls,controls.paintWidget,{modes:_textOverlayModes,onModeChange:function(overlayObject,mode){if(!overlayObject.text){_addHelpText()}_hideEditableText();if(mode===_textOverlayModes.DRAG_STATE){_drawPreviewText();overlayObject.element.find(".avpw_textwithfont_entry").trigger("blur")}else if(mode===_textOverlayModes.EDIT_STATE){overlayObject.element.find(".avpw_textwithfont_entry").removeClass(_DISABLE_USER_SELECT_CLASS);_showEditableText()}},handlePosition:AV.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT})};var _loadCustomFonts=function(){if(!AV.customFontPresets){return}var newPresets=[];var fontList=AV.toolDefaults.textwithfont.presetsFont=AV.customFontPresets[0];if(!fontList)return;for(var i=0,l=fontList.length;i<l;i++){if(fontList[i]){newPresets.push(fontList[i])}}_presetsFont=newPresets;_buildFontDictionary();_fontDropdown.shutdown();var font;for(var i=0,l=fontList.length;i<l;i++){font=fontList[i];if(font){if(font.custom){_addFontToPage(font.label,true)}}}_fontDropdown=new AV.Dropdown({defaultValue:_DEFAULT_FONT.label,updateElement:avpw$("#avpw_font_browser"),popupElement:avpw$(AV.template[AV.launchData.layout].fontGroupPopup()),popupParent:avpw$("#avpw_controls"),items:_presetsFont,itemTemplate:AV.template[AV.launchData.layout].fontGroupPopupItem,onItemClicked:_addFontToPage})};var _restrictPresetFontsToSystemOnly=function(){if(AV.launchData.hiresUrl&&AV.launchData.hiresUrl!=""){var newPresets=[];var fontList=AV.toolDefaults.textwithfont.presetsFont;for(var i=0,l=fontList.length;i<l;i++){if(fontList[i]&&fontList[i]["system"]){newPresets.push(fontList[i])}}_presetsFont=newPresets;_fontDropdown.shutdown();_fontDropdown=new AV.Dropdown({defaultValue:_DEFAULT_FONT.label,updateElement:avpw$("#avpw_font_browser"),popupElement:avpw$(AV.template[AV.launchData.layout].fontGroupPopup()),popupParent:avpw$("#avpw_controls"),items:_presetsFont,itemTemplate:AV.template[AV.launchData.layout].fontGroupPopupItem,onItemClicked:_addFontToPage})}};api.panelWillOpen=function(){if(AV.launchData["enableCustomFonts"]){_loadCustomFonts()}_addHelpText();_mouseDown=false;_sizeMouseDown=false;_textFont=_DEFAULT_FONT;_textSize=_DEFAULT_FONT_SIZE;_textColor=_presetsColor[0];_applyFontToFontSelector(_textFont);_setOutline(_useOutline);if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}_bindEvents();if(avpw$.miniColors){AV.miniColors=new avpw$.miniColors}_addTextEntryOverlayProxy();_controls.layoutNotify(AV.launchData["openType"],"hideZoomButton");_controls.layoutNotify(AV.launchData["openType"],"showCanvasControlsElement");_controls.layoutNotify(AV.launchData["openType"],"scaleCanvas");_overlayController.activate();_newOverlayTopOffset=_OVERLAY_TOP_MARGIN};api.panelDidOpen=function(){avpw$("#avpw_controlpanel_textwithfont").find(".avpw_isa_color_feedback").css("background","");_addTextEntryOverlay();_updateColorSelectedWithColor(_textColor);if(_fontDropdown){_fontDropdown.position();_fontDropdown.update()}mediator.on("layout:resize",_onResize)};var _onResize=function(){if(_fontDropdown){_fontDropdown.position()}};api.panelWillClose=function(){_removeTextEntryOverlayProxy();_unbindEvents();if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}if(_colorPicker){_colorPicker.hideColorPicker();_colorPicker=null}AV.miniColors=null;if(_fontDropdown){_fontDropdown.hide()}_controls.layoutNotify(AV.launchData["openType"],"showZoomButton");_controls.layoutNotify(AV.launchData["openType"],"hideCanvasControlsElement");_overlayController.deactivate();mediator.off("layout:resize",_onResize)};api.shutdown=function(){if(_controls){_controls.layoutNotify(AV.launchData["openType"],"unsubscribeToResize",["buildTextWithFontPresets"])}if(_fontDropdown){_fontDropdown.shutdown();_fontDropdown=undefined}_controls=null;_fontDictionary=null};api.mouseDownEvent=function(coords,ev){return _overlayController.updateUIDown(coords,ev,function(overlayObject,isCurrentOverlay){if(isCurrentOverlay){overlayObject.element.find(".avpw_textwithfont_entry").removeClass(_DISABLE_USER_SELECT_CLASS)}_addHelpText()},function(overlayObject){_textSizeAtScale1=overlayObject.textSize},function(overlayObject){mediator.trigger("usage:interact","textwithfont","textremoved",overlayObject.text);if(_overlayController.isLastOverlayAdded(overlayObject)){_updateNewOverlayTopOffset()}})};api.mouseMoveEvent=function(coords,ev){_overlayController.updateUIMove(coords,ev,function(overlayObject){if(overlayObject.mode!==_textOverlayModes.EDIT_STATE){overlayObject.element.find(".avpw_textwithfont_entry").addClass(_DISABLE_USER_SELECT_CLASS)}if(overlayObject.wasMoved){overlayObject.element.find(".avpw_textwithfont_entry").trigger("blur")}},function(overlayObject,scale){scale=scale||1;_drawPreviewTextSizeFromScale(scale);_drawPreviewText()});return false};api.mouseUpEvent=function(coords,ev){_overlayController.apply(coords,ev,function(overlayObject,isCurrentOverlay,sizeWasDown){if(isCurrentOverlay){_updateColorSelectedWithColor(overlayObject.textColor);_applySizeToProxy(overlayObject.textSize);_setOutline(overlayObject.textOutline);_applyFontToFontSelector(overlayObject.textFont);_applyFontToProxy(overlayObject.textFont);if(overlayObject.text){_setProxyText(overlayObject.text)}else{_addHelpText()}_trimOverlaySpace();if(!sizeWasDown&&!overlayObject.wasMoved&&_overlayController.isLastOverlayAdded(overlayObject)){overlayObject.wasMoved=true;_updateNewOverlayTopOffset()}}else{if(overlayObject){overlayObject.element.find(".avpw_textwithfont_entry").trigger("blur")}}if(sizeWasDown){mediator.trigger("usage:interact","textwithfont","sizechanged",overlayObject?overlayObject.textSize:"")}})};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}};api.commit=function(){_overlayController.commit(_addTextToCanvas)};return api}();AV.ControlsWidget.prototype.tool["focus"]=function(){var _OVERLAY_WIDTH=150;var _OVERLAY_BORDER_WIDTH=10;var _controls;var _OVERLAY_MODES={OFF_STATE:0,DRAG_STATE:1};var _overlayController;var api={};var _overlayObject,_overlayElement;var _effectMode="circle";var _maxSize=30;var _sleepTimeout=-1;var _throttleId=-1;var _fadeInOverlay=function(){_overlayObject.element.stop().animate({opacity:1},100)};var _fadeOutOverlay=function(){_overlayObject.element.stop().animate({opacity:0},300)};var _setOverlayModeCircle=function(){avpw$(".avpw_tiltshift_circle_button").addClass("avpw_inset_button_down").siblings().removeClass("avpw_inset_button_down");_overlayElement.removeClass("avpw_tiltshift_rectangle").addClass("avpw_tiltshift_circle");_effectMode="circle";_overlayController.setHandlePosition(AV.OverlayController.HANDLE_POSITION.BOTTOM_CENTER);_resetOverlayPositionAndSize(-.785398163);applyEffect();mediator.trigger("usage:interact","focus","CircleClicked")};var _setOverlayModeRectangle=function(){avpw$(".avpw_tiltshift_rectangle_button").addClass("avpw_inset_button_down").siblings().removeClass("avpw_inset_button_down");_overlayElement.removeClass("avpw_tiltshift_circle").addClass("avpw_tiltshift_rectangle");_effectMode="rectangle";_overlayController.setHandlePosition(AV.OverlayController.HANDLE_POSITION.BOTTOM_CENTER);_resetOverlayPositionAndSize(0);applyEffect();mediator.trigger("usage:interact","focus","RectangleClicked")};var _resetOverlayPositionAndSize=function(rotation){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();_overlayObject.element.css({width:_OVERLAY_WIDTH,height:_OVERLAY_WIDTH,top:_controls.paintWidget.height/2/zoomScale-_OVERLAY_WIDTH/2,left:_controls.paintWidget.width/2/zoomScale-_OVERLAY_WIDTH/2});_overlayController.setRotation(_overlayObject,rotation);_overlayController.saveDimensions(_overlayObject)};var _addOverlay=function(x,y,sx,sy){var left,top;var w,h,ratio,offsetW,style;var randId=Math.floor(Math.random()*4294967295).toString(16);var id="avpw_tiltshift_overlay-"+randId;_overlayElement=avpw$(AV.template[AV.launchData.layout].selectionOverlay({id:id,body:'<div class="avpw_tiltshift_shape"></div>'})).addClass("avpw_tiltshift_overlay");ratio=1;if(_controls.canvasUI){ratio=_controls.canvasUI.viewport.getRatio()}offsetW=_OVERLAY_WIDTH+2*_OVERLAY_BORDER_WIDTH;left=x/ratio-offsetW/2;top=y/ratio-offsetW/2;style={left:left+"px",top:top+"px",width:_OVERLAY_WIDTH+"px",height:_OVERLAY_WIDTH+"px"};_overlayElement.css(style);_overlayObject={id:id,initialCoordsX:0,initialCoordsY:0,element:_overlayElement};_overlayController.newOverlay(_overlayObject)};var _shutDownUI=function(){};api.init=function(controls){_controls=controls;if(avpw$.support.touch){_fadeInOverlay=_fadeOutOverlay=function(){}}_maxSize=.1*_controls.paintWidget.width<_controls.paintWidget.height?_controls.paintWidget.width:_controls.paintWidget.height;if(AV.OverlayController){_overlayController=new AV.OverlayController(controls,controls.paintWidget,{modes:_OVERLAY_MODES,aspectRatio:1,handlePosition:AV.OverlayController.HANDLE_POSITION.BOTTOM_CENTER,forceDragMode:true,minimumOverlaySize:40,maximumOverlaySize:_maxSize})}};api.panelDidOpen=function(){_setOverlayModeCircle();mediator.trigger("usage:interact","focus","Opened");mediator.on("canvas:resize",applyEffect)};api.panelWillOpen=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api)}avpw$("#avpw_controlpanel_focus").delegate(".avpw_tiltshift_circle_button","mousedown",_setOverlayModeCircle).delegate(".avpw_tiltshift_rectangle_button","mousedown",_setOverlayModeRectangle);if(_overlayController){_overlayController.activate();var minDim=Math.min(_controls.paintWidget.width,_controls.paintWidget.height);if(minDim<_OVERLAY_WIDTH){_OVERLAY_WIDTH=minDim*.9;if(_OVERLAY_WIDTH<40)_OVERLAY_WIDTH=40}_addOverlay(_controls.paintWidget.width/2,_controls.paintWidget.height/2,100,100)}};api.panelWillClose=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api)}avpw$("#avpw_controlpanel_focus").undelegate();if(_overlayController){_overlayController.deactivate()}mediator.trigger("usage:interact","focus","Closed");mediator.off("canvas:resize",applyEffect)};api.shutdown=function(){_shutDownUI();_controls=null;mediator.off("canvas:resize",applyEffect)};var applyEffect=function(){var zoomScale=AV.controlsWidgetInstance.canvasUI.viewport.getRatio();var pos=_overlayObject.element.position();var element=_overlayObject.element[0],width=element?parseInt(element.style.width,10):0,height=element?avpw$(element).height():0,left=element?parseInt(element.style.left,10):0,top=element?parseInt(element.style.top,10):0;var x=(left+width/2)*zoomScale;var y=(top+height/2)*zoomScale;var radius=width/2*zoomScale-3;if(_effectMode=="circle"){_controls.paintWidget.module["focus"].applyRadialBlur(x,y,radius)}else if(_effectMode=="rectangle"){var angle=_overlayObject.rotation||0;var radius=height*zoomScale;_controls.paintWidget.module["focus"].applyLinearBlur(x,y,radius/2,-angle)}};var _throttleEffect=function(){if(AV.msie)return;window.clearTimeout(_throttleId);_throttleId=window.setTimeout(applyEffect,5)};api.mouseDownEvent=function(coords,ev){_fadeInOverlay();return _overlayController.updateUIDown(coords,ev,function(){},null,function(overlay){},function(){_fadeOutOverlay()})};api.mouseMoveEvent=function(coords,ev,withinCanvas){if(_overlayObject){_fadeInOverlay();window.clearTimeout(_sleepTimeout);_sleepTimeout=window.setTimeout(_fadeOutOverlay,900);_overlayController.updateUIMove(coords,null,null,_throttleEffect,_throttleEffect)}return false};api.mouseUpEvent=function(coords,ev){if(AV.msie){applyEffect()}_overlayController.apply(coords,ev)};api.onEnableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.unsubscribe(api);_fadeOutOverlay()}return false};api.onDisableZoomMode=function(){if(_controls.canvasUI){_controls.canvasUI.subscribe(api);_fadeInOverlay()}};api.cancel=function(){_controls.paintWidget.module["focus"].reset();mediator.trigger("usage:interact","focus","Canceled")};api.commit=function(){_controls.paintWidget.module["focus"].commit();mediator.trigger("usage:interact","focus","Applied",_effectMode)};api.onUndoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module["focus"].resetImageData();return false}};api.onRedoComplete=function(opts){if(opts&&opts.global){_controls.paintWidget.module["focus"].resetImageData();return false}};return api}();AV.ControlsWidget.prototype.tool["warmth"]=function(){var _controls;var _presets=AV.toolDefaults.warmth.presets;var _slider;var _defaultValue;var _lastValue;var _shouldReset=false;var api={};var sliderChanged=function(ev,ui){_lastValue=ui.value;_controls.paintWidget.module["warmth"].applyPreview(_lastValue,true)};api.init=function(controls){_defaultValue=0;_controls=controls;_slider=new _controls.Slider({element:document.getElementById("avpw_warmth_slider"),min:_presets[0],max:_presets[3],defaultValue:_defaultValue,delay:100,onchange:sliderChanged,onslide:sliderChanged})};api.cancel=function(){_shouldReset=false};api.panelWillOpen=function(){_lastValue=_defaultValue};api.panelDidOpen=function(){_slider.addListeners()};api.panelWillClose=function(){_slider.removeListeners()};api.panelDidClose=function(){if(_shouldReset){api.resetUI();_shouldReset=false}};api.onUndo=function(opts){if(!opts){api.resetUI()}_controls.paintWidget.module["warmth"].resetBacking()};api.onRedo=function(opts){if(!opts&&_slider){_slider.setValue(_lastValue)}};api.resetUI=function(){_slider.reset()};api.shutdown=function(){if(_slider){_slider.shutdown();_slider=undefined}_controls=null};return api}()}(window["AV"]||(window["AV"]={}),window,document);